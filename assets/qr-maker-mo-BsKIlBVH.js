import{r,j as e}from"./vendor-CRMzTT1s.js";import{B as a,P as R,a as g,au as gt,al as vt,am as mt,x as jt,y as ye,Y as bt,a1 as V,ao as wt,a9 as S,ap as ae,n as l,T as o,a3 as ne,a4 as re,af as yt,S as p,J as X,a7 as se,I as L,aq as Ce,ar as Re,aa as Se,as as Ct,at as Ie,av as ke,aw as Ee,a6 as We}from"./mui-COpd2GBn.js";import{u as Rt,Q as De,a as St}from"./qr-maker-controller-izNAdlJ4.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";const It=[{label:"L (7%)",value:"L"},{label:"M (15%)",value:"M"},{label:"Q (25%)",value:"Q"},{label:"H (30%)",value:"H"}],kt=[{label:"WPA/WPA2/3",value:"WPA"},{label:"WEP",value:"WEP"},{label:"Open (nopass)",value:"nopass"}],Et=[{label:"cover",value:"cover"},{label:"contain",value:"contain"},{label:"stretch",value:"stretch"}],ze=20,b={dark:"#000000",light:"#ffffff"},Wt=/^#([0-9a-fA-F]{6})$/,Dt=/^#([0-9a-fA-F]{3})$/,k=(f,w)=>{const u=f.trim();return Wt.test(u)?u.toLowerCase():Dt.test(u)?`#${u.slice(1).split("").map(v=>`${v}${v}`).join("").toLowerCase()}`:w},Pe=(f,w)=>k(f,w),Le={width:28,height:28,border:0,p:0,bgcolor:"transparent",cursor:"pointer","&::-webkit-color-swatch-wrapper":{p:0},"&::-webkit-color-swatch":{borderRadius:"50%",border:"1px solid rgba(0,0,0,0.2)"},"&::-moz-color-swatch":{borderRadius:"50%",border:"1px solid rgba(0,0,0,0.2)"}},i={size:"small",margin:"dense"},I={componentsProps:{typography:{variant:"body2"}}},Ft=()=>{const f=r.useRef(null),w=r.useRef(null),u=r.useRef(null),x=r.useRef(null),v=r.useRef(null),N=r.useRef(null),{mode:M,setMode:Me,textDraft:Ae,setTextDraft:Fe,vcardDraft:n,setVcardDraft:d,wifiDraft:h,setWifiDraft:A,isVCardValid:Te,isWifiValid:le,colorDark:F,setColorDark:E,colorLight:T,setColorLight:W,ecLevel:_e,setEcLevel:Oe,withIcon:Be,setWithIcon:Qe,iconImg:He,iconScale:ie,setIconScale:Ue,iconMargin:oe,setIconMargin:Ve,roundIcon:Xe,setRoundIcon:Ne,iconFit:$e,setIconFit:qe,errorMsg:ce,setErrorMsg:y,exportSize:Ge,setExportSize:Ke,exportSizeSafe:Ye,generateQR:Je,resetAll:Ze,handleIconFile:et,clearIcon:tt,downloadResult:at,drawToCanvas:_}=Rt(),[de,nt]=r.useState(()=>Math.max(1,window.devicePixelRatio||1)),[$,rt]=r.useState(320),[q,st]=r.useState(null),[G,lt]=r.useState("input"),[K,O]=r.useState(!1),[D,Y]=r.useState(!1),[z,ue]=r.useState(""),[xe,P]=r.useState(""),[B,J]=r.useState(!1);r.useEffect(()=>{let t=0,s=-1;const c=()=>{const C=f.current;if(!C)return;const we=C.getBoundingClientRect(),U=getComputedStyle(C),xt=(parseFloat(U.paddingLeft)||0)+(parseFloat(U.paddingRight)||0),ht=(parseFloat(U.paddingTop)||0)+(parseFloat(U.paddingBottom)||0),pt=Math.max(0,we.width-xt-ze*2),ft=Math.max(0,we.height-ht-ze*2),te=Math.floor(Math.max(120,Math.min(pt,ft)));Math.abs(te-s)>.5&&(s=te,rt(te))},j=new ResizeObserver(()=>{cancelAnimationFrame(t),t=requestAnimationFrame(c)});[f.current,w.current,f.current?.parentElement??null].forEach(C=>C&&j.observe(C));const me=()=>nt(Math.max(1,window.devicePixelRatio||1)),je=window.matchMedia(`(resolution: ${window.devicePixelRatio||1}dppx)`);je.addEventListener?.("change",me);const be=()=>{cancelAnimationFrame(t),t=requestAnimationFrame(c)};return c(),window.addEventListener("resize",be),()=>{j.disconnect(),je.removeEventListener?.("change",me),window.removeEventListener("resize",be),cancelAnimationFrame(t)}},[]);const Q=q??$,H=r.useMemo(()=>Math.round(Q*de),[Q,de]);r.useEffect(()=>{(async()=>{const s=u.current;if(s)try{await _(s,H),y("")}catch(c){y(c instanceof Error?c.message:"QR을 생성할 수 없습니다.")}})()},[_,H,y]),r.useEffect(()=>{if(!K)return;let t=0;return t=requestAnimationFrame(()=>{q===null&&st($);const s=u.current;s&&_(s,H).then(()=>y("")).catch(c=>{y(c instanceof Error?c.message:"QR을 생성할 수 없습니다.")})}),()=>cancelAnimationFrame(t)},[K,_,H,y,$,q]);const it=r.useMemo(()=>Pe(F,b.dark),[F]),ot=r.useMemo(()=>Pe(T,b.light),[T]),he=typeof window<"u"&&!!window.EyeDropper,ct=typeof window<"u"&&window.isSecureContext&&!!window.BarcodeDetector&&!!navigator.mediaDevices?.getUserMedia,pe=t=>{at(t,u.current)},fe=()=>{Je(),O(!0)},m=r.useCallback(()=>{v.current&&(v.current.getTracks().forEach(t=>t.stop()),v.current=null),x.current&&(x.current.srcObject=null),J(!1)},[]),Z=r.useCallback(async()=>{if(P(""),ue(""),!(typeof window>"u")){if(!window.isSecureContext){P("보안 연결(HTTPS)에서만 카메라를 사용할 수 있습니다.");return}if(!navigator.mediaDevices?.getUserMedia){P("카메라를 사용할 수 없습니다.");return}if(!window.BarcodeDetector){P("QR 스캔 기능을 지원하지 않는 브라우저입니다.");return}try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});v.current=t,x.current&&(x.current.srcObject=t,await x.current.play()),N.current=new window.BarcodeDetector({formats:["qr_code"]}),J(!0)}catch{P("카메라 권한이 필요합니다."),m()}}},[m]),dt=()=>{Y(!0)},ge=()=>{Y(!1)},ut=r.useCallback(t=>{try{const s=new URL(t);return s.protocol==="http:"||s.protocol==="https:"}catch{return!1}},[]);r.useEffect(()=>{if(!D){m();return}return Z(),()=>{m()}},[D,Z,m]),r.useEffect(()=>{if(!D||!B||!N.current)return;let t=!0;const s=setInterval(async()=>{if(!(!t||!x.current))try{const c=await N.current?.detect(x.current);if(!c||!c.length)return;const j=c[0]?.rawValue??"";if(!j)return;ue(j),J(!1),m()}catch{}},400);return()=>{t=!1,clearInterval(s)}},[D,B,m]);const ve=r.useCallback(async t=>{if(!(typeof window>"u"||!window.EyeDropper))try{const c=await new window.EyeDropper().open(),j=b[t],ee=k(c?.sRGBHex??"",j);t==="dark"?E(ee):W(ee)}catch(s){if(s instanceof DOMException&&s.name==="AbortError")return}},[E,W]);return e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:0,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden",boxSizing:"border-box"},children:[e.jsx(R,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:1},children:[ct&&e.jsx(g,{variant:"outlined",startIcon:e.jsx(gt,{}),onClick:dt,children:"QR 확인"}),e.jsx(g,{variant:"contained",startIcon:e.jsx(vt,{}),onClick:fe,children:"QR 생성"}),e.jsx(g,{variant:"outlined",startIcon:e.jsx(mt,{}),onClick:Ze,children:"초기화"})]})}),e.jsxs(R,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:[e.jsxs(jt,{value:G,onChange:(t,s)=>lt(s),variant:"fullWidth",sx:{minHeight:36},children:[e.jsx(ye,{value:"input",label:"입력",sx:{minHeight:36,py:.5,fontWeight:600}}),e.jsx(ye,{value:"options",label:"옵션",sx:{minHeight:36,py:.5,fontWeight:600}})]}),e.jsx(bt,{sx:{my:1}}),G==="input"&&e.jsxs(a,{children:[e.jsx(V,{sx:{mt:0},children:e.jsxs(wt,{row:!0,value:M,onChange:(t,s)=>Me(s??"text"),children:[e.jsx(S,{value:"text",control:e.jsx(ae,{size:"small"}),label:"텍스트 / URL",...I}),e.jsx(S,{value:"vcard",control:e.jsx(ae,{size:"small"}),label:"연락처 (vCard)",...I}),e.jsx(S,{value:"wifi",control:e.jsx(ae,{size:"small"}),label:"Wi-Fi",...I})]})}),M==="text"&&e.jsx(a,{mt:1,display:"flex",flexDirection:"column",gap:1,children:e.jsx(l,{...i,label:"텍스트 / URL",value:Ae,onChange:t=>Fe(t.target.value),fullWidth:!0,multiline:!0,minRows:3,helperText:"⌘/Ctrl + Enter 로 빠르게 생성",onKeyDown:t=>{(t.metaKey||t.ctrlKey)&&t.key==="Enter"&&(t.preventDefault(),fe())}})}),M==="vcard"&&e.jsxs(a,{mt:1,display:"flex",flexDirection:"column",gap:0,children:[e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"성",value:n.lastName,onChange:t=>d({...n,lastName:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"이름",value:n.firstName,onChange:t=>d({...n,firstName:t.target.value}),fullWidth:!0})]}),e.jsx(l,{...i,label:"회사/조직",value:n.org,onChange:t=>d({...n,org:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"직함",value:n.title,onChange:t=>d({...n,title:t.target.value}),fullWidth:!0}),e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"휴대전화",value:n.mobile,onChange:t=>d({...n,mobile:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"전화",value:n.phone,onChange:t=>d({...n,phone:t.target.value}),fullWidth:!0})]}),e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"이메일",value:n.email,onChange:t=>d({...n,email:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"웹사이트",value:n.url,onChange:t=>d({...n,url:t.target.value}),fullWidth:!0})]}),e.jsx(l,{...i,label:"주소",value:n.street,onChange:t=>d({...n,street:t.target.value}),fullWidth:!0}),e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"도시",value:n.city,onChange:t=>d({...n,city:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"지역/주",value:n.region,onChange:t=>d({...n,region:t.target.value}),fullWidth:!0})]}),e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"우편번호",value:n.postal,onChange:t=>d({...n,postal:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"국가",value:n.country,onChange:t=>d({...n,country:t.target.value}),fullWidth:!0})]}),e.jsx(l,{...i,label:"메모",value:n.note,onChange:t=>d({...n,note:t.target.value}),fullWidth:!0,multiline:!0,minRows:2}),!Te&&e.jsx(o,{variant:"caption",color:"error",children:"이름/회사 1개 이상과 전화·휴대전화·이메일 중 1개 이상을 입력하세요."})]}),M==="wifi"&&e.jsxs(a,{mt:1,display:"flex",flexDirection:"column",gap:0,children:[e.jsx(l,{...i,label:"SSID",value:h.ssid,onChange:t=>A({...h,ssid:t.target.value}),fullWidth:!0}),e.jsxs(a,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(V,{fullWidth:!0,margin:"dense",size:"small",children:e.jsx(ne,{value:h.security,onChange:t=>A({...h,security:t.target.value}),size:"small",children:kt.map(t=>e.jsx(re,{value:t.value,children:t.label},t.value))})}),e.jsx(l,{...i,label:"비밀번호",type:"password",value:h.password,onChange:t=>A({...h,password:t.target.value}),fullWidth:!0,disabled:h.security==="nopass"})]}),e.jsx(S,{...I,control:e.jsx(yt,{size:"small",checked:h.hidden,onChange:t=>A({...h,hidden:t.target.checked})}),label:"SSID 숨김"}),e.jsx(o,{variant:"caption",color:le?"success.main":"error",children:le?"Wi-Fi QR 생성 가능":"SSID와 비밀번호를 확인하세요."})]}),ce&&e.jsx(o,{variant:"body2",color:"error",mt:1,children:ce})]}),G==="options"&&e.jsxs(p,{spacing:1.25,children:[e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"QR",value:F,onChange:t=>E(t.target.value),onBlur:()=>E(k(F,b.dark)),InputProps:{startAdornment:e.jsx(X,{position:"start",children:e.jsx(Re,{fontSize:"small"})}),endAdornment:e.jsx(X,{position:"end",sx:{pl:1},children:e.jsxs(p,{direction:"row",spacing:.5,alignItems:"center",children:[he&&e.jsx(se,{title:"스포이드로 화면에서 색상 선택",children:e.jsx(L,{size:"small",onClick:()=>ve("dark"),"aria-label":"QR 색상 스포이드",children:e.jsx(Ce,{fontSize:"small"})})}),e.jsx(a,{component:"input",type:"color",value:it,onChange:t=>E(k(t.target.value,b.dark)),"aria-label":"QR color picker",title:"QR 색상 선택",sx:Le})]})})},fullWidth:!0}),e.jsx(l,{...i,label:"Background",value:T,onChange:t=>W(t.target.value),onBlur:()=>W(k(T,b.light)),InputProps:{startAdornment:e.jsx(X,{position:"start",children:e.jsx(Re,{fontSize:"small"})}),endAdornment:e.jsx(X,{position:"end",sx:{pl:1},children:e.jsxs(p,{direction:"row",spacing:.5,alignItems:"center",children:[he&&e.jsx(se,{title:"스포이드로 화면에서 색상 선택",children:e.jsx(L,{size:"small",onClick:()=>ve("light"),"aria-label":"Background 색상 스포이드",children:e.jsx(Ce,{fontSize:"small"})})}),e.jsx(a,{component:"input",type:"color",value:ot,onChange:t=>W(k(t.target.value,b.light)),"aria-label":"Background color picker",title:"Background 색상 선택",sx:Le})]})})},fullWidth:!0})]}),e.jsxs(V,{fullWidth:!0,children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"에러 보정(EC Level)"}),e.jsx(ne,{value:_e,onChange:t=>Oe(t.target.value),size:"small",children:It.map(t=>e.jsx(re,{value:t.value,children:t.label},t.value))})]}),e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,children:[e.jsx(S,{...I,control:e.jsx(Se,{size:"small",checked:Be,onChange:t=>Qe(t.target.checked)}),label:"아이콘 사용"}),e.jsx(S,{...I,control:e.jsx(Se,{size:"small",checked:Xe,onChange:t=>Ne(t.target.checked)}),label:"아이콘 둥글게",sx:{ml:0}})]}),e.jsxs(a,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(se,{title:"아이콘 업로드",children:e.jsxs(L,{component:"label",size:"small",children:[e.jsx(Ct,{}),e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>et(t.target.files?.[0]??null)})]})}),He&&e.jsx(g,{size:"small",onClick:tt,children:"아이콘 제거"})]}),e.jsxs(a,{children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"baseline",sx:{mb:.5},children:[e.jsx(o,{variant:"body2",children:"아이콘 크기"}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:[Math.round(ie*100),"%"]})]}),e.jsx(Ie,{value:ie,onChange:(t,s)=>Ue(s),min:.05,max:.35,step:.01})]}),e.jsxs(a,{children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"baseline",sx:{mb:.5},children:[e.jsx(o,{variant:"body2",children:"아이콘 여백"}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:[oe.toFixed(0),"px"]})]}),e.jsx(Ie,{value:oe,onChange:(t,s)=>Ve(s),min:0,max:20,step:1})]}),e.jsxs(V,{fullWidth:!0,children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"아이콘 맞춤"}),e.jsx(ne,{value:$e,onChange:t=>qe(t.target.value),size:"small",children:Et.map(t=>e.jsx(re,{value:t.value,children:t.label},t.value))})]})]})]}),e.jsx(ke,{anchor:"bottom",open:K,onOpen:()=>O(!0),onClose:()=>O(!1),disableDiscovery:!0,swipeAreaWidth:56,ModalProps:{keepMounted:!0},PaperProps:{sx:{borderTopLeftRadius:16,borderTopRightRadius:16,maxHeight:"80vh",height:"80vh",overflow:"hidden"}},children:e.jsxs(a,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(a,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",px:2,pt:1.5,pb:1},children:[e.jsx(a,{sx:{width:36,height:4,borderRadius:999,bgcolor:"divider",position:"absolute",left:"50%",top:8,transform:"translateX(-50%)"}}),e.jsx(o,{variant:"subtitle1",fontWeight:600,children:"QR 미리보기"}),e.jsx(L,{size:"small",onClick:()=>O(!1),children:e.jsx(Ee,{fontSize:"small"})})]}),e.jsx(a,{sx:{px:2,pb:2,overflowY:"auto"},children:e.jsxs(p,{spacing:1.25,children:[e.jsx(R,{ref:f,sx:{p:2,borderRadius:1,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",minHeight:320},children:e.jsx(a,{ref:w,sx:{width:`${Q}px`,height:`${Q}px`,maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("canvas",{ref:u,style:{width:"100%",height:"100%",imageRendering:"crisp-edges",display:"block",borderRadius:8,background:"#fff",boxShadow:"0 8px 24px rgba(0,0,0,0.06)"}})})}),e.jsx(R,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(p,{spacing:1,children:[e.jsx(l,{label:`내보내기 (최대 ${De.toLocaleString()}px)`,type:"number",value:Ge,onChange:t=>Ke(Number(t.target.value||St)),inputProps:{min:64,max:De,step:1.25},size:"small"}),e.jsxs(p,{direction:"row",spacing:1,children:[e.jsx(g,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(We,{}),onClick:()=>pe("png"),children:"PNG"}),e.jsx(g,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(We,{}),onClick:()=>pe("svg"),children:"SVG"})]}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:["결과 크기: ",Ye.toLocaleString(),"px"]})]})})]})})]})}),e.jsx(ke,{anchor:"bottom",open:D,onOpen:()=>Y(!0),onClose:ge,disableDiscovery:!0,swipeAreaWidth:56,ModalProps:{keepMounted:!0},PaperProps:{sx:{borderTopLeftRadius:16,borderTopRightRadius:16,maxHeight:"85vh",height:"85vh",overflow:"hidden"}},children:e.jsxs(a,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(a,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",px:2,pt:1.5,pb:1},children:[e.jsx(a,{sx:{width:36,height:4,borderRadius:999,bgcolor:"divider",position:"absolute",left:"50%",top:8,transform:"translateX(-50%)"}}),e.jsx(o,{variant:"subtitle1",fontWeight:600,children:"QR 확인"}),e.jsx(L,{size:"small",onClick:ge,children:e.jsx(Ee,{fontSize:"small"})})]}),e.jsx(a,{sx:{px:2,pb:2,overflowY:"auto"},children:e.jsxs(p,{spacing:1.25,children:[e.jsxs(R,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:[e.jsx(a,{sx:{width:"100%",aspectRatio:"3 / 4",borderRadius:1,overflow:"hidden",bgcolor:"grey.900",display:"flex",alignItems:"center",justifyContent:"center"},children:xe?e.jsx(o,{variant:"body2",color:"error",sx:{px:2,textAlign:"center"},children:xe}):e.jsx("video",{ref:x,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs(p,{direction:"row",spacing:1,sx:{mt:1},children:[e.jsx(g,{variant:"outlined",size:"small",onClick:Z,disabled:B,children:"다시 스캔"}),B&&e.jsx(o,{variant:"caption",color:"text.secondary",sx:{alignSelf:"center"},children:"스캔 중..."})]})]}),e.jsx(R,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(p,{spacing:1,children:[e.jsx(o,{variant:"subtitle2",children:"결과"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:z||"QR을 스캔하면 내용이 표시됩니다."}),e.jsx(g,{variant:"contained",size:"small",disabled:!z||!ut(z),onClick:()=>{z&&window.open(z,"_blank","noopener")},children:"링크 열기"})]})})]})})]})})]})};export{Ft as default};
