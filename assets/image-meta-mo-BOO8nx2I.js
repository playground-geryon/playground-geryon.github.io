import{j as e,r as k}from"./vendor-CRMzTT1s.js";import{a as Pe,b as Y,u as Ee}from"./image-meta-utils-C81JK1o9.js";import{P as R,a as f,x as Re,B as c,bm as Ne,I as b,N as O,bt as Le,bl as ee,bi as $e,bu as Ae,bv as Ze,T as r,S as C,y as _e,z as J,g as Ge,bj as He,bk as Xe,o as N,L as Qe,_ as Ue,d as qe,l as L,m as $,n as A,p as Z,bp as Ve,a4 as M,bq as P,as as K,ab as j,at as z,br as E,ak as g,bs as Ye,C as Je}from"./mui-CAFjvBaw.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";const Ke=({imagesCount:n,selectionMode:s,deleteLabel:l,deleteDisabled:t,onPickFiles:h,onDelete:x,onOpenExport:i,onToggleSelectionMode:o})=>e.jsxs(R,{sx:{p:1.25,borderRadius:1,display:"flex",flexDirection:"column",gap:1.25,overflow:"hidden",width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:[e.jsx(f,{variant:"contained",startIcon:e.jsx(Re,{}),onClick:h,fullWidth:!0,children:"이미지 추가"}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(f,{variant:"outlined",startIcon:e.jsx(Ne,{}),onClick:i,disabled:!n,size:"small",children:"내보내기"}),e.jsxs(c,{sx:{ml:"auto",display:"flex",alignItems:"center",gap:1},children:[e.jsx(f,{variant:"text",color:"error",onClick:x,disabled:t,size:"small",children:l}),s?e.jsx(b,{onClick:o,disabled:!n,size:"small","aria-label":"선택 해제",children:e.jsx(O,{})}):e.jsx(f,{variant:"outlined",onClick:o,disabled:!n,size:"small",children:"선택"})]})]})]}),le=k.memo(({image:n,index:s,selected:l,selectionMode:t,onSelect:h,onToggleSelect:x,onRemove:i,onPreview:o})=>e.jsxs(c,{sx:{width:108,minWidth:108,flex:"0 0 108px"},children:[e.jsxs(c,{sx:{position:"relative",borderRadius:1,overflow:"hidden",border:l?"2px solid":"1px solid",borderColor:l?"primary.main":"divider"},children:[e.jsx(Le,{onClick:()=>t?x(n):h(n),sx:{width:"100%",display:"block"},children:e.jsx(c,{component:"img",src:n.preview,alt:n.file.name,loading:"lazy",decoding:"async",sx:{width:"100%",height:88,display:"block",objectFit:"cover"}})}),t?e.jsx(b,{size:"small",onClick:()=>x(n),sx:{position:"absolute",right:4,bottom:4,bgcolor:"rgba(0,0,0,0.45)",color:"#fff","&:hover":{bgcolor:"rgba(0,0,0,0.6)"}},children:l?e.jsx(Ae,{fontSize:"small"}):e.jsx(Ze,{fontSize:"small"})}):e.jsxs(e.Fragment,{children:[e.jsx(b,{size:"small",onClick:()=>o(n),sx:{position:"absolute",left:4,bottom:4,bgcolor:"rgba(0,0,0,0.45)",color:"#fff","&:hover":{bgcolor:"rgba(0,0,0,0.6)"}},children:e.jsx(ee,{fontSize:"small"})}),e.jsx(b,{size:"small",onClick:()=>i(s),sx:{position:"absolute",right:4,top:4,bgcolor:"rgba(0,0,0,0.45)",color:"#fff","&:hover":{bgcolor:"rgba(0,0,0,0.6)"}},children:e.jsx($e,{fontSize:"small"})})]})]}),e.jsx(c,{sx:{height:0}})]}));le.displayName="ImageListItem";const Oe=({images:n,selectedImage:s,selectionMode:l,selectedImageIds:t,onSelect:h,onToggleSelect:x,onRemove:i,onPreview:o})=>e.jsx(R,{sx:{p:1.25,borderRadius:1,overflow:"hidden",width:"100%",maxWidth:"100%",minWidth:0,boxSizing:"border-box"},children:n.length?e.jsx(c,{sx:{width:"100%",maxWidth:"100%",minWidth:0,overflowX:"auto",overflowY:"hidden",WebkitOverflowScrolling:"touch",overscrollBehaviorX:"contain",pb:.5,display:"block",position:"relative",minHeight:88},children:e.jsx(c,{sx:{display:"grid",gridAutoFlow:"column",gridAutoColumns:"108px",gap:1,width:120,paddingRight:8,alignItems:"start"},children:n.map((m,a)=>{const F=l?t.has(m.preview):s===m;return e.jsx(le,{image:m,index:a,selected:F,selectionMode:l,onSelect:h,onToggleSelect:x,onRemove:i,onPreview:o},`${m.file.name}-${a}`)})})}):e.jsx(r,{variant:"body2",color:"text.secondary",children:"아직 추가된 이미지가 없습니다."})}),el=({selectedImage:n,detailTab:s,onTabChange:l,searchQuery:t,onSearchChange:h,filteredMeta:x,onEditComment:i})=>e.jsxs(C,{spacing:1.5,children:[e.jsxs(_e,{value:s,onChange:(o,m)=>l(m),variant:"fullWidth",sx:{mb:1,minHeight:36},children:[e.jsx(J,{label:"기본정보",sx:{minHeight:36,py:.5,fontWeight:600}}),e.jsx(J,{label:"메타데이터",sx:{minHeight:36,py:.5,fontWeight:600}})]}),s===0?n?e.jsxs(C,{spacing:1.5,children:[e.jsx(Ge,{}),e.jsxs(C,{spacing:1.5,children:[e.jsxs(c,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,display:"block"},children:"파일명"}),e.jsx(r,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{textOverflow:"ellipsis",overflow:"hidden"},children:n.file.name})]}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:1},children:[e.jsxs(c,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,display:"block"},children:"파일 크기"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:Pe(n.file.size)})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,display:"block"},children:"파일 형식"}),e.jsx(r,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{textOverflow:"ellipsis",overflow:"hidden"},children:n.file.type||"N/A"})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,display:"block"},children:"이미지 크기"}),e.jsx(r,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{textOverflow:"ellipsis",overflow:"hidden"},children:`${n.width} x ${n.height}`})]})]}),e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:1},children:[e.jsxs(c,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,display:"block"},children:"생성일"}),e.jsx(r,{variant:"caption",color:"text.secondary",sx:{wordBreak:"break-all"},children:Y(n.createdDate)})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,display:"block"},children:"촬영일"}),e.jsx(r,{variant:"caption",color:"text.secondary",sx:{wordBreak:"break-all"},children:Y(n.takenDate)})]})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,display:"block"},children:"Google Maps"}),n.gpsLocation?e.jsx(He,{href:n.gpsLocation,target:"_blank",rel:"noreferrer",sx:{display:"inline-block",maxWidth:"100%",wordBreak:"break-all"},children:"위치 열기"}):e.jsx(r,{variant:"caption",color:"text.secondary",children:"N/A"})]}),e.jsxs(c,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(r,{variant:"caption",color:"text.secondary",sx:{fontWeight:700,display:"block"},children:"코멘트"}),e.jsx(b,{size:"small",onClick:i,"aria-label":"코멘트 편집",children:e.jsx(Xe,{fontSize:"inherit",sx:{fontSize:16}})})]}),e.jsx(r,{variant:"caption",color:"text.secondary",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:n.comment?.trim()?n.comment:"작성된 코멘트가 없습니다."})]})]})]}):e.jsx(r,{variant:"body2",color:"text.secondary",children:"이미지가 선택되지 않았습니다."}):null,s===1?e.jsxs(C,{spacing:1.5,children:[e.jsx(N,{size:"small",placeholder:"키워드로 검색",value:t,onChange:o=>h(o.target.value)}),n?x.length?e.jsx(Qe,{sx:{p:0},children:x.map(o=>e.jsx(Ue,{disablePadding:!0,sx:{py:.5},children:e.jsx(qe,{primary:o.key,secondary:o.value,primaryTypographyProps:{variant:"caption",color:"text.secondary",sx:{fontWeight:700}},secondaryTypographyProps:{variant:"caption",color:"text.secondary",sx:{wordBreak:"break-all"}},sx:{minWidth:0}})},`${o.key}-${o.value}`))}):e.jsx(r,{variant:"body2",color:"text.secondary",children:"표시할 메타데이터가 없습니다."}):e.jsx(r,{variant:"body2",color:"text.secondary",children:"이미지를 선택해 메타데이터를 확인하세요."})]}):null]}),ll=({open:n,selectedImage:s,viewOriginalSize:l,modalZoom:t,zoomPercent:h,onToggleOriginalSize:x,onZoomOut:i,onZoomIn:o,onClose:m})=>e.jsxs(L,{open:n,onClose:m,fullScreen:!0,children:[e.jsxs($,{children:["이미지 미리보기",e.jsx(b,{"aria-label":"close",onClick:m,sx:{position:"absolute",right:8,top:8},children:e.jsx(O,{})})]}),e.jsx(A,{dividers:!0,sx:{p:1},children:e.jsx(c,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",overflow:"auto"},children:s?e.jsx(c,{component:"img",src:s.preview,alt:s.file.name,sx:{width:l?`${s.width*t}px`:`${t*100}%`,height:l?`${s.height*t}px`:"auto",maxWidth:l?"none":`${t*100}%`,maxHeight:!l&&t<=1?"100%":"none",objectFit:"contain",transition:"width 0.2s ease, height 0.2s ease"}}):e.jsx(r,{variant:"body2",children:"선택된 이미지가 없습니다."})})}),e.jsxs(Z,{sx:{justifyContent:"space-between"},children:[e.jsx(f,{onClick:x,children:l?"화면 맞춤":"원본 크기"}),e.jsxs(C,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(b,{onClick:i,children:e.jsx(Ve,{})}),e.jsxs(r,{variant:"caption",children:[h,"%"]}),e.jsx(b,{onClick:o,children:e.jsx(ee,{})})]})]})]}),nl=({open:n,exportDialogType:s,exportOptions:l,selectionLabel:t,canSelectCurrent:h,onChangeExportType:x,onChangeOptions:i,onClose:o,onConfirm:m})=>e.jsxs(L,{open:n,onClose:o,fullWidth:!0,maxWidth:"sm",children:[e.jsx($,{children:"내보내기 옵션"}),e.jsx(A,{dividers:!0,children:e.jsxs(C,{spacing:1.25,children:[e.jsx(N,{label:"파일명",fullWidth:!0,size:"small",value:l.fileName,onChange:a=>i({...l,fileName:a.target.value}),helperText:s==="excel"?"확장자는 자동으로 .xlsx 로 저장됩니다.":"확장자는 자동으로 .pdf 로 저장됩니다."}),e.jsxs(M,{children:[e.jsx(P,{children:"형식"}),e.jsxs(K,{row:!0,value:s??"pdf",onChange:a=>x(a.target.value),children:[e.jsx(j,{value:"pdf",control:e.jsx(z,{}),label:"PDF"}),e.jsx(j,{value:"excel",control:e.jsx(z,{}),label:"EXCEL"})]})]}),e.jsxs(M,{children:[e.jsx(P,{children:"대상"}),e.jsxs(K,{row:!0,value:l.scope,onChange:a=>i({...l,scope:a.target.value}),children:[e.jsx(j,{value:"all",control:e.jsx(z,{}),label:"전체 이미지"}),e.jsx(j,{value:"selected",control:e.jsx(z,{}),label:t,disabled:!h})]})]}),e.jsxs(M,{component:"fieldset",variant:"standard",children:[e.jsx(P,{children:"포함 항목"}),e.jsxs(E,{children:[e.jsx(j,{control:e.jsx(g,{checked:l.includeBasicInfo,onChange:a=>i({...l,includeBasicInfo:a.target.checked})}),label:"파일 기본 정보"}),e.jsx(j,{control:e.jsx(g,{checked:l.includeMetadata,onChange:a=>i({...l,includeMetadata:a.target.checked})}),label:"메타데이터 전체"})]}),l.includeBasicInfo?e.jsxs(E,{children:[e.jsx(j,{control:e.jsx(g,{checked:l.includeFileName,onChange:a=>i({...l,includeFileName:a.target.checked})}),label:"파일명"}),e.jsx(j,{control:e.jsx(g,{checked:l.includeFileSize,onChange:a=>i({...l,includeFileSize:a.target.checked})}),label:"파일 크기"}),e.jsx(j,{control:e.jsx(g,{checked:l.includeFileType,onChange:a=>i({...l,includeFileType:a.target.checked})}),label:"파일 형식"}),e.jsx(j,{control:e.jsx(g,{checked:l.includeDimensions,onChange:a=>i({...l,includeDimensions:a.target.checked})}),label:"이미지 해상도"})]}):null,l.includeBasicInfo?e.jsxs(E,{children:[e.jsx(j,{control:e.jsx(g,{checked:l.includeComment,onChange:a=>i({...l,includeComment:a.target.checked})}),label:"코멘트"}),e.jsx(j,{control:e.jsx(g,{checked:l.includeGps,onChange:a=>i({...l,includeGps:a.target.checked})}),label:"위치 링크"}),e.jsx(j,{control:e.jsx(g,{checked:l.includeCreateDate,onChange:a=>i({...l,includeCreateDate:a.target.checked})}),label:"생성 일시"}),e.jsx(j,{control:e.jsx(g,{checked:l.includeTakenDate,onChange:a=>i({...l,includeTakenDate:a.target.checked})}),label:"촬영 일시"})]}):null]})]})}),e.jsxs(Z,{children:[e.jsx(f,{onClick:o,children:"취소"}),e.jsx(f,{variant:"contained",onClick:m,children:s==="excel"?"Excel 다운로드":"PDF 다운로드"})]})]}),al=({open:n,commentInput:s,onChange:l,onClose:t,onSave:h,saveDisabled:x})=>e.jsxs(L,{open:n,onClose:t,fullWidth:!0,maxWidth:"sm",children:[e.jsx($,{children:"Comment"}),e.jsx(A,{dividers:!0,children:e.jsx(N,{multiline:!0,minRows:4,fullWidth:!0,autoFocus:!0,value:s,onChange:i=>l(i.target.value),placeholder:"이미지에 대한 메모를 입력하세요."})}),e.jsxs(Z,{children:[e.jsx(f,{onClick:t,children:"취소"}),e.jsx(f,{variant:"contained",onClick:h,disabled:x,children:"저장"})]})]}),cl=()=>{const{fileInputRef:n,images:s,selectedImage:l,setSelectedImage:t,searchQuery:h,setSearchQuery:x,isModalOpen:i,setIsModalOpen:o,viewOriginalSize:m,setViewOriginalSize:a,isExporting:F,isCommentDialogOpen:ne,setIsCommentDialogOpen:T,commentInput:_,setCommentInput:G,handleFiles:ae,handleRemoveImage:se,handleRemoveImagesByPreview:ie,handleClearAllImages:te,handleDownloadPDFForTargets:oe,handleDownloadExcelForTargets:re,filteredMeta:ce,saveCommentForSelected:de,modalZoom:H,setModalZoom:S}=Ee(),[I,B]=k.useState(null),[xe,X]=k.useState(0),[v,Q]=k.useState(!1),[y,D]=k.useState(new Set),he=d=>{t(d),X(0)},ue=()=>{Q(d=>{const u=!d;return u||D(new Set),u})},je=d=>{D(u=>{const p=new Set(u);return p.has(d.preview)?p.delete(d.preview):p.add(d.preview),p})},me=()=>{y.size&&(ie(y),D(new Set))},ge=v?"선택 삭제":"전체 삭제",pe=v?me:te,fe=v?!y.size:!s.length,be=d=>{t(d),S(1),a(!1),o(!0)},[W,ve]=k.useState({scope:"all",includeBasicInfo:!0,includeMetadata:!0,fileName:"images_metadata",includeFileName:!0,includeFileSize:!0,includeFileType:!0,includeDimensions:!0,includeGps:!0,includeCreateDate:!0,includeTakenDate:!0,includeComment:!0}),U=.25,ye=.5,ke=4,Ce=Math.round(H*100),q=d=>{S(u=>{const p=Math.min(ke,Math.max(ye,u+d));return Number(p.toFixed(2))})},we=()=>q(U),Se=()=>q(-U),Ie=()=>{a(d=>{const u=!d;return u||S(1),u})},De=()=>{o(!1),a(!1),S(1)},We=()=>{l&&(G(l.comment??""),T(!0))},ze=()=>{de(_),T(!1)},Fe=()=>{B("pdf"),l&&(Q(!0),D(d=>{const u=new Set(d);return u.add(l.preview),u}))},V=()=>{B(null)},Te=()=>{if(!I)return;const d=W.fileName.trim()||"images_metadata",u=W.scope,p={...W,fileName:d,scope:u};let w=[];u==="all"?w=s:v&&y.size>0?w=s.filter(Me=>y.has(Me.preview)):l&&(w=[l]),I==="pdf"?oe(w,p):re(w,p),V()},Be=()=>{n.current?.click()};return e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:1.25,alignItems:"stretch",width:"100%",maxWidth:"100vw",minWidth:0,overflowX:"hidden",boxSizing:"border-box"},children:[e.jsx(Ke,{imagesCount:s.length,selectionMode:v,deleteLabel:ge,deleteDisabled:fe,onPickFiles:Be,onDelete:pe,onOpenExport:Fe,onToggleSelectionMode:ue}),e.jsx("input",{ref:n,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:d=>ae(d.target.files)}),e.jsx(Oe,{images:s,selectedImage:l,selectionMode:v,selectedImageIds:y,onSelect:he,onToggleSelect:je,onRemove:se,onPreview:be}),e.jsx(R,{sx:{p:1.5,borderRadius:1,overflow:"hidden",width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:e.jsx(el,{selectedImage:l,detailTab:xe,onTabChange:X,searchQuery:h,onSearchChange:x,filteredMeta:ce,onEditComment:We})}),e.jsx(ll,{open:i,selectedImage:l,viewOriginalSize:m,modalZoom:H,zoomPercent:Ce,onToggleOriginalSize:Ie,onZoomOut:Se,onZoomIn:we,onClose:De}),e.jsx(nl,{open:!!I,exportDialogType:I,exportOptions:W,selectionLabel:v&&y.size>0?"선택한 이미지":"현재 이미지",canSelectCurrent:!!l,onChangeExportType:B,onChangeOptions:ve,onClose:V,onConfirm:Te}),e.jsx(al,{open:ne,commentInput:_,onChange:G,onClose:()=>T(!1),onSave:ze,saveDisabled:!l}),e.jsx(Ye,{open:F,sx:{color:"#fff",zIndex:d=>d.zIndex.modal+1},children:e.jsx(Je,{color:"inherit"})})]})};export{cl as default};
