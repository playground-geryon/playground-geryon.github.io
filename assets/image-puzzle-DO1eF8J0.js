import{r as n,j as e}from"./vendor-CRMzTT1s.js";import{S as x,B as o,T as h,a as m,P as X,at as B,am as xe,aM as ge,a7 as me,I as fe,bD as be}from"./mui-COpd2GBn.js";import{u as je}from"./image-puzzle-control-BrwZCmuE.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";const ve=(r,a,c,l)=>{const s=[],y=r/3,k=a/3;if(s.push("M 0 0"),s.push(`L ${y} 0`),l.top!==0){const d=-l.top*c;s.push(`Q ${r/2} ${d} ${2*r/3} 0`)}else s.push(`L ${2*r/3} 0`);if(s.push(`L ${r} 0`),s.push(`L ${r} ${k}`),l.right!==0){const d=l.right*c;s.push(`Q ${r+d} ${a/2} ${r} ${2*a/3}`)}else s.push(`L ${r} ${2*a/3}`);if(s.push(`L ${r} ${a}`),s.push(`L ${2*r/3} ${a}`),l.bottom!==0){const d=l.bottom*c;s.push(`Q ${r/2} ${a+d} ${r/3} ${a}`)}else s.push(`L ${r/3} ${a}`);if(s.push(`L 0 ${a}`),s.push(`L 0 ${2*a/3}`),l.left!==0){const d=-l.left*c;s.push(`Q ${d} ${a/2} 0 ${a/3}`)}else s.push(`L 0 ${a/3}`);return s.push("Z"),s.join(" ")},De=()=>{const{imageSrc:r,rows:a,cols:c,pieces:l,board:s,placements:y,trayPieces:k,draggingId:d,solved:E,handleFileInput:T,setRows:ee,setCols:te,shufflePieces:ie,resetPlacements:se,placePiece:F,removePlacement:re,startDrag:O,endDrag:A,acknowledgeSolved:Q}=je(),[V,_]=n.useState(!1),[Z,N]=n.useState(!0),D=n.useRef(null),[w,S]=n.useState(1),[U,Y]=n.useState(1),[I,H]=n.useState("fit");n.useEffect(()=>{_(!1),N(!0),H("fit"),Y(1)},[r]),n.useEffect(()=>{if(!E)return;const t=setTimeout(()=>{alert("축하합니다! 퍼즐을 모두 맞췄어요."),Q()},200);return()=>clearTimeout(t)},[E,Q]);const ne=n.useCallback(t=>i=>{i.dataTransfer.setData("text/plain",t),O(t)},[O]),oe=n.useCallback(()=>{A()},[A]),W=n.useCallback(t=>{t.preventDefault()},[]),ae=n.useCallback((t,i)=>u=>{u.preventDefault();const g=u.dataTransfer.getData("text/plain")||d;g&&F(g,t,i)},[d,F]),P=n.useCallback(t=>{t&&T(t)},[T]),q=n.useCallback(t=>{t.preventDefault();const i=t.dataTransfer?.files?.[0];P(i)},[P]),G=n.useRef(null),le=n.useCallback(()=>{H("original"),S(1)},[]),ce=n.useCallback(()=>{H("fit"),S(U||1)},[U]),de=n.useCallback((t,i)=>{const u=Array.isArray(i)?i[0]:i;H("custom"),S(u)},[]),f=s?.width??400,b=s?.height??400,j=s?.pieceWidth??f/Math.max(1,c),v=s?.pieceHeight??b/Math.max(1,a),p=s?.tabSize??0,J=s?.paddedWidth??j,K=s?.paddedHeight??v,pe=f*w,ue=b*w,z=.25,R=5,he=n.useMemo(()=>l.map(t=>({id:t.id,row:t.row,col:t.col,path:ve(j,v,p,t)})),[l,j,v,p]),M=n.useCallback(()=>{if(!D.current||!f||!b)return;const{clientWidth:t,clientHeight:i}=D.current;if(!t||!i)return;const u=t/f,g=i/b,C=Math.min(u,g),$=Math.min(Math.max(C,z),R);!Number.isFinite($)||$<=0||(Y($),I==="fit"&&S($))},[f,b,I,z,R]);return n.useEffect(()=>{M()},[M]),n.useEffect(()=>{if(typeof ResizeObserver>"u")return;const t=D.current;if(!t)return;const i=new ResizeObserver(()=>M());return i.observe(t),()=>i.disconnect()},[M]),e.jsxs(x,{spacing:2,sx:{height:"100%",minHeight:600},children:[e.jsxs(x,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(o,{children:[e.jsx(h,{variant:"h5",fontWeight:700,children:"이미지 퍼즐"}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"이미지를 업로드하고 조각을 맞춰 보세요. 모든 조각을 올바르게 배치하면 축하 메시지를 보여줍니다."})]}),r&&e.jsxs(x,{direction:"row",spacing:1,children:[e.jsx(m,{variant:"outlined",onClick:()=>_(t=>!t),children:V?"힌트 숨기기":"힌트 보기"}),e.jsx(m,{variant:"outlined",onClick:()=>N(t=>!t),children:Z?"배경 숨기기":"배경 보이기"})]})]}),e.jsxs(x,{direction:"row",spacing:2,sx:{flex:1,minHeight:0},children:[e.jsxs(X,{sx:{width:360,flexShrink:0,p:2,display:"flex",flexDirection:"column",gap:2,minHeight:0},children:[e.jsx("input",{ref:G,hidden:!0,type:"file",accept:"image/*",onChange:t=>{P(t.target.files?.[0]),t.target.value=""}}),e.jsxs(o,{children:[e.jsx(h,{variant:"subtitle2",gutterBottom:!0,children:"퍼즐 크기 (행 / 열)"}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(h,{variant:"body2",children:"행"}),e.jsx(B,{min:2,max:30,value:a,onChange:(t,i)=>ee(i),valueLabelDisplay:"auto"})]}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(h,{variant:"body2",children:"열"}),e.jsx(B,{min:2,max:30,value:c,onChange:(t,i)=>te(i),valueLabelDisplay:"auto"})]})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{direction:"row",spacing:1,children:[e.jsx(m,{size:"small",variant:I==="original"?"contained":"outlined",onClick:le,children:"원본 사이즈"}),e.jsx(m,{size:"small",variant:I==="fit"?"contained":"outlined",onClick:ce,children:"화면에 맞추기"})]}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",sx:{mt:1},children:[e.jsx(h,{variant:"caption",color:"text.secondary",sx:{width:48,textAlign:"center"},children:`${Math.round(w*100)}%`}),e.jsx(B,{size:"small",min:z,max:R,step:.01,value:Math.min(Math.max(w,z),R),onChange:de})]})]}),e.jsxs(x,{direction:"row",spacing:1,children:[e.jsx(m,{fullWidth:!0,startIcon:e.jsx(xe,{}),onClick:ie,children:"퍼즐 섞기"}),e.jsx(m,{fullWidth:!0,variant:"outlined",onClick:se,children:"초기화"})]}),e.jsxs(o,{sx:{flex:1,minHeight:0},children:[e.jsx(h,{variant:"subtitle2",gutterBottom:!0,children:"퍼즐 조각"}),e.jsx(o,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,p:1,minHeight:160,maxHeight:640,overflowY:"auto",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(90px, 1fr))",gap:1},children:k.length===0?e.jsx(h,{variant:"caption",color:"text.secondary",children:"남은 조각이 없습니다."}):k.map(t=>e.jsx(o,{draggable:!0,onDragStart:ne(t.id),onDragEnd:oe,sx:{border:"1px solid",borderColor:d===t.id?"primary.main":"divider",borderRadius:1,p:.5,bgcolor:"background.paper",cursor:"grab"},children:e.jsx("img",{src:t.image,alt:"조각",style:{width:"100%",display:"block"}})},t.id))})]})]}),e.jsx(X,{sx:{flex:1,minHeight:0,p:1.25,display:"flex",flexDirection:"column",gap:2},children:r?e.jsx(e.Fragment,{children:e.jsxs(o,{sx:{minHeight:0,display:"flex",flexDirection:"column",position:"relative",gap:1},children:[V&&e.jsx(o,{sx:{position:"absolute",top:16,right:16,border:"1px solid",borderColor:"divider",borderRadius:1,overflow:"hidden",width:160,boxShadow:t=>t.shadows[2],bgcolor:"background.paper",zIndex:5},children:e.jsx("img",{src:r,alt:"원본",style:{width:"100%",display:"block"}})}),e.jsx(o,{ref:D,onDragOver:W,onDrop:q,sx:{minHeight:0,borderRadius:1,border:"1px solid",borderColor:"divider",bgcolor:"action.hover",overflow:"auto",position:"relative",height:"calc(100vh - 260px)",width:"calc(100vw - 415px)"},children:e.jsx(o,{sx:{minWidth:"100%",minHeight:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(o,{sx:{width:pe,height:ue,position:"relative"},children:e.jsxs(o,{sx:{position:"absolute",top:0,left:0,width:f,height:b,borderRadius:1,border:"2px dashed",borderColor:"divider",overflow:"hidden",backgroundColor:"action.hover",transform:`scale(${w})`,transformOrigin:"top left"},children:[Z&&e.jsx(o,{sx:{position:"absolute",inset:0,backgroundImage:r?`url(${r})`:void 0,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",opacity:r?.2:1}}),e.jsx(o,{sx:{position:"absolute",inset:0,zIndex:3,pointerEvents:"none"},children:he.map(t=>{const i=!!y[t.id];return e.jsx(o,{sx:{position:"absolute",top:t.row*v-p,left:t.col*j-p,width:J,height:K,opacity:i?0:1,transition:"opacity 0.2s ease"},children:e.jsx("svg",{width:"100%",height:"100%",viewBox:`0 0 ${j+p*2} ${v+p*2}`,preserveAspectRatio:"none",children:e.jsx("g",{transform:`translate(${p}, ${p})`,children:e.jsx("path",{d:t.path,fill:"rgba(255,255,255,0.08)",stroke:"rgba(0,0,0,0.2)",strokeWidth:1})})})},`outline-${t.id}`)})}),e.jsx(o,{sx:{position:"absolute",inset:0,zIndex:2,pointerEvents:"none"},children:l.map(t=>{const i=y[t.id];return i?e.jsx(o,{sx:{position:"absolute",top:i.row*v-p,left:i.col*j-p,width:J,height:K,pointerEvents:"none"},children:e.jsx("img",{src:t.image,alt:"완성조각",draggable:!1,style:{width:"100%",height:"100%",display:"block"}})},`placed-${t.id}`):null})}),e.jsx(o,{sx:{position:"absolute",inset:0,display:"grid",gridTemplateColumns:`repeat(${c}, 1fr)`,gridTemplateRows:`repeat(${a}, 1fr)`,zIndex:4},children:Array.from({length:a*c}).map((t,i)=>{const u=Math.floor(i/c),g=i%c,C=l.find($=>{const L=y[$.id];return L&&L.row===u&&L.col===g});return e.jsx(o,{onDragOver:W,onDrop:ae(u,g),sx:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",bgcolor:C?"rgba(255,255,255,0.05)":"transparent"},children:C&&e.jsx(me,{title:"조각 되돌리기",children:e.jsx(fe,{size:"small",sx:{position:"absolute",top:4,right:4},onClick:()=>re(C.id),children:e.jsx(be,{fontSize:"inherit"})})})},`slot-${u}-${g}`)})})]})})})})]})}):e.jsx(e.Fragment,{children:e.jsx(o,{onDragOver:W,onDrop:q,sx:{flex:1,minHeight:0,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs(o,{sx:{width:"100%",maxWidth:"100%",minHeight:360,borderRadius:1,border:"2px dashed",borderColor:"divider",bgcolor:"action.hover",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,textAlign:"center",p:1,height:"100%"},children:[e.jsx(h,{variant:"subtitle1",children:"이미지를 드래그하거나 업로드하세요."}),e.jsx(h,{variant:"body2",color:"text.secondary",children:"이 영역에 이미지를 드래그하거나 버튼을 눌러 파일을 선택하면 퍼즐이 생성됩니다."}),e.jsx(m,{startIcon:e.jsx(ge,{}),variant:"contained",size:"small",onClick:()=>G.current?.click(),children:"이미지 선택"})]})})})})]})]})};export{De as default};
