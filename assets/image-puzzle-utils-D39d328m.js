import{r}from"./vendor-DyxFRNuv.js";const R=600,F=320,z=(e,t,o)=>Math.min(Math.max(e,t),o),_=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():Math.random().toString(36).slice(2,10),j=e=>new Promise((t,o)=>{const n=new Image;n.onload=()=>t(n),n.onerror=o,n.src=e}),B=(e,t)=>{const o=Array.from({length:e},()=>Array.from({length:t},()=>[0,0,0,0]));for(let n=0;n<e;n+=1)for(let s=0;s<t;s+=1){const d=n===0?0:o[n-1][s][2]*-1,l=s===0?0:o[n][s-1][1]*-1,a=s===t-1?0:Math.random()>.5?1:-1,c=n===e-1?0:Math.random()>.5?1:-1;o[n][s]=[d,a,c,l]}return o},J=(e,t,o,n,s)=>{const d=n;if(e.beginPath(),e.moveTo(0,0),e.lineTo(t/3,0),s.top!==0){const a=-s.top*d;e.quadraticCurveTo(t/2,a,2*t/3,0)}else e.lineTo(2*t/3,0);if(e.lineTo(t,0),e.lineTo(t,o/3),s.right!==0){const a=s.right*d;e.quadraticCurveTo(t+a,o/2,t,2*o/3)}else e.lineTo(t,2*o/3);if(e.lineTo(t,o),e.lineTo(2*t/3,o),s.bottom!==0){const a=s.bottom*d;e.quadraticCurveTo(t/2,o+a,t/3,o)}else e.lineTo(t/3,o);if(e.lineTo(0,o),e.lineTo(0,2*o/3),s.left!==0){const a=-s.left*d;e.quadraticCurveTo(a,o/2,0,o/3)}else e.lineTo(0,o/3);e.closePath()},N=async(e,t,o)=>{const n=await j(e),s=z(n.width,F,R),d=n.height/n.width,l=s,a=Math.round(l*d),c=l/o,f=a/t,g=Math.min(c,f)*.2,T=c+g*2,C=f+g*2,p=document.createElement("canvas");p.width=l,p.height=a;const M=p.getContext("2d");M?.drawImage(n,0,0,l,a);const L=B(t,o),k=[];for(let P=0;P<t;P+=1)for(let S=0;S<o;S+=1){const[D,W,U,q]=L[P][S],v=document.createElement("canvas");v.width=T,v.height=C;const m=v.getContext("2d");!m||!M||(m.translate(g,g),J(m,c,f,g,{top:D,right:W,bottom:U,left:q}),m.save(),m.clip(),m.drawImage(p,-S*c,-P*f,l,a),m.restore(),m.strokeStyle="rgba(0,0,0,0.25)",m.lineWidth=1,m.stroke(),k.push({id:_(),row:P,col:S,top:D,right:W,bottom:U,left:q,image:v.toDataURL()}))}return{pieces:k,metrics:{width:l,height:a,pieceWidth:c,pieceHeight:f,tabSize:g,paddedWidth:T,paddedHeight:C}}},Z=()=>{const[e,t]=r.useState(null),[o,n]=r.useState(null),[s,d]=r.useState(3),[l,a]=r.useState(4),[c,f]=r.useState([]),[g,T]=r.useState(null),[C,p]=r.useState({}),[M,L]=r.useState(null),[k,E]=r.useState(!1),P=r.useMemo(()=>c.filter(u=>!C[u.id]),[c,C]),S=r.useCallback(u=>{if(!u.type.startsWith("image/")){t("이미지 파일만 업로드할 수 있습니다.");return}const i=new FileReader;i.onload=()=>{typeof i.result=="string"&&(n(i.result),t(null))},i.onerror=()=>t("파일을 읽을 수 없습니다."),i.readAsDataURL(u)},[]);r.useEffect(()=>{let u=!1;return(async()=>{if(!o){f([]),T(null),p({});return}const{pieces:$,metrics:b}=await N(o,s,l);u||(f($.sort(()=>Math.random()-.5)),p({}),T(b))})(),()=>{u=!0}},[o,s,l]),r.useEffect(()=>{if(!c.length){E(!1);return}const u=c.length>0&&c.every(i=>{const $=C[i.id];return $&&$.row===i.row&&$.col===i.col});E(u)},[c,C]);const D=r.useCallback(()=>{p({}),f(u=>[...u].sort(()=>Math.random()-.5))},[]),W=r.useCallback(()=>{p({})},[]),U=r.useCallback((u,i,$)=>{const b=c.find(y=>y.id===u);if(!b)return!1;const I=c.find(y=>y.row===i&&y.col===$);if(!I)return!1;const H=b.row===i&&b.col===$,Q=b.top===I.top&&b.right===I.right&&b.bottom===I.bottom&&b.left===I.left;return!H&&!Q?!1:(p(y=>({...y,[u]:{row:i,col:$}})),!0)},[c]),q=r.useCallback(u=>{p(i=>({...i,[u]:null}))},[]),v=r.useCallback(u=>{L(u)},[]),m=r.useCallback(()=>{L(null)},[]),A=r.useCallback(()=>{E(!1)},[]);return{fileError:e,imageSrc:o,rows:s,cols:l,pieces:c,board:g,placements:C,trayPieces:P,draggingId:M,solved:k,handleFileInput:S,setRows:d,setCols:a,shufflePieces:D,resetPlacements:W,placePiece:U,removePlacement:q,startDrag:v,endDrag:m,acknowledgeSolved:A}},G=(e,t,o,n)=>{const s=[],d=e/3,l=t/3;if(s.push("M 0 0"),s.push(`L ${d} 0`),n.top!==0){const a=-n.top*o;s.push(`Q ${e/2} ${a} ${2*e/3} 0`)}else s.push(`L ${2*e/3} 0`);if(s.push(`L ${e} 0`),s.push(`L ${e} ${l}`),n.right!==0){const a=n.right*o;s.push(`Q ${e+a} ${t/2} ${e} ${2*t/3}`)}else s.push(`L ${e} ${2*t/3}`);if(s.push(`L ${e} ${t}`),s.push(`L ${2*e/3} ${t}`),n.bottom!==0){const a=n.bottom*o;s.push(`Q ${e/2} ${t+a} ${e/3} ${t}`)}else s.push(`L ${e/3} ${t}`);if(s.push(`L 0 ${t}`),s.push(`L 0 ${2*t/3}`),n.left!==0){const a=-n.left*o;s.push(`Q ${a} ${t/2} 0 ${t/3}`)}else s.push(`L 0 ${t/3}`);return s.push("Z"),s.join(" ")};export{G as b,Z as u};
