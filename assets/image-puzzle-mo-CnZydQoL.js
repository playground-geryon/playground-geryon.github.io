import{r as n,j as t}from"./vendor-CRMzTT1s.js";import{B as a,P as O,S as j,a as E,aM as he,am as ue,T as y,a3 as V,a4 as Z,a7 as pe,I as xe,bD as ge,bI as fe,W as me}from"./mui-COpd2GBn.js";import{u as be}from"./image-puzzle-control-BrwZCmuE.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";const ve=(i,s,c,d)=>{const r=[],w=i/3,W=s/3;if(r.push("M 0 0"),r.push(`L ${w} 0`),d.top!==0){const u=-d.top*c;r.push(`Q ${i/2} ${u} ${2*i/3} 0`)}else r.push(`L ${2*i/3} 0`);if(r.push(`L ${i} 0`),r.push(`L ${i} ${W}`),d.right!==0){const u=d.right*c;r.push(`Q ${i+u} ${s/2} ${i} ${2*s/3}`)}else r.push(`L ${i} ${2*s/3}`);if(r.push(`L ${i} ${s}`),r.push(`L ${2*i/3} ${s}`),d.bottom!==0){const u=d.bottom*c;r.push(`Q ${i/2} ${s+u} ${i/3} ${s}`)}else r.push(`L ${i/3} ${s}`);if(r.push(`L 0 ${s}`),r.push(`L 0 ${2*s/3}`),d.left!==0){const u=-d.left*c;r.push(`Q ${u} ${s/2} 0 ${s/3}`)}else r.push(`L 0 ${s/3}`);return r.push("Z"),r.join(" ")},We=()=>{const{imageSrc:i,rows:s,cols:c,pieces:d,board:r,placements:w,trayPieces:W,draggingId:u,solved:L,handleFileInput:B,setRows:q,setCols:G,shufflePieces:J,resetPlacements:K,placePiece:k,removePlacement:A,startDrag:M,endDrag:F,acknowledgeSolved:T}=be(),Q=n.useRef(null),X=n.useRef(null),[C,ee]=n.useState(1),[g,te]=n.useState({width:0,height:0}),[D,re]=n.useState(!0),[x,z]=n.useState(null),[ie,I]=n.useState(!1),oe=n.useCallback(e=>o=>{o.dataTransfer.setData("text/plain",e),M(e)},[M]),se=n.useCallback(()=>{F()},[F]),R=n.useCallback(e=>{e.preventDefault()},[]),ne=n.useCallback((e,o)=>h=>{h.preventDefault();const l=h.dataTransfer.getData("text/plain")||u;l&&k(l,e,o)},[u,k]),H=n.useCallback(e=>{e&&B(e)},[B]),N=n.useCallback(e=>{e.preventDefault();const o=e.dataTransfer?.files?.[0];H(o)},[H]),f=r?.width??400,m=r?.height??400,b=r?.pieceWidth??f/Math.max(1,c),v=r?.pieceHeight??m/Math.max(1,s),p=r?.tabSize??0,_=r?.paddedWidth??b,Y=r?.paddedHeight??v,ae=f*C,le=m*C,de=1.2,ce=n.useMemo(()=>d.map(e=>({id:e.id,row:e.row,col:e.col,path:ve(b,v,p,e)})),[d,b,v,p]);n.useEffect(()=>{if(!i)return;const e=new Image;e.onload=()=>{!e.naturalWidth||!e.naturalHeight||re(e.naturalHeight>=e.naturalWidth)},e.src=i},[i]),n.useEffect(()=>{L&&(I(!0),T())},[L,T]);const U=n.useCallback(()=>{if(!f||!m||!g.width||!g.height)return;const e=g.width/f,o=g.height/m,l=Math.min((D?e:o)*de,e);!Number.isFinite(l)||l<=0||ee(l)},[f,m,g,D]);return n.useEffect(()=>{U()},[U,s,c,i,g,D]),n.useEffect(()=>{z(null)},[i]),n.useEffect(()=>{if(typeof ResizeObserver>"u")return;const e=X.current;if(!e)return;const o=new ResizeObserver(()=>{te({width:e.clientWidth,height:e.clientHeight})});return o.observe(e),()=>o.disconnect()},[]),t.jsxs(t.Fragment,{children:[t.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:0,height:"100%",width:1,maxWidth:"calc(100vw - 16px)",overflowX:"hidden",boxSizing:"border-box"},children:[t.jsx(O,{sx:{p:1,borderRadius:1,overflow:"hidden",boxSizing:"border-box",maxWidth:"100vw",width:"100%",minWidth:0},children:t.jsxs(j,{spacing:1.25,children:[t.jsxs(j,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx("input",{ref:Q,hidden:!0,type:"file",accept:"image/*",onChange:e=>{H(e.target.files?.[0]),e.target.value=""}}),t.jsx(E,{variant:"contained",startIcon:t.jsx(he,{}),onClick:()=>Q.current?.click(),children:"이미지 선택"}),t.jsxs(a,{sx:{display:"flex",gap:1,ml:"auto"},children:[t.jsx(E,{variant:"outlined",startIcon:t.jsx(ue,{}),onClick:K,children:"초기화"}),t.jsx(E,{variant:"outlined",onClick:J,children:"퍼즐 섞기"})]})]}),t.jsx(j,{spacing:.75,children:t.jsxs(j,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx(y,{variant:"body2",sx:{width:24},children:"행"}),t.jsx(a,{sx:{flex:1},children:t.jsx(V,{size:"small",value:s,onChange:e=>q(Number(e.target.value)),fullWidth:!0,sx:{height:36},children:Array.from({length:29},(e,o)=>o+2).map(e=>t.jsx(Z,{value:e,children:e},`rows-${e}`))})}),t.jsx(y,{variant:"body2",sx:{width:24},children:"열"}),t.jsx(a,{sx:{flex:1},children:t.jsx(V,{size:"small",value:c,onChange:e=>G(Number(e.target.value)),fullWidth:!0,sx:{height:36},children:Array.from({length:29},(e,o)=>o+2).map(e=>t.jsx(Z,{value:e,children:e},`cols-${e}`))})})]})})]})}),t.jsx(O,{sx:{p:1,borderRadius:1,overflow:"hidden",boxSizing:"border-box",maxWidth:"100vw",width:"100%",minWidth:0},children:i?t.jsx(a,{ref:X,onDragOver:R,onDrop:N,sx:{borderRadius:1,border:"1px solid",borderColor:"divider",bgcolor:"action.hover",overflowX:"auto",overflowY:"auto",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",position:"relative",minHeight:320,height:"48vh",width:"100%",maxWidth:"100vw",minWidth:0,boxSizing:"border-box"},children:t.jsx(a,{sx:{width:ae,height:le,position:"relative"},children:t.jsxs(a,{sx:{position:"absolute",top:0,left:0,width:f,height:m,borderRadius:1,border:"2px dashed",borderColor:"divider",overflow:"hidden",backgroundColor:"action.hover",transform:`scale(${C})`,transformOrigin:"top left"},children:[t.jsx(a,{sx:{position:"absolute",inset:0,backgroundImage:i?`url(${i})`:void 0,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",opacity:i?.2:1}}),t.jsx(a,{sx:{position:"absolute",inset:0,zIndex:3,pointerEvents:"none"},children:ce.map(e=>{const o=!!w[e.id];return t.jsx(a,{sx:{position:"absolute",top:e.row*v-p,left:e.col*b-p,width:_,height:Y,opacity:o?0:1,transition:"opacity 0.2s ease"},children:t.jsx("svg",{width:"100%",height:"100%",viewBox:`0 0 ${b+p*2} ${v+p*2}`,preserveAspectRatio:"none",children:t.jsx("g",{transform:`translate(${p}, ${p})`,children:t.jsx("path",{d:e.path,fill:"rgba(255,255,255,0.08)",stroke:"rgba(0,0,0,0.2)",strokeWidth:1})})})},`outline-${e.id}`)})}),t.jsx(a,{sx:{position:"absolute",inset:0,zIndex:2,pointerEvents:"none"},children:d.map(e=>{const o=w[e.id];return o?t.jsx(a,{sx:{position:"absolute",top:o.row*v-p,left:o.col*b-p,width:_,height:Y,pointerEvents:"none"},children:t.jsx("img",{src:e.image,alt:"완성조각",draggable:!1,style:{width:"100%",height:"100%",display:"block"}})},`placed-${e.id}`):null})}),t.jsx(a,{sx:{position:"absolute",inset:0,display:"grid",gridTemplateColumns:`repeat(${c}, 1fr)`,gridTemplateRows:`repeat(${s}, 1fr)`,zIndex:4},children:Array.from({length:s*c}).map((e,o)=>{const h=Math.floor(o/c),l=o%c,$=d.find(S=>{const P=w[S.id];return P&&P.row===h&&P.col===l});return t.jsx(a,{onDragOver:R,onDrop:ne(h,l),onClick:()=>{if($){A($.id);return}z(S=>S&&S.row===h&&S.col===l?null:{row:h,col:l})},sx:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",outline:x&&x.row===h&&x.col===l?"2px solid":"none",outlineColor:x&&x.row===h&&x.col===l?"primary.main":"transparent",bgcolor:$?"rgba(255,255,255,0.05)":"transparent"},children:$&&t.jsx(pe,{title:"조각 되돌리기",children:t.jsx(xe,{size:"small",sx:{position:"absolute",top:4,right:4},onClick:()=>A($.id),children:t.jsx(ge,{fontSize:"inherit"})})})},`slot-${h}-${l}`)})})]})})}):t.jsx(a,{onDragOver:R,onDrop:N,sx:{borderRadius:1,border:"2px dashed",borderColor:"divider",bgcolor:"action.hover",p:2,minHeight:260,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:t.jsxs(j,{spacing:1,children:[t.jsx(y,{variant:"subtitle1",children:"이미지를 선택해 주세요."}),t.jsx(y,{variant:"body2",color:"text.secondary",children:"버튼으로 업로드하면 퍼즐이 생성됩니다."})]})})}),t.jsx(O,{sx:{p:1,borderRadius:1,overflow:"hidden",boxSizing:"border-box",maxWidth:"100vw",width:"100%",minWidth:0},children:t.jsx(j,{spacing:1,sx:{minWidth:0},children:t.jsx(a,{sx:{borderRadius:1,minHeight:88,maxHeight:"20vh",width:"100%",maxWidth:"100%",minWidth:0,boxSizing:"border-box",overflowX:"auto",overflowY:"hidden",WebkitOverflowScrolling:"touch",overscrollBehaviorX:"contain",display:"block",position:"relative",pb:.5},children:W.length===0?t.jsx(y,{variant:"caption",color:"text.secondary",children:"남은 조각이 없습니다."}):t.jsx(a,{sx:{display:"grid",gridAutoFlow:"column",gridAutoColumns:"96px",gap:1,alignItems:"start",width:"max-content",paddingRight:8},children:W.map(e=>t.jsx(a,{draggable:!0,onDragStart:oe(e.id),onDragEnd:se,onClick:()=>{x&&(k(e.id,x.row,x.col),z(null))},sx:{borderRadius:1,p:.25,bgcolor:"background.paper",cursor:"grab",width:96,minWidth:96},children:t.jsx("img",{src:e.image,alt:"조각",style:{width:"100%",display:"block"}})},e.id))})})})})]}),t.jsx(fe,{open:ie,autoHideDuration:2400,onClose:()=>I(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:t.jsx(me,{onClose:()=>I(!1),severity:"success",variant:"filled",children:"축하합니다! 퍼즐을 모두 맞췄어요."})})]})};export{We as default};
