import{j as e,r}from"./vendor-DyxFRNuv.js";import{u as le,b as de}from"./image-puzzle-utils-D39d328m.js";import{P as U,B as o,S as B,T as E,a9 as ce,I as he,bL as ue,a as L,aV as xe,ap as ge,a6 as G,a7 as J,a3 as pe,a1 as fe}from"./mui-Dn-s4uu_.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-DJeWk4Ia.js";const me=({imageSrc:s,boardWrapperRef:l,onDragOver:d,onBoardDrop:h,scaledWidth:a,scaledHeight:v,boardWidth:u,boardHeight:i,pieces:f,placements:k,slotOutlines:X,rows:H,cols:y,pieceWidth:S,pieceHeight:C,tabSize:x,paddedWidth:R,paddedHeight:D,viewScale:O,selectedSlot:m,setSelectedSlot:M,onDropOnBoard:P,onRemovePlacement:A})=>e.jsx(U,{sx:{p:1,borderRadius:1,overflow:"hidden",boxSizing:"border-box",maxWidth:"100vw",width:"100%",minWidth:0},children:s?e.jsx(o,{ref:l,onDragOver:d,onDrop:h,sx:{borderRadius:1,border:"1px solid",borderColor:"divider",bgcolor:"action.hover",overflowX:"auto",overflowY:"auto",WebkitOverflowScrolling:"touch",overscrollBehavior:"contain",position:"relative",minHeight:320,height:"48vh",width:"100%",maxWidth:"100vw",minWidth:0,boxSizing:"border-box"},children:e.jsx(o,{sx:{width:a,height:v,position:"relative"},children:e.jsxs(o,{sx:{position:"absolute",top:0,left:0,width:u,height:i,borderRadius:1,border:"1px dashed",borderColor:"divider",overflow:"hidden",backgroundColor:"action.hover",transform:`scale(${O})`,transformOrigin:"top left"},children:[e.jsx(o,{sx:{position:"absolute",inset:0,backgroundImage:s?`url(${s})`:void 0,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",opacity:s?.2:1}}),e.jsx(o,{sx:{position:"absolute",inset:0,zIndex:3,pointerEvents:"none"},children:X.map(n=>{const g=!!k[n.id];return e.jsx(o,{sx:{position:"absolute",top:n.row*C-x,left:n.col*S-x,width:R,height:D,opacity:g?0:1,transition:"opacity 0.2s ease"},children:e.jsx("svg",{width:"100%",height:"100%",viewBox:`0 0 ${S+x*2} ${C+x*2}`,preserveAspectRatio:"none",children:e.jsx("g",{transform:`translate(${x}, ${x})`,children:e.jsx("path",{d:n.path,fill:"rgba(255,255,255,0.08)",stroke:"rgba(0,0,0,0.2)",strokeWidth:.6})})})},`outline-${n.id}`)})}),e.jsx(o,{sx:{position:"absolute",inset:0,zIndex:2,pointerEvents:"none"},children:f.map(n=>{const g=k[n.id];return g?e.jsx(o,{sx:{position:"absolute",top:g.row*C-x,left:g.col*S-x,width:R,height:D,pointerEvents:"none"},children:e.jsx("img",{src:n.image,alt:"완성조각",draggable:!1,style:{width:"100%",height:"100%",display:"block"}})},`placed-${n.id}`):null})}),e.jsx(o,{sx:{position:"absolute",inset:0,display:"grid",gridTemplateColumns:`repeat(${y}, 1fr)`,gridTemplateRows:`repeat(${H}, 1fr)`,zIndex:4},children:Array.from({length:H*y}).map((n,g)=>{const c=Math.floor(g/y),b=g%y,j=f.find(w=>{const $=k[w.id];return $&&$.row===c&&$.col===b});return e.jsx(o,{onDragOver:d,onDrop:P(c,b),onClick:()=>{if(j){A(j.id);return}M(w=>w&&w.row===c&&w.col===b?null:{row:c,col:b})},sx:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",outline:m&&m.row===c&&m.col===b?"2px solid":"none",outlineColor:m&&m.row===c&&m.col===b?"primary.main":"transparent",bgcolor:j?"rgba(255,255,255,0.05)":"transparent"},children:j&&e.jsx(ce,{title:"조각 되돌리기",children:e.jsx(he,{size:"small",sx:{position:"absolute",top:4,right:4},onClick:()=>A(j.id),children:e.jsx(ue,{fontSize:"inherit"})})})},`slot-${c}-${b}`)})})]})})}):e.jsx(o,{onDragOver:d,onDrop:h,sx:{borderRadius:1,border:"1px dashed",borderColor:"divider",bgcolor:"action.hover",p:2,minHeight:260,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center"},children:e.jsxs(B,{spacing:1,children:[e.jsx(E,{variant:"subtitle1",children:"이미지를 선택해 주세요."}),e.jsx(E,{variant:"body2",color:"text.secondary",children:"버튼으로 업로드하면 퍼즐이 생성됩니다."})]})})}),be=({onPickFile:s,onReset:l,onShuffle:d,rows:h,cols:a,onRowsChange:v,onColsChange:u})=>e.jsx(U,{sx:{p:1,borderRadius:1,overflow:"hidden",boxSizing:"border-box",maxWidth:"100vw",width:"100%",minWidth:0},children:e.jsxs(B,{spacing:1.25,children:[e.jsxs(B,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(L,{variant:"contained",startIcon:e.jsx(xe,{}),onClick:s,children:"이미지 선택"}),e.jsxs(o,{sx:{display:"flex",gap:1,ml:"auto"},children:[e.jsx(L,{variant:"outlined",startIcon:e.jsx(ge,{}),onClick:l,children:"초기화"}),e.jsx(L,{variant:"outlined",onClick:d,children:"퍼즐 섞기"})]})]}),e.jsx(B,{spacing:.75,children:e.jsxs(B,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(E,{variant:"body2",sx:{width:24},children:"행"}),e.jsx(o,{sx:{flex:1},children:e.jsx(G,{size:"small",value:h,onChange:i=>v(Number(i.target.value)),fullWidth:!0,sx:{height:36},children:Array.from({length:29},(i,f)=>f+2).map(i=>e.jsx(J,{value:i,children:i},`rows-${i}`))})}),e.jsx(E,{variant:"body2",sx:{width:24},children:"열"}),e.jsx(o,{sx:{flex:1},children:e.jsx(G,{size:"small",value:a,onChange:i=>u(Number(i.target.value)),fullWidth:!0,sx:{height:36},children:Array.from({length:29},(i,f)=>f+2).map(i=>e.jsx(J,{value:i,children:i},`cols-${i}`))})})]})})]})}),we=({trayPieces:s,selectedSlot:l,onPlacePiece:d,onClearSelectedSlot:h,onDragStart:a,onDragEnd:v})=>e.jsx(U,{sx:{p:1,borderRadius:1,overflow:"hidden",boxSizing:"border-box",maxWidth:"100vw",width:"100%",minWidth:0},children:e.jsx(o,{sx:{minWidth:0},children:e.jsx(o,{sx:{borderRadius:1,minHeight:88,maxHeight:"20vh",width:"100%",maxWidth:"100%",minWidth:0,boxSizing:"border-box",overflowX:"auto",overflowY:"hidden",WebkitOverflowScrolling:"touch",overscrollBehaviorX:"contain",display:"block",position:"relative",pb:.5},children:s.length===0?e.jsx(E,{variant:"caption",color:"text.secondary",children:"남은 조각이 없습니다."}):e.jsx(o,{sx:{display:"grid",gridAutoFlow:"column",gridAutoColumns:"96px",gap:1,alignItems:"start",width:"max-content",paddingRight:8},children:s.map(u=>e.jsx(o,{draggable:!0,onDragStart:a(u.id),onDragEnd:v,onClick:()=>{l&&(d(u.id,l.row,l.col),h())},sx:{borderRadius:1,p:.25,bgcolor:"background.paper",cursor:"grab",width:96,minWidth:96},children:e.jsx("img",{src:u.image,alt:"조각",style:{width:"100%",display:"block"}})},u.id))})})})}),We=()=>{const{imageSrc:s,rows:l,cols:d,pieces:h,board:a,placements:v,trayPieces:u,draggingId:i,solved:f,handleFileInput:k,setRows:X,setCols:H,shufflePieces:y,resetPlacements:S,placePiece:C,removePlacement:x,startDrag:R,endDrag:D,acknowledgeSolved:O}=le(),m=r.useRef(null),M=r.useRef(null),[P,A]=r.useState(1),[n,g]=r.useState({width:0,height:0}),[c,b]=r.useState(!0),[j,w]=r.useState(null),[$,N]=r.useState(!1),K=r.useCallback(t=>p=>{p.dataTransfer.setData("text/plain",t),R(t)},[R]),Q=r.useCallback(()=>{D()},[D]),Z=r.useCallback(t=>{t.preventDefault()},[]),ee=r.useCallback((t,p)=>Y=>{Y.preventDefault();const I=Y.dataTransfer.getData("text/plain")||i;I&&C(I,t,p)},[i,C]),_=r.useCallback(t=>{t&&k(t)},[k]),te=r.useCallback(t=>{t.preventDefault();const p=t.dataTransfer?.files?.[0];_(p)},[_]),W=a?.width??400,z=a?.height??400,F=a?.pieceWidth??W/Math.max(1,d),T=a?.pieceHeight??z/Math.max(1,l),V=a?.tabSize??0,re=a?.paddedWidth??F,oe=a?.paddedHeight??T,ie=W*P,ne=z*P,se=1.2,ae=r.useMemo(()=>h.map(t=>({id:t.id,row:t.row,col:t.col,path:de(F,T,V,t)})),[h,F,T,V]);r.useEffect(()=>{if(!s)return;const t=new Image;t.onload=()=>{!t.naturalWidth||!t.naturalHeight||b(t.naturalHeight>=t.naturalWidth)},t.src=s},[s]),r.useEffect(()=>{f&&(N(!0),O())},[f,O]);const q=r.useCallback(()=>{if(!W||!z||!n.width||!n.height)return;const t=n.width/W,p=n.height/z,I=Math.min((c?t:p)*se,t);!Number.isFinite(I)||I<=0||A(I)},[W,z,n,c]);return r.useEffect(()=>{q()},[q,l,d,s,n,c]),r.useEffect(()=>{w(null)},[s]),r.useEffect(()=>{if(typeof ResizeObserver>"u")return;const t=M.current;if(!t)return;const p=new ResizeObserver(()=>{g({width:t.clientWidth,height:t.clientHeight})});return p.observe(t),()=>p.disconnect()},[]),e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:0,height:"100%",width:1,maxWidth:"calc(100vw - 16px)",overflowX:"hidden",boxSizing:"border-box"},children:[e.jsx("input",{ref:m,hidden:!0,type:"file",accept:"image/*",onChange:t=>{_(t.target.files?.[0]),t.target.value=""}}),e.jsx(be,{onPickFile:()=>m.current?.click(),onReset:S,onShuffle:y,rows:l,cols:d,onRowsChange:X,onColsChange:H}),e.jsx(me,{imageSrc:s,boardWrapperRef:M,onDragOver:Z,onBoardDrop:te,scaledWidth:ie,scaledHeight:ne,boardWidth:W,boardHeight:z,pieces:h,placements:v,slotOutlines:ae,rows:l,cols:d,pieceWidth:F,pieceHeight:T,tabSize:V,paddedWidth:re,paddedHeight:oe,viewScale:P,selectedSlot:j,setSelectedSlot:w,onDropOnBoard:ee,onRemovePlacement:x}),e.jsx(we,{trayPieces:u,selectedSlot:j,onPlacePiece:C,onClearSelectedSlot:()=>w(null),onDragStart:K,onDragEnd:Q})]}),e.jsx(pe,{open:$,autoHideDuration:2400,onClose:()=>N(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(fe,{onClose:()=>N(!1),severity:"success",variant:"filled",children:"축하합니다! 퍼즐을 모두 맞췄어요."})})]})};export{We as default};
