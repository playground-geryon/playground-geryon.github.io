import{r as m,t as yt,v as bt,F as jt,J as vt,j as e}from"./vendor-DuO8O3Ni.js";import{u as ut,p as Ct,P as ie,B as z,S as p,a as D,aD as je,aE as kt,aF as Rt,aG as St,T as v,az as ze,n as w,aa as Q,I as X,aC as ke,a9 as Ke,Y as Tt,X as ht,aH as Pt,ac as nt,a4 as Qe,J as ve,a7 as Ae,aI as Xe,x as rt,y as le,aA as It,aJ as At,aK as Et,aL as Nt}from"./mui-BrtMkxyc.js";import{M as He}from"./monaco-editor-Cz9NNAw7.js";import"./excel-CUMakpxJ.js";import"./monaco-p3yQZa36.js";const Ze=["GET","POST","PUT","PATCH","DELETE"],Ye=20,wt=1,zt=new Set(Ze),J=t=>`${t}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,ce=(t,n)=>t&&t.replace(/\{\{\s*([\w.-]+)\s*\}\}/g,(s,i)=>{const l=i.trim();return l in n?String(n[l]):""}),at=(t,n)=>t.reduce((s,i)=>{if(!i.enabled)return s;const l=i.key.trim();if(!l)return s;const b=ce(l,n);return b&&(s[b]=ce(i.value,n)),s},{}),ot=(t,n)=>t.reduce((s,i)=>{if(!i.enabled)return s;const l=i.key.trim();return l&&(s[ce(l,n)]=ce(i.value,n)),s},{}),Ht=(t,n)=>{const i=ce(t,n).trim();if(i)try{return JSON.parse(i)}catch{return i}},L=t=>({id:J("hdr"),key:"",value:"",enabled:!0,...t}),q=(t,n)=>({id:J(t),key:"",value:"",enabled:!0,...n}),Ot=t=>{const n=new Set;for(let s=0;s<t.length;s++){if(t[s]!=="{")continue;if(t[s+1]==="{"){s++;continue}const i=t.indexOf("}",s+1);if(i===-1)break;if(t[i+1]==="}"){s=i+1;continue}const l=t.slice(s+1,i).trim();l&&n.add(l),s=i}return n},Ee=t=>{const n=Array.from(Ot(t.url));if(!n.length)return t.localVariables.length===0?t:{...t,localVariables:[]};const s=new Map(t.localVariables.map(l=>[l.key,l])),i=n.map(l=>s.get(l)??q("var",{key:l}));return{...t,localVariables:i}},Le=(t,n)=>{if(typeof t!="string"||!t.startsWith("#/"))return;const s=t.replace(/^#\//,"").split("/");let i=n;for(const l of s)if(i=i?.[l],i===void 0)return;return i},Be=(t,n,s=0)=>{if(!t||s>5)return"";if(t.example!==void 0)return t.example;if(t.default!==void 0)return t.default;if(t.$ref){const l=Le(t.$ref,n);return Be(l,n,s+1)}switch(t.type??(t.properties?"object":t.items?"array":"string")){case"object":{const l={},b=t.properties??{};return Object.entries(b).forEach(([j,k])=>{l[j]=Be(k,n,s+1)??""}),l}case"array":return[Be(t.items??{},n,s+1)??""];case"boolean":return!1;case"number":case"integer":return 0;default:return""}},pt=(t,n)=>{if(!t)return[];if(t.$ref){const i=Le(t.$ref,n);return pt(i,n)}const s=t.properties??{};return Object.keys(s).length===0?[q("form")]:Object.keys(s).map(i=>q("form",{key:i,value:"",enabled:!0}))},qt=t=>{if(!t||typeof t!="object")return[];const n=typeof t.servers?.[0]?.url=="string"?t.servers[0].url.replace(/\/$/,""):"",s=t.paths;if(!s||typeof s!="object")return[];const i=[],l=(b,j)=>{const k=[];return Array.isArray(b)&&k.push(...b),Array.isArray(j)&&k.push(...j),k};return Object.entries(s).forEach(([b,j])=>{!j||typeof j!="object"||Object.entries(j).forEach(([k,R])=>{const f=k.toUpperCase();if(!zt.has(f)||!R||typeof R!="object")return;const Y=R.summary??`${f} ${b}`,se=R.description??"",ge=l(j.parameters,R.parameters),G=[],N=[];ge.forEach(U=>{const x=U?.$ref?Le(U.$ref,t):U;if(!x)return;const $=x.name;if(!$)return;const ee=x.example??x.schema?.example??x.schema?.default??"";switch(x.in){case"query":G.push(q("query",{key:$,value:String(ee??"")}));break;case"header":N.push(L({key:$,value:String(ee??"")}));break}});let B=`{
  
}`,P=[],Z;const ne=R.requestBody?.$ref?Le(R.requestBody.$ref,t):R.requestBody;if(ne?.content&&typeof ne.content=="object"){const U=Object.entries(ne.content),x=U.find(([$])=>$.includes("application/json"))??U[0];if(x){Z=x[0];const $=x[1],ee=$?.schema;if(Z.includes("application/x-www-form-urlencoded"))P=pt(ee,t);else{const M=$?.example??$?.examples?.default?.value??Be(ee,t);if(M!==void 0)try{B=typeof M=="string"?M:JSON.stringify(M,null,2)}catch{B=String(M)}}}}Z&&N.push(L({key:"Content-Type",value:Z}));const Se=`${n}${b}`.replace(new RegExp("(?<!:)\\/{2,}","g"),"/"),re=de(i.length,{label:Y,description:se,method:f,url:Se,headers:N.length?N:[L()],useGlobalHeaders:N.length===0,queryParams:G.length?G:[q("query")],formBodyEntries:P.length?P:[q("form")],body:B});i.push(re)})}),i},Je=t=>{const n={order:[],meta:{},body:{},headers:{},passThroughs:{},queryParams:{},localVariables:{},formBodyEntries:{},runtime:{}};return t.forEach(s=>{n.order.push(s.id),n.meta[s.id]={id:s.id,label:s.label,description:s.description,method:s.method,url:s.url,useGlobalHeaders:s.useGlobalHeaders,autoTriggerNext:s.autoTriggerNext,enabled:s.enabled},n.body[s.id]=s.body??"",n.headers[s.id]=s.headers??[],n.passThroughs[s.id]=s.passThroughs??[],n.queryParams[s.id]=s.queryParams??[],n.localVariables[s.id]=s.localVariables??[],n.formBodyEntries[s.id]=s.formBodyEntries??[],n.runtime[s.id]={status:s.status??"idle",lastRunAt:s.lastRunAt,responsePreview:s.responsePreview??"",lastRequest:s.lastRequest}}),n},Ie=(t,n)=>{const s=t.meta[n];if(!s)return null;const i=t.runtime[n]??{status:"idle",responsePreview:""};return{id:n,label:s.label,description:s.description,method:s.method,url:s.url,body:t.body[n]??"",headers:t.headers[n]??[],useGlobalHeaders:s.useGlobalHeaders,passThroughs:t.passThroughs[n]??[],queryParams:t.queryParams[n]??[],localVariables:t.localVariables[n]??[],formBodyEntries:t.formBodyEntries[n]??[],responsePreview:i.responsePreview??"",autoTriggerNext:s.autoTriggerNext,enabled:s.enabled,status:i.status??"idle",lastRunAt:i.lastRunAt,lastRequest:i.lastRequest}},Ue=(t,n)=>{const s={order:t.order,meta:{...t.meta},body:{...t.body},headers:{...t.headers},passThroughs:{...t.passThroughs},queryParams:{...t.queryParams},localVariables:{...t.localVariables},formBodyEntries:{...t.formBodyEntries},runtime:{...t.runtime}};return s.meta[n.id]={id:n.id,label:n.label,description:n.description,method:n.method,url:n.url,useGlobalHeaders:n.useGlobalHeaders,autoTriggerNext:n.autoTriggerNext,enabled:n.enabled},s.body[n.id]=n.body??"",s.headers[n.id]=n.headers??[],s.passThroughs[n.id]=n.passThroughs??[],s.queryParams[n.id]=n.queryParams??[],s.localVariables[n.id]=n.localVariables??[],s.formBodyEntries[n.id]=n.formBodyEntries??[],s.runtime[n.id]={status:n.status??"idle",lastRunAt:n.lastRunAt,responsePreview:n.responsePreview??"",lastRequest:n.lastRequest},s},Bt=(t,n)=>{const s=n??t.order,i=[];return s.forEach(l=>{const b=t.meta[l];if(!b)return;const j=t.runtime[l];i.push({id:l,label:b.label,method:b.method,url:b.url,enabled:b.enabled,autoTriggerNext:b.autoTriggerNext,status:j?.status??"idle",lastRunAt:j?.lastRunAt})}),i},Lt=t=>{if(t.length===0)return[{index:0,start:0,end:0,nodeIds:[]}];const n=[];for(let s=0;s<t.length;s+=Ye){const i=Math.min(t.length,s+Ye);n.push({index:n.length,start:s,end:i,nodeIds:t.slice(s,i)})}return n},$t=t=>{if(t!==void 0){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return String(t)}}},Vt=(t,n)=>{if(!(!t||!n.trim()))try{const s=vt({path:n,json:t,wrap:!0});return!Array.isArray(s)||s.length===0?void 0:s[0]}catch{return}},We=(t,n)=>{const s={};return{updatedRows:n.map(l=>{if(!l.enabled)return{...l,preview:void 0};const b=Vt(t,l.jsonPath),j=$t(b),k=l.targetKey.trim();return k&&j!==void 0&&(s[k]=j),{...l,preview:j}}),variables:s}},Re=t=>({id:J("map"),label:"",jsonPath:"$.data.token",targetKey:"",enabled:!0,preview:void 0,...t}),mt=t=>({...L(),...t,id:typeof t?.id=="string"?t.id:J("hdr"),key:typeof t?.key=="string"?t.key:"",value:typeof t?.value=="string"?t.value:"",enabled:typeof t?.enabled=="boolean"?t.enabled:!0}),_t=t=>({...Re(),...t,id:typeof t?.id=="string"?t.id:J("map"),label:typeof t?.label=="string"?t.label:"",jsonPath:typeof t?.jsonPath=="string"?t.jsonPath:"$.data.token",targetKey:typeof t?.targetKey=="string"?t.targetKey:"",enabled:typeof t?.enabled=="boolean"?t.enabled:!0,preview:void 0}),Mt=(t,n)=>{const s=de(n),i=Ze.includes(t.method)?t.method:s.method,l=Array.isArray(t.headers)&&t.headers.length>0?t.headers.map(f=>mt(f)):s.headers,b=Array.isArray(t.passThroughs)&&t.passThroughs.length>0?t.passThroughs.map(f=>_t(f)):s.passThroughs,j=Array.isArray(t.queryParams)&&t.queryParams.length>0?t.queryParams.map(f=>({...q("query"),...f})):s.queryParams,k=Array.isArray(t.localVariables)&&t.localVariables.length>0?t.localVariables.filter(f=>typeof f.key=="string"&&f.key.trim()).map(f=>({...q("var"),...f,key:f.key.trim()})):s.localVariables,R=Array.isArray(t.formBodyEntries)&&t.formBodyEntries.length>0?t.formBodyEntries.map(f=>({...q("form"),...f})):s.formBodyEntries;return Ee({...s,...t,id:typeof t.id=="string"?t.id:s.id,label:typeof t.label=="string"?t.label:s.label,description:typeof t.description=="string"?t.description:s.description,method:i,url:typeof t.url=="string"?t.url:s.url,body:typeof t.body=="string"?t.body:s.body,headers:l,useGlobalHeaders:typeof t.useGlobalHeaders=="boolean"?t.useGlobalHeaders:s.useGlobalHeaders,passThroughs:b,queryParams:j,localVariables:k,formBodyEntries:R,autoTriggerNext:typeof t.autoTriggerNext=="boolean"?t.autoTriggerNext:s.autoTriggerNext,enabled:typeof t.enabled=="boolean"?t.enabled:s.enabled,status:"idle",responsePreview:s.responsePreview,lastRunAt:void 0,lastRequest:void 0})},de=(t,n)=>{const s={id:J("node"),label:`노드 ${t+1}`,description:"",method:"POST",url:"",body:`{
  
}`,headers:[L()],useGlobalHeaders:!0,passThroughs:[Re()],queryParams:[q("query")],localVariables:[],formBodyEntries:[q("form")],responsePreview:`{
  "status": "idle"
}`,autoTriggerNext:!1,enabled:!1,status:"idle",lastRunAt:void 0,lastRequest:void 0};return Ee({...s,...n})},Ft=()=>{const t=de(0,{label:"1. 로그인 - 토큰 발급",description:"http://localhost:4000/login 호출 후 응답에서 토큰을 추출합니다.",url:"http://localhost:4000/login",method:"POST",headers:[L({key:"Content-Type",value:"application/json"})],body:`{
  "username": "demo",
  "password": "demo1234"
}`,passThroughs:[Re({label:"토큰",jsonPath:"$.data.token",targetKey:"common_token"})]}),n=de(1,{label:"2. 게시글 등록",description:"1번 노드가 저장한 {{common_token}} 값을 Authorization 헤더와 본문에서 재사용합니다.",url:"http://localhost:4000/posts",method:"POST",useGlobalHeaders:!1,headers:[L({key:"Authorization",value:"Bearer {{common_token}}"}),L({key:"Content-Type",value:"application/json"})],body:`{
  "title": "자동 등록 게시글",
  "token": "{{common_token}}"
}`,passThroughs:[Re({label:"게시글 ID",jsonPath:"$.data.id",targetKey:"post_id"})]}),s=de(2,{label:"3. 게시글 목록 조회",description:"등록된 게시글 리스트를 조회합니다.",url:"http://localhost:4000/posts",method:"GET",useGlobalHeaders:!1,headers:[L({key:"Authorization",value:"Bearer {{common_token}}"})],passThroughs:[Re({label:"첫 번째 게시글 ID",jsonPath:"$.data[0].id",targetKey:"latest_post_id"})],body:"{}"}),i=de(3,{label:"4. 게시글 수정",description:"생성된 post_id를 이용해 게시글을 수정합니다.",url:"http://localhost:4000/posts/{post_id}",method:"PUT",useGlobalHeaders:!1,headers:[L({key:"Authorization",value:"Bearer {{common_token}}"}),L({key:"Content-Type",value:"application/json"})],body:`{
  "title": "게시글 제목 수정",
  "status": "updated"
}`,localVariables:[q("var",{key:"post_id"})]}),l=de(4,{label:"5. 게시글 삭제",description:"post_id를 사용해 게시글을 삭제합니다.",url:"http://localhost:4000/posts/{post_id}",method:"DELETE",useGlobalHeaders:!1,headers:[L({key:"Authorization",value:"Bearer {{common_token}}"})],localVariables:[q("var",{key:"post_id"})]});return[t,n,s,i,l]},Gt=()=>{const t=m.useMemo(()=>Ft(),[]),[n,s]=m.useState(()=>Je(t)),i=m.useRef({}),[l,b]=m.useState(t[0]?.id??null),[j,k]=m.useState([{id:J("gh"),key:"Content-Type",value:"application/json",enabled:!0}]),[R,f]=m.useState(!1),[Y,se]=m.useState({}),[ge,G]=m.useState(0),N=m.useMemo(()=>Lt(n.order),[n.order]),B=Math.min(ge,Math.max(N.length-1,0)),P=N[B]?.nodeIds??[],Z=m.useMemo(()=>Bt(n,P),[n,P]),ne=m.useMemo(()=>N.map(o=>({index:o.index,label:`그룹 ${o.index+1}`,rangeLabel:o.nodeIds.length>0?`${o.start+1}-${o.end}`:"노드 없음",nodeCount:o.nodeIds.length})),[N]),Se=n.order.length;m.useEffect(()=>{if(l&&n.meta[l])return;const o=n.order[0];b(o??null)},[n.order,n.meta,l]),m.useEffect(()=>{G(o=>{const c=Math.max(N.length-1,0);return o>c?c:o})},[N.length]),m.useEffect(()=>{if(!l)return;const o=n.order.indexOf(l);if(o===-1)return;const c=Math.floor(o/Ye);G(d=>d===c?d:c)},[l,n.order]);const re=m.useCallback(()=>l?Ie(n,l):null,[n,l]),U=m.useCallback(o=>{const c=Math.max(N.length-1,0),d=Math.min(Math.max(o,0),c);G(d),b(u=>{const h=N[d];return!h||u&&h.nodeIds.includes(u)?u:h.nodeIds[0]??u})},[N]),x=m.useCallback((o,c)=>{s(d=>{const u=Ie(d,o);if(!u)return d;const h=Ee(c(u));return Ue(d,h)})},[]),$=()=>{s(o=>{const c=Ee(de(o.order.length));return b(c.id),{...Ue(o,c),order:[...o.order,c.id]}})},ee=o=>()=>{s(c=>{const d=Ie(c,o);if(!d)return c;const u=Ee({...d,id:J("node"),label:`${d.label} (복제)`,status:"idle",responsePreview:"",lastRunAt:void 0,lastRequest:void 0,headers:d.headers.map(C=>({...C,id:J("hdr")})),passThroughs:d.passThroughs.map(C=>({...C,id:J("map"),preview:void 0})),formBodyEntries:d.formBodyEntries.map(C=>({...C,id:J("form")}))});return b(u.id),{...Ue(c,u),order:[...c.order,u.id]}})},M=o=>c=>{c.stopPropagation(),s(d=>{if(d.order.length===1)return d;const u=d.order.filter(A=>A!==o),h=A=>{const{[o]:E,...O}=A;return O},C={order:u,meta:h(d.meta),body:h(d.body),headers:h(d.headers),passThroughs:h(d.passThroughs),queryParams:h(d.queryParams),localVariables:h(d.localVariables),formBodyEntries:h(d.formBodyEntries),runtime:h(d.runtime)},S={...i.current};return delete S[o],i.current=S,C})},Ne=m.useCallback(async(o,c,d=new Set)=>{if(d.has(o))return;d.add(o);const u=Ie(n,o);if(!u)return;if(!u.url.trim()){x(o,T=>({...T,status:"error",responsePreview:JSON.stringify({error:"요청 URL을 입력하세요."},null,2)}));return}const h=c??Y,C=ot(u.localVariables,h),S=Object.keys(C).length>0?{...h,...C}:h,A=new Date,E={...u.useGlobalHeaders?at(j,S):{},...at(u.headers,S)},V=Object.entries(E).find(([T])=>T.toLowerCase()==="content-type")?.[1]?.toLowerCase(),te={...E};u.method==="GET"&&Object.keys(te).forEach(T=>{T.toLowerCase()==="content-type"&&delete te[T]});const Te=ce(u.url,S),Pe=Ht(u.body,S),r=ot(u.queryParams,S),a={method:u.method,url:Te,headers:te};Object.keys(r).length>0&&(a.params=r);const y=u.formBodyEntries.filter(T=>T.enabled&&T.key.trim());if((V?.includes("application/x-www-form-urlencoded")??!1)&&y.length>0){const T=new URLSearchParams;y.forEach(K=>{const _=ce(K.key,S);_&&T.append(_,ce(K.value,S))});const F=T.toString();if(u.method==="GET"){const K=Array.from(T.entries()).reduce((_,[me,oe])=>(_[me]=oe,_),{});a.params={...a.params??{},...K}}else a.data=F}else Pe!==void 0&&(u.method==="GET"?a.params={...a.params??{},...Pe}:a.data=Pe);const pe={url:Te,method:u.method,headers:te,body:a.data,params:a.params};x(o,T=>({...T,lastRunAt:A.toISOString(),status:"running",responsePreview:JSON.stringify({status:"running",startedAt:A.toLocaleString()},null,2),lastRequest:pe}));try{const F=(await yt(a)).data;i.current={...i.current,[o]:F};const{updatedRows:K,variables:_}=We(F,u.passThroughs),me=Object.keys(_).length>0?{...S,..._}:S;if(x(o,oe=>({...oe,lastRunAt:new Date().toISOString(),status:"success",responsePreview:JSON.stringify(F,null,2),passThroughs:K,lastRequest:pe})),Object.keys(_).length>0&&se(oe=>({...oe,..._})),R&&u.autoTriggerNext){const oe=n.order.findIndex(ft=>ft===o),st=oe>=0?n.order[oe+1]:void 0;st&&await Ne(st,me,d)}}catch(T){if(bt(T)){const F=T.response?.data;i.current={...i.current,[o]:F};const{updatedRows:K,variables:_}=We(F,u.passThroughs);x(o,me=>({...me,lastRunAt:new Date().toISOString(),status:"error",responsePreview:JSON.stringify(F??{status:T.response?.status??"error",message:T.message},null,2),passThroughs:K,lastRequest:pe})),Object.keys(_).length>0&&se(me=>({...me,..._}));return}i.current={...i.current,[o]:void 0},x(o,F=>({...F,lastRunAt:new Date().toISOString(),status:"error",responsePreview:JSON.stringify({status:"error",message:String(T)},null,2),passThroughs:F.passThroughs.map(K=>({...K,preview:void 0})),lastRequest:pe}))}},[n,Y,j,R,x]),$e=o=>async c=>{c?.stopPropagation(),await Ne(o)},ue=m.useCallback((o,c,d)=>{x(o,u=>{let h={...u,[c]:d};if(c==="url"&&typeof d=="string"){const C=new Set,S=d;for(let E=0;E<S.length;E++)if(S[E]==="{"){if(S[E+1]==="{"){E++;continue}const O=S.indexOf("}",E+1);if(O===-1)break;if(S[O+1]==="}"){E=O+1;continue}const V=S.slice(E+1,O).trim();V&&C.add(V),E=O}const A=Array.from(C).map(E=>h.localVariables.find(V=>V.key===E)??q("var",{key:E}));h={...h,localVariables:A}}return h})},[x]),xe=m.useCallback(()=>{const o=n.order.map(h=>Ie(n,h)).filter(h=>!!h).map(h=>({...h})),c={version:wt,nodes:o,globalHeaders:j,autoRunAll:R},d=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),u=`api-flow-${new Date().toISOString().slice(0,10)}.json`;jt.saveAs(d,u)},[n,j,R]),Ve=m.useCallback(async o=>{if(o)try{const c=await o.text(),d=JSON.parse(c);if(!d||!Array.isArray(d.nodes))throw new Error("Invalid flow snapshot");const u=d.nodes.map((C,S)=>Mt(C,S)),h=Array.isArray(d.globalHeaders)&&d.globalHeaders.length>0?d.globalHeaders.map(C=>mt(C)):j;s(Je(u)),b(u[0]?.id??null),k(h),f(typeof d.autoRunAll=="boolean"?d.autoRunAll:!1),se({}),i.current={}}catch(c){console.error(c),window.alert("JSON 파일을 불러오는 중 오류가 발생했습니다.")}},[j]),_e=m.useCallback(async o=>{if(o)try{const c=await o.text(),d=JSON.parse(c),u=qt(d);if(!u.length){window.alert("OpenAPI 문서에서 변환할 경로를 찾지 못했습니다.");return}s(Je(u)),b(u[0]?.id??null),se({}),i.current={},window.alert(`OpenAPI 문서에서 ${u.length}개의 노드를 변환했습니다.`)}catch(c){console.error(c),window.alert("OpenAPI 문서를 불러오는 중 오류가 발생했습니다.")}},[]);return{nodes:Z,nodeGroups:ne,activeGroupIndex:ge,handleGroupChange:U,totalNodeCount:Se,selectedNodeId:l,setSelectedNodeId:b,globalHeaders:j,autoRunAll:R,setAutoRunAll:f,handleAddNode:$,handleCloneNode:ee,handleRemoveNode:M,handleRunNode:$e,handleNodeFieldChange:ue,handleSelectedNodeChange:(o,c)=>{l&&ue(l,o,c)},handleHeaderChange:(o,c,d,u)=>{if(o){x(o,h=>({...h,headers:h.headers.map(C=>C.id===c?{...C,[d]:u}:C)}));return}k(h=>h.map(C=>C.id===c?{...C,[d]:u}:C))},handleAddHeaderRow:o=>()=>{if(o){x(o,c=>({...c,headers:[...c.headers,L()]}));return}k(c=>[...c,L()])},handleRemoveHeaderRow:(o,c)=>()=>{if(o){x(o,d=>({...d,headers:d.headers.filter(u=>u.id!==c)}));return}k(d=>d.filter(u=>u.id!==c))},handleAddPassThrough:()=>{l&&x(l,o=>({...o,passThroughs:[...o.passThroughs,Re()]}))},handlePassThroughChange:(o,c,d)=>{if(!l)return;const u=i.current[l];x(l,h=>{const C=h.passThroughs.map(A=>A.id===o?{...A,[c]:d}:A);if(!u)return{...h,passThroughs:C.map(A=>A.id===o?{...A,preview:void 0}:A)};const{updatedRows:S}=We(u,C);return{...h,passThroughs:S}})},handleRemovePassThrough:o=>()=>{l&&x(l,c=>({...c,passThroughs:c.passThroughs.filter(d=>d.id!==o)}))},headerHelper:o=>o?"공통 헤더와 병합되어 전송됩니다.":"이 노드에서만 사용될 헤더입니다.",flowVariables:Y,handleExportFlow:xe,handleImportFlow:Ve,handleQueryParamChange:(o,c,d)=>{l&&x(l,u=>({...u,queryParams:u.queryParams.map(h=>h.id===o?{...h,[c]:d}:h)}))},handleAddQueryParam:()=>{l&&x(l,o=>({...o,queryParams:[...o.queryParams,q("query")]}))},handleRemoveQueryParam:o=>()=>{l&&x(l,c=>({...c,queryParams:c.queryParams.filter(d=>d.id!==o)}))},handleLocalVariableChange:(o,c,d)=>{l&&x(l,u=>({...u,localVariables:u.localVariables.map(h=>h.id===o?{...h,[c]:d}:h)}))},handleFormBodyChange:(o,c,d)=>{l&&x(l,u=>({...u,formBodyEntries:u.formBodyEntries.map(h=>h.id===o?{...h,[c]:d}:h)}))},handleAddFormBodyEntry:()=>{l&&x(l,o=>({...o,formBodyEntries:[...o.formBodyEntries,q("form")]}))},handleRemoveFormBodyEntry:o=>()=>{l&&x(l,c=>({...c,formBodyEntries:c.formBodyEntries.filter(d=>d.id!==o)}))},handleImportOpenApi:_e,getSelectedNodeData:re}},Ce=({variables:t,onInsert:n})=>{const[s,i]=m.useState(null),l=Object.entries(t),b=!!s,j=f=>{f.stopPropagation(),i(f.currentTarget)},k=()=>i(null),R=f=>{n(`{{${f}}}`),k()};return e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"small",onClick:j,disabled:l.length===0,children:e.jsx(At,{fontSize:"small"})}),e.jsx(Et,{anchorEl:s,open:b,onClose:k,children:l.length===0?e.jsx(Qe,{disabled:!0,children:"저장된 변수가 없습니다"}):l.map(([f,Y])=>e.jsx(Qe,{onClick:()=>R(f),children:e.jsxs(p,{spacing:.5,children:[e.jsx(v,{variant:"body2",fontWeight:600,children:f}),e.jsx(v,{variant:"caption",color:"text.secondary",children:Y})]})},f))})]})},Dt={idle:{label:"대기",color:"text.disabled"},running:{label:"실행 중",color:"warning.main"},success:{label:"성공",color:"success.main"},error:{label:"실패",color:"error.main"}},Jt=({status:t})=>{const n=Dt[t];return e.jsxs(p,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(z,{sx:{width:10,height:10,borderRadius:"50%",bgcolor:n.color,transition:"background-color 0.2s ease"}}),e.jsx(v,{variant:"caption",color:"text.secondary",children:n.label})]})},Oe=({hidden:t,children:n,sx:s})=>t?null:e.jsx(p,{spacing:1.25,sx:{mt:2,flex:1,minHeight:0,overflow:"auto",...s},children:n}),Ut=520,qe=320,lt=420,it=["Content-Type","Accept","Authorization","User-Agent","Cache-Control","X-Request-Id"],dt={"content-type":["application/json","application/xml","application/x-www-form-urlencoded","multipart/form-data","text/plain","text/html","application/octet-stream"],accept:["application/json","application/xml","text/plain","text/html","*/*"]},ct=t=>{const n=t?.trim().toLowerCase();return n&&n in dt?dt[n]:[]},Zt=()=>{const{nodes:t,nodeGroups:n,activeGroupIndex:s,handleGroupChange:i,totalNodeCount:l,selectedNodeId:b,setSelectedNodeId:j,globalHeaders:k,autoRunAll:R,setAutoRunAll:f,handleAddNode:Y,handleCloneNode:se,handleRemoveNode:ge,handleRunNode:G,handleNodeFieldChange:N,handleSelectedNodeChange:B,handleHeaderChange:P,handleAddHeaderRow:Z,handleRemoveHeaderRow:ne,handleAddPassThrough:Se,handlePassThroughChange:re,handleRemovePassThrough:U,flowVariables:x,handleExportFlow:$,handleImportFlow:ee,handleQueryParamChange:M,handleAddQueryParam:Ne,handleRemoveQueryParam:$e,handleLocalVariableChange:ue,handleFormBodyChange:xe,handleAddFormBodyEntry:Ve,handleRemoveFormBodyEntry:_e,handleImportOpenApi:et,getSelectedNodeData:Me}=Gt(),g=m.useMemo(()=>Me(),[Me]),H=ut(),W=Ct(H.breakpoints.down("md")),[fe,Fe]=m.useState("request"),Ge=m.useRef(null),De=m.useRef(null),I=m.useMemo(()=>({"& .MuiInputBase-input":{fontSize:H.typography.body2.fontSize},"& .MuiInputLabel-root":{fontSize:H.typography.body2.fontSize}}),[H.typography.body2.fontSize]),he=m.useRef(null),ye=m.useRef(!1),[tt,we]=m.useState(Ut),[ae,o]=m.useState("headers"),c=m.useMemo(()=>{if(!g)return;const r=g.headers.find(a=>a.enabled&&a.key.trim().toLowerCase()==="content-type");if(r?.value.trim())return r.value.trim().toLowerCase();if(g.useGlobalHeaders)return k.find(y=>y.enabled&&y.key.trim().toLowerCase()==="content-type")?.value.trim().toLowerCase()},[g,k]),d=!!(c&&c.includes("application/x-www-form-urlencoded")),u=n[s]??null,h=()=>{Ge.current?.click()},C=r=>{const a=r.target.files?.[0]??null;ee(a),r.target.value=""},S=()=>{De.current?.click()},A=r=>{const a=r.target.files?.[0]??null;et(a),r.target.value=""};m.useEffect(()=>{Fe("request")},[g?.id]),m.useEffect(()=>{g&&g.method==="GET"&&ae==="body"&&o("query")},[g?.method,ae]);const E=(r,a)=>{Fe(a)},O=m.useCallback(r=>{const a=he.current?.getBoundingClientRect().width??0;if(!a)return Math.max(r,qe);const y=Math.max(a-lt,qe);return Math.min(Math.max(r,qe),y)},[]),V=m.useCallback(r=>{if(!he.current)return;const a=he.current.getBoundingClientRect();we(O(r-a.left))},[O]),te=m.useCallback(()=>{ye.current&&(ye.current=!1,typeof document<"u"&&(document.body.style.cursor="",document.body.style.userSelect=""))},[]),Te=m.useCallback(r=>{if(!W)if(r.preventDefault(),ye.current=!0,typeof document<"u"&&(document.body.style.cursor="col-resize",document.body.style.userSelect="none"),"touches"in r){const a=r.touches[0];a&&V(a.clientX)}else V(r.clientX)},[W,V]);m.useEffect(()=>{const r=be=>{ye.current&&(be.preventDefault(),V(be.clientX))},a=be=>{if(!ye.current)return;const pe=be.touches[0];pe&&(be.preventDefault(),V(pe.clientX))},y=()=>te();return window.addEventListener("mousemove",r),window.addEventListener("mouseup",y),window.addEventListener("touchmove",a,{passive:!1}),window.addEventListener("touchend",y),window.addEventListener("touchcancel",y),()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",y),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",y),window.removeEventListener("touchcancel",y)}},[te,V]),m.useEffect(()=>{if(!he.current)return;const r=new ResizeObserver(()=>{we(a=>O(a))});return r.observe(he.current),()=>r.disconnect()},[O]),m.useEffect(()=>{if(!(typeof window>"u"))return()=>{}},[]),m.useEffect(()=>{if(W){te();return}we(r=>O(r))},[W,O,te]);const Pe=W?"1fr":`minmax(${qe}px, ${Math.round(tt)}px) 6px minmax(${lt}px, 1fr)`;return e.jsxs(ie,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:785,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden"},children:[e.jsx("input",{ref:Ge,type:"file",accept:"application/json,.json",style:{display:"none"},onChange:C}),e.jsx("input",{ref:De,type:"file",accept:"application/json,.json",style:{display:"none"},onChange:A}),e.jsxs(z,{ref:he,sx:{flex:1,minHeight:685,width:1,display:"grid",gridTemplateColumns:Pe,gridTemplateRows:"1fr",columnGap:W?0:1,rowGap:1.25,alignItems:"stretch",overflow:"hidden",touchAction:W?"auto":"none"},children:[e.jsxs(p,{component:ie,variant:"outlined",spacing:1.2,sx:{p:1.25,minHeight:0,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(p,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",flexShrink:0,children:[e.jsxs(p,{direction:"row",spacing:1,children:[e.jsx(D,{startIcon:e.jsx(je,{}),onClick:Y,size:"small",variant:"contained",children:"추가"}),e.jsx(D,{startIcon:e.jsx(kt,{}),onClick:$,size:"small",variant:"outlined",children:"저장"}),e.jsx(D,{startIcon:e.jsx(Rt,{}),onClick:h,size:"small",variant:"outlined",children:"불러오기"})]}),e.jsx(D,{startIcon:e.jsx(St,{}),onClick:S,size:"small",variant:"outlined",children:"OpenAPI 변환"})]}),e.jsxs(p,{spacing:1.25,flexShrink:0,children:[e.jsx(ie,{variant:"outlined",sx:{p:1,bgcolor:"background.default"},children:e.jsxs(p,{spacing:1,children:[e.jsxs(p,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(v,{variant:"subtitle2",children:"공통 헤더"}),e.jsx(D,{size:"small",startIcon:e.jsx(je,{}),onClick:Z(null),children:"헤더 추가"})]}),e.jsx(p,{spacing:1,maxHeight:100,overflow:"auto",children:k.map(r=>e.jsxs(p,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(ze,{freeSolo:!0,options:it,value:r.key,onInputChange:(a,y)=>P(null,r.id,"key",y??""),onChange:(a,y)=>P(null,r.id,"key",typeof y=="string"?y:""),sx:{width:160,flexShrink:0},renderInput:a=>e.jsx(w,{...a,size:"small",label:"Key",sx:{...I}})}),e.jsx(ze,{freeSolo:!0,options:ct(r.key),value:r.value,onInputChange:(a,y)=>P(null,r.id,"value",y??""),onChange:(a,y)=>P(null,r.id,"value",typeof y=="string"?y:""),sx:{flex:1},renderInput:a=>e.jsx(w,{...a,size:"small",label:"Value",sx:{...I}})}),e.jsxs(p,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(Q,{size:"small",checked:r.enabled,onChange:a=>P(null,r.id,"enabled",a.target.checked)}),e.jsx(v,{variant:"caption",color:"text.secondary",children:"활성"})]}),e.jsx(X,{size:"small",onClick:ne(null,r.id),children:e.jsx(ke,{fontSize:"small"})})]},r.id))})]})}),e.jsx(Ke,{control:e.jsx(Q,{size:"small",checked:R,onChange:r=>f(r.target.checked)}),label:"모든 노드 자동 실행"}),e.jsx(Tt,{flexItem:!0}),Object.keys(x).length>0&&e.jsx(ie,{variant:"outlined",sx:{p:1},children:e.jsxs(p,{spacing:1,children:[e.jsx(v,{variant:"subtitle2",children:"사용 가능한 변수"}),e.jsx(p,{direction:"row",spacing:1,flexWrap:"wrap",children:Object.entries(x).map(([r,a])=>e.jsx(ht,{label:`${r}: ${a}`,size:"small"},r))})]})})]}),n.length>1&&u&&e.jsxs(p,{spacing:.5,flexShrink:0,children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(v,{variant:"subtitle2",children:"노드 페이지"}),e.jsxs(v,{variant:"caption",color:"text.secondary",children:[u.rangeLabel," (",u.nodeCount,"개)"]})]}),e.jsx(Pt,{count:n.length,page:s+1,onChange:(r,a)=>i(a-1),color:"primary",size:"small",siblingCount:0,boundaryCount:1})]}),e.jsx(gt,{nodes:t,selectedNodeId:b,onSelect:j,onRunNode:G,onCloneNode:se,onRemoveNode:ge,onToggleField:N,disableRemove:l===1})]}),!W&&e.jsx(z,{sx:{width:6,justifySelf:"stretch",cursor:"col-resize",bgcolor:"divider","&:hover":{bgcolor:"action.hover"},borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none"},onMouseDown:Te,onTouchStart:Te,children:e.jsxs(z,{sx:{display:"flex",flexDirection:"column",gap:.25},children:[e.jsx(z,{sx:{width:2,height:2,bgcolor:"text.secondary",borderRadius:"50%"}}),e.jsx(z,{sx:{width:2,height:2,bgcolor:"text.secondary",borderRadius:"50%"}}),e.jsx(z,{sx:{width:2,height:2,bgcolor:"text.secondary",borderRadius:"50%"}})]})}),e.jsx(ie,{variant:"outlined",sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,minHeight:0,overflow:"hidden",height:"100%"},children:g?e.jsxs(p,{spacing:1.2,sx:{flex:1,minHeight:0},children:[e.jsxs(p,{direction:{xs:"column",md:"row"},spacing:1.25,children:[e.jsx(w,{size:"small",label:"노드 이름",value:g.label,onChange:r=>B("label",r.target.value),fullWidth:!0,sx:I}),e.jsx(w,{select:!0,size:"small",label:"HTTP Method",value:g.method,onChange:r=>B("method",r.target.value),sx:{width:W?1:160,...I},children:Ze.map(r=>e.jsx(Qe,{value:r,children:r},r))})]}),e.jsx(w,{size:"small",label:"요청 URL",value:g.url,placeholder:"https://api.example.com/login",onChange:r=>B("url",r.target.value),fullWidth:!0,sx:I,InputProps:{endAdornment:e.jsxs(ve,{position:"end",children:[e.jsx(Ce,{variables:x,onInsert:r=>B("url",`${g.url}${r}`)}),e.jsx(Ae,{title:"이 노드만 실행",children:e.jsx(X,{size:"small",onClick:G(g.id),children:e.jsx(Xe,{fontSize:"small"})})})]})}}),e.jsx(w,{size:"small",label:"설명",value:g.description,onChange:r=>B("description",r.target.value),fullWidth:!0,multiline:!0,minRows:2,sx:I}),e.jsx(p,{direction:{xs:"column",md:"row"},spacing:1.25,alignItems:"center",children:e.jsx(Ke,{control:e.jsx(Q,{size:"small",checked:g.useGlobalHeaders,onChange:r=>B("useGlobalHeaders",r.target.checked)}),label:"공통 헤더 사용"})}),e.jsxs(rt,{value:fe,onChange:E,"aria-label":"요청/응답 탭",textColor:"primary",indicatorColor:"primary",children:[e.jsx(le,{label:"요청",value:"request"}),e.jsx(le,{label:"응답",value:"response"}),e.jsx(le,{label:"요청 로그",value:"requestLog"}),e.jsx(le,{label:"변수 설정",value:"variables"})]}),e.jsxs(z,{sx:{flex:1,minHeight:0,overflow:"auto",pr:.5},children:[e.jsxs(Oe,{hidden:fe!=="request",sx:{flex:1,minHeight:0,overflow:"hidden",p:0,m:0},children:[e.jsxs(rt,{value:ae,onChange:(r,a)=>o(a),textColor:"primary",indicatorColor:"primary",sx:{mb:1},children:[e.jsx(le,{label:"요청 헤더",value:"headers"}),e.jsx(le,{label:"Query Param",value:"query"}),e.jsx(le,{label:"Path 변수",value:"path"}),e.jsx(le,{label:"Request Value",value:"body"})]}),ae==="headers"&&e.jsxs(z,{sx:{p:1,border:`1px solid ${H.palette.divider}`,borderRadius:2,bgcolor:"background.default"},children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1},children:[e.jsx(v,{variant:"subtitle2",children:"요청 헤더"}),e.jsx(D,{size:"small",startIcon:e.jsx(je,{}),onClick:Z(g.id),children:"헤더 추가"})]}),e.jsx(p,{spacing:1.25,children:g.headers.map(r=>e.jsxs(p,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(Q,{size:"small",checked:r.enabled,onChange:a=>P(g.id,r.id,"enabled",a.target.checked)}),e.jsx(ze,{freeSolo:!0,options:it,value:r.key,onInputChange:(a,y)=>P(g.id,r.id,"key",y??""),onChange:(a,y)=>P(g.id,r.id,"key",typeof y=="string"?y:""),sx:{flex:1},renderInput:a=>e.jsx(w,{...a,label:"Key",size:"small",sx:{flex:1,...I},InputProps:{...a.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[e.jsx(ve,{position:"end",children:e.jsx(Ce,{variables:x,onInsert:y=>P(g.id,r.id,"key",`${r.key}${y}`)})}),a.InputProps.endAdornment]})}})}),e.jsx(ze,{freeSolo:!0,options:ct(r.key),value:r.value,onInputChange:(a,y)=>P(g.id,r.id,"value",y??""),onChange:(a,y)=>P(g.id,r.id,"value",typeof y=="string"?y:""),sx:{flex:2},renderInput:a=>e.jsx(w,{...a,label:"Value",size:"small",sx:{flex:1,...I},InputProps:{...a.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[e.jsx(ve,{position:"end",children:e.jsx(Ce,{variables:x,onInsert:y=>P(g.id,r.id,"value",`${r.value}${y}`)})}),a.InputProps.endAdornment]})}})}),e.jsx(X,{size:"small",onClick:ne(g.id,r.id),children:e.jsx(ke,{fontSize:"small"})})]},r.id))})]}),ae==="query"&&e.jsxs(z,{sx:{p:1,border:`1px solid ${H.palette.divider}`,borderRadius:2,bgcolor:"background.default"},children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1},children:[e.jsx(v,{variant:"subtitle2",children:"Query Parameters"}),e.jsx(D,{size:"small",startIcon:e.jsx(je,{}),onClick:Ne,children:"파라미터 추가"})]}),g.method==="GET"&&e.jsx(v,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"GET 요청은 Body 대신 Query Param을 사용하는 것이 일반적입니다."}),e.jsx(p,{spacing:1,children:g.queryParams.map(r=>e.jsxs(p,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(Q,{size:"small",checked:r.enabled,onChange:a=>M(r.id,"enabled",a.target.checked)}),e.jsx(w,{label:"Key",size:"small",value:r.key,onChange:a=>M(r.id,"key",a.target.value),sx:{flex:1,...I}}),e.jsx(w,{label:"Value",size:"small",value:r.value,onChange:a=>M(r.id,"value",a.target.value),sx:{flex:1,...I},InputProps:{endAdornment:e.jsx(ve,{position:"end",children:e.jsx(Ce,{variables:x,onInsert:a=>M(r.id,"value",`${r.value}${a}`)})})}}),e.jsx(X,{size:"small",onClick:$e(r.id),children:e.jsx(ke,{fontSize:"small"})})]},r.id))})]}),ae==="path"&&e.jsxs(z,{sx:{p:1,border:`1px solid ${H.palette.divider}`,borderRadius:2,bgcolor:"background.default"},children:[e.jsx(p,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1},children:e.jsx(v,{variant:"subtitle2",children:"Path / Form 변수"})}),g.localVariables.filter(r=>r.key).length===0?e.jsxs(v,{variant:"body2",color:"text.secondary",children:["URL에 ","{path_param}"," 형식으로 변수를 작성하면 자동으로 목록이 생성됩니다."]}):e.jsx(p,{spacing:1,children:g.localVariables.filter(r=>r.key).map(r=>e.jsxs(p,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(Q,{size:"small",checked:r.enabled,onChange:a=>ue(r.id,"enabled",a.target.checked)}),e.jsx(w,{label:"Key",size:"small",value:r.key,onChange:a=>ue(r.id,"key",a.target.value),sx:{flex:1,...I},helperText:"예: post_id / user_token"}),e.jsx(w,{label:"Value",size:"small",value:r.value,onChange:a=>ue(r.id,"value",a.target.value),sx:{flex:1,...I},InputProps:{endAdornment:e.jsx(ve,{position:"end",children:e.jsx(Ce,{variables:x,onInsert:a=>ue(r.id,"value",`${r.value}${a}`)})})}})]},r.id))})]}),ae==="body"&&e.jsxs(p,{spacing:1,sx:{flex:1,minHeight:0},children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(v,{variant:"subtitle2",children:"Request Value"}),d?e.jsx(v,{variant:"caption",color:"text.secondary",children:"Content-Type이 form-urlencoded이므로 아래 폼을 사용해 값을 입력하세요."}):e.jsx(Ae,{title:"샘플 JSON 입력 후 실행하면 응답이 우측에서 확인됩니다.",children:e.jsx(nt,{fontSize:"small",color:"action"})})]}),d?e.jsxs(ie,{variant:"outlined",sx:{p:1},children:[e.jsxs(p,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(v,{variant:"subtitle2",children:"Form 필드"}),e.jsx(D,{size:"small",startIcon:e.jsx(je,{}),onClick:Ve,children:"필드 추가"})]}),e.jsx(p,{spacing:1,children:g.formBodyEntries.map(r=>e.jsxs(p,{direction:{xs:"column",sm:"row"},spacing:1,children:[e.jsx(Q,{size:"small",checked:r.enabled,onChange:a=>xe(r.id,"enabled",a.target.checked)}),e.jsx(w,{size:"small",label:"Key",value:r.key,onChange:a=>xe(r.id,"key",a.target.value),sx:{flex:1,...I}}),e.jsx(w,{size:"small",label:"Value",value:r.value,onChange:a=>xe(r.id,"value",a.target.value),sx:{flex:1,...I},InputProps:{endAdornment:e.jsx(ve,{position:"end",children:e.jsx(Ce,{variables:x,onInsert:a=>xe(r.id,"value",`${r.value}${a}`)})})}}),e.jsx(X,{size:"small",onClick:_e(r.id),children:e.jsx(ke,{fontSize:"small"})})]},r.id))})]}):e.jsx(z,{sx:{border:`1px solid ${H.palette.divider}`,borderRadius:1,overflow:"hidden"},children:e.jsx(He,{height:"100%",defaultLanguage:c?.includes("xml")?"xml":c?.includes("html")?"html":"json",theme:H.palette.mode==="dark"?"vs-dark":"vs-light",value:g.body,onChange:r=>B("body",r??""),options:{minimap:{enabled:!1},fontSize:13,scrollBeyondLastLine:!1}})})]})]}),e.jsx(Oe,{hidden:fe!=="response",sx:{flex:1,minHeight:0,overflow:"hidden"},children:e.jsxs(p,{spacing:1,sx:{flex:1,minHeight:0},children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(v,{variant:"subtitle2",children:"응답 미리보기"}),e.jsxs(p,{direction:"row",spacing:1,children:[e.jsx(D,{size:"small",startIcon:e.jsx(Xe,{}),variant:"contained",onClick:G(g.id),children:"실행"}),e.jsx(D,{size:"small",startIcon:e.jsx(It,{}),variant:"outlined",onClick:()=>B("responsePreview",`{
  "status": "cleared"
}`),children:"초기화"})]})]}),e.jsx(z,{sx:{border:`1px solid ${H.palette.divider}`,borderRadius:1,overflow:"hidden",height:"calc(100vh - 677px)"},children:e.jsx(He,{height:"100%",defaultLanguage:"json",theme:H.palette.mode==="dark"?"vs-dark":"vs-light",value:g.responsePreview,onChange:r=>B("responsePreview",r??""),options:{minimap:{enabled:!1},readOnly:!1,scrollBeyondLastLine:!1,fontSize:13}})})]})}),e.jsx(Oe,{hidden:fe!=="requestLog",sx:{flex:1,minHeight:0,overflow:"hidden"},children:g.lastRequest?e.jsxs(p,{spacing:1.25,sx:{flex:1,minHeight:0},children:[e.jsxs(p,{spacing:.5,children:[e.jsx(v,{variant:"subtitle2",children:"요청 URL"}),e.jsx(v,{variant:"body2",color:"text.secondary",children:g.lastRequest.url})]}),e.jsxs(p,{spacing:.5,children:[e.jsx(v,{variant:"subtitle2",children:"HTTP Method"}),e.jsx(v,{variant:"body2",color:"text.secondary",children:g.lastRequest.method})]}),e.jsxs(p,{direction:{xs:"column",md:"row"},spacing:1.25,sx:{flex:1,minHeight:0},children:[e.jsxs(z,{sx:{flex:1,minHeight:0},children:[e.jsx(v,{variant:"subtitle2",sx:{mb:.5},children:"Headers"}),e.jsx(z,{sx:{border:`1px solid ${H.palette.divider}`,borderRadius:1,height:"100%",minHeight:160},children:e.jsx(He,{height:"100%",defaultLanguage:"json",theme:H.palette.mode==="dark"?"vs-dark":"vs-light",value:JSON.stringify(g.lastRequest.headers,null,2),options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:13}})})]}),e.jsxs(z,{sx:{flex:1,minHeight:0},children:[e.jsx(v,{variant:"subtitle2",sx:{mb:.5},children:"Body / Params"}),e.jsx(z,{sx:{border:`1px solid ${H.palette.divider}`,borderRadius:1,height:"100%",minHeight:160},children:e.jsx(He,{height:"100%",defaultLanguage:"json",theme:H.palette.mode==="dark"?"vs-dark":"vs-light",value:JSON.stringify(g.lastRequest.body??g.lastRequest.params??{},null,2),options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:13}})})]})]})]}):e.jsx(p,{flex:1,alignItems:"center",justifyContent:"center",spacing:1,sx:{color:"text.secondary",textAlign:"center"},children:e.jsx(v,{variant:"body2",children:"아직 요청 로그가 없습니다. 노드를 실행해 정보를 확인하세요."})})}),e.jsxs(Oe,{hidden:fe!=="variables",sx:{flex:1,minHeight:0,overflow:"hidden"},children:[e.jsxs(p,{spacing:1,sx:{flexShrink:0},children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(v,{variant:"subtitle2",children:"응답 변수 전달"}),e.jsx(D,{size:"small",startIcon:e.jsx(je,{}),onClick:Se,children:"전달 항목 추가"})]}),e.jsxs(v,{variant:"body2",color:"text.secondary",children:["JSONPath로 추출된 값은 ",e.jsx("code",{children:"{{변수명}}"})," 형태로 다음 노드의 URL, 헤더, 바디 어디에서든 사용할 수 있습니다."]}),e.jsxs(v,{variant:"caption",color:"text.secondary",children:["JSONPath는 실제 API 응답 본문(`response.data`)의 루트 기준입니다. 예: 위 구조에서 토큰 → ",e.jsx("code",{children:"$.token"})]})]}),e.jsx(p,{spacing:1.25,sx:{flex:1,minHeight:0,overflowY:"auto"},children:g.passThroughs.map(r=>e.jsx(ie,{variant:"outlined",sx:{p:1.25},children:e.jsxs(p,{spacing:1,children:[e.jsxs(p,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(Q,{size:"small",checked:r.enabled,onChange:a=>re(r.id,"enabled",a.target.checked)}),e.jsx(w,{label:"알리기 쉬운 이름",size:"small",sx:{flex:1,...I},value:r.label,onChange:a=>re(r.id,"label",a.target.value)}),e.jsx(w,{label:"다음 노드 변수명",size:"small",sx:{flex:1,...I},placeholder:"token",value:r.targetKey,onChange:a=>re(r.id,"targetKey",a.target.value)}),e.jsx(X,{size:"small",onClick:U(r.id),children:e.jsx(ke,{fontSize:"small"})})]}),e.jsx(w,{size:"small",label:"JSONPath",placeholder:"$.data.token",value:r.jsonPath,onChange:a=>re(r.id,"jsonPath",a.target.value),sx:I}),e.jsx(v,{variant:"caption",color:r.preview?"success.main":"text.secondary",children:r.preview?`최근 추출 값: ${r.preview}`:"최근 실행 기록이 없습니다."})]})},r.id))})]})]})]}):e.jsxs(p,{flex:1,alignItems:"center",justifyContent:"center",spacing:1,sx:{color:"text.secondary",textAlign:"center"},children:[e.jsx(nt,{fontSize:"large"}),e.jsx(v,{variant:"body2",children:"좌측에서 노드를 선택하면 상세 설정을 확인할 수 있습니다."})]})})]})]})},gt=m.memo(({nodes:t,selectedNodeId:n,onSelect:s,onRunNode:i,onCloneNode:l,onRemoveNode:b,onToggleField:j,disableRemove:k})=>e.jsx(p,{spacing:1,sx:{minHeight:500,overflowY:"auto",height:"calc(100vh - 480px)"},children:t.map(R=>e.jsx(xt,{node:R,selected:R.id===n,disableRemove:k,onSelect:s,onRunNode:i,onCloneNode:l,onRemoveNode:b,onToggleField:j},R.id))}));gt.displayName="NodeListPanel";const xt=m.memo(({node:t,selected:n,disableRemove:s,onSelect:i,onRunNode:l,onCloneNode:b,onRemoveNode:j,onToggleField:k})=>{const R=ut();return e.jsx(ie,{variant:n?"outlined":"elevation",elevation:n?0:1,sx:{p:1.2,borderColor:n?"primary.main":t.status==="error"?"error.light":t.status==="success"?"success.light":t.status==="running"?"warning.light":void 0,cursor:"pointer","&:hover":{borderColor:"primary.light"}},onClick:()=>i(t.id),children:e.jsxs(p,{spacing:1.2,children:[e.jsxs(p,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(p,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(ht,{label:t.method,color:"primary",size:"small",sx:{fontWeight:600},variant:"outlined"}),e.jsxs(p,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Q,{size:"small",checked:t.enabled,onChange:f=>{f.stopPropagation(),k(t.id,"enabled",f.target.checked)}}),e.jsx(v,{variant:"caption",color:"text.secondary",children:t.enabled?"활성":"비활성"}),e.jsx(Ke,{control:e.jsx(Q,{size:"small",checked:t.autoTriggerNext,onChange:f=>{f.stopPropagation(),k(t.id,"autoTriggerNext",f.target.checked)}}),label:e.jsx(v,{variant:"caption",color:"text.secondary",children:"다음 노드 자동 실행"}),onClick:f=>f.stopPropagation(),sx:{"& .MuiFormControlLabel-label":{fontSize:R.typography.body2.fontSize}}})]})]}),e.jsxs(p,{direction:"row",spacing:.5,children:[e.jsx(Ae,{title:"실행",children:e.jsx(X,{size:"small",onClick:l(t.id),children:e.jsx(Xe,{fontSize:"small"})})}),e.jsx(Ae,{title:"복제",children:e.jsx(X,{size:"small",onClick:b(t.id),children:e.jsx(Nt,{fontSize:"small"})})}),e.jsx(Ae,{title:"삭제",children:e.jsx("span",{children:e.jsx(X,{size:"small",disabled:s,onClick:j(t.id),children:e.jsx(ke,{fontSize:"small"})})})})]})]}),e.jsxs(p,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(v,{fontWeight:600,sx:{flex:1},children:t.label}),e.jsx(Jt,{status:t.status})]}),e.jsx(v,{variant:"body2",color:"text.secondary",noWrap:!0,children:t.url||"URL을 입력하세요"}),t.lastRunAt&&e.jsxs(v,{variant:"caption",color:"text.secondary",children:["최근 실행 ",new Date(t.lastRunAt).toLocaleTimeString()]})]})})},(t,n)=>{if(t.selected!==n.selected||t.disableRemove!==n.disableRemove||t.onSelect!==n.onSelect||t.onCloneNode!==n.onCloneNode||t.onRemoveNode!==n.onRemoveNode||t.onRunNode!==n.onRunNode||t.onToggleField!==n.onToggleField)return!1;const s=t.node,i=n.node;return s.id===i.id&&s.label===i.label&&s.method===i.method&&s.url===i.url&&s.enabled===i.enabled&&s.autoTriggerNext===i.autoTriggerNext&&s.status===i.status&&s.lastRunAt===i.lastRunAt});xt.displayName="NodeListItemCard";export{Zt as default};
