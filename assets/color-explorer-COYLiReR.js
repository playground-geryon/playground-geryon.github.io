import{r as s,j as e}from"./vendor-CRMzTT1s.js";import{u as Pe,B as v,S as z,a9 as Te,I as We,au as ie,T,ax as Ee,a as A,bx as $e,ad as Ue,Y as Q,a2 as re,av as de,a1 as Fe,y as Be,z as le,g as He,aT as qe,l as Ae,m as Oe,n as Xe,o as Ye,p as Ze,P as _e}from"./mui-CAFjvBaw.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";const Ge=700,he=o=>new Promise((t,i)=>{const a=new FileReader;a.onload=()=>t(String(a.result)),a.onerror=h=>i(h),a.readAsDataURL(o)}),Ne=o=>new Promise((t,i)=>{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>t(a),a.onerror=h=>i(h),a.src=o}),K=o=>o.toString(16).padStart(2,"0"),xe=(o,t,i)=>`#${K(o)}${K(t)}${K(i)}`,Ve=async o=>{const t=await fetch(o,{mode:"cors"});if(!t.ok)throw new Error("이미지를 불러오지 못했습니다.");const i=await t.blob();return he(new File([i],"remote-image"))},ce=async o=>{const t=await Ne(o),i=Math.min(Ge/Math.max(t.width,t.height),1),a=Math.max(1,Math.round(t.width*i)),h=Math.max(1,Math.round(t.height*i)),b=document.createElement("canvas");b.width=a,b.height=h;const S=b.getContext("2d",{willReadFrequently:!0});if(!S)throw new Error("캔버스를 초기화할 수 없습니다.");S.drawImage(t,0,0,a,h);const{data:g}=S.getImageData(0,0,a,h),x=new Map;for(let d=0;d<g.length;d+=4){if(g[d+3]===0)continue;const j=g[d],L=g[d+1],M=g[d+2],R=xe(j,L,M);x.set(R,(x.get(R)??0)+1)}const p=g.length/4;return{colors:Array.from(x.entries()).map(([d,y])=>({hex:d,count:y,percent:Number((y/p*100).toFixed(2))})).sort((d,y)=>y.count-d.count),totalPixels:p,uniqueCount:x.size,originalSize:{width:t.width,height:t.height}}},Je=()=>{const[o,t]=s.useState(null),[i,a]=s.useState([]),[h,b]=s.useState(0),[S,g]=s.useState(0),[x,p]=s.useState(null),[B,d]=s.useState(!1),[y,j]=s.useState(null),[L,M]=s.useState({width:0,height:0}),R=async I=>{d(!0),j(null);try{const w=await he(I);t(w),p(null);const r=await ce(w);a(r.colors),b(r.uniqueCount),g(r.totalPixels),M(r.originalSize)}catch(w){j(w?.message??"이미지 처리 중 오류가 발생했습니다."),a([]),b(0),g(0)}finally{d(!1)}},W=async I=>{d(!0),j(null);try{const w=await Ve(I);t(w),p(null);const r=await ce(w);a(r.colors),b(r.uniqueCount),g(r.totalPixels),M(r.originalSize)}catch(w){j(w?.message??"이미지 URL 처리 중 오류가 발생했습니다."),a([]),b(0),g(0)}finally{d(!1)}},H=I=>{const{r:w,g:r,b:D,a:q}=I,m=xe(w,r,D);p({hex:m,rgba:`rgba(${w}, ${r}, ${D}, ${q/255})`})},U=s.useMemo(()=>i.slice(0,300),[i]);return{imageSrc:o,colors:i,topColors:U,uniqueCount:h,totalPixels:S,pickedColor:x,loading:B,error:y,originalSize:L,handleFile:R,handleUrl:W,handlePick:H}},ue={border:"1px solid",borderColor:"divider",borderRadius:1.5,bgcolor:"background.paper",display:"flex",flexDirection:"column",overflow:"hidden",maxWidth:"100%"},Ke=({imageSrc:o,pickedColor:t,loading:i,error:a,originalSize:h,uniqueCount:b,totalPixels:S,pickerEnabled:g,onTogglePicker:x,zoom:p,onZoomChange:B,onResetZoom:d,inputRef:y,onUploadClick:j,onFileSelected:L,onOpenLinkDialog:M,canvasRef:R,canvasBoxRef:W,onCanvasClick:H,onCanvasMove:U,onCanvasLeave:I,onDropFile:w,hoverPreview:r,onCopyColor:D})=>{const q=Pe();return e.jsx(v,{sx:{...ue,minHeight:0,minWidth:0,flex:1},children:e.jsxs(v,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1,flex:1,minHeight:0},children:[e.jsxs(z,{direction:"row",spacing:1,flexWrap:"wrap",alignItems:"center",children:[e.jsxs(z,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:0,flexWrap:"wrap"},children:[e.jsx(Te,{title:"스포이드",children:e.jsx(We,{color:g?"primary":"default",onClick:x,"aria-label":"스포이드",size:"small",children:e.jsx(ie,{fontSize:"small"})})}),e.jsxs(z,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:0},children:[e.jsx(T,{variant:"caption",color:"text.secondary",sx:{whiteSpace:"nowrap"},children:"확대/축소"}),e.jsx(Ee,{size:"small",min:50,max:200,step:10,value:p,onChange:(m,k)=>{typeof k=="number"&&B(k)},valueLabelDisplay:"auto",valueLabelFormat:m=>`${m}%`,sx:{width:160},disabled:!o}),e.jsx(A,{size:"small",variant:"outlined",color:"primary",onClick:d,disabled:!o,children:"100%"})]})]}),e.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},ref:y,onChange:m=>{const k=m.target.files?.[0]??null;k&&L(k)}}),e.jsx(v,{sx:{flexGrow:1,minWidth:0}}),e.jsx(A,{size:"small",variant:"contained",startIcon:e.jsx($e,{}),onClick:j,children:"이미지 업로드"}),e.jsx(A,{size:"small",variant:"outlined",color:"primary",onClick:M,children:"링크로 불러오기"})]}),i&&e.jsx(Ue,{}),t&&e.jsx(v,{display:"flex",justifyContent:"flex-end",children:e.jsxs(z,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Q,{size:"small",label:t.hex,icon:e.jsx(ie,{fontSize:"small"}),onClick:()=>D(t.hex),onDelete:()=>D(t.hex),deleteIcon:e.jsx(re,{fontSize:"small"}),sx:{bgcolor:t.hex,color:q.palette.getContrastText(t.hex),border:"1px solid",borderColor:"divider"}}),e.jsx(Q,{size:"small",label:t.rgba,onClick:()=>D(t.rgba),onDelete:()=>D(t.rgba),deleteIcon:e.jsx(re,{fontSize:"small"}),variant:"outlined"})]})}),e.jsxs(v,{sx:{flex:1,minWidth:0,width:"100%",maxWidth:"100%",border:"1px dashed",borderColor:o?"divider":"text.disabled",borderRadius:1,bgcolor:"background.default",position:"relative",overflow:o?"auto":"hidden",outline:"none",display:"flex",justifyContent:"center",alignItems:"center","&:focus-visible":{boxShadow:m=>`0 0 0 2px ${m.palette.primary.main}`}},ref:W,tabIndex:0,onDragOver:m=>{m.preventDefault()},onDrop:m=>{m.preventDefault();const k=m.dataTransfer.files?.[0];k&&k.type.startsWith("image/")&&w(k)},children:[!o&&e.jsxs(z,{sx:{inset:0,position:"absolute"},alignItems:"center",justifyContent:"center",spacing:1,children:[e.jsx(de,{color:"disabled"}),e.jsx(T,{variant:"body2",color:"text.secondary",children:"이미지를 업로드해 팔레트를 추출하세요."})]}),e.jsx("canvas",{ref:R,onClick:H,onMouseMove:U,onMouseLeave:I,style:{cursor:o?"none":"default",display:"block",maxWidth:"none",maxHeight:"none",transform:o?`scale(${p/100})`:"none",transformOrigin:"center center"}}),r&&o&&e.jsx(v,{sx:{position:"absolute",left:r.x,top:r.y,width:36,height:36,borderRadius:1,border:"2px solid",borderColor:"primary.main",boxShadow:3,backgroundImage:`url(${r.dataUrl})`,backgroundSize:"cover",backgroundPosition:"center",pointerEvents:"none","&::before":{content:'""',position:"absolute",left:"50%",top:0,width:"1px",height:"100%",backgroundColor:"rgba(255,255,255,0.9)",transform:"translateX(-0.5px)",boxShadow:"0 0 2px rgba(0,0,0,0.6)"},"&::after":{content:'""',position:"absolute",top:"50%",left:0,height:"1px",width:"100%",backgroundColor:"rgba(255,255,255,0.9)",transform:"translateY(-0.5px)",boxShadow:"0 0 2px rgba(0,0,0,0.6)"}}})]}),o&&e.jsxs(z,{spacing:.25,direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(T,{variant:"caption",color:"text.secondary",children:["원본 크기: ",h.width," x ",h.height,"px"]}),e.jsxs(T,{variant:"caption",color:"text.secondary",children:["고유 색상: ",b.toLocaleString(),"개 · 픽셀: ",S.toLocaleString(),"개"]})]}),a&&e.jsx(Fe,{severity:"error",children:a})]})})},Qe=({paletteTab:o,onTabChange:t,uniqueCount:i,pagedColors:a,showPagination:h,page:b,pageCount:S,onPageChange:g})=>e.jsxs(v,{sx:{...ue,width:360,minHeight:0,flexShrink:0},children:[e.jsxs(v,{sx:{display:"flex",flexDirection:"column"},children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:1.25,py:1.25,borderBottom:"1px solid",borderColor:"divider"},children:[e.jsxs(z,{spacing:.25,children:[e.jsx(T,{variant:"subtitle1",fontWeight:700,children:"팔레트"}),e.jsx(T,{variant:"caption",color:"text.secondary",children:"빈도순 상위 300개 색상"})]}),e.jsx(Q,{size:"small",label:`${i.toLocaleString()} colors`,variant:"outlined"})]}),e.jsxs(Be,{value:o,onChange:(x,p)=>t(p),variant:"fullWidth",sx:{borderBottom:"1px solid",borderColor:"divider"},children:[e.jsx(le,{value:"summary",label:"요약(유사 색상 묶음)"}),e.jsx(le,{value:"detail",label:"상세(모든 색상)"})]})]}),e.jsxs(v,{sx:{minHeight:0,overflow:"auto"},children:[a.length===0&&e.jsxs(z,{sx:{p:1.25},spacing:1,alignItems:"center",children:[e.jsx(de,{color:"disabled"}),e.jsx(T,{variant:"body2",color:"text.secondary",children:"팔레트가 없습니다. 이미지를 업로드하세요."})]}),a.map(x=>e.jsxs(v,{sx:{display:"flex",alignItems:"center",px:1.25,py:1,borderBottom:"1px solid",borderColor:"divider",columnGap:1},children:[e.jsx(v,{sx:{width:40,height:40,borderRadius:1,border:"1px solid",borderColor:"divider",bgcolor:x.hex,flexShrink:0}}),e.jsxs(z,{spacing:.25,flex:1,children:[e.jsx(T,{variant:"subtitle2",fontWeight:700,children:x.hex}),e.jsxs(T,{variant:"caption",color:"text.secondary",children:[x.count.toLocaleString()," px · ",x.percent,"%"]})]}),e.jsx(He,{orientation:"vertical",flexItem:!0})]},x.hex)),h&&e.jsx(v,{sx:{py:1.25,display:"flex",justifyContent:"center"},children:e.jsx(qe,{page:b,count:S,size:"small",color:"primary",onChange:(x,p)=>g(p),showFirstButton:!0,showLastButton:!0})})]})]}),et=({open:o,value:t,onChange:i,onClose:a,onConfirm:h})=>e.jsxs(Ae,{open:o,onClose:a,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Oe,{children:"이미지 링크로 불러오기"}),e.jsx(Xe,{children:e.jsx(Ye,{autoFocus:!0,fullWidth:!0,label:"이미지 URL",placeholder:"https://example.com/image.png",value:t,onChange:b=>i(b.target.value),variant:"outlined",size:"small",margin:"dense"})}),e.jsxs(Ze,{children:[e.jsx(A,{onClick:a,children:"취소"}),e.jsx(A,{onClick:h,variant:"contained",disabled:!t.trim(),autoFocus:!0,children:"불러오기"})]})]}),st=()=>{const{imageSrc:o,colors:t,topColors:i,uniqueCount:a,totalPixels:h,pickedColor:b,loading:S,error:g,originalSize:x,handleFile:p,handleUrl:B,handlePick:d}=Je(),y=s.useRef(null),j=s.useRef(null),L=s.useRef(null),[M,R]=s.useState(1),W=50,[H,U]=s.useState(null),[I,w]=s.useState("summary"),[r,D]=s.useState(!0),[q,m]=s.useState(100),[k,N]=s.useState(!1),[ee,te]=s.useState(""),O=s.useRef(1),ge=async()=>{const n=ee.trim();n&&(await B(n),te(""),N(!1))},pe=s.useCallback(n=>{n&&p(n)},[p]);s.useEffect(()=>{O.current=1,m(100)},[o]);const X=s.useCallback(()=>{const n=j.current,f=L.current;if(!n||!o){if(n){const c=n.getContext("2d");c&&c.clearRect(0,0,n.width,n.height)}return}const l=n.getContext("2d");if(!l)return;const u=new Image;u.onload=()=>{let c=1;if(f){const E=f.clientWidth||u.width,Y=f.clientHeight||u.height;c=Math.min(E/u.width,Y/u.height,1)}O.current=c>0?c:1;const P=Math.max(1,Math.round(u.width*O.current)),C=Math.max(1,Math.round(u.height*O.current));n.width=P,n.height=C,n.style.width=`${P}px`,n.style.height=`${C}px`,n.style.maxWidth="none",n.style.maxHeight="none",l.clearRect(0,0,P,C),l.drawImage(u,0,0,P,C)},u.src=o},[o]);s.useEffect(()=>{X()},[X]),s.useEffect(()=>{if(!o)return;const n=()=>{X()};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[o,X]);const ne=s.useCallback(n=>{const f=j.current,l=L.current;if(!f||!l||!o||!r)return null;const u=f.getBoundingClientRect(),c=l.getBoundingClientRect(),P=(n.clientX-u.left)/u.width,C=(n.clientY-u.top)/u.height,E=Math.floor(P*f.width),Y=Math.floor(C*f.height),V=f.getContext("2d",{willReadFrequently:!0});if(!V)return null;const Z=V.getImageData(E,Y,1,1).data,Se=`#${Z[0].toString(16).padStart(2,"0")}${Z[1].toString(16).padStart(2,"0")}${Z[2].toString(16).padStart(2,"0")}`,$=39,Ie=n.clientX-c.left+l.scrollLeft,ke=n.clientY-c.top+l.scrollTop,Me=Math.min(Math.max(l.scrollLeft,Ie-$/2),Math.max(l.scrollLeft,l.scrollLeft+c.width-$)),ze=Math.min(Math.max(l.scrollTop,ke-$/2),Math.max(l.scrollTop,l.scrollTop+c.height-$)),F=13,ae=Math.floor(F/2),Le=Math.max(0,Math.min(f.width-F,E-ae)),Re=Math.max(0,Math.min(f.height-F,Y-ae)),De=V.getImageData(Le,Re,F,F),_=document.createElement("canvas");_.width=F,_.height=F;const se=_.getContext("2d");se&&se.putImageData(De,0,0);const G=document.createElement("canvas");G.width=$,G.height=$;const J=G.getContext("2d");return J&&(J.imageSmoothingEnabled=!1,J.drawImage(_,0,0,$,$)),U({x:Me,y:ze,hex:Se,dataUrl:G.toDataURL("image/png")}),Z},[o,r]),me=n=>{if(!j.current||!o||!r)return;const l=ne(n);l&&d({r:l[0],g:l[1],b:l[2],a:l[3]})},fe=n=>{ne(n)},be=()=>U(null),we=s.useMemo(()=>{const n=c=>({r:parseInt(c.slice(1,3),16),g:parseInt(c.slice(3,5),16),b:parseInt(c.slice(5,7),16)}),f=(c,P)=>{const C=n(c),E=n(P);return Math.sqrt((C.r-E.r)**2+(C.g-E.g)**2+(C.b-E.b)**2)},u=[];for(const c of t)u.some(C=>f(C.hex,c.hex)<18)||u.push(c);return u},[t]);s.useEffect(()=>{R(1)},[I,t]);const oe=I==="summary"?we:t,je=()=>y.current?.click(),ve=Math.max(1,Math.ceil(oe.length/W)),ye=oe.slice((M-1)*W,M*W),Ce=n=>navigator.clipboard?.writeText(n).catch(()=>{});return e.jsxs(_e,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:785,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden"},children:[e.jsxs(z,{direction:"row",spacing:1.25,sx:{minHeight:769,width:"100%",maxWidth:"100%",height:"calc(100vh - 190px)"},children:[e.jsx(Ke,{imageSrc:o,pickedColor:b,loading:S,error:g,originalSize:x,uniqueCount:a,totalPixels:h,pickerEnabled:r,onTogglePicker:()=>{D(n=>{const f=!n;return f||U(null),f})},zoom:q,onZoomChange:m,onResetZoom:()=>m(100),inputRef:y,onUploadClick:je,onFileSelected:pe,onOpenLinkDialog:()=>N(!0),canvasRef:j,canvasBoxRef:L,onCanvasClick:me,onCanvasMove:fe,onCanvasLeave:be,onDropFile:n=>void p(n),hoverPreview:H,onCopyColor:Ce}),e.jsx(Qe,{paletteTab:I,onTabChange:w,uniqueCount:a,pagedColors:ye,showPagination:i.length>W,page:M,pageCount:ve,onPageChange:R})]}),e.jsx(et,{open:k,value:ee,onChange:te,onClose:()=>N(!1),onConfirm:ge})]})};export{st as default};
