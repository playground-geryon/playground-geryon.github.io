import{_ as ae}from"./tree-sitter-aGyQ8e2w.js";import{r,F as ue,j as w}from"./vendor-CRMzTT1s.js";import{l as le,m as ie,n as ce,o as me,p as de,a as P}from"./mui-BTFQHN8y.js";const fe=async()=>{const u=await ae(()=>import("./excel-CUMakpxJ.js").then(a=>a.e),[]);return u.default??u},be=u=>u.filter(a=>Array.isArray(a)&&a.length>=8).map(a=>({round:a[0],numbers:a.slice(1,7),bonus:a[7]})).sort((a,i)=>i.round-a.round),ge="lotto_combinations_db",C="saved_combinations",B="list",O=()=>new Promise((u,a)=>{if(typeof indexedDB>"u"){a(new Error("IndexedDB is not available."));return}const i=indexedDB.open(ge,1);i.onupgradeneeded=()=>{const c=i.result;c.objectStoreNames.contains(C)||c.createObjectStore(C)},i.onsuccess=()=>u(i.result),i.onerror=()=>a(i.error??new Error("Failed to open IndexedDB."))}),he=async()=>{const u=await O();return new Promise((a,i)=>{const c=u.transaction(C,"readonly"),b=c.objectStore(C).get(B);b.onsuccess=()=>{a(b.result??[])},b.onerror=()=>i(b.error??new Error("Failed to read combinations.")),c.oncomplete=()=>u.close(),c.onerror=()=>u.close(),c.onabort=()=>u.close()})},we=async u=>{const a=await O();return new Promise((i,c)=>{const s=a.transaction(C,"readwrite"),h=s.objectStore(C).put(u,B);h.onsuccess=()=>i(),h.onerror=()=>c(h.error??new Error("Failed to write combinations.")),s.oncomplete=()=>a.close(),s.onerror=()=>a.close(),s.onabort=()=>a.close()})},Ce=()=>{const[u,a]=r.useState(!0),[i,c]=r.useState(null),[s,b]=r.useState([]),[h,L]=r.useState("number"),[y,M]=r.useState([]),[g,x]=r.useState([]),[N,T]=r.useState(!1),[D,S]=r.useState(1),[E,I]=r.useState(15),[_,A]=r.useState({from:null,to:null}),W=r.useMemo(()=>s.length?{min:s[s.length-1].round,max:s[0].round}:{min:null,max:null},[s]),p=r.useMemo(()=>{let e=_.from,n=_.to;return e!==null&&n!==null&&e>n&&([e,n]=[n,e]),{from:e,to:n}},[_]),m=r.useMemo(()=>s.filter(e=>!(p.from!==null&&e.round<p.from||p.to!==null&&e.round>p.to)),[s,p]),R=m.length,j=r.useMemo(()=>R*6,[R]),k=r.useMemo(()=>{const e=Array.from({length:45},()=>0);return m.forEach(n=>{n.numbers.forEach(t=>{t>=1&&t<=45&&(e[t-1]+=1)})}),e.map((n,t)=>({number:t+1,count:n,percent:j?n/j*100:0}))},[m,j]),q=r.useMemo(()=>{const e=Array.from({length:45},()=>0);return s.forEach(n=>{n.numbers.forEach(t=>{t>=1&&t<=45&&(e[t-1]+=1)})}),e.map((n,t)=>({number:t+1,count:n}))},[s]),z=r.useMemo(()=>{const e=[...k];return h==="frequency"&&e.sort((n,t)=>t.count===n.count?n.number-t.number:t.count-n.count),e},[k,h]),J=r.useMemo(()=>k.filter(e=>e.count===0).map(e=>e.number),[k]),Y=r.useMemo(()=>{if(!m.length)return Array.from({length:45},(t,o)=>({number:o+1,streak:0}));const e=[...m].sort((t,o)=>o.round-t.round),n=Array.from({length:45},(t,o)=>{const d=o+1;let l=0;for(const f of e){if(f.numbers.includes(d))break;l+=1}return{number:d,streak:l}});return n.sort((t,o)=>o.streak===t.streak?t.number-o.number:o.streak-t.streak),n},[m]),$=r.useMemo(()=>{if(!m.length)return{avgSum:0,avgOdd:0,avgEven:0};let e=0,n=0;m.forEach(l=>{e+=l.numbers.reduce((f,F)=>f+F,0),n+=l.numbers.filter(f=>f%2===1).length});const t=e/m.length,o=n/m.length,d=6-o;return{avgSum:t,avgOdd:o,avgEven:d}},[m]),v=r.useMemo(()=>y.length?m.filter(e=>y.every(n=>e.numbers.includes(n))):m,[m,y]),H=r.useMemo(()=>{const e=(D-1)*E;return v.slice(e,e+E)},[v,D,E]),K=Math.max(1,Math.ceil(v.length/E));r.useEffect(()=>{let e=!0;return(async()=>{a(!0),c(null);try{const t=await fetch("/data/lotto.json",{cache:"no-cache"});if(!t.ok)throw new Error("데이터를 불러오지 못했습니다.");const o=await t.json();if(!e)return;b(be(o))}catch(t){if(!e)return;c(t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다.")}finally{e&&a(!1)}})(),()=>{e=!1}},[]),r.useEffect(()=>{s.length&&A(e=>e.from!==null||e.to!==null?e:{from:s[s.length-1].round,to:s[0].round})},[s]),r.useEffect(()=>{if(typeof window>"u")return;let e=!0;return he().then(n=>{e&&Array.isArray(n)&&x(n.filter(t=>Array.isArray(t.numbers)&&t.numbers.length===6))}).catch(()=>{}).finally(()=>{e&&T(!0)}),()=>{e=!1}},[]),r.useEffect(()=>{typeof window>"u"||N&&we(g).catch(()=>{})},[g,N]);const V=r.useCallback(e=>{M(n=>n.includes(e)?n.filter(t=>t!==e):n.length>=6?n:[...n,e]),S(1)},[]),G=r.useCallback(()=>{M([]),S(1)},[]),Q=r.useCallback(e=>{const n=[...e].sort((t,o)=>t-o).slice(0,6);M(n),S(1)},[]),U=r.useCallback((e,n)=>{const t=[...e].sort((l,f)=>l-f);if(t.length!==6)return{ok:!1,message:"번호 6개를 선택하세요."};const o=t.join(",");if(g.some(l=>l.numbers.join(",")===o))return{ok:!1,message:"이미 저장된 조합입니다."};const d={id:`${Date.now()}_${Math.random().toString(16).slice(2)}`,createdAt:new Date().toISOString(),numbers:t,isFavorite:!1,memo:n?.trim()||""};return x(l=>[d,...l]),{ok:!0,message:"조합을 저장했습니다."}},[g]),X=r.useCallback(e=>{x(n=>n.map(t=>t.id===e?{...t,isFavorite:!t.isFavorite}:t))},[]),Z=r.useCallback((e,n)=>{x(t=>t.map(o=>o.id===e?{...o,memo:n}:o))},[]),ee=r.useCallback(e=>{x(n=>n.filter(t=>t.id!==e))},[]),te=r.useCallback(()=>{x([])},[]),ne=r.useCallback(async()=>{if(!g.length)return{ok:!1,message:"저장된 조합이 없습니다."};const e=await fe(),n=new e.Workbook,t=n.addWorksheet("Combinations");t.addRow(["No","CreatedAt","Title/Memo","Numbers","Favorite","n1","n2","n3","n4","n5","n6"]),g.forEach((d,l)=>{t.addRow([l+1,new Date(d.createdAt).toLocaleString(),d.memo??"",d.numbers.join(", "),d.isFavorite?"Y":"N",...d.numbers])}),t.columns?.forEach(d=>{let l=10;d.eachCell?.({includeEmpty:!0},f=>{const F=f.value==null?"":f.value.toString();l=Math.max(l,F.length)}),d.width=Math.min(40,Math.max(10,l+2))});const o=await n.xlsx.writeBuffer();return ue.saveAs(new Blob([o]),"lotto-combinations.xlsx"),{ok:!0,message:"엑셀로 내보냈습니다."}},[g]),re=r.useCallback((e,n)=>{A(t=>{const o={...t,[e]:n};return o.from!==null&&o.to!==null&&o.from>o.to&&(e==="from"?o.to=n:o.from=n),o}),S(1)},[]),oe=r.useCallback(()=>{s.length&&(A({from:s[s.length-1].round,to:s[0].round}),S(1))},[s]),se=r.useCallback((e,n)=>{S(n)},[]);return{loading:u,error:i,draws:s,rangeFilteredDraws:m,roundBounds:W,roundRange:p,updateRoundRange:re,resetFilters:oe,rangeDrawCount:R,sortedStats:z,numberStats:k,allNumberStats:q,sortMode:h,setSortMode:L,selectedNumbers:y,toggleNumber:V,clearSelection:G,applyCombination:Q,savedCombinations:g,saveCombination:U,toggleFavorite:X,updateCombinationMemo:Z,deleteCombination:ee,clearCombinations:te,exportCombinations:ne,paginatedDraws:H,filteredDraws:v,page:D,pageCount:K,itemsPerPage:E,setItemsPerPage:I,handlePageChange:se,neverDrawnNumbers:J,consecutiveMisses:Y,patternSummary:$}},Ee=({open:u,memoDraft:a,onChange:i,onClose:c,onSave:s})=>w.jsxs(le,{open:u,onClose:c,fullWidth:!0,maxWidth:"sm",children:[w.jsx(ie,{children:"메모 편집"}),w.jsx(ce,{dividers:!0,children:w.jsx(me,{fullWidth:!0,multiline:!0,minRows:3,value:a,onChange:b=>i(b.target.value),placeholder:"메모를 입력하세요."})}),w.jsxs(de,{children:[w.jsx(P,{onClick:c,children:"취소"}),w.jsx(P,{variant:"contained",onClick:s,children:"저장"})]})]});export{Ee as L,Ce as u};
