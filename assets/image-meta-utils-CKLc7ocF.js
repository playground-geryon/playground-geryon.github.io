import{_ as le}from"./monaco-BZh3GCvz.js";import{r as c,z as ce,E as ue,A as H,F as de}from"./vendor-BHnfqNCc.js";const P=new Map,me=o=>{const r=new Uint8Array(o);let n="";for(let l=0;l<r.length;l++)n+=String.fromCharCode(r[l]);return btoa(n)},fe=async o=>{if(P.has(o))return P.get(o);const r=await fetch(`/fonts/${o}`);if(!r.ok)throw new Error(`폰트 파일을 불러올 수 없습니다: ${o}`);const n=await r.arrayBuffer(),l=me(n);return P.set(o,l),l},ge=async()=>fe("NotoSansKR-Regular.ttf"),he=async()=>{const o=await le(()=>import("./excel-CUMakpxJ.js").then(r=>r.e),[]);return o.default??o},we=o=>new Promise((r,n)=>{const l=new Image;l.onload=()=>r({width:l.width,height:l.height}),l.onerror=()=>n(new Error("이미지를 불러올 수 없습니다.")),l.src=o}),pe={tiff:!0,exif:!0,gps:!0,icc:!0,xmp:!0},ye=()=>{const[o,r]=c.useState([]),[n,l]=c.useState(null),[S,N]=c.useState(""),[V,W]=c.useState(!1),[j,O]=c.useState(!1),[Y,A]=c.useState(1),[X,C]=c.useState(!1),[Z,K]=c.useState(!1),[J,_]=c.useState(""),D=c.useRef(null),U=c.useCallback(async a=>{try{const e=await ce.parse(a,pe);if(!e)return{metaData:[],gpsLocation:null,createdDate:"",takenDate:""};const t=Object.entries(e).map(([s,g])=>({key:s,value:g==null?"N/A":g.toString()})),u=typeof e.latitude=="number"?e.latitude:null,i=typeof e.longitude=="number"?e.longitude:null,d=u!=null&&i!=null?`https://www.google.com/maps?q=${u},${i}`:null;return{metaData:t,gpsLocation:d,createdDate:e.CreateDate?.toString()??"",takenDate:e.DateTimeOriginal?.toString()??""}}catch(e){return console.error("EXIF 추출 실패",e),{metaData:[],gpsLocation:null,createdDate:"",takenDate:""}}},[]),G=c.useCallback(async a=>{const e=URL.createObjectURL(a),{width:t,height:u}=await we(e),i=await U(a);return{file:a,preview:e,width:t,height:u,metaData:i.metaData,gpsLocation:i.gpsLocation,createdDate:i.createdDate,takenDate:i.takenDate}},[U]),M=c.useCallback(async a=>{if(!a||a.length===0)return;const e=[];for(const t of Array.from(a))try{const u=await G(t);e.push(u)}catch(u){console.error("이미지 정보를 불러오지 못했습니다.",u)}e.length&&(r(t=>[...t,...e]),l(e[0]),D.current&&(D.current.value=""))},[G]),Q=c.useCallback(a=>{a.preventDefault(),M(a.dataTransfer?.files??null)},[M]),q=c.useCallback(a=>{let e;r(t=>{if(a<0||a>=t.length)return t;const u=[...t];return[e]=u.splice(a,1),e?.preview&&URL.revokeObjectURL(e.preview),u}),e&&e===n&&l(null)},[n]),ee=c.useCallback(a=>{const e=new Set(a);e.size&&(r(t=>(t.forEach(u=>{e.has(u.preview)&&URL.revokeObjectURL(u.preview)}),t.filter(u=>!e.has(u.preview)))),l(t=>t&&e.has(t.preview)?null:t))},[]),te=c.useCallback(()=>{o.forEach(a=>{a.preview&&URL.revokeObjectURL(a.preview)}),r([]),l(null),N(""),W(!1),O(!1),A(1),K(!1),_(""),D.current&&(D.current.value="")},[o]),ae=async a=>{const e=await ge();a.addFileToVFS("NotoSansKR.ttf",e),a.addFont("NotoSansKR.ttf","NotoSansKR","normal"),a.setFont("NotoSansKR")},b=c.useCallback((a,e)=>{const t=a.trim()||"images_metadata";return t.toLowerCase().endsWith(`.${e}`)?t:`${t}.${e}`},[]),I=c.useCallback(a=>a==="selected"?n?[n]:[]:o,[o,n]),z=c.useCallback(async(a,e)=>{if(!a.length){window.alert(e.scope==="selected"?"선택된 이미지가 없습니다.":"다운로드할 이미지가 없습니다.");return}C(!0);try{let t=null,u=!1;for(const i of a){const d=i.width>i.height?"landscape":"portrait";if(t?(t.addPage("a4",d),t.setPage(t.getNumberOfPages())):t=new ue({orientation:d,unit:"mm",format:"a4"}),t&&!u&&(await ae(t),u=!0),!t)continue;const s=15,g=new Image;g.src=i.preview,await new Promise(h=>{g.onload=()=>h()});const w=document.createElement("canvas");w.width=g.width,w.height=g.height;const y=w.getContext("2d");if(!y)continue;y.drawImage(g,0,0);const m=w.toDataURL("image/png"),x=t.internal.pageSize.getWidth(),F=t.internal.pageSize.getHeight(),$=x-s*2,k=F-s*2,R=Math.min($/i.width,k/i.height),v=i.width*R,B=i.height*R,L=(x-v)/2,p=Math.max(s,(F-B)/2);t.addImage(m,"PNG",L,p,v,B);const f=[];if(e.includeBasicInfo&&(e.includeFileName&&f.push(["File Name",i.file.name]),e.includeFileSize&&f.push(["Size",`${(i.file.size/1024/1024).toFixed(2)} MB`]),e.includeFileType&&f.push(["Type",i.file.type]),e.includeDimensions&&f.push(["Dimensions",`${i.width} x ${i.height}`]),e.includeGps&&i.gpsLocation&&f.push(["Google Maps",i.gpsLocation]),e.includeCreateDate&&f.push(["Create Date",i.createdDate??""]),e.includeTakenDate&&f.push(["Taken Date",i.takenDate??""]),e.includeComment&&f.push(["Comment",i.comment??""])),e.includeBasicInfo&&f.length){t.addPage("a4",d);const h=t.internal.pageSize.getWidth();t.setFontSize(14),t.text("Basic Info",s,s),H(t,{startY:s+5,head:[["Key","Value"]],body:f,styles:{font:"NotoSansKR",fontSize:11},margin:{left:s,right:s},columnStyles:{0:{cellWidth:40},1:{cellWidth:h-2*s-40}}})}if(e.includeMetadata){t.addPage("a4",d);const h=t.internal.pageSize.getWidth();t.setFontSize(14),t.text("Metadata",s,s),H(t,{startY:s+5,head:[["Key","Value"]],body:i.metaData.map(({key:T,value:re})=>[T,re]),styles:{fontSize:10,font:"NotoSansKR"},margin:{left:s,right:s},columnStyles:{0:{cellWidth:60},1:{cellWidth:h-2*s-60}}})}}t?.save(b(e.fileName,"pdf"))}finally{C(!1)}},[b]),ne=c.useCallback(async a=>{const e=I(a.scope);await z(e,a)},[z,I]),E=c.useCallback(async(a,e)=>{if(!a.length){window.alert(e.scope==="selected"?"선택된 이미지가 없습니다.":"다운로드할 이미지가 없습니다.");return}C(!0);try{const t=await he(),u=new t.Workbook;for(const d of a){const s=u.addWorksheet(d.file.name.substring(0,31));if(s.pageSetup={paperSize:9,orientation:"portrait"},e.includeBasicInfo){const m=[];e.includeFileName&&m.push(["File Name",d.file.name]),e.includeFileSize&&m.push(["File Size",`${(d.file.size/1024/1024).toFixed(2)} MB`]),e.includeFileType&&m.push(["File Type",d.file.type]),e.includeDimensions&&m.push(["Image Dimensions",`${d.width} x ${d.height} px`]),e.includeGps&&d.gpsLocation&&m.push(["Google Maps",d.gpsLocation]),e.includeCreateDate&&m.push(["Create Date",d.createdDate??""]),e.includeTakenDate&&m.push(["Taken Date",d.takenDate??""]),e.includeComment&&m.push(["Comment",d.comment??""]),m.length&&(s.mergeCells("A1:B1"),s.getCell("A1").value="File Information",s.getCell("A1").font={bold:!0,size:14},s.addRows(m))}const g=new Image;g.src=d.preview,await new Promise(m=>{g.onload=()=>m()});const w=document.createElement("canvas");w.width=g.width,w.height=g.height;const y=w.getContext("2d");y&&(y.drawImage(g,0,0),await new Promise(m=>{w.toBlob(async x=>{if(x){const F=await x.arrayBuffer(),$=u.addImage({buffer:F,extension:"png"}),k=500,R=k/d.width,v=k,B=d.height*R,L=s.rowCount+2;if(s.addImage($,{tl:{col:0,row:Math.max(0,L-1)},ext:{width:v,height:B}}),e.includeMetadata){const p=s.rowCount+2;s.addTable({name:`MetaData_${s.name.replace(/[^A-Za-z0-9]/g,"")}`,ref:`A${p}`,headerRow:!0,style:{showRowStripes:!0},columns:[{name:"Key",filterButton:!0},{name:"Value",filterButton:!0}],rows:d.metaData.map(({key:f,value:h})=>[f,h])})}s.columns?.forEach(p=>{let f=0;p.eachCell?.({includeEmpty:!0},h=>{const T=h.value==null?"":h.value.toString();f=Math.max(f,T.length)}),p.width=Math.min(80,Math.max(12,f+4))})}m()})}))}const i=await u.xlsx.writeBuffer();de.saveAs(new Blob([i]),b(e.fileName,"xlsx"))}finally{C(!1)}},[b]),se=c.useCallback(async a=>{const e=I(a.scope);await E(e,a)},[E,I]),oe=c.useCallback(a=>{n&&(r(e=>e.map(t=>t===n?{...t,comment:a}:t)),l(e=>e&&{...e,comment:a}))},[n]),ie=c.useMemo(()=>{if(!n)return[];const a=S.trim().toLowerCase();return a?n.metaData.filter(e=>[e.key,e.value].some(t=>t.toLowerCase().includes(a))):n.metaData},[S,n]);return{fileInputRef:D,images:o,selectedImage:n,setSelectedImage:l,searchQuery:S,setSearchQuery:N,isModalOpen:V,setIsModalOpen:W,viewOriginalSize:j,setViewOriginalSize:O,isExporting:X,isCommentDialogOpen:Z,setIsCommentDialogOpen:K,commentInput:J,setCommentInput:_,handleFiles:M,handleDrop:Q,handleRemoveImage:q,handleRemoveImagesByPreview:ee,handleClearAllImages:te,handleDownloadPDF:ne,handleDownloadPDFForTargets:z,handleDownloadExcel:se,handleDownloadExcelForTargets:E,filteredMeta:ie,saveCommentForSelected:oe,modalZoom:Y,setModalZoom:A}},xe=o=>`${(o/1024/1024).toFixed(2)} MB`,Ce=o=>{if(!Number.isFinite(o)||o<=0)return"0 Bytes";const r=["Bytes","KB","MB","GB","TB","PB"];let n=o,l=0;for(;n>=1024&&l<r.length-1;)n/=1024,l++;const S=n>=100?0:n>=10?1:2;return`${n.toFixed(S)} ${r[l]}`},be=o=>{if(!o)return"N/A";const r=new Date(o);if(Number.isNaN(r.getTime()))return o;const n=l=>l.toString().padStart(2,"0");return`${r.getFullYear()}-${n(r.getMonth()+1)}-${n(r.getDate())} ${n(r.getHours())}:${n(r.getMinutes())}:${n(r.getSeconds())}`};export{Ce as a,be as b,xe as f,ye as u};
