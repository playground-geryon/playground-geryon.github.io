import{r as u,j as e,q as Ds,t as $s,F as Gs,J as Fs}from"./vendor-CRMzTT1s.js";import{u as Gt,l as Ht,m as Vt,n as Mt,S as m,y as ct,z as ie,T as j,I as W,aa as ds,a as se,aE as Oe,B as N,aA as ut,o as _,ac as ye,aD as Te,aF as us,p as Bt,P as me,aG as _s,aH as Ws,Y as hs,a9 as xe,aI as Lt,aJ as Us,aK as qt,aL as He,a7 as Q,q as Js,aM as Ks,aN as Qs,aO as Xs,g as Et,aP as Ys,aQ as Zs,aR as en,af as ts,aS as tn,K as Ne,ab as ss,aB as sn,aT as nn}from"./mui-DQUFsC14.js";import{M as Ue}from"./monaco-editor-CJz8LXZx.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";const rn=({open:t,tab:r,onTabChange:n,onClose:d,globalHeaders:c,globalVariables:b,commonHeaderKeys:g,getHeaderValueOptions:k,smallFieldSx:R,onAddHeader:v,onChangeHeader:L,onRemoveHeader:H,onAddVariable:q,onChangeVariable:te,onRemoveVariable:Y})=>{const U=Gt(),[F,Z]=u.useState(null),E=S=>{S.stopPropagation(),Z(S.currentTarget)},C=()=>Z(null);return e.jsxs(Ht,{open:t,onClose:d,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{height:"40vh"}},children:[e.jsx(Vt,{sx:{fontSize:U.typography.body2.fontSize,py:1},children:"공통 설정 관리"}),e.jsxs(Mt,{dividers:!0,sx:{py:1.5,display:"flex",flexDirection:"column",gap:1,overflow:"hidden"},children:[e.jsxs(m,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(ct,{value:r,onChange:(S,A)=>{A&&n(A)},textColor:"primary",indicatorColor:"primary",sx:{minHeight:28,"& .MuiTabs-flexContainer":{gap:.5},"& .MuiTab-root":{minHeight:28,fontSize:U.typography.caption.fontSize,py:.5},"& .MuiTabs-indicator":{bottom:2}},children:[e.jsx(ie,{label:"헤더",value:"headers"}),e.jsx(ie,{label:e.jsxs(m,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(j,{variant:"caption",sx:{fontSize:U.typography.caption.fontSize},children:"변수"}),e.jsx(W,{size:"small",onClick:E,children:e.jsx(ds,{fontSize:"small"})})]}),value:"variables"})]}),e.jsx(se,{size:"small",startIcon:e.jsx(Oe,{}),onClick:r==="headers"?v:q,children:r==="headers"?"헤더 추가":"변수 추가"})]}),r==="headers"&&e.jsxs(m,{spacing:1,sx:{flex:1,minHeight:0},children:[e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",sx:{px:.5},children:[e.jsx(j,{variant:"caption",sx:{width:{xs:1,sm:180}},children:"Key"}),e.jsx(j,{variant:"caption",sx:{flex:1},children:"Value"}),e.jsx(N,{sx:{width:96}})]}),e.jsx(m,{spacing:1,sx:{flex:1,minHeight:0,overflow:"auto"},children:c.map(S=>e.jsxs(m,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(ut,{freeSolo:!0,options:g,value:S.key,onInputChange:(A,V)=>L(S.id,"key",V??""),onChange:(A,V)=>L(S.id,"key",typeof V=="string"?V:""),sx:{width:{xs:1,sm:180}},ListboxProps:{sx:{"& .MuiAutocomplete-option":{fontSize:U.typography.caption.fontSize}}},renderInput:A=>e.jsx(_,{...A,size:"small",placeholder:"Key",sx:{...R}})}),e.jsx(ut,{freeSolo:!0,options:k(S.key),value:S.value,onInputChange:(A,V)=>L(S.id,"value",V??""),onChange:(A,V)=>L(S.id,"value",typeof V=="string"?V:""),sx:{flex:1},ListboxProps:{sx:{"& .MuiAutocomplete-option":{fontSize:U.typography.caption.fontSize}}},renderInput:A=>e.jsx(_,{...A,size:"small",placeholder:"Value",sx:{...R}})}),e.jsxs(m,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(ye,{size:"small",checked:S.enabled,onChange:A=>L(S.id,"enabled",A.target.checked)}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"활성"})]}),e.jsx(W,{size:"small",onClick:()=>H(S.id),children:e.jsx(Te,{fontSize:"small"})})]},S.id))})]}),r==="variables"&&e.jsxs(m,{spacing:1,sx:{flex:1,minHeight:0},children:[e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",sx:{px:.5},children:[e.jsx(j,{variant:"caption",sx:{width:{xs:1,sm:180}},children:"Key"}),e.jsx(j,{variant:"caption",sx:{flex:1},children:"Value"}),e.jsx(N,{sx:{width:96}})]}),e.jsx(m,{spacing:1,sx:{flex:1,minHeight:0,overflow:"auto"},children:b.map(S=>e.jsxs(m,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(_,{size:"small",value:S.key,onChange:A=>te(S.id,"key",A.target.value),placeholder:"Key",sx:{width:{xs:1,sm:180},...R}}),e.jsx(_,{size:"small",value:S.value,onChange:A=>te(S.id,"value",A.target.value),placeholder:"Value",sx:{flex:1,...R}}),e.jsxs(m,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(ye,{size:"small",checked:S.enabled,onChange:A=>te(S.id,"enabled",A.target.checked)}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"활성"})]}),e.jsx(W,{size:"small",onClick:()=>Y(S.id),children:e.jsx(Te,{fontSize:"small"})})]},S.id))}),e.jsx(us,{open:!!F,anchorEl:F,onClose:C,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsxs(m,{sx:{p:1,maxWidth:320,bgcolor:"grey.900",color:"common.white",borderRadius:1},spacing:.5,children:[e.jsxs(j,{variant:"caption",sx:{fontSize:10,lineHeight:1.5},children:["변수는 ",e.jsx("span",{style:{color:"#90caf9"},children:"공통"}),"으로 저장되며 URL/헤더/바디에서"," ",e.jsx("code",{style:{color:"#ffd54f"},children:"{{변수명}}"})," 형태로 사용할 수 있습니다."]}),e.jsxs(j,{variant:"caption",sx:{fontSize:10,lineHeight:1.5},children:["예: ",e.jsx("code",{style:{color:"#ffe082"},children:"API_URL"})," ="," ",e.jsx("code",{style:{color:"#ffcc80"},children:"https://api.example.com"})]})]})})]})]}),e.jsx(Bt,{children:e.jsx(se,{onClick:d,children:"닫기"})})]})},an={idle:{label:"대기",color:"text.disabled"},running:{label:"실행 중",color:"warning.main"},success:{label:"성공",color:"success.main"},error:{label:"실패",color:"error.main"}},on=({status:t})=>{const r=an[t];return e.jsxs(m,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(N,{sx:{width:10,height:10,borderRadius:"50%",bgcolor:r.color,transition:"background-color 0.2s ease"}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:r.label})]})},ps=u.memo(({nodes:t,selectedNodeId:r,onSelect:n,onRunNode:d,onCloneNode:c,onRemoveNode:b,onToggleField:g,selectionMode:k,selectedNodeIds:R,onToggleNodeSelection:v,disableRemove:L})=>{const H=u.useRef(null);return u.useEffect(()=>{if(!r)return;const q=H.current?.querySelector(`[data-node-id="${r}"]`);q&&q.scrollIntoView({block:"nearest"})},[r,t.length]),e.jsx(m,{ref:H,spacing:1,sx:{minHeight:500,overflowY:"auto",height:"calc(100vh - 305px)"},children:t.length===0?e.jsx(m,{flex:1,alignItems:"center",justifyContent:"center",sx:{color:"text.secondary"},children:e.jsx(j,{variant:"body2",children:"노드가 없습니다. 상단의 추가 버튼으로 시작하세요."})}):t.map(q=>e.jsx(ms,{node:q,selected:q.id===r,selectionMode:k,isChecked:R.has(q.id),onToggleSelect:()=>v(q.id),disableRemove:L,onSelect:n,onRunNode:d,onCloneNode:c,onRemoveNode:b,onToggleField:g},q.id))})});ps.displayName="NodeListPanel";const ms=u.memo(({node:t,selected:r,selectionMode:n,isChecked:d,onToggleSelect:c,disableRemove:b,onSelect:g,onRunNode:k,onCloneNode:R,onRemoveNode:v,onToggleField:L})=>{const H=Gt(),q=u.useMemo(()=>{switch(t.method){case"GET":return H.palette.success.main;case"POST":return H.palette.primary.main;case"PUT":return H.palette.warning.main;case"PATCH":return H.palette.info.main;case"DELETE":return H.palette.error.main;default:return H.palette.grey[400]}},[t.method,H.palette]),[te,Y]=u.useState(null),U=!!te,F=C=>{C.stopPropagation(),!n&&Y(C.currentTarget)},Z=()=>Y(null),E=n;return e.jsxs(me,{variant:"outlined",sx:{p:1.2,boxShadow:"none",borderColor:r?"primary.main":t.status==="error"?"error.light":t.status==="success"?"success.light":t.status==="running"?"warning.light":void 0,cursor:"pointer","&:hover":{borderColor:"primary.light"}},"data-node-id":t.id,onClick:()=>{if(n){c(),g(t.id);return}g(t.id)},children:[e.jsxs(m,{spacing:1.2,children:[e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",children:[n&&e.jsx(W,{size:"small",onClick:C=>{C.stopPropagation(),c()},sx:{width:28,height:28},children:d?e.jsx(_s,{fontSize:"small",color:"primary"}):e.jsx(Ws,{fontSize:"small",color:"action"})}),e.jsx(hs,{label:t.method,size:"small",variant:"filled",sx:{fontWeight:600,fontSize:12,minWidth:72,justifyContent:"center",bgcolor:q,color:H.palette.getContrastText(q)}}),e.jsx(j,{fontWeight:600,color:t.enabled?"text.primary":"text.disabled",noWrap:!0,sx:{minWidth:0,maxWidth:160,fontSize:12},children:t.label||"노드명 없음"})]}),e.jsxs(m,{direction:"row",spacing:.5,children:[e.jsx(xe,{title:"실행",children:e.jsx("span",{children:e.jsx(W,{size:"small",onClick:k(t.id),disabled:E,children:e.jsx(Lt,{fontSize:"small"})})})}),e.jsx(xe,{title:"복제",children:e.jsx("span",{children:e.jsx(W,{size:"small",onClick:R(t.id),disabled:E,children:e.jsx(Us,{fontSize:"small"})})})}),e.jsx(xe,{title:"옵션",children:e.jsx("span",{children:e.jsx(W,{size:"small",onClick:F,disabled:E,children:e.jsx(qt,{fontSize:"small"})})})})]})]}),e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(j,{color:"text.secondary",noWrap:!0,sx:{flex:1,minWidth:0,fontSize:12},children:t.resolvedUrl||t.url||"URL을 입력하세요"}),e.jsx(on,{status:t.status})]}),t.lastRunAt&&e.jsxs(j,{variant:"caption",color:"text.secondary",children:["최근 실행 ",new Date(t.lastRunAt).toLocaleTimeString()]})]}),e.jsxs(He,{anchorEl:te,open:U,onClose:Z,onClick:C=>C.stopPropagation(),children:[e.jsx(Q,{disableRipple:!0,onClick:C=>C.stopPropagation(),children:e.jsxs(m,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(ye,{size:"small",checked:t.enabled,onChange:C=>{C.stopPropagation(),L(t.id,"enabled",C.target.checked)}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:t.enabled?"활성":"비활성"})]})}),e.jsx(Q,{disableRipple:!0,onClick:C=>C.stopPropagation(),children:e.jsxs(m,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(ye,{size:"small",checked:t.autoTriggerNext,onChange:C=>{C.stopPropagation(),L(t.id,"autoTriggerNext",C.target.checked)}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"다음 노드 자동 실행"})]})}),e.jsxs(Q,{disabled:b,onClick:C=>{C.stopPropagation(),v(t.id)(C),Z()},children:[e.jsx(Te,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"삭제"})]})]})]})},(t,r)=>{if(t.selected!==r.selected||t.selectionMode!==r.selectionMode||t.isChecked!==r.isChecked||t.disableRemove!==r.disableRemove||t.onSelect!==r.onSelect||t.onCloneNode!==r.onCloneNode||t.onRemoveNode!==r.onRemoveNode||t.onRunNode!==r.onRunNode||t.onToggleField!==r.onToggleField||t.onToggleSelect!==r.onToggleSelect)return!1;const n=t.node,d=r.node;return n.id===d.id&&n.label===d.label&&n.method===d.method&&n.url===d.url&&n.resolvedUrl===d.resolvedUrl&&n.enabled===d.enabled&&n.autoTriggerNext===d.autoTriggerNext&&n.status===d.status&&n.lastRunAt===d.lastRunAt});ms.displayName="NodeListItemCard";const Ft=["GET","POST","PUT","PATCH","DELETE"],Dt=20,ns=1,ln=new Set(Ft),cn="api-flow",Ve="snapshots",xs="latest",oe=t=>`${t}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,ce=(t,r,n)=>{if(!t)return t;const d=t.replace(/\{\{\s*([^}]+?)\s*\}\}/g,(c,b)=>{const g=b.trim();return g in r?String(r[g]):`{{${b}}}`});return!n||n.size===0?d:d.replace(/\{([^}]+)\}/g,(c,b)=>{const g=b.trim();return n.has(g)&&g in r?String(r[g]):c})},gs=()=>new Promise((t,r)=>{const n=indexedDB.open(cn,1);n.onupgradeneeded=()=>{const d=n.result;d.objectStoreNames.contains(Ve)||d.createObjectStore(Ve)},n.onsuccess=()=>t(n.result),n.onerror=()=>r(n.error)}),dn=async()=>{const t=await gs();return new Promise((r,n)=>{const b=t.transaction(Ve,"readonly").objectStore(Ve).get(xs);b.onsuccess=()=>r(b.result??null),b.onerror=()=>n(b.error)})},un=async t=>{const r=await gs();return new Promise((n,d)=>{const g=r.transaction(Ve,"readwrite").objectStore(Ve).put(t,xs);g.onsuccess=()=>n(),g.onerror=()=>d(g.error)})},hn=t=>({...t,status:"idle",responsePreview:`{
  "status": "idle"
}`,lastRunAt:void 0,lastRequest:void 0,passThroughs:t.passThroughs.map(r=>({...r,preview:void 0}))}),rs=(t,r)=>t.reduce((n,d)=>{if(!d.enabled)return n;const c=d.key.trim();if(!c)return n;const b=ce(c,r);return b&&(n[b]=ce(d.value,r)),n},{}),Nt=(t,r)=>t.reduce((n,d)=>{if(!d.enabled)return n;const c=d.key.trim();return c&&(n[ce(c,r)]=ce(d.value,r)),n},{}),pn=(t,r)=>{const d=ce(t,r).trim();if(d)try{return JSON.parse(d)}catch{return d}},ke=t=>({id:oe("hdr"),key:"",value:"",enabled:!0,...t}),X=(t,r)=>({id:oe(t),key:"",value:"",enabled:!0,...r}),mn=t=>{const r=new Set;for(let n=0;n<t.length;n++){if(t[n]!=="{")continue;if(t[n+1]==="{"){n++;continue}const d=t.indexOf("}",n+1);if(d===-1)break;if(t[d+1]==="}"){n=d+1;continue}const c=t.slice(n+1,d).trim();c&&r.add(c),n=d}return r},Ke=t=>{const r=Array.from(mn(t.url));if(!r.length)return t.localVariables.length===0?t:{...t,localVariables:[]};const n=new Map(t.localVariables.map(c=>[c.key,c])),d=r.map(c=>n.get(c)??X("var",{key:c}));return{...t,localVariables:d}},ht=(t,r)=>{if(typeof t!="string"||!t.startsWith("#/"))return;const n=t.replace(/^#\//,"").split("/");let d=r;for(const c of n)if(d=d?.[c],d===void 0)return;return d},dt=(t,r,n=0)=>{if(!t||n>5)return"";if(t.example!==void 0)return t.example;if(t.default!==void 0)return t.default;if(t.$ref){const c=ht(t.$ref,r);return dt(c,r,n+1)}switch(t.type??(t.properties?"object":t.items?"array":"string")){case"object":{const c={},b=t.properties??{};return Object.entries(b).forEach(([g,k])=>{c[g]=dt(k,r,n+1)??""}),c}case"array":return[dt(t.items??{},r,n+1)??""];case"boolean":return!1;case"number":case"integer":return 0;default:return""}},fs=(t,r)=>{if(!t)return[];if(t.$ref){const d=ht(t.$ref,r);return fs(d,r)}const n=t.properties??{};return Object.keys(n).length===0?[X("form")]:Object.keys(n).map(d=>X("form",{key:d,value:"",enabled:!0}))},xn=t=>{if(!t||typeof t!="object")return[];const r=typeof t.servers?.[0]?.url=="string"?t.servers[0].url.replace(/\/$/,""):"",n=t.paths;if(!n||typeof n!="object")return[];const d=[],c=(b,g)=>{const k=[];return Array.isArray(b)&&k.push(...b),Array.isArray(g)&&k.push(...g),k};return Object.entries(n).forEach(([b,g])=>{!g||typeof g!="object"||Object.entries(g).forEach(([k,R])=>{const v=k.toUpperCase();if(!ln.has(v)||!R||typeof R!="object")return;const L=R.summary??`${v} ${b}`,H=R.description??"",q=c(g.parameters,R.parameters),te=[],Y=[];q.forEach(A=>{const V=A?.$ref?ht(A.$ref,t):A;if(!V)return;const ne=V.name;if(!ne)return;const de=V.example??V.schema?.example??V.schema?.default??"";switch(V.in){case"query":te.push(X("query",{key:ne,value:String(de??"")}));break;case"header":Y.push(ke({key:ne,value:String(de??"")}));break}});let U=`{
  
}`,F=[],Z;const E=R.requestBody?.$ref?ht(R.requestBody.$ref,t):R.requestBody;if(E?.content&&typeof E.content=="object"){const A=Object.entries(E.content),V=A.find(([ne])=>ne.includes("application/json"))??A[0];if(V){Z=V[0];const ne=V[1],de=ne?.schema;if(Z.includes("application/x-www-form-urlencoded"))F=fs(de,t);else{const ue=ne?.example??ne?.examples?.default?.value??dt(de,t);if(ue!==void 0)try{U=typeof ue=="string"?ue:JSON.stringify(ue,null,2)}catch{U=String(ue)}}}}Z&&Y.push(ke({key:"Content-Type",value:Z}));const C=`${r}${b}`.replace(new RegExp("(?<!:)\\/{2,}","g"),"/"),S=Wt(d.length,{label:L,description:H,method:v,url:C,headers:Y.length?Y:[ke()],useGlobalHeaders:Y.length===0,queryParams:te.length?te:[X("query")],formBodyEntries:F.length?F:[X("form")],body:U});d.push(S)})}),d},Ot=t=>{const r={order:[],meta:{},body:{},headers:{},passThroughs:{},queryParams:{},localVariables:{},formBodyEntries:{},runtime:{}};return t.forEach(n=>{r.order.push(n.id),r.meta[n.id]={id:n.id,label:n.label,description:n.description,method:n.method,url:n.url,useGlobalHeaders:n.useGlobalHeaders,autoTriggerNext:n.autoTriggerNext,enabled:n.enabled},r.body[n.id]=n.body??"",r.headers[n.id]=n.headers??[],r.passThroughs[n.id]=n.passThroughs??[],r.queryParams[n.id]=n.queryParams??[],r.localVariables[n.id]=n.localVariables??[],r.formBodyEntries[n.id]=n.formBodyEntries??[],r.runtime[n.id]={status:n.status??"idle",lastRunAt:n.lastRunAt,responsePreview:n.responsePreview??"",lastRequest:n.lastRequest}}),r},Je=(t,r)=>{const n=t.meta[r];if(!n)return null;const d=t.runtime[r]??{status:"idle",responsePreview:""};return{id:r,label:n.label,description:n.description,method:n.method,url:n.url,body:t.body[r]??"",headers:t.headers[r]??[],useGlobalHeaders:n.useGlobalHeaders,passThroughs:t.passThroughs[r]??[],queryParams:t.queryParams[r]??[],localVariables:t.localVariables[r]??[],formBodyEntries:t.formBodyEntries[r]??[],responsePreview:d.responsePreview??"",autoTriggerNext:n.autoTriggerNext,enabled:n.enabled,status:d.status??"idle",lastRunAt:d.lastRunAt,lastRequest:d.lastRequest}},ot=(t,r)=>{const n={order:t.order,meta:{...t.meta},body:{...t.body},headers:{...t.headers},passThroughs:{...t.passThroughs},queryParams:{...t.queryParams},localVariables:{...t.localVariables},formBodyEntries:{...t.formBodyEntries},runtime:{...t.runtime}};return n.meta[r.id]={id:r.id,label:r.label,description:r.description,method:r.method,url:r.url,useGlobalHeaders:r.useGlobalHeaders,autoTriggerNext:r.autoTriggerNext,enabled:r.enabled},n.body[r.id]=r.body??"",n.headers[r.id]=r.headers??[],n.passThroughs[r.id]=r.passThroughs??[],n.queryParams[r.id]=r.queryParams??[],n.localVariables[r.id]=r.localVariables??[],n.formBodyEntries[r.id]=r.formBodyEntries??[],n.runtime[r.id]={status:r.status??"idle",lastRunAt:r.lastRunAt,responsePreview:r.responsePreview??"",lastRequest:r.lastRequest},n},gn=(t,r,n)=>{const d=n??t.order,c=[];return d.forEach(b=>{const g=t.meta[b];if(!g)return;const k=t.runtime[b];c.push({id:b,label:g.label,method:g.method,url:g.url,resolvedUrl:g.url?ce(g.url,r,new Set((t.localVariables[b]??[]).map(R=>R.key.trim()).filter(Boolean))):g.url,enabled:g.enabled,autoTriggerNext:g.autoTriggerNext,status:k?.status??"idle",lastRunAt:k?.lastRunAt})}),c},fn=t=>{if(t.length===0)return[{index:0,start:0,end:0,nodeIds:[]}];const r=[];for(let n=0;n<t.length;n+=Dt){const d=Math.min(t.length,n+Dt);r.push({index:r.length,start:n,end:d,nodeIds:t.slice(n,d)})}return r},bn=t=>{if(t!==void 0){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return String(t)}}},yn=(t,r)=>{if(!(!t||!r.trim()))try{const n=Fs({path:r,json:t,wrap:!0});return!Array.isArray(n)||n.length===0?void 0:n[0]}catch{return}},lt=(t,r)=>{const n={};return{updatedRows:r.map(c=>{const b=yn(t,c.jsonPath),g=bn(b),k=c.label.trim()||c.targetKey.trim();return k&&g!==void 0&&(n[k]=g),{...c,preview:g}}),variables:n}},_t=t=>({id:oe("map"),label:"",jsonPath:"$.name",targetKey:"",enabled:!0,preview:void 0,...t}),$t=t=>({...ke(),...t,id:typeof t?.id=="string"?t.id:oe("hdr"),key:typeof t?.key=="string"?t.key:"",value:typeof t?.value=="string"?t.value:"",enabled:typeof t?.enabled=="boolean"?t.enabled:!0}),jn=t=>({..._t(),...t,id:typeof t?.id=="string"?t.id:oe("map"),label:typeof t?.label=="string"&&t.label?t.label:typeof t?.targetKey=="string"?t.targetKey:"",jsonPath:typeof t?.jsonPath=="string"?t.jsonPath:"$.name",targetKey:typeof t?.targetKey=="string"?t.targetKey:"",enabled:!0,preview:void 0}),as=(t,r)=>{const n=Wt(),d=Ft.includes(t.method)?t.method:n.method,c=Array.isArray(t.headers)&&t.headers.length>0?t.headers.map(v=>$t(v)):n.headers,b=Array.isArray(t.passThroughs)&&t.passThroughs.length>0?t.passThroughs.map(v=>jn(v)):n.passThroughs,g=Array.isArray(t.queryParams)&&t.queryParams.length>0?t.queryParams.map(v=>({...X("query"),...v})):n.queryParams,k=Array.isArray(t.localVariables)&&t.localVariables.length>0?t.localVariables.filter(v=>typeof v.key=="string"&&v.key.trim()).map(v=>({...X("var"),...v,key:v.key.trim()})):n.localVariables,R=Array.isArray(t.formBodyEntries)&&t.formBodyEntries.length>0?t.formBodyEntries.map(v=>({...X("form"),...v})):n.formBodyEntries;return Ke({...n,...t,id:typeof t.id=="string"?t.id:n.id,label:typeof t.label=="string"?t.label:n.label,description:typeof t.description=="string"?t.description:n.description,method:d,url:typeof t.url=="string"?t.url:n.url,body:typeof t.body=="string"?t.body:n.body,headers:c,useGlobalHeaders:typeof t.useGlobalHeaders=="boolean"?t.useGlobalHeaders:n.useGlobalHeaders,passThroughs:b,queryParams:g,localVariables:k,formBodyEntries:R,autoTriggerNext:typeof t.autoTriggerNext=="boolean"?t.autoTriggerNext:n.autoTriggerNext,enabled:typeof t.enabled=="boolean"?t.enabled:n.enabled,status:"idle",responsePreview:n.responsePreview,lastRunAt:void 0,lastRequest:void 0})},Wt=(t,r)=>{const n={id:oe("node"),label:"",description:"",method:"POST",url:"",body:`{
  
}`,headers:[ke()],useGlobalHeaders:!0,passThroughs:[_t()],queryParams:[X("query")],localVariables:[],formBodyEntries:[X("form")],responsePreview:`{
  "status": "idle"
}`,autoTriggerNext:!1,enabled:!0,status:"idle",lastRunAt:void 0,lastRequest:void 0};return Ke({...n,...r})},vn=()=>[],Sn=()=>{const t=u.useMemo(()=>vn(),[]),[r,n]=u.useState(()=>Ot(t)),d=u.useRef({}),[c,b]=u.useState(t[0]?.id??null),g=u.useMemo(()=>[{id:oe("gh"),key:"Content-Type",value:"application/json",enabled:!0}],[]),[k,R]=u.useState(g),[v,L]=u.useState([]),[H,q]=u.useState({}),[te,Y]=u.useState(0),[U,F]=u.useState(!1),Z=u.useRef(""),E=u.useRef(!1),C=u.useRef(!1),S=u.useMemo(()=>fn(r.order),[r.order]),A=Math.min(te,Math.max(S.length-1,0)),V=S[A]?.nodeIds??[],ne=u.useMemo(()=>Nt(v,H),[v,H]),de=u.useMemo(()=>({...H,...ne}),[H,ne]),ue=u.useMemo(()=>{if(!c)return[];const a=r.order.indexOf(c);if(a<=0)return[];const l=new Set;return r.order.slice(0,a).forEach(i=>{(r.passThroughs[i]??[]).forEach(h=>{const y=h.label?.trim()||h.targetKey?.trim();y&&l.add(y)})}),Array.from(l)},[r.order,r.passThroughs,c]),Qe=u.useMemo(()=>gn(r,de,V),[r,de,V]),pt=u.useMemo(()=>S.map(a=>({index:a.index,label:`그룹 ${a.index+1}`,rangeLabel:a.nodeIds.length>0?`${a.start+1}-${a.end}`:"노드 없음",nodeCount:a.nodeIds.length})),[S]),je=r.order.length;u.useEffect(()=>{if(c&&r.meta[c])return;const a=r.order[0];b(a??null)},[r.order,r.meta,c]),u.useEffect(()=>{Y(a=>{const l=Math.max(S.length-1,0);return a>l?l:a})},[S.length]),u.useEffect(()=>{if(!c)return;const a=r.order.indexOf(c);if(a===-1)return;const l=Math.floor(a/Dt);Y(i=>i===l?i:l)},[c,r.order]);const mt=u.useCallback(()=>c?Je(r,c):null,[r,c]),xt=u.useCallback(a=>{const l=Math.max(S.length-1,0),i=Math.min(Math.max(a,0),l);Y(i),b(p=>{const h=S[i];return!h||p&&h.nodeIds.includes(p)?p:h.nodeIds[0]??p})},[S]),ge=u.useCallback(()=>{const a=r.order.map(l=>Je(r,l)).filter(l=>!!l).map(l=>hn({...l}));return{version:ns,nodes:a,globalHeaders:k,globalVariables:v}},[r,k,v]);u.useEffect(()=>{if(E.current)return;const a=ge();Z.current=JSON.stringify(a),F(!1),E.current=!0},[ge]),u.useEffect(()=>{if(E.current){if(!C.current){C.current=!0;return}U||F(!0)}},[r,k,v,U]);const Re=u.useCallback((a,l)=>{const i=a.nodes.map((y,w)=>as(y)),p=Array.isArray(a.globalHeaders)&&a.globalHeaders.length>0?a.globalHeaders.map(y=>$t(y)):g,h=Array.isArray(a.globalVariables)&&a.globalVariables.length>0?a.globalVariables.map(y=>({...X("var"),...y})):[];l?.markSaved&&(Z.current=JSON.stringify(a),F(!1),C.current=!1),n(Ot(i)),b(i[0]?.id??null),R(p),L(h),q({}),d.current={}},[g]);u.useEffect(()=>{let a=!0;return dn().then(l=>{!a||!l||Re(l,{markSaved:!0})}).catch(l=>{console.error(l)}),()=>{a=!1}},[Re]);const z=u.useCallback((a,l)=>{n(i=>{const p=Je(i,a);if(!p)return i;const h=Ke(l(p));return ot(i,h)})},[]),gt=u.useCallback((a,l)=>{if(a.length===0)return;const i=new Set(a);n(p=>{let h=!1;const y={...p.meta};return p.order.forEach(w=>{if(!i.has(w))return;const I=y[w];!I||I.enabled===l||(y[w]={...I,enabled:l},h=!0)}),h?{...p,meta:y}:p})},[]),ft=u.useCallback(a=>{if(a.length===0)return;const l=new Set(a);n(i=>{const p=i.order.filter(I=>!l.has(I)),h=I=>{const $={};return Object.entries(I).forEach(([M,re])=>{l.has(M)||($[M]=re)}),$},y={order:p,meta:h(i.meta),body:h(i.body),headers:h(i.headers),passThroughs:h(i.passThroughs),queryParams:h(i.queryParams),localVariables:h(i.localVariables),formBodyEntries:h(i.formBodyEntries),runtime:h(i.runtime)},w={...d.current};return a.forEach(I=>{delete w[I]}),d.current=w,c&&l.has(c)&&b(p[0]??null),y})},[c]),ve=()=>{n(a=>{const l=Ke(Wt(a.order.length));return b(l.id),{...ot(a,l),order:[...a.order,l.id]}})},fe=a=>()=>{n(l=>{const i=Je(l,a);if(!i)return l;const p=Ke({...i,id:oe("node"),label:`${i.label} (복제)`,status:"idle",responsePreview:"",lastRunAt:void 0,lastRequest:void 0,headers:i.headers.map(y=>({...y,id:oe("hdr")})),passThroughs:i.passThroughs.map(y=>({...y,id:oe("map"),preview:void 0})),formBodyEntries:i.formBodyEntries.map(y=>({...y,id:oe("form")}))});return b(p.id),{...ot(l,p),order:[...l.order,p.id]}})},bt=a=>l=>{l.stopPropagation(),n(i=>{if(i.order.length===1)return i;const p=i.order.filter(I=>I!==a),h=I=>{const{[a]:$,...M}=I;return M},y={order:p,meta:h(i.meta),body:h(i.body),headers:h(i.headers),passThroughs:h(i.passThroughs),queryParams:h(i.queryParams),localVariables:h(i.localVariables),formBodyEntries:h(i.formBodyEntries),runtime:h(i.runtime)},w={...d.current};return delete w[a],d.current=w,y})},Xe=u.useCallback(async(a,l,i=new Set)=>{if(i.has(a))return;i.add(a);const p=Je(r,a);if(!p)return;if(!p.url.trim()){z(a,T=>({...T,status:"error",responsePreview:JSON.stringify({error:"요청 URL을 입력하세요."},null,2)}));return}const h=l??H,y=Nt(v,h),w=Object.keys(y).length>0?{...y,...h}:h,I=p.localVariables.reduce((T,B)=>{const ee=ce(B.key,w).trim();if(!ee)return T;const D=ce(B.value,w);return D.trim()===""||(T[ee]=D),T},{}),$=new Set(p.localVariables.map(T=>T.key.trim()).filter(Boolean)),M=Object.keys(I).length>0?{...w,...I}:w,re=new Date,De={...p.useGlobalHeaders?rs(k,M):{},...rs(p.headers,M)},$e=Object.entries(De).find(([T])=>T.toLowerCase()==="content-type")?.[1]?.toLowerCase(),be={...De};p.method==="GET"&&Object.keys(be).forEach(T=>{T.toLowerCase()==="content-type"&&delete be[T]});const Ge=ce(p.url,M,$),Pe=pn(p.body,M),Fe=Nt(p.queryParams,M),O={method:p.method,url:Ge,headers:be};Object.keys(Fe).length>0&&(O.params=Fe);const he=p.formBodyEntries.filter(T=>T.enabled&&T.key.trim());if(($e?.includes("application/x-www-form-urlencoded")??!1)&&he.length>0){const T=new URLSearchParams;he.forEach(ee=>{const D=ce(ee.key,M);D&&T.append(D,ce(ee.value,M))});const B=T.toString();if(p.method==="GET"){const ee=Array.from(T.entries()).reduce((D,[J,K])=>(D[J]=K,D),{});O.params={...O.params??{},...ee}}else O.data=B}else Pe!==void 0&&(p.method==="GET"?O.params={...O.params??{},...Pe}:O.data=Pe);const Ae={url:Ge,method:p.method,headers:be,body:O.data,params:O.params};z(a,T=>({...T,lastRunAt:re.toISOString(),status:"running",responsePreview:JSON.stringify({status:"running",startedAt:re.toLocaleString()},null,2),lastRequest:Ae}));try{const T=await Ds(O),B=T.data;d.current={...d.current,[a]:B};const{updatedRows:ee,variables:D}=lt(B,p.passThroughs),J=Object.keys(D).length>0?{...M,...D}:M;if(z(a,K=>({...K,lastRunAt:new Date().toISOString(),status:"success",responsePreview:JSON.stringify(B,null,2),passThroughs:ee,lastRequest:{...Ae,responseHeaders:T.headers}})),Object.keys(D).length>0&&q(K=>({...K,...D})),p.autoTriggerNext){const K=r.order.findIndex(tt=>tt===a),_e=K>=0?r.order[K+1]:void 0;_e&&await Xe(_e,J,i)}}catch(T){if($s(T)){const B=T.response?.data;d.current={...d.current,[a]:B};const{updatedRows:ee,variables:D}=lt(B,p.passThroughs);z(a,J=>({...J,lastRunAt:new Date().toISOString(),status:"error",responsePreview:JSON.stringify(B??{status:T.response?.status??"error",message:T.message},null,2),passThroughs:ee,lastRequest:{...Ae,responseHeaders:T.response?.headers??void 0}})),Object.keys(D).length>0&&q(J=>({...J,...D}));return}d.current={...d.current,[a]:void 0},z(a,B=>({...B,lastRunAt:new Date().toISOString(),status:"error",responsePreview:JSON.stringify({status:"error",message:String(T)},null,2),passThroughs:B.passThroughs.map(ee=>({...ee,preview:void 0})),lastRequest:Ae}))}},[r,H,k,v,z]),yt=a=>async l=>{l?.stopPropagation(),await Xe(a)},Me=u.useCallback((a,l,i)=>{z(a,p=>{let h={...p,[l]:i};if(l==="url"&&typeof i=="string"){const y=new Set,w=i;for(let $=0;$<w.length;$++)if(w[$]==="{"){if(w[$+1]==="{"){$++;continue}const M=w.indexOf("}",$+1);if(M===-1)break;if(w[M+1]==="}"){$=M+1;continue}const re=w.slice($+1,M).trim();re&&y.add(re),$=M}const I=Array.from(y).map($=>h.localVariables.find(re=>re.key===$)??X("var",{key:$}));h={...h,localVariables:I}}if(l==="responsePreview"&&typeof i=="string")try{const y=JSON.parse(i),{updatedRows:w}=lt(y,h.passThroughs);h={...h,passThroughs:w}}catch{h={...h,passThroughs:h.passThroughs.map(y=>({...y,preview:void 0}))}}return h})},[z]),f=u.useCallback(()=>{const a=ge(),l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),i=`api-flow-${new Date().toISOString().slice(0,10)}.json`;Gs.saveAs(l,i)},[ge]),G=u.useCallback(async()=>{const a=ge();try{await un(a),Z.current=JSON.stringify(a),F(!1),C.current=!1}catch(l){console.error(l),window.alert("저장 중 오류가 발생했습니다.")}},[ge]),le=u.useCallback(async a=>{if(a)try{const l=await a.text(),i=JSON.parse(l);if(!i||!Array.isArray(i.nodes))throw new Error("Invalid flow snapshot");Re({version:ns,nodes:i.nodes,globalHeaders:Array.isArray(i.globalHeaders)?i.globalHeaders:[],globalVariables:Array.isArray(i.globalVariables)?i.globalVariables:[]},{markSaved:!1})}catch(l){console.error(l),window.alert("JSON 파일을 불러오는 중 오류가 발생했습니다.")}},[Re]),Be=u.useCallback(a=>{if(a.globalHeaders){const p=Array.isArray(a.globalHeaders)&&a.globalHeaders.length>0?a.globalHeaders.map(h=>$t(h)):g;R(p)}if(a.globalVariables){const p=Array.isArray(a.globalVariables)&&a.globalVariables.length>0?a.globalVariables.map(h=>({...X("var"),...h})):[];L(p)}const l=a.nodes??[];if(!Array.isArray(l)||l.length===0)return;const i=l.map((p,h)=>{const{id:y,...w}=p;return{...as(w),id:oe("node")}});n(p=>{let h={...p,order:[...p.order]};return i.forEach(y=>{h=ot(h,y),h={...h,order:[...h.order,y.id]}}),h}),i[0]?.id&&b(i[0].id)},[g]),jt=u.useCallback(async a=>{if(a)try{const l=await a.text(),i=JSON.parse(l),p=xn(i);if(!p.length){window.alert("OpenAPI 문서에서 변환할 경로를 찾지 못했습니다.");return}n(Ot(p)),b(p[0]?.id??null),q({}),d.current={},F(!0),window.alert(`OpenAPI 문서에서 ${p.length}개의 노드를 변환했습니다.`)}catch(l){console.error(l),window.alert("OpenAPI 문서를 불러오는 중 오류가 발생했습니다.")}},[]);return{nodes:Qe,nodeGroups:pt,activeGroupIndex:te,handleGroupChange:xt,totalNodeCount:je,selectedNodeId:c,setSelectedNodeId:b,globalHeaders:k,globalVariables:v,passThroughVariableKeys:ue,hasUnsavedChanges:U,setNodesEnabled:gt,removeNodes:ft,handleAddNode:ve,handleCloneNode:fe,handleRemoveNode:bt,handleRunNode:yt,handleNodeFieldChange:Me,handleSelectedNodeChange:(a,l)=>{c&&Me(c,a,l)},handleHeaderChange:(a,l,i,p)=>{if(a){z(a,h=>({...h,headers:h.headers.map(y=>y.id===l?{...y,[i]:p}:y)}));return}R(h=>h.map(y=>y.id===l?{...y,[i]:p}:y))},handleAddHeaderRow:a=>()=>{if(a){z(a,l=>({...l,headers:[...l.headers,ke()]}));return}R(l=>[...l,ke()])},handleRemoveHeaderRow:(a,l)=>()=>{if(a){z(a,i=>({...i,headers:i.headers.filter(p=>p.id!==l)}));return}R(i=>i.filter(p=>p.id!==l))},handleGlobalVariableChange:(a,l,i)=>{L(p=>p.map(h=>h.id===a?{...h,[l]:i}:h))},handleAddGlobalVariable:()=>{L(a=>[...a,X("var")])},handleRemoveGlobalVariable:a=>()=>{L(l=>l.filter(i=>i.id!==a))},handleAddPassThrough:()=>{c&&z(c,a=>({...a,passThroughs:[...a.passThroughs,_t()]}))},handlePassThroughChange:(a,l,i)=>{if(!c)return;const p=d.current[c];z(c,h=>{const y=h.passThroughs.map(I=>I.id===a?{...I,[l]:i}:I);if(!p)return{...h,passThroughs:y.map(I=>I.id===a?{...I,preview:void 0}:I)};const{updatedRows:w}=lt(p,y);return{...h,passThroughs:w}})},handleRemovePassThrough:a=>()=>{c&&z(c,l=>({...l,passThroughs:l.passThroughs.filter(i=>i.id!==a)}))},headerHelper:a=>a?"공통 헤더와 병합되어 전송됩니다.":"이 노드에서만 사용될 헤더입니다.",flowVariables:H,handleExportFlow:f,handleSaveToDb:G,handleImportFlow:le,handleAppendSampleNodes:Be,handleQueryParamChange:(a,l,i)=>{c&&z(c,p=>({...p,queryParams:p.queryParams.map(h=>h.id===a?{...h,[l]:i}:h)}))},handleAddQueryParam:()=>{c&&z(c,a=>({...a,queryParams:[...a.queryParams,X("query")]}))},handleRemoveQueryParam:a=>()=>{c&&z(c,l=>({...l,queryParams:l.queryParams.filter(i=>i.id!==a)}))},handleLocalVariableChange:(a,l,i)=>{c&&z(c,p=>({...p,localVariables:p.localVariables.map(h=>h.id===a?{...h,[l]:i}:h)}))},handleFormBodyChange:(a,l,i)=>{c&&z(c,p=>({...p,formBodyEntries:p.formBodyEntries.map(h=>h.id===a?{...h,[l]:i}:h)}))},handleAddFormBodyEntry:()=>{c&&z(c,a=>({...a,formBodyEntries:[...a.formBodyEntries,X("form")]}))},handleRemoveFormBodyEntry:a=>()=>{c&&z(c,l=>({...l,formBodyEntries:l.formBodyEntries.filter(i=>i.id!==a)}))},handleImportOpenApi:jt,getSelectedNodeData:mt}},Ce=({variables:t,onInsert:r})=>{const[n,d]=u.useState(null),c=Object.entries(t),b=!!n,g=v=>{v.stopPropagation(),d(v.currentTarget)},k=()=>d(null),R=v=>{r(`{{${v}}}`),k()};return e.jsxs(e.Fragment,{children:[e.jsx(W,{size:"small",onClick:g,disabled:c.length===0,children:e.jsx(nn,{fontSize:"small"})}),e.jsx(He,{anchorEl:n,open:b,onClose:k,children:c.length===0?e.jsx(Q,{disabled:!0,children:"저장된 변수가 없습니다"}):c.map(([v,L])=>e.jsx(Q,{onClick:()=>R(v),children:e.jsxs(m,{spacing:.5,children:[e.jsx(j,{variant:"body2",fontWeight:600,children:v}),e.jsx(j,{variant:"caption",color:"text.secondary",children:L||"값 없음"})]})},v))})]})},Cn=360,it=320,os=420,ls=["Content-Type","Accept","Authorization","User-Agent","Cache-Control","X-Request-Id"],is={"content-type":["application/json","application/xml","application/x-www-form-urlencoded","multipart/form-data","text/plain","text/html","application/octet-stream"],accept:["application/json","application/xml","text/plain","text/html","*/*"]},cs=t=>{const r=t?.trim().toLowerCase();return r&&r in is?is[r]:[]},An=()=>{const{nodes:t,nodeGroups:r,activeGroupIndex:n,handleGroupChange:d,totalNodeCount:c,selectedNodeId:b,setSelectedNodeId:g,globalHeaders:k,globalVariables:R,passThroughVariableKeys:v,hasUnsavedChanges:L,setNodesEnabled:H,removeNodes:q,handleAddNode:te,handleCloneNode:Y,handleRemoveNode:U,handleRunNode:F,handleNodeFieldChange:Z,handleSelectedNodeChange:E,handleHeaderChange:C,handleAddHeaderRow:S,handleRemoveHeaderRow:A,handleGlobalVariableChange:V,handleAddGlobalVariable:ne,handleRemoveGlobalVariable:de,handleAddPassThrough:ue,handlePassThroughChange:Qe,handleRemovePassThrough:pt,flowVariables:je,handleExportFlow:mt,handleSaveToDb:xt,handleImportFlow:ge,handleAppendSampleNodes:Re,handleQueryParamChange:z,handleAddQueryParam:gt,handleRemoveQueryParam:ft,handleLocalVariableChange:ve,handleFormBodyChange:fe,handleAddFormBodyEntry:bt,handleRemoveFormBodyEntry:Xe,handleImportOpenApi:yt,getSelectedNodeData:Me}=Sn(),f=u.useMemo(()=>Me(),[Me]),G=Gt(),le=Js(G.breakpoints.down("md")),[Be,jt]=u.useState("preview"),[Ye,Ut]=u.useState("headers"),[Le,vt]=u.useState(!1),[qe,Se]=u.useState(new Set),[St,Ct]=u.useState(null),[Tt,kt]=u.useState(null),[Jt,Rt]=u.useState(!1),[Kt,Qt]=u.useState("headers"),[Pt,wt]=u.useState(null),[Ze,At]=u.useState(null),[a,l]=u.useState(!1),[i,p]=u.useState(""),[h,y]=u.useState(!1),[w,I]=u.useState(null),[$,M]=u.useState(null),[re,De]=u.useState(null),et=u.useRef(null),$e=u.useRef(null),be=u.useRef(!1),Ge=u.useRef(null),Pe=u.useRef(null),Fe=u.useRef(null),O=u.useMemo(()=>({"& .MuiInputBase-input":{fontSize:12},"& .MuiInputLabel-root":{fontSize:12}}),[]),he=u.useRef(null),we=u.useRef(!1),[Ae,T]=u.useState(Cn),[B,ee]=u.useState("headers"),D=qe.size,J=u.useMemo(()=>{const s={};return R.forEach(o=>{if(!o.enabled)return;const x=o.key.trim();x&&(s[x]=o.value??"")}),v.forEach(o=>{o&&(s[o]=je[o]??"")}),Object.entries(je).forEach(([o,x])=>{s[o]=x}),s},[R,v,je]),K=u.useMemo(()=>Object.keys(J),[J]),_e=u.useMemo(()=>{if(Ze===null)return[];const s=Ze.trim().toLowerCase();return s?K.filter(o=>o.toLowerCase().includes(s)):K},[K,Ze]),tt=u.useMemo(()=>{if(re===null)return[];const s=re.trim().toLowerCase();return s?K.filter(o=>o.toLowerCase().includes(s)):K},[K,re]),st=u.useMemo(()=>{if(!f)return;const s=f.headers.find(o=>o.enabled&&o.key.trim().toLowerCase()==="content-type");if(s?.value.trim())return s.value.trim().toLowerCase();if(f.useGlobalHeaders)return k.find(x=>x.enabled&&x.key.trim().toLowerCase()==="content-type")?.value.trim().toLowerCase()},[f,k]),It=!!(st&&st.includes("application/x-www-form-urlencoded")),zt=r[n]??null,bs=()=>{Ge.current?.click()},ys=s=>{const o=s.target.files?.[0]??null;ge(o),s.target.value=""},js=()=>{Pe.current?.click()},vs=s=>{const o=s.target.files?.[0]??null;yt(o),s.target.value=""},Ss=s=>{s.stopPropagation(),kt(s.currentTarget)},Cs=async()=>{try{const s=await fetch("/sample/api_flow_sample_data.json");if(!s.ok)throw new Error("Failed to load sample");const o=await s.json();if(!o?.nodes||!Array.isArray(o.nodes))throw new Error("Invalid sample format");Re(o)}catch(s){console.error(s),window.alert("예시 데이터를 불러오는 중 오류가 발생했습니다.")}},We=()=>kt(null),nt=()=>{wt(null),At(null)},rt=()=>{M(null),De(null),et.current=null},Ts=s=>{if(!f)return;const o=f.url??"",x=o.lastIndexOf("{{");if(x===-1)return;const ae=`${o.slice(0,x)}{{${s}}}`;E("url",ae),nt()},ks=s=>{const o=et.current;if(!o)return;const x=o.value??"",P=x.lastIndexOf("{{");if(P===-1)return;const qs=`${x.slice(0,P)}{{${s}}}`;o.setValue(qs),rt()},pe=(s,o,x)=>{if(!s||K.length===0)return;const P=o.lastIndexOf("{{");if(P===-1){rt();return}const ae=o.slice(P+2);if(ae.includes("}}")){rt();return}et.current={value:o,setValue:x},M(s),De(ae)},Rs=s=>{const o=s.target.value;if(E("url",o),K.length===0)return;const x=o.lastIndexOf("{{");if(x===-1){nt();return}const P=o.slice(x+2);if(P.includes("}}")){nt();return}wt(s.target),At(P)},Ps=()=>{be.current=!0,vt(!1),Se(new Set),te()},ws=()=>{vt(s=>{const o=!s;return o||Se(new Set),o})},As=s=>{Se(o=>{const x=new Set(o);return x.has(s)?x.delete(s):x.add(s),x})},Is=()=>{Se(new Set(t.map(s=>s.id)))},zs=()=>{Se(new Set)},Es=s=>{s.stopPropagation(),Ct(s.currentTarget)},Ie=()=>Ct(null),Ns=()=>{p(f?.description??""),l(!0)},Xt=()=>l(!1),Os=()=>{f&&(E("description",i),l(!1))},Hs=()=>y(!0),Yt=()=>y(!1),Vs=s=>{s.stopPropagation(),I(s.currentTarget)},Ms=()=>I(null),Zt=s=>{const o=Array.from(qe);o.length!==0&&H(o,s)},Bs=()=>{const s=Array.from(qe);s.length!==0&&(q(s),Se(new Set))};u.useEffect(()=>{f&&f.method==="GET"&&B==="body"&&ee("query")},[f?.method,B]),u.useEffect(()=>{f?.id&&be.current&&(be.current=!1,requestAnimationFrame(()=>{$e.current?.focus(),$e.current?.select()}))},[f?.id]);const ze=u.useCallback(s=>{const o=he.current?.getBoundingClientRect().width??0;if(!o)return Math.max(s,it);const x=Math.max(o-os,it);return Math.min(Math.max(s,it),x)},[]),Ee=u.useCallback(s=>{if(!he.current)return;const o=he.current.getBoundingClientRect();T(ze(s-o.left))},[ze]),at=u.useCallback(()=>{we.current&&(we.current=!1,typeof document<"u"&&(document.body.style.cursor="",document.body.style.userSelect=""))},[]),es=u.useCallback(s=>{if(!le)if(s.preventDefault(),we.current=!0,typeof document<"u"&&(document.body.style.cursor="col-resize",document.body.style.userSelect="none"),"touches"in s){const o=s.touches[0];o&&Ee(o.clientX)}else Ee(s.clientX)},[le,Ee]);u.useEffect(()=>{const s=P=>{we.current&&(P.preventDefault(),Ee(P.clientX))},o=P=>{if(!we.current)return;const ae=P.touches[0];ae&&(P.preventDefault(),Ee(ae.clientX))},x=()=>at();return window.addEventListener("mousemove",s),window.addEventListener("mouseup",x),window.addEventListener("touchmove",o,{passive:!1}),window.addEventListener("touchend",x),window.addEventListener("touchcancel",x),()=>{window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",x),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",x),window.removeEventListener("touchcancel",x)}},[at,Ee]),u.useEffect(()=>{if(!he.current)return;const s=new ResizeObserver(()=>{T(o=>ze(o))});return s.observe(he.current),()=>s.disconnect()},[ze]),u.useEffect(()=>{if(!(typeof window>"u"))return()=>{}},[]),u.useEffect(()=>{if(le){at();return}T(s=>ze(s))},[le,ze,at]);const Ls=le?"1fr":`minmax(${it}px, ${Math.round(Ae)}px) 6px minmax(${os}px, 1fr)`;return e.jsxs(me,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:785,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden"},children:[e.jsx("input",{ref:Ge,type:"file",accept:"application/json,.json",style:{display:"none"},onChange:ys}),e.jsx("input",{ref:Pe,type:"file",accept:"application/json,.json",style:{display:"none"},onChange:vs}),e.jsx(N,{sx:{width:1},children:e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(se,{startIcon:e.jsx(Oe,{}),onClick:Ps,size:"small",variant:"contained",children:"추가"}),e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",justifyContent:"flex-end",children:[e.jsxs(N,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(se,{size:"small",variant:"outlined",onClick:xt,disabled:!L,children:"저장"}),L&&e.jsx(N,{sx:{position:"absolute",top:-3,right:-3,width:8,height:8,borderRadius:"50%",bgcolor:"warning.main",boxShadow:"0 0 0 2px #fff"}})]}),e.jsx(se,{size:"small",variant:"outlined",onClick:()=>Rt(!0),children:"공통 설정"}),e.jsx(xe,{title:"더보기",children:e.jsx(W,{size:"small",onClick:Ss,children:e.jsx(qt,{fontSize:"small"})})})]})]})}),e.jsxs(N,{ref:he,sx:{flex:1,minHeight:650,height:"calc(100vh - 250px)",width:1,display:"grid",gridTemplateColumns:Ls,gridTemplateRows:"1fr",columnGap:le?0:1,rowGap:1.25,alignItems:"stretch",overflow:"hidden",touchAction:le?"auto":"none"},children:[e.jsxs(m,{component:me,variant:"outlined",spacing:1.2,sx:{pt:1,pl:1.25,pr:1.25,pb:1,minHeight:0,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(He,{anchorEl:Tt,open:!!Tt,onClose:We,onClick:s=>s.stopPropagation(),children:[e.jsxs(Q,{onClick:()=>{mt(),We()},children:[e.jsx(Ks,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"내보내기"})]}),e.jsxs(Q,{onClick:()=>{bs(),We()},children:[e.jsx(Qs,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"불러오기"})]}),e.jsxs(Q,{onClick:()=>{Cs(),We()},children:[e.jsx(Xs,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"예시 불러오기"})]}),e.jsx(Et,{}),e.jsxs(Q,{onClick:()=>{js(),We()},children:[e.jsx(Ys,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"OpenAPI 3.0 불러오기"})]})]}),e.jsx(rn,{open:Jt,tab:Kt,onTabChange:Qt,onClose:()=>Rt(!1),globalHeaders:k,globalVariables:R,commonHeaderKeys:ls,getHeaderValueOptions:cs,smallFieldSx:O,onAddHeader:S(null),onChangeHeader:(s,o,x)=>C(null,s,o,x),onRemoveHeader:s=>A(null,s)(),onAddVariable:ne,onChangeVariable:V,onRemoveVariable:s=>de(s)()}),e.jsxs(m,{spacing:1.25,flexShrink:0,children:[e.jsxs(m,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(xe,{title:"선택 모드",children:e.jsx(W,{size:"small",onClick:ws,children:e.jsx(Zs,{fontSize:"small",color:Le?"primary":"inherit"})})}),Le&&e.jsxs(j,{variant:"caption",color:"text.secondary",children:["선택 ",D,"개"]})]}),Le&&e.jsx(xe,{title:"선택 옵션",children:e.jsx(W,{size:"small",onClick:Es,children:e.jsx(qt,{fontSize:"small"})})})]}),e.jsxs(He,{anchorEl:St,open:!!St,onClose:Ie,onClick:s=>s.stopPropagation(),children:[e.jsx(Q,{onClick:()=>{Is(),Ie()},children:"전체 선택"}),e.jsx(Q,{disabled:D===0,onClick:()=>{zs(),Ie()},children:"선택 해제"}),e.jsx(Et,{}),e.jsx(Q,{disabled:D===0,onClick:()=>{Zt(!0),Ie()},children:"선택 노드 활성"}),e.jsx(Q,{disabled:D===0,onClick:()=>{Zt(!1),Ie()},children:"선택 노드 비활성"}),e.jsx(Q,{disabled:D===0,onClick:()=>{Bs(),Ie()},children:"선택 노드 삭제"})]}),e.jsx(Et,{flexItem:!0}),Object.keys(je).length>0&&e.jsx(me,{variant:"outlined",sx:{p:1},children:e.jsxs(m,{spacing:1,children:[e.jsx(j,{variant:"subtitle2",children:"사용 가능한 변수"}),e.jsx(m,{direction:"row",spacing:1,flexWrap:"wrap",children:Object.entries(je).map(([s,o])=>e.jsx(hs,{label:`${s}: ${o}`,size:"small"},s))})]})})]}),r.length>1&&zt&&e.jsxs(m,{spacing:.5,flexShrink:0,children:[e.jsxs(m,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(j,{variant:"subtitle2",children:"노드 페이지"}),e.jsxs(j,{variant:"caption",color:"text.secondary",children:[zt.rangeLabel," (",zt.nodeCount,"개)"]})]}),e.jsx(en,{count:r.length,page:n+1,onChange:(s,o)=>d(o-1),color:"primary",size:"small",siblingCount:0,boundaryCount:1})]}),e.jsx(ps,{nodes:t,selectedNodeId:b,onSelect:g,onRunNode:F,onCloneNode:Y,onRemoveNode:U,onToggleField:Z,selectionMode:Le,selectedNodeIds:qe,onToggleNodeSelection:As,disableRemove:c===1})]}),!le&&e.jsx(N,{sx:{width:6,justifySelf:"stretch",cursor:"col-resize",bgcolor:"divider","&:hover":{bgcolor:"action.hover"},borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none"},onMouseDown:es,onTouchStart:es,children:e.jsxs(N,{sx:{display:"flex",flexDirection:"column",gap:.25},children:[e.jsx(N,{sx:{width:2,height:2,bgcolor:"text.secondary",borderRadius:"50%"}}),e.jsx(N,{sx:{width:2,height:2,bgcolor:"text.secondary",borderRadius:"50%"}}),e.jsx(N,{sx:{width:2,height:2,bgcolor:"text.secondary",borderRadius:"50%"}})]})}),e.jsx(me,{variant:"outlined",sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,minHeight:0,overflow:"hidden",height:"100%","& .MuiTypography-subtitle2, & .MuiTypography-body1, & .MuiTypography-body2":{fontSize:12}},children:f?e.jsxs(m,{spacing:1.2,sx:{flex:1,minHeight:0},children:[e.jsxs(m,{direction:{xs:"column",md:"row"},spacing:1.25,children:[e.jsx(_,{size:"small",label:"노드명",value:f.label,onChange:s=>E("label",s.target.value),fullWidth:!0,inputRef:$e,sx:O}),e.jsx(xe,{title:"메모",children:e.jsx(W,{size:"small",onClick:Ns,sx:{alignSelf:"center"},children:e.jsx(tn,{fontSize:"small"})})})]}),e.jsxs(m,{direction:{xs:"column",md:"row"},spacing:1.25,children:[e.jsx(_,{select:!0,size:"small",label:"HTTP Method",value:f.method,onChange:s=>E("method",s.target.value),sx:{width:le?1:160,...O,"& .MuiSelect-select":{fontSize:12},"& .MuiInputBase-root":{height:34}},SelectProps:{MenuProps:{PaperProps:{sx:{"& .MuiMenuItem-root":{fontSize:12}}},MenuListProps:{sx:{"& .MuiMenuItem-root":{fontSize:12}}}}},children:Ft.map(s=>e.jsx(Q,{value:s,sx:{fontSize:12},children:s},s))}),e.jsx(_,{size:"small",label:"요청 URL",value:f.url,placeholder:"https://api.example.com/login",onChange:Rs,fullWidth:!0,sx:O,InputProps:{endAdornment:e.jsxs(Ne,{position:"end",children:[e.jsx(Ce,{variables:J,onInsert:s=>E("url",`${f.url}${s}`)}),e.jsx(xe,{title:"이 노드만 실행",children:e.jsx(W,{size:"small",onClick:F(f.id),children:e.jsx(Lt,{fontSize:"small"})})})]})}})]}),e.jsx(He,{anchorEl:Pt,open:!!Pt&&_e.length>0,onClose:nt,onClick:s=>s.stopPropagation(),children:_e.map(s=>e.jsx(Q,{onClick:()=>Ts(s),children:e.jsx(j,{variant:"caption",color:"text.secondary",children:`{{${s}}}`})},s))}),e.jsx(He,{anchorEl:$,open:!!$&&tt.length>0,onClose:rt,onClick:s=>s.stopPropagation(),children:tt.map(s=>e.jsx(Q,{onClick:()=>ks(s),children:e.jsx(j,{variant:"caption",color:"text.secondary",children:`{{${s}}}`})},s))}),e.jsxs(Ht,{open:a,onClose:Xt,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Vt,{sx:{fontSize:12},children:"메모"}),e.jsx(Mt,{dividers:!0,sx:{py:1.5},children:e.jsx(_,{autoFocus:!0,size:"small",label:"설명",value:i,onChange:s=>p(s.target.value),fullWidth:!0,multiline:!0,minRows:4,sx:O})}),e.jsxs(Bt,{children:[e.jsx(se,{onClick:Xt,children:"취소"}),e.jsx(se,{variant:"contained",onClick:Os,children:"저장"})]})]}),e.jsxs(Ht,{open:h,onClose:Yt,maxWidth:!1,PaperProps:{sx:{width:720,height:520}},children:[e.jsx(Vt,{sx:{fontSize:12,fontWeight:70,pt:.5,pb:.5},children:e.jsxs(m,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(j,{fontWeight:700,fontSize:12,children:"전달 변수 설정"}),e.jsx(W,{size:"small",onClick:Vs,children:e.jsx(ds,{fontSize:"small"})})]})}),e.jsx(us,{open:!!w,anchorEl:w,onClose:Ms,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(N,{sx:{p:1,maxWidth:500,bgcolor:"grey.900",color:"common.white",borderRadius:1},children:e.jsxs(j,{variant:"caption",sx:{fontSize:10,lineHeight:1.3,whiteSpace:"normal"},children:["응답 JSON에서 ",e.jsx("span",{style:{color:"#90caf9"},children:"JSONPath"}),"로 값을 추출해 변수로 저장합니다.",e.jsx("br",{}),"저장된 변수는 다음 노드의"," ",e.jsx("span",{style:{color:"#a5d6a7"},children:"URL/헤더/바디"}),"에서"," ",e.jsx("code",{style:{color:"#ffd54f"},children:"{{변수명}}"})," 형태로 사용할 수 있습니다.",e.jsx("br",{}),"예: 응답이 ",e.jsx("code",{style:{color:"#ffe082"},children:'{"name":"홍길동"}'})," 이면 JSONPath는"," ",e.jsx("code",{style:{color:"#ffcc80"},children:"$.name"})," 입니다.",e.jsx("br",{}),"응답이 ",e.jsx("code",{style:{color:"#ffe082"},children:'{"data":{"name":"홍길동"}}'})," 이면"," ",e.jsx("code",{style:{color:"#ffcc80"},children:"$.data.name"})," 입니다.",e.jsx("br",{}),"결과는 ",e.jsx("code",{style:{color:"#ce93d8"},children:"홍길동"})," 를 전달합니다."]})})}),e.jsxs(Mt,{dividers:!0,sx:{py:1.5},children:[e.jsx(m,{spacing:1,sx:{flexShrink:0},children:e.jsx(m,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:e.jsx(se,{size:"small",startIcon:e.jsx(Oe,{}),onClick:ue,children:"전달 항목 추가"})})}),e.jsx(m,{spacing:1.25,sx:{mt:1},children:f.passThroughs.map(s=>e.jsx(me,{variant:"outlined",sx:{p:1.25},children:e.jsxs(m,{spacing:1,children:[e.jsxs(m,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(_,{label:"전달 변수명",size:"small",sx:{flex:.6,...O},placeholder:"token",value:s.label,onChange:o=>Qe(s.id,"label",o.target.value)}),e.jsx(_,{size:"small",label:"JSON Path",placeholder:"$.name",value:s.jsonPath,onChange:o=>Qe(s.id,"jsonPath",o.target.value),sx:{flex:1,...O}}),e.jsx(W,{size:"small",onClick:pt(s.id),children:e.jsx(Te,{fontSize:"small"})})]}),e.jsx(j,{variant:"caption",color:s.preview?"success.main":"text.secondary",children:s.preview?`최근 추출 값: ${s.preview}`:"최근 실행 기록이 없습니다."})]})},s.id))})]}),e.jsx(Bt,{children:e.jsx(se,{onClick:Yt,children:"닫기"})})]}),e.jsxs(m,{direction:{xs:"column",md:"row"},spacing:1.25,alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",children:[e.jsx(ss,{control:e.jsx(ye,{size:"small",checked:f.useGlobalHeaders,onChange:s=>E("useGlobalHeaders",s.target.checked)}),label:"공통 헤더 사용",sx:{"& .MuiFormControlLabel-label":{fontSize:12}}}),e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",justifyContent:"flex-end",children:[e.jsx(ss,{control:e.jsx(ye,{size:"small",checked:f.autoTriggerNext,onChange:s=>E("autoTriggerNext",s.target.checked)}),label:"다음 노드 자동 실행",sx:{"& .MuiFormControlLabel-label":{fontSize:12}}}),e.jsx(se,{size:"small",variant:"outlined",onClick:Hs,disabled:!f.autoTriggerNext,children:"전달 변수 설정"})]})]}),e.jsxs(m,{direction:{xs:"column",md:"row"},spacing:1.25,sx:{flex:1,minHeight:0,overflow:"hidden"},children:[e.jsxs(me,{variant:"outlined",sx:{p:0,display:"flex",flexDirection:"column",flex:1,minHeight:0,overflow:"hidden"},children:[e.jsx(N,{sx:{mb:1,px:1.25,py:.75,bgcolor:"action.hover",width:1},children:e.jsx(j,{variant:"subtitle2",children:"요청"})}),e.jsxs(ct,{value:B,onChange:(s,o)=>ee(o),textColor:"primary",indicatorColor:"primary",sx:{mb:.5,pl:1.25,pr:1.25,pb:0,pt:0,minHeight:28,"& .MuiTabs-flexContainer":{gap:.5},"& .MuiTab-root":{minHeight:28,fontSize:G.typography.caption.fontSize,py:.5},"& .MuiTabs-indicator":{bottom:2}},children:[e.jsx(ie,{label:"요청 헤더",value:"headers"}),e.jsx(ie,{label:"Query Param",value:"query"}),e.jsx(ie,{label:"Path 변수",value:"path"}),e.jsx(ie,{label:"Request Value",value:"body"}),e.jsx(ie,{label:"요청 로그",value:"log"})]}),e.jsxs(N,{sx:{flex:1,minHeight:0,p:1.25,overflow:"auto",display:"flex",flexDirection:"column"},children:[B==="headers"&&e.jsxs(N,{sx:{p:1,border:`1px solid ${G.palette.divider}`,borderRadius:1,bgcolor:"background.default"},children:[e.jsxs(m,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1},children:[e.jsx(j,{variant:"subtitle2",children:"요청 헤더"}),e.jsx(se,{size:"small",startIcon:e.jsx(Oe,{}),onClick:S(f.id),children:"헤더 추가"})]}),e.jsx(m,{spacing:1.25,children:f.headers.map(s=>e.jsxs(m,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(ut,{freeSolo:!0,options:ls,value:s.key,onInputChange:(o,x)=>{const P=x??"";C(f.id,s.id,"key",P),pe(o?.currentTarget,P,ae=>C(f.id,s.id,"key",ae))},onChange:(o,x)=>C(f.id,s.id,"key",typeof x=="string"?x:""),sx:{flex:1},ListboxProps:{sx:{"& .MuiAutocomplete-option":{fontSize:12}}},renderInput:o=>e.jsx(_,{...o,label:"Key",size:"small",sx:{flex:1,...O},InputProps:{...o.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[e.jsx(Ne,{position:"end",children:e.jsx(Ce,{variables:J,onInsert:x=>C(f.id,s.id,"key",`${s.key}${x}`)})}),o.InputProps.endAdornment]})}})}),e.jsx(ut,{freeSolo:!0,options:cs(s.key),value:s.value,onInputChange:(o,x)=>{const P=x??"";C(f.id,s.id,"value",P),pe(o?.currentTarget,P,ae=>C(f.id,s.id,"value",ae))},onChange:(o,x)=>C(f.id,s.id,"value",typeof x=="string"?x:""),sx:{flex:2},renderInput:o=>e.jsx(_,{...o,label:"Value",size:"small",sx:{flex:1,...O},InputProps:{...o.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[e.jsx(Ne,{position:"end",children:e.jsx(Ce,{variables:J,onInsert:x=>C(f.id,s.id,"value",`${s.value}${x}`)})}),o.InputProps.endAdornment]})}})}),e.jsx(W,{size:"small",onClick:A(f.id,s.id),children:e.jsx(Te,{fontSize:"small"})})]},s.id))})]}),B==="query"&&e.jsxs(N,{sx:{p:1,border:`1px solid ${G.palette.divider}`,borderRadius:1,bgcolor:"background.default"},children:[e.jsxs(m,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1},children:[e.jsx(j,{variant:"subtitle2",children:"Query Parameters"}),e.jsx(se,{size:"small",startIcon:e.jsx(Oe,{}),onClick:gt,children:"파라미터 추가"})]}),f.method==="GET"&&e.jsx(j,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"GET 요청은 Body 대신 Query Param을 사용하는 것이 일반적입니다."}),e.jsx(m,{spacing:1,children:f.queryParams.map(s=>e.jsxs(m,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(ye,{size:"small",checked:s.enabled,onChange:o=>z(s.id,"enabled",o.target.checked)}),e.jsx(_,{label:"Key",size:"small",value:s.key,onChange:o=>{const x=o.target.value;z(s.id,"key",x),pe(o.target,x,P=>z(s.id,"key",P))},sx:{flex:1,...O}}),e.jsx(_,{label:"Value",size:"small",value:s.value,onChange:o=>{const x=o.target.value;z(s.id,"value",x),pe(o.target,x,P=>z(s.id,"value",P))},sx:{flex:1,...O},InputProps:{endAdornment:e.jsx(Ne,{position:"end",children:e.jsx(Ce,{variables:J,onInsert:o=>z(s.id,"value",`${s.value}${o}`)})})}}),e.jsx(W,{size:"small",onClick:ft(s.id),children:e.jsx(Te,{fontSize:"small"})})]},s.id))})]}),B==="path"&&e.jsxs(N,{sx:{p:1,border:`1px solid ${G.palette.divider}`,borderRadius:1,bgcolor:"background.default"},children:[e.jsx(m,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1},children:e.jsx(j,{variant:"subtitle2",children:"Path / Form 변수"})}),f.localVariables.filter(s=>s.key).length===0?e.jsxs(j,{variant:"body2",color:"text.secondary",children:["URL에 ","{path_param}"," 형식으로 변수를 작성하면 자동으로 목록이 생성됩니다."]}):e.jsx(m,{spacing:1,children:f.localVariables.filter(s=>s.key).map(s=>e.jsxs(m,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(_,{label:"Key",size:"small",value:s.key,onChange:o=>{const x=o.target.value;ve(s.id,"key",x),pe(o.target,x,P=>ve(s.id,"key",P))},sx:{flex:1,...O}}),e.jsx(_,{label:"Value",size:"small",value:s.value,onChange:o=>{const x=o.target.value;ve(s.id,"value",x),pe(o.target,x,P=>ve(s.id,"value",P))},sx:{flex:1,...O},InputProps:{endAdornment:e.jsx(Ne,{position:"end",children:e.jsx(Ce,{variables:J,onInsert:o=>ve(s.id,"value",`${s.value}${o}`)})})}})]},s.id))})]}),B==="body"&&e.jsxs(m,{spacing:1,sx:{flex:1,minHeight:0,overflow:"hidden"},children:[e.jsxs(m,{direction:"row",alignItems:"center",spacing:1,ref:Fe,children:[e.jsx(j,{variant:"subtitle2",children:"Request Value"}),It?e.jsx(j,{variant:"caption",color:"text.secondary",children:"Content-Type이 form-urlencoded이므로 아래 폼을 사용해 값을 입력하세요."}):e.jsx(xe,{title:"샘플 JSON 입력 후 실행하면 응답이 우측에서 확인됩니다.",children:e.jsx(ts,{fontSize:"small",color:"action"})}),!It&&e.jsx(Ce,{variables:J,onInsert:s=>E("body",`${f.body}${s}`)})]}),It?e.jsxs(me,{variant:"outlined",sx:{p:1},children:[e.jsxs(m,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(j,{variant:"subtitle2",children:"Form 필드"}),e.jsx(se,{size:"small",startIcon:e.jsx(Oe,{}),onClick:bt,children:"필드 추가"})]}),e.jsx(m,{spacing:1,children:f.formBodyEntries.map(s=>e.jsxs(m,{direction:{xs:"column",sm:"row"},spacing:1,children:[e.jsx(ye,{size:"small",checked:s.enabled,onChange:o=>fe(s.id,"enabled",o.target.checked)}),e.jsx(_,{size:"small",label:"Key",value:s.key,onChange:o=>{const x=o.target.value;fe(s.id,"key",x),pe(o.target,x,P=>fe(s.id,"key",P))},sx:{flex:1,...O}}),e.jsx(_,{size:"small",label:"Value",value:s.value,onChange:o=>{const x=o.target.value;fe(s.id,"value",x),pe(o.target,x,P=>fe(s.id,"value",P))},sx:{flex:1,...O},InputProps:{endAdornment:e.jsx(Ne,{position:"end",children:e.jsx(Ce,{variables:J,onInsert:o=>fe(s.id,"value",`${s.value}${o}`)})})}}),e.jsx(W,{size:"small",onClick:Xe(s.id),children:e.jsx(Te,{fontSize:"small"})})]},s.id))})]}):e.jsx(N,{sx:{border:`1px solid ${G.palette.divider}`,borderRadius:1,overflow:"hidden",flex:1,minHeight:240,display:"flex"},children:e.jsx(Ue,{height:"100%",defaultLanguage:st?.includes("xml")?"xml":st?.includes("html")?"html":"json",theme:G.palette.mode==="dark"?"vs-dark":"vs-light",value:f.body,onChange:s=>{const o=s??"";E("body",o),pe(Fe.current,o,x=>E("body",x))},options:{minimap:{enabled:!1},fontSize:13,automaticLayout:!0,scrollBeyondLastLine:!1,wordWrap:"on"}})})]}),B==="log"&&e.jsx(m,{spacing:1.25,sx:{flex:1,minHeight:0},children:f.lastRequest?e.jsxs(e.Fragment,{children:[e.jsxs(m,{spacing:.5,children:[e.jsx(j,{variant:"subtitle2",children:"요청"}),e.jsxs(j,{variant:"body2",color:"text.secondary",children:["[",f.lastRequest.method,"] ",f.lastRequest.url]})]}),e.jsxs(ct,{value:Ye,onChange:(s,o)=>Ut(o),textColor:"primary",indicatorColor:"primary",sx:{mb:.5,minHeight:28,"& .MuiTabs-flexContainer":{gap:.5},"& .MuiTab-root":{minHeight:28,fontSize:G.typography.caption.fontSize,py:.5},"& .MuiTabs-indicator":{bottom:2}},children:[e.jsx(ie,{label:"Headers",value:"headers"}),e.jsx(ie,{label:"Body / Params",value:"body"})]}),e.jsxs(m,{direction:{xs:"column",md:"row"},spacing:1.25,sx:{flex:1,minHeight:0},children:[Ye==="headers"&&e.jsx(N,{sx:{flex:1,minHeight:0},children:e.jsx(N,{sx:{border:`1px solid ${G.palette.divider}`,borderRadius:1,height:"100%",minHeight:160},children:e.jsx(Ue,{height:"100%",defaultLanguage:"json",theme:G.palette.mode==="dark"?"vs-dark":"vs-light",value:JSON.stringify(f.lastRequest.headers,null,2),options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:13,automaticLayout:!0,wordWrap:"on"}})})}),Ye==="body"&&e.jsx(N,{sx:{flex:1,minHeight:0},children:e.jsx(N,{sx:{border:`1px solid ${G.palette.divider}`,borderRadius:1,height:"100%",minHeight:160},children:e.jsx(Ue,{height:"100%",defaultLanguage:"json",theme:G.palette.mode==="dark"?"vs-dark":"vs-light",value:JSON.stringify(f.lastRequest.body??f.lastRequest.params??{},null,2),options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:13,automaticLayout:!0,wordWrap:"on"}})})})]})]}):e.jsx(m,{flex:1,alignItems:"center",justifyContent:"center",spacing:1,sx:{color:"text.secondary",textAlign:"center"},children:e.jsx(j,{variant:"body2",children:"아직 요청 로그가 없습니다. 노드를 실행해 정보를 확인하세요."})})})]})]}),e.jsxs(me,{variant:"outlined",sx:{p:0,display:"flex",flexDirection:"column",flex:1,minHeight:0,overflow:"hidden"},children:[e.jsx(N,{sx:{mb:1,px:1.25,py:.75,bgcolor:"action.hover",width:1},children:e.jsx(j,{variant:"subtitle2",children:"응답"})}),e.jsxs(ct,{value:Be,onChange:(s,o)=>jt(o),textColor:"primary",indicatorColor:"primary",sx:{pl:1.25,pr:1.25,pb:0,pt:0,minHeight:28,"& .MuiTabs-flexContainer":{gap:.5},"& .MuiTab-root":{minHeight:28,fontSize:G.typography.caption.fontSize,py:.5},"& .MuiTabs-indicator":{bottom:2}},children:[e.jsx(ie,{label:"응답 본문",value:"preview"}),e.jsx(ie,{label:"응답 헤더",value:"headers"})]}),e.jsxs(N,{sx:{flex:1,minHeight:0,p:1.25,overflow:"auto",display:"flex",flexDirection:"column"},children:[Be==="preview"&&e.jsxs(m,{spacing:1,sx:{flex:1,minHeight:0},children:[e.jsxs(m,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(j,{variant:"subtitle2",children:"응답 본문"}),e.jsxs(m,{direction:"row",spacing:1,children:[e.jsx(se,{size:"small",startIcon:e.jsx(Lt,{}),variant:"contained",onClick:F(f.id),children:"실행"}),e.jsx(se,{size:"small",startIcon:e.jsx(sn,{}),variant:"outlined",onClick:()=>E("responsePreview",`{
  "status": "cleared"
}`),children:"초기화"})]})]}),e.jsx(N,{sx:{border:`1px solid ${G.palette.divider}`,borderRadius:1,overflow:"hidden",flex:1,minHeight:220,display:"flex"},children:e.jsx(Ue,{height:"100%",defaultLanguage:"json",theme:G.palette.mode==="dark"?"vs-dark":"vs-light",value:f.responsePreview,onChange:s=>E("responsePreview",s??""),options:{minimap:{enabled:!1},readOnly:!1,scrollBeyondLastLine:!1,fontSize:11,automaticLayout:!0,wordWrap:"on"}})})]}),Be==="headers"&&e.jsx(m,{spacing:1,sx:{flex:1,minHeight:0},children:f.lastRequest?.responseHeaders?e.jsx(N,{sx:{border:`1px solid ${G.palette.divider}`,borderRadius:1,overflow:"hidden",flex:1,minHeight:220,display:"flex"},children:e.jsx(Ue,{height:"100%",defaultLanguage:"json",theme:G.palette.mode==="dark"?"vs-dark":"vs-light",value:JSON.stringify(f.lastRequest.responseHeaders,null,2),options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:11,automaticLayout:!0,wordWrap:"on"}})}):e.jsx(m,{flex:1,alignItems:"center",justifyContent:"center",spacing:1,sx:{color:"text.secondary",textAlign:"center"},children:e.jsx(j,{variant:"body2",children:"응답 헤더가 없습니다. 노드를 실행해 확인하세요."})})})]})]})]})]}):e.jsxs(m,{flex:1,alignItems:"center",justifyContent:"center",spacing:1,sx:{color:"text.secondary",textAlign:"center"},children:[e.jsx(ts,{fontSize:"large"}),e.jsx(j,{variant:"body2",children:"좌측에서 노드를 선택하면 상세 설정을 확인할 수 있습니다."})]})})]})]})};export{An as default};
