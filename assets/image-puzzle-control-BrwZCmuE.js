import{r as a}from"./vendor-CRMzTT1s.js";const A=600,R=320,w=(t,o,e)=>Math.min(Math.max(t,o),e),F=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():Math.random().toString(36).slice(2,10),H=t=>new Promise((o,e)=>{const n=new Image;n.onload=()=>o(n),n.onerror=e,n.src=t}),L=(t,o)=>{const e=Array.from({length:t},()=>Array.from({length:o},()=>[0,0,0,0]));for(let n=0;n<t;n+=1)for(let s=0;s<o;s+=1){const f=n===0?0:e[n-1][s][2]*-1,i=s===0?0:e[n][s-1][1]*-1,l=s===o-1?0:Math.random()>.5?1:-1,c=n===t-1?0:Math.random()>.5?1:-1;e[n][s]=[f,l,c,i]}return e},_=(t,o,e,n,s)=>{const f=n;if(t.beginPath(),t.moveTo(0,0),t.lineTo(o/3,0),s.top!==0){const l=-s.top*f;t.quadraticCurveTo(o/2,l,2*o/3,0)}else t.lineTo(2*o/3,0);if(t.lineTo(o,0),t.lineTo(o,e/3),s.right!==0){const l=s.right*f;t.quadraticCurveTo(o+l,e/2,o,2*e/3)}else t.lineTo(o,2*e/3);if(t.lineTo(o,e),t.lineTo(2*o/3,e),s.bottom!==0){const l=s.bottom*f;t.quadraticCurveTo(o/2,e+l,o/3,e)}else t.lineTo(o/3,e);if(t.lineTo(0,e),t.lineTo(0,2*e/3),s.left!==0){const l=-s.left*f;t.quadraticCurveTo(l,e/2,0,e/3)}else t.lineTo(0,e/3);t.closePath()},B=async(t,o,e)=>{const n=await H(t),s=w(n.width,R,A),f=n.height/n.width,i=s,l=Math.round(i*f),c=i/e,g=l/o,p=Math.min(c,g)*.2,P=c+p*2,b=g+p*2,m=document.createElement("canvas");m.width=i,m.height=l;const I=m.getContext("2d");I?.drawImage(n,0,0,i,l);const M=L(o,e),k=[];for(let S=0;S<o;S+=1)for(let v=0;v<e;v+=1){const[E,U,W,h]=M[S][v],y=document.createElement("canvas");y.width=P,y.height=b;const d=y.getContext("2d");!d||!I||(d.translate(p,p),_(d,c,g,p,{top:E,right:U,bottom:W,left:h}),d.save(),d.clip(),d.drawImage(m,-v*c,-S*g,i,l),d.restore(),d.strokeStyle="rgba(0,0,0,0.25)",d.lineWidth=1,d.stroke(),k.push({id:F(),row:S,col:v,top:E,right:U,bottom:W,left:h,image:y.toDataURL()}))}return{pieces:k,metrics:{width:i,height:l,pieceWidth:c,pieceHeight:g,tabSize:p,paddedWidth:P,paddedHeight:b}}},N=()=>{const[t,o]=a.useState(null),[e,n]=a.useState(null),[s,f]=a.useState(3),[i,l]=a.useState(4),[c,g]=a.useState([]),[p,P]=a.useState(null),[b,m]=a.useState({}),[I,M]=a.useState(null),[k,D]=a.useState(!1),S=a.useMemo(()=>c.filter(r=>!b[r.id]),[c,b]),v=a.useCallback(r=>{if(!r.type.startsWith("image/")){o("이미지 파일만 업로드할 수 있습니다.");return}const u=new FileReader;u.onload=()=>{typeof u.result=="string"&&(n(u.result),o(null))},u.onerror=()=>o("파일을 읽을 수 없습니다."),u.readAsDataURL(r)},[]);a.useEffect(()=>{let r=!1;return(async()=>{if(!e){g([]),P(null),m({});return}const{pieces:C,metrics:T}=await B(e,s,i);r||(g(C.sort(()=>Math.random()-.5)),m({}),P(T))})(),()=>{r=!0}},[e,s,i]),a.useEffect(()=>{if(!c.length){D(!1);return}const r=c.length>0&&c.every(u=>{const C=b[u.id];return C&&C.row===u.row&&C.col===u.col});D(r)},[c,b]);const E=a.useCallback(()=>{m({}),g(r=>[...r].sort(()=>Math.random()-.5))},[]),U=a.useCallback(()=>{m({})},[]),W=a.useCallback((r,u,C)=>{const T=c.find(z=>z.id===r);return!T||T.row!==u||T.col!==C?!1:(m(z=>({...z,[r]:{row:u,col:C}})),!0)},[c]),h=a.useCallback(r=>{m(u=>({...u,[r]:null}))},[]),y=a.useCallback(r=>{M(r)},[]),d=a.useCallback(()=>{M(null)},[]),q=a.useCallback(()=>{D(!1)},[]);return{fileError:t,imageSrc:e,rows:s,cols:i,pieces:c,board:p,placements:b,trayPieces:S,draggingId:I,solved:k,handleFileInput:v,setRows:f,setCols:l,shufflePieces:E,resetPlacements:U,placePiece:W,removePlacement:h,startDrag:y,endDrag:d,acknowledgeSolved:q}};export{N as u};
