import{r as n,j as e}from"./vendor-DyxFRNuv.js";import{B as o,P as F,a9 as It,a as f,aq as Et,ao as kt,ap as Mt,y as Pt,z as ue,h as Qt,ar as he,T as p,I as fe,N as pe,S as D,o as Bt,ae as xe,l as ge,m as me,n as ve,p as we}from"./mui-Dn-s4uu_.js";import{u as Tt,g as Ot,n as zt,b as Ft,c as Wt,Q as Ce,a as At,P as je}from"./qr-maker-options-panel-BGQVeoqs.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-DJeWk4Ia.js";let J=null;const Lt=async()=>{if(typeof window>"u")throw new Error("QR 스캔은 브라우저 환경에서만 사용할 수 있습니다.");return window.jsQR?window.jsQR:(J||(J=new Promise((m,j)=>{const i=document.createElement("script");i.src="/libs/jsQR.min.js",i.async=!0,i.onload=()=>{window.jsQR?m(window.jsQR):j(new Error("QR 스캔 스크립트를 불러올 수 없습니다."))},i.onerror=()=>j(new Error("QR 스캔 스크립트를 불러올 수 없습니다.")),document.head.appendChild(i)})),J)},Ut=()=>{const m=n.useRef(null),j=n.useRef(null),i=n.useRef(null),c=n.useRef(null),I=n.useRef(null),b=n.useRef(null),E=n.useRef(null),W=n.useRef(null),{mode:be,setMode:Re,textDraft:ye,setTextDraft:Se,vcardDraft:De,setVcardDraft:Ie,wifiDraft:Ee,setWifiDraft:ke,isVCardValid:Me,isWifiValid:Pe,colorDark:Qe,setColorDark:A,colorLight:Be,setColorLight:L,ecLevel:Te,setEcLevel:Oe,withIcon:K,iconImg:ze,iconScale:H,setIconScale:Fe,containerRadius:We,setContainerRadius:Ae,containerBgColor:Le,setContainerBgColor:He,containerBorderEnabled:Xe,setContainerBorderEnabled:Ve,containerBorderColor:_e,setContainerBorderColor:qe,containerBorderWidth:Ue,setContainerBorderWidth:Ge,imageRadius:Ye,setImageRadius:Ne,imageFit:$e,setImageFit:Je,imageScale:Ke,setImageScale:Ze,imageOffsetX:et,setImageOffsetX:tt,imageOffsetY:nt,setImageOffsetY:rt,errorMsg:X,setErrorMsg:g,exportSize:at,setExportSize:st,exportSizeSafe:ot,generateQR:it,resetAll:ct,handleIconFile:lt,clearIcon:dt,downloadResult:ut,drawToCanvas:k}=Tt(),[Z,ht]=n.useState(()=>Math.max(1,window.devicePixelRatio||1)),[R,ft]=n.useState(320),pt=n.useMemo(()=>{if(!K)return 0;const t=Math.max(16,Math.floor(R*H));return Math.max(0,Math.floor(t))},[K,R,H]),[V,xt]=n.useState(null),[_,gt]=n.useState("input"),[q,v]=n.useState(!1),[ee,M]=n.useState(!1),[x,U]=n.useState(!1),[y,G]=n.useState(""),[te,S]=n.useState(""),[w,P]=n.useState(!1),[mt,Y]=n.useState(!1),[vt,ne]=n.useState(!1);n.useEffect(()=>{let t=0,r=-1;const a=()=>{const h=m.current;if(!h)return;const de=h.getBoundingClientRect(),z=getComputedStyle(h),Rt=(parseFloat(z.paddingLeft)||0)+(parseFloat(z.paddingRight)||0),yt=(parseFloat(z.paddingTop)||0)+(parseFloat(z.paddingBottom)||0),St=Math.max(0,de.width-Rt-je*2),Dt=Math.max(0,de.height-yt-je*2),$=Math.floor(Math.max(120,Math.min(St,Dt)));Math.abs($-r)>.5&&(r=$,ft($))},s=new ResizeObserver(()=>{cancelAnimationFrame(t),t=requestAnimationFrame(a)});[m.current,j.current,m.current?.parentElement??null].forEach(h=>h&&s.observe(h));const u=()=>ht(Math.max(1,window.devicePixelRatio||1)),C=window.matchMedia(`(resolution: ${window.devicePixelRatio||1}dppx)`);C.addEventListener?.("change",u);const O=()=>{cancelAnimationFrame(t),t=requestAnimationFrame(a)};return a(),window.addEventListener("resize",O),()=>{s.disconnect(),C.removeEventListener?.("change",u),window.removeEventListener("resize",O),cancelAnimationFrame(t)}},[]);const Q=V??R,B=n.useMemo(()=>Math.round(Q*Z),[Q,Z]);n.useEffect(()=>{(async()=>{const r=i.current;if(r)try{await k(r,B),g(""),ee&&(v(!0),M(!1))}catch(a){g(a instanceof Error?a.message:"QR을 생성할 수 없습니다."),M(!1)}})()},[k,B,g,ee]),n.useEffect(()=>{if(!q)return;let t=0;return t=requestAnimationFrame(()=>{V===null&&xt(R);const r=i.current;r&&k(r,B).then(()=>g("")).catch(a=>{g(a instanceof Error?a.message:"QR을 생성할 수 없습니다.")})}),()=>cancelAnimationFrame(t)},[q,k,B,g,R,V]);const wt=typeof window<"u"&&!!window.EyeDropper,re=typeof window<"u"&&window.isSecureContext&&!!navigator.mediaDevices?.getUserMedia,ae=t=>{ut(t,i.current)},se=()=>{if(!it()){M(!1),v(!1);return}M(!0)},d=n.useCallback(()=>{I.current&&(I.current.getTracks().forEach(t=>t.stop()),I.current=null),c.current&&(c.current.srcObject=null),b.current=null,P(!1)},[]),T=n.useCallback(async()=>{if(S(""),G(""),!(typeof window>"u")){if(!window.isSecureContext){S("보안 연결(HTTPS)에서만 카메라를 사용할 수 있습니다.");return}if(!navigator.mediaDevices?.getUserMedia){S("카메라를 사용할 수 없습니다.");return}try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});I.current=t,c.current&&(c.current.srcObject=t,await c.current.play()),window.BarcodeDetector?b.current=new window.BarcodeDetector({formats:["qr_code"]}):E.current=await Lt(),P(!0)}catch(t){t instanceof Error&&t.message?S(t.message):S("카메라 권한이 필요합니다."),d()}}},[d]),Ct=()=>{U(!0)},oe=()=>{U(!1)},ie=()=>{Y(!1),x&&T()},N=n.useCallback(t=>{const r=t.trim();return/^http:\/\//i.test(r)?`https://${r.slice(7)}`:r},[]),jt=n.useCallback(t=>{try{const r=new URL(N(t));return r.protocol==="http:"||r.protocol==="https:"}catch{return!1}},[N]);n.useEffect(()=>{if(!x){d();return}return T(),()=>{d()}},[x,T,d]),n.useEffect(()=>{if(!x||!w||!b.current)return;let t=!0;const r=setInterval(async()=>{if(!(!t||!c.current))try{const a=await b.current?.detect(c.current);if(!a||!a.length)return;const s=a[0]?.rawValue??"";if(!s)return;G(s),Y(!0),P(!1),d()}catch{}},400);return()=>{t=!1,clearInterval(r)}},[x,w,d]),n.useEffect(()=>{if(!x||!w||b.current||!E.current)return;let t=!0;const r=setInterval(()=>{if(!t||!c.current||!E.current)return;const a=c.current,s=a.videoWidth,l=a.videoHeight;if(!s||!l)return;W.current||(W.current=document.createElement("canvas"));const u=W.current;if(!u)return;(u.width!==s||u.height!==l)&&(u.width=s,u.height=l);const C=u.getContext("2d");if(!C)return;C.drawImage(a,0,0,s,l);const O=C.getImageData(0,0,s,l),h=E.current(O.data,s,l);h?.data&&(G(h.data),Y(!0),P(!1),d())},500);return()=>{t=!1,clearInterval(r)}},[x,w,d]);const bt=n.useCallback(async t=>{if(!(typeof window>"u"||!window.EyeDropper))try{const a=await new window.EyeDropper().open(),s=Ot(t),l=zt(a?.sRGBHex??"",s);t==="dark"?A(l):L(l)}catch(r){if(r instanceof DOMException&&r.name==="AbortError")return}},[A,L]),ce=n.useCallback(()=>{const t=i.current;if(!t)return;t.getContext("2d")?.clearRect(0,0,t.width,t.height)},[]);n.useEffect(()=>{X&&(ce(),v(!1),ne(!0))},[X,ce]);const le=()=>{ne(!1),g("")};return e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:0,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden",boxSizing:"border-box"},children:[e.jsx(F,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[e.jsx(It,{title:re?"":"카메라 기능은 HTTPS 및 지원 브라우저에서만 사용할 수 있습니다.",children:e.jsx("span",{children:e.jsx(f,{variant:"outlined",startIcon:e.jsx(Et,{}),onClick:Ct,disabled:!re,children:"QR 확인"})})}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(f,{variant:"contained",startIcon:e.jsx(kt,{}),onClick:se,children:"QR 생성"}),e.jsx(f,{variant:"outlined",startIcon:e.jsx(Mt,{}),onClick:ct,children:"초기화"})]})]})}),e.jsxs(F,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:[e.jsxs(Pt,{value:_,onChange:(t,r)=>gt(r),variant:"fullWidth",sx:{minHeight:36},children:[e.jsx(ue,{value:"input",label:"입력",sx:{minHeight:36,py:.5,fontWeight:600}}),e.jsx(ue,{value:"options",label:"옵션",sx:{minHeight:36,py:.5,fontWeight:600}})]}),e.jsx(Qt,{sx:{my:1}}),_==="input"&&e.jsx(Ft,{mode:be,onModeChange:Re,textDraft:ye,onTextChange:Se,vcardDraft:De,onVcardChange:Ie,wifiDraft:Ee,onWifiChange:ke,isVCardValid:Me,isWifiValid:Pe,onQuickGenerate:se}),_==="options"&&e.jsx(Wt,{colorDark:Qe,onColorDarkChange:A,colorLight:Be,onColorLightChange:L,ecLevel:Te,onEcLevelChange:Oe,hasIcon:!!ze,onIconFile:lt,onClearIcon:dt,iconScale:H,onIconScaleChange:Fe,containerRadius:We,onContainerRadiusChange:Ae,containerBgColor:Le,onContainerBgColorChange:He,containerBorderEnabled:Xe,onContainerBorderEnabledChange:Ve,containerBorderColor:_e,onContainerBorderColorChange:qe,containerBorderWidth:Ue,onContainerBorderWidthChange:Ge,imageRadius:Ye,onImageRadiusChange:Ne,iconRadiusMax:pt,imageFit:$e,onImageFitChange:Je,imageScale:Ke,onImageScaleChange:Ze,imageOffsetX:et,onImageOffsetXChange:tt,imageOffsetY:nt,onImageOffsetYChange:rt,eyeDropperAvailable:wt,onEyeDropper:bt})]}),e.jsx(he,{anchor:"bottom",open:q,onOpen:()=>v(!0),onClose:()=>v(!1),disableDiscovery:!0,swipeAreaWidth:56,ModalProps:{keepMounted:!0},PaperProps:{sx:{borderTopLeftRadius:16,borderTopRightRadius:16,maxHeight:"80vh",height:"80vh",overflow:"hidden"}},children:e.jsxs(o,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(o,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",px:2,pt:1.5,pb:1},children:[e.jsx(o,{sx:{width:36,height:4,borderRadius:999,bgcolor:"divider",position:"absolute",left:"50%",top:8,transform:"translateX(-50%)"}}),e.jsx(p,{variant:"subtitle1",fontWeight:600,children:"QR 미리보기"}),e.jsx(fe,{size:"small",onClick:()=>v(!1),children:e.jsx(pe,{fontSize:"small"})})]}),e.jsx(o,{sx:{px:2,pb:2,overflowY:"auto"},children:e.jsxs(D,{spacing:1.25,children:[e.jsx(F,{ref:m,sx:{p:2,borderRadius:1,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",minHeight:320},children:e.jsx(o,{ref:j,sx:{width:`${Q}px`,height:`${Q}px`,maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("canvas",{ref:i,style:{width:"100%",height:"100%",imageRendering:"crisp-edges",display:"block",borderRadius:8,background:"#fff",boxShadow:"0 8px 24px rgba(0,0,0,0.06)"}})})}),e.jsx(F,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(D,{spacing:1,children:[e.jsx(Bt,{label:`내보내기 (최대 ${Ce.toLocaleString()}px)`,type:"number",value:at,onChange:t=>st(Number(t.target.value||At)),inputProps:{min:64,max:Ce,step:1.25},size:"small"}),e.jsxs(D,{direction:"row",spacing:1,children:[e.jsx(f,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(xe,{}),onClick:()=>ae("png"),children:"PNG"}),e.jsx(f,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(xe,{}),onClick:()=>ae("svg"),children:"SVG"})]}),e.jsxs(p,{variant:"caption",color:"text.secondary",children:["결과 크기: ",ot.toLocaleString(),"px"]})]})})]})})]})}),e.jsx(he,{anchor:"bottom",open:x,onOpen:()=>U(!0),onClose:oe,disableDiscovery:!0,swipeAreaWidth:56,ModalProps:{keepMounted:!0},PaperProps:{sx:{borderTopLeftRadius:16,borderTopRightRadius:16,maxHeight:"calc(85vh - 10px)",height:"calc(85vh - 10px)",overflow:"hidden"}},children:e.jsxs(o,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(o,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",px:2,pt:1.5,pb:1},children:[e.jsx(o,{sx:{width:36,height:4,borderRadius:999,bgcolor:"divider",position:"absolute",left:"50%",top:8,transform:"translateX(-50%)"}}),e.jsx(p,{variant:"subtitle1",fontWeight:600,children:"QR 확인"}),e.jsx(fe,{size:"small",onClick:oe,children:e.jsx(pe,{fontSize:"small"})})]}),e.jsx(o,{sx:{px:2,pb:2,flex:1,minHeight:0,overflow:"hidden"},children:e.jsxs(D,{spacing:1.25,sx:{height:"100%"},children:[e.jsx(o,{sx:{width:"100%",aspectRatio:"3 / 4",borderRadius:1,overflow:"hidden",bgcolor:"grey.900",display:"flex",alignItems:"center",justifyContent:"center"},children:te?e.jsx(p,{variant:"body2",color:"error",sx:{px:2,textAlign:"center"},children:te}):e.jsx("video",{ref:c,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs(D,{direction:"row",spacing:1,children:[e.jsx(f,{variant:"outlined",size:"small",onClick:T,disabled:w,children:"다시 스캔"}),w&&e.jsx(p,{variant:"caption",color:"text.secondary",sx:{alignSelf:"center"},children:"스캔 중..."})]})]})})]})}),e.jsxs(ge,{open:mt,onClose:ie,fullWidth:!0,PaperProps:{sx:{maxHeight:"80vh"}},children:[e.jsx(me,{sx:{py:1.5},children:e.jsx(p,{variant:"subtitle1",fontWeight:600,children:"QR 확인"})}),e.jsxs(ve,{dividers:!0,sx:{maxHeight:"60vh",overflowY:"auto"},children:[e.jsx(p,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:1},children:"QR 결과"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:y||"QR을 스캔하면 내용이 표시됩니다."})]}),e.jsxs(we,{children:[e.jsx(f,{onClick:ie,children:"닫기"}),e.jsx(f,{variant:"contained",disabled:!y||!jt(y),onClick:()=>{y&&window.open(N(y),"_blank","noopener")},children:"링크 열기"})]})]}),e.jsxs(ge,{open:vt,onClose:le,fullWidth:!0,children:[e.jsx(me,{children:"오류"}),e.jsx(ve,{dividers:!0,children:e.jsx(p,{variant:"body2",color:"text.secondary",children:X||"오류가 발생했습니다."})}),e.jsx(we,{children:e.jsx(f,{onClick:le,children:"닫기"})})]})]})};export{Ut as default};
