import{j as e,r as t}from"./vendor-CRMzTT1s.js";import{ak as u,B as l,S as ke,o as Me,a as p,a6 as H,T as m,P as Se,al as R,a7 as L,am as Pe,an as Fe,g as ze,l as We,m as Qe,n as Ae,p as He}from"./mui-CJhvyw4B.js";import{Q as T,a as Le,P as I,u as Te,g as Be,n as Oe,b as Ve,c as Xe}from"./qr-maker-options-panel-FIFSub2h.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";const Ge=({exportSize:o,onExportSizeChange:c,exportSizeSafe:a,onDownload:i})=>e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center",justifyContent:"space-between",overflowX:"hidden",minWidth:0},children:e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:.75,minWidth:0,flex:"1 1 240px"},children:[e.jsxs(ke,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",children:[e.jsx(Me,{label:`내보내기 (최대 ${T.toLocaleString()}px)`,type:"number",value:o,onChange:d=>c(Number(d.target.value||Le)),sx:{width:170,flexShrink:0},inputProps:{min:64,max:T,step:1.25},size:"small"}),e.jsx(p,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(H,{}),onClick:()=>i("png"),children:"PNG"}),e.jsx(p,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(H,{}),onClick:()=>i("svg"),children:"SVG"})]}),e.jsxs(m,{variant:"caption",color:"text.secondary",children:["결과 크기: ",a.toLocaleString(),"px"]})]})}),_e=({previewCardRef:o,squareBoxRef:c,canvasRef:a,cssSide:i,minHeight:d=320})=>e.jsx(l,{ref:o,sx:{flex:1,minHeight:0,width:"100%",height:"100%",p:`${I}px`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(l,{ref:c,sx:{width:`${i}px`,height:`${i}px`,maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",minHeight:d},children:e.jsx("canvas",{ref:a,style:{width:"100%",height:"100%",imageRendering:"crisp-edges",display:"block",borderRadius:8,background:"#fff",boxShadow:"0 8px 24px rgba(0,0,0,0.06)"}})})}),Je=()=>{const o=t.useRef(null),c=t.useRef(null),a=t.useRef(null),i=t.useRef(null),d=t.useRef(null),[B,b]=t.useState(!1),{mode:O,setMode:V,textDraft:X,setTextDraft:G,vcardDraft:_,setVcardDraft:$,wifiDraft:q,setWifiDraft:N,isVCardValid:U,isWifiValid:Y,colorDark:J,setColorDark:v,colorLight:K,setColorLight:w,ecLevel:Z,setEcLevel:ee,withIcon:ne,setWithIcon:te,iconImg:re,iconScale:oe,setIconScale:ae,iconMargin:ie,setIconMargin:se,roundIcon:le,setRoundIcon:ce,iconFit:de,setIconFit:xe,errorMsg:C,setErrorMsg:h,exportSize:pe,setExportSize:he,exportSizeSafe:ge,generateQR:E,resetAll:fe,handleIconFile:ue,clearIcon:me,downloadResult:ve,drawToCanvas:k}=Te(),[M,we]=t.useState(()=>Math.max(1,window.devicePixelRatio||1)),[j,Ce]=t.useState(320);t.useEffect(()=>{let n=0,r=-1;const s=()=>{const x=o.current;if(!x)return;const A=x.getBoundingClientRect(),f=getComputedStyle(x),Re=(parseFloat(f.paddingLeft)||0)+(parseFloat(f.paddingRight)||0),Ie=(parseFloat(f.paddingTop)||0)+(parseFloat(f.paddingBottom)||0),be=Math.max(0,A.width-Re-I*2),Ee=Math.max(0,A.height-Ie-I*2),D=Math.floor(Math.max(120,Math.min(be,Ee)));Math.abs(D-r)>.5&&(r=D,Ce(D))},g=new ResizeObserver(()=>{cancelAnimationFrame(n),n=requestAnimationFrame(s)});[o.current,c.current,i.current,d.current,o.current?.parentElement??null].forEach(x=>x&&g.observe(x));const z=()=>we(Math.max(1,window.devicePixelRatio||1)),W=window.matchMedia(`(resolution: ${window.devicePixelRatio||1}dppx)`);W.addEventListener?.("change",z);const Q=()=>{cancelAnimationFrame(n),n=requestAnimationFrame(s)};return s(),window.addEventListener("resize",Q),()=>{g.disconnect(),W.removeEventListener?.("change",z),window.removeEventListener("resize",Q),cancelAnimationFrame(n)}},[]);const S=t.useMemo(()=>Math.round(j*M),[j,M]);t.useEffect(()=>{(async()=>{const r=a.current;if(r)try{await k(r,S),h("")}catch(s){h(s instanceof Error?s.message:"QR을 생성할 수 없습니다.")}})()},[k,S,h]);const je=typeof window<"u"&&!!window.EyeDropper,ye=n=>{ve(n,a.current)},De=t.useCallback(async n=>{if(!(typeof window>"u"||!window.EyeDropper))try{const s=await new window.EyeDropper().open(),g=Be(n),y=Oe(s?.sRGBHex??"",g);n==="dark"?v(y):w(y)}catch(r){if(r instanceof DOMException&&r.name==="AbortError")return}},[v,w]),P=t.useCallback(()=>{const n=a.current;if(!n)return;n.getContext("2d")?.clearRect(0,0,n.width,n.height)},[]);t.useEffect(()=>{C&&(P(),b(!0))},[C,P]);const F=()=>{b(!1),h("")};return e.jsxs(e.Fragment,{children:[e.jsx(Se,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:785,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden"},children:e.jsxs(l,{sx:{flex:1,minHeight:0,display:"grid",gridTemplateColumns:"380px 1fr 380px",gap:1.25,alignItems:"stretch"},children:[e.jsxs(R,{ref:i,variant:"outlined",sx:{minHeight:770,flexDirection:"column",overflow:"hidden",height:"calc(100vh - 190px)"},children:[e.jsx(l,{sx:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid",borderColor:"divider",bgcolor:"background.paper",px:1.25,py:1.25},children:e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,children:[e.jsx(m,{variant:"body2",sx:{fontWeight:600,color:"text.secondary"},children:"입력"}),e.jsxs(l,{display:"flex",gap:1,children:[e.jsx(L,{title:"현재 입력 값으로 QR 생성",children:e.jsx(p,{variant:"contained",size:"small",startIcon:e.jsx(Pe,{}),onClick:E,children:"QR 생성"})}),e.jsx(L,{title:"모든 입력/옵션 초기화 및 QR 제거",children:e.jsx(p,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(Fe,{}),onClick:fe,children:"초기화"})})]})]})}),e.jsx(u,{sx:{flex:1,minHeight:0,overflow:"auto",pt:1.25,pb:2,pr:2},children:e.jsx(Ve,{mode:O,onModeChange:V,textDraft:X,onTextChange:G,vcardDraft:_,onVcardChange:$,wifiDraft:q,onWifiChange:N,isVCardValid:U,isWifiValid:Y,onQuickGenerate:E})})]}),e.jsx(R,{variant:"outlined",sx:{minWidth:0,minHeight:0,display:"flex",maxHeight:"100%",height:"auto"},children:e.jsx(u,{sx:{flex:1,minHeight:0,p:0,display:"flex"},children:e.jsx(_e,{previewCardRef:o,squareBoxRef:c,canvasRef:a,cssSide:j})})}),e.jsxs(R,{ref:d,variant:"outlined",sx:{height:"calc(100vh - 190px)",minHeight:770,flexDirection:"column",overflow:"hidden"},children:[e.jsxs(u,{sx:{flex:1,minHeight:0,overflow:"auto",pt:1.25,pb:2,px:1.25,display:"flex",flexDirection:"column",gap:1.25},children:[e.jsx(m,{variant:"body2",fontWeight:600,color:"text.secondary",children:"옵션"}),e.jsx(Xe,{colorDark:J,onColorDarkChange:v,colorLight:K,onColorLightChange:w,ecLevel:Z,onEcLevelChange:ee,withIcon:ne,onWithIconChange:te,roundIcon:le,onRoundIconChange:ce,hasIcon:!!re,onIconFile:ue,onClearIcon:me,iconScale:oe,onIconScaleChange:ae,iconMargin:ie,onIconMarginChange:se,iconFit:de,onIconFitChange:xe,eyeDropperAvailable:je,onEyeDropper:De})]}),e.jsx(ze,{}),e.jsx(l,{sx:{position:"sticky",bottom:0,bgcolor:"background.paper",borderTop:"1px solid",borderColor:"divider"},children:e.jsx(Ge,{exportSize:pe,onExportSizeChange:he,exportSizeSafe:ge,onDownload:ye})})]})]})}),e.jsxs(We,{open:B,onClose:F,fullWidth:!0,children:[e.jsx(Qe,{children:"오류"}),e.jsx(Ae,{dividers:!0,children:e.jsx(m,{variant:"body2",color:"text.secondary",children:C||"오류가 발생했습니다."})}),e.jsx(He,{children:e.jsx(p,{onClick:F,children:"닫기"})})]})]})};export{Je as default};
