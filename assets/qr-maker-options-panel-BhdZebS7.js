import{r as h,j as t}from"./vendor-CRMzTT1s.js";import{B as x,a1 as B,ar as ye,a9 as A,as as Y,n as p,T as M,a3 as te,a4 as le,af as Ie,S as J,J as _,a7 as V,I as Z,at as ie,au as ce,aa as ue,av as Se,a as Ee,aw as he}from"./mui-CTdB6wcY.js";const de={firstName:"",lastName:"",org:"",title:"",mobile:"",phone:"",email:"",url:"",street:"",city:"",region:"",postal:"",country:"",note:""},me={ssid:"",security:"WPA",password:"",hidden:!1},pe="https://ofsimple.com",ke=8192,ge=1024,v=e=>e.replace(/([\\;,:"])/g,"\\$1"),Le=(e,o="3.0")=>{const n=r=>r?.trim()??"",a=["BEGIN:VCARD",`VERSION:${o}`],s=`${n(e.lastName)};${n(e.firstName)};;;`;s!==";;;;"&&a.push(`N:${s}`);const i=[n(e.firstName),n(e.lastName)].filter(Boolean).join(" ");if(i&&a.push(`FN:${i}`),e.org&&a.push(`ORG:${v(n(e.org))}`),e.title&&a.push(`TITLE:${v(n(e.title))}`),e.mobile&&a.push(`TEL;TYPE=CELL:${v(n(e.mobile))}`),e.phone&&a.push(`TEL;TYPE=WORK:${v(n(e.phone))}`),e.email&&a.push(`EMAIL:${v(n(e.email))}`),e.url&&a.push(`URL:${v(n(e.url))}`),e.street||e.city||e.region||e.postal||e.country){const r=`;;${v(n(e.street))};${v(n(e.city))};${v(n(e.region))};${v(n(e.postal))};${v(n(e.country))}`;a.push(`ADR;TYPE=WORK:${r}`)}return e.note&&a.push(`NOTE:${v(n(e.note))}`),a.push("END:VCARD"),a.join(`
`)},We=e=>{const o=[`WIFI:T:${e.security||"nopass"}`,`S:${v(e.ssid||"")}`];return e.security!=="nopass"&&o.push(`P:${v(e.password||"")}`),e.hidden&&o.push("H:true"),`${o.join(";")};`};let D=null;const Me=async()=>{if(typeof window>"u")throw new Error("QR 코드는 브라우저 환경에서만 생성할 수 있습니다.");return window.QRCode?.toCanvas?window.QRCode:(D||(D=new Promise((e,o)=>{const n=document.createElement("script");n.src="/libs/qrcode.min.js",n.async=!0,n.onload=()=>{window.QRCode?.toCanvas?e(window.QRCode):o(new Error("QR 스크립트를 불러올 수 없습니다."))},n.onerror=()=>o(new Error("QR 스크립트를 불러올 수 없습니다.")),document.head.appendChild(n)})),D)},Pe=e=>new Promise((o,n)=>{const a=URL.createObjectURL(e),s=new Image;s.onload=()=>{URL.revokeObjectURL(a),o(s)},s.onerror=i=>{URL.revokeObjectURL(a),n(i)},s.src=a}),Te=(e,o,n="qrcode.png")=>{const a=document.createElement("canvas");a.width=o,a.height=o;const s=a.getContext("2d");s.imageSmoothingEnabled=!1,s.drawImage(e,0,0,e.width,e.height,0,0,o,o),a.toBlob(i=>{if(!i)return;const r=URL.createObjectURL(i),j=document.createElement("a");j.href=r,j.download=n,j.click(),URL.revokeObjectURL(r)},"image/png")},$e=(e,o,n="qrcode.svg")=>{const a=document.createElement("canvas");a.width=o,a.height=o;const s=a.getContext("2d");s.imageSmoothingEnabled=!1,s.drawImage(e,0,0,e.width,e.height,0,0,o,o);const i=a.toDataURL("image/png"),r=`<svg xmlns="http://www.w3.org/2000/svg" width="${o}" height="${o}" viewBox="0 0 ${o} ${o}">
  <image href="${i}" x="0" y="0" width="${o}" height="${o}" />
</svg>`,j=new Blob([r],{type:"image/svg+xml"}),c=URL.createObjectURL(j),d=document.createElement("a");d.href=c,d.download=n,d.click(),URL.revokeObjectURL(c)},ee=(e,o,n,a,s,i)=>{const r=Math.min(i,a/2,s/2);e.beginPath(),e.moveTo(o+r,n),e.arcTo(o+a,n,o+a,n+s,r),e.arcTo(o+a,n+s,o,n+s,r),e.arcTo(o,n+s,o,n,r),e.arcTo(o,n,o+a,n,r),e.closePath()},Qe=(e,o)=>{const{size:n,iconImage:a,iconScale:s,iconMargin:i,roundIcon:r,iconFit:j}=o;if(!a)return;const c=Math.max(16,Math.floor(n*s)),d=Math.floor((n-c)/2),w=Math.floor((n-c)/2),l=Math.max(0,Math.min(c/2,i));e.save(),r&&l>0&&(ee(e,d,w,c,c,l),e.clip());const b=a.naturalWidth||a.width,y=a.naturalHeight||a.height;let I=d,k=w,C=c,L=c;if(j==="contain"){const R=Math.min(c/b,c/y);C=Math.round(b*R),L=Math.round(y*R),I=d+Math.floor((c-C)/2),k=w+Math.floor((c-L)/2)}else if(j==="cover"){const R=Math.max(c/b,c/y),W=Math.round(c/R),S=Math.round(c/R),E=Math.floor((b-W)/2),P=Math.floor((y-S)/2);e.drawImage(a,E,P,W,S,d,w,c,c),e.restore(),r&&l>0&&(e.save(),e.lineWidth=2,e.strokeStyle="rgba(0,0,0,0.08)",ee(e,d,w,c,c,l),e.stroke(),e.restore());return}e.drawImage(a,I,k,C,L),e.restore(),r&&l>0&&(e.save(),e.lineWidth=2,e.strokeStyle="rgba(0,0,0,0.08)",ee(e,d,w,c,c,l),e.stroke(),e.restore())},He=()=>{const[e,o]=h.useState("text"),[n,a]=h.useState(pe),[s,i]=h.useState(de),[r,j]=h.useState(me),c=h.useMemo(()=>{const m=!!(s.firstName?.trim()||s.lastName?.trim()||s.org?.trim()),f=!!(s.mobile?.trim()||s.phone?.trim()||s.email?.trim());return m&&f},[s]),d=h.useMemo(()=>r.ssid?.trim()?r.security==="nopass"?!0:!!r.password?.trim():!1,[r]),[w,l]=h.useState(""),[b,y]=h.useState("#000000"),[I,k]=h.useState("#ffffff"),[C,L]=h.useState("Q"),[R,W]=h.useState(!0),[S,E]=h.useState(null),[P,u]=h.useState(.2),[T,se]=h.useState(6),[z,ne]=h.useState(!0),[H,oe]=h.useState("stretch"),[O,N]=h.useState(pe),[X,ae]=h.useState(ge),K=h.useMemo(()=>Math.min(ke,Math.max(64,Math.round(X))),[X]),fe=h.useCallback(async m=>{if(!m){E(null);return}try{const f=await Pe(m);E(f)}catch{E(null)}},[]),be=h.useCallback(()=>E(null),[]),re=h.useCallback(m=>({text:O,size:m,colorDark:b,colorLight:I,ecLevel:C,iconImage:R?S:null,iconScale:P,iconMargin:T,roundIcon:z,iconFit:H}),[O,b,I,C,R,S,P,T,z,H]),ve=h.useCallback(async(m,f)=>{if(!m)return;if(!O.trim()){m.getContext("2d")?.clearRect(0,0,m.width,m.height);return}const G=await Me(),$=document.createElement("canvas");$.width=f,$.height=f,await G.toCanvas($,O||" ",{errorCorrectionLevel:C,width:f,color:{dark:b,light:I},margin:0,scale:1});const q=m.getContext("2d");m.width=f,m.height=f,q.clearRect(0,0,f,f),q.drawImage($,0,0),Qe(q,re(f)),l("")},[O,C,b,I,re]),we=h.useCallback(()=>{if(e==="text"){const m=n.trim();return m?(N(m),l(""),!0):(l("텍스트/URL을 입력하세요."),!1)}if(e==="vcard"){if(!c)return l("연락처 QR: 이름/회사 1개 이상 + 전화·휴대전화·이메일 중 1개 이상 필요합니다."),!1;try{return N(Le(s,"3.0")),l(""),!0}catch{return l("vCard를 생성할 수 없습니다."),!1}}return d?(N(We(r)),l(""),!0):(l("Wi-Fi QR: SSID는 필수이며 WPA/WEP는 비밀번호가 필요합니다."),!1)},[e,n,s,r,c,d]),Ce=h.useCallback(()=>{o("text"),a(""),i(de),j(me),y("#000000"),k("#ffffff"),L("Q"),W(!0),E(null),u(.2),se(6),ne(!0),oe("stretch"),ae(ge),N(""),l("")},[]),Re=h.useCallback(async(m,f,G)=>{if(!f)return;const $=G??K;m==="png"?Te(f,$):$e(f,$)},[K]);return{mode:e,setMode:o,textDraft:n,setTextDraft:a,vcardDraft:s,setVcardDraft:i,wifiDraft:r,setWifiDraft:j,isVCardValid:c,isWifiValid:d,colorDark:b,setColorDark:y,colorLight:I,setColorLight:k,ecLevel:C,setEcLevel:L,withIcon:R,setWithIcon:W,iconImg:S,iconScale:P,setIconScale:u,iconMargin:T,setIconMargin:se,roundIcon:z,setRoundIcon:ne,iconFit:H,setIconFit:oe,payload:O,errorMsg:w,setErrorMsg:l,exportSize:X,setExportSize:ae,exportSizeSafe:K,generateQR:we,resetAll:Ce,handleIconFile:fe,clearIcon:be,downloadResult:Re,drawToCanvas:ve}},Oe=[{label:"L (7%)",value:"L"},{label:"M (15%)",value:"M"},{label:"Q (25%)",value:"Q"},{label:"H (30%)",value:"H"}],Ae=[{label:"WPA/WPA2/3",value:"WPA"},{label:"WEP",value:"WEP"},{label:"Open (nopass)",value:"nopass"}],Fe=[{label:"cover",value:"cover"},{label:"contain",value:"contain"},{label:"stretch",value:"stretch"}],Xe=20,Q={dark:"#000000",light:"#ffffff"},Ue=/^#([0-9a-fA-F]{6})$/,Ne=/^#([0-9a-fA-F]{3})$/,xe={width:28,height:28,border:0,p:0,bgcolor:"transparent",cursor:"pointer","&::-webkit-color-swatch-wrapper":{p:0},"&::-webkit-color-swatch":{borderRadius:"50%",border:"1px solid rgba(0,0,0,0.2)"},"&::-moz-color-swatch":{borderRadius:"50%",border:"1px solid rgba(0,0,0,0.2)"}},g={size:"small",margin:"dense"},F={componentsProps:{typography:{variant:"body2"}}},U=(e,o)=>{const n=e.trim();return Ue.test(n)?n.toLowerCase():Ne.test(n)?`#${n.slice(1).split("").map(s=>`${s}${s}`).join("").toLowerCase()}`:o},je=(e,o)=>U(e,o),Ke=e=>Q[e],Ge=({mode:e,onModeChange:o,textDraft:n,onTextChange:a,vcardDraft:s,onVcardChange:i,wifiDraft:r,onWifiChange:j,isVCardValid:c,isWifiValid:d,onQuickGenerate:w})=>t.jsxs(x,{children:[t.jsx(B,{sx:{mt:0},children:t.jsxs(ye,{row:!0,value:e,onChange:(l,b)=>o(b??"text"),children:[t.jsx(A,{value:"text",control:t.jsx(Y,{size:"small"}),label:"텍스트 / URL",...F}),t.jsx(A,{value:"vcard",control:t.jsx(Y,{size:"small"}),label:"연락처 (vCard)",...F}),t.jsx(A,{value:"wifi",control:t.jsx(Y,{size:"small"}),label:"Wi-Fi",...F})]})}),e==="text"&&t.jsx(x,{mt:1,display:"flex",flexDirection:"column",gap:1,color:"red",children:t.jsx(p,{...g,label:"텍스트 / URL",value:n,onChange:l=>a(l.target.value),fullWidth:!0,multiline:!0,minRows:3,maxRows:22,helperText:"⌘/Ctrl + Enter 로 빠르게 생성",onKeyDown:l=>{(l.metaKey||l.ctrlKey)&&l.key==="Enter"&&(l.preventDefault(),w?.())}})}),e==="vcard"&&t.jsxs(x,{mt:1,display:"flex",flexDirection:"column",gap:0,children:[t.jsxs(x,{display:"flex",gap:1,children:[t.jsx(p,{...g,label:"성",value:s.lastName,onChange:l=>i({...s,lastName:l.target.value}),fullWidth:!0}),t.jsx(p,{...g,label:"이름",value:s.firstName,onChange:l=>i({...s,firstName:l.target.value}),fullWidth:!0})]}),t.jsx(p,{...g,label:"회사/조직",value:s.org,onChange:l=>i({...s,org:l.target.value}),fullWidth:!0}),t.jsx(p,{...g,label:"직함",value:s.title,onChange:l=>i({...s,title:l.target.value}),fullWidth:!0}),t.jsxs(x,{display:"flex",gap:1,children:[t.jsx(p,{...g,label:"휴대전화",value:s.mobile,onChange:l=>i({...s,mobile:l.target.value}),fullWidth:!0}),t.jsx(p,{...g,label:"전화",value:s.phone,onChange:l=>i({...s,phone:l.target.value}),fullWidth:!0})]}),t.jsxs(x,{display:"flex",gap:1,children:[t.jsx(p,{...g,label:"이메일",value:s.email,onChange:l=>i({...s,email:l.target.value}),fullWidth:!0}),t.jsx(p,{...g,label:"웹사이트",value:s.url,onChange:l=>i({...s,url:l.target.value}),fullWidth:!0})]}),t.jsx(p,{...g,label:"주소",value:s.street,onChange:l=>i({...s,street:l.target.value}),fullWidth:!0}),t.jsxs(x,{display:"flex",gap:1,children:[t.jsx(p,{...g,label:"도시",value:s.city,onChange:l=>i({...s,city:l.target.value}),fullWidth:!0}),t.jsx(p,{...g,label:"지역/주",value:s.region,onChange:l=>i({...s,region:l.target.value}),fullWidth:!0})]}),t.jsxs(x,{display:"flex",gap:1,children:[t.jsx(p,{...g,label:"우편번호",value:s.postal,onChange:l=>i({...s,postal:l.target.value}),fullWidth:!0}),t.jsx(p,{...g,label:"국가",value:s.country,onChange:l=>i({...s,country:l.target.value}),fullWidth:!0})]}),t.jsx(p,{...g,label:"메모",value:s.note,onChange:l=>i({...s,note:l.target.value}),fullWidth:!0,multiline:!0,minRows:2}),!c&&t.jsx(M,{variant:"caption",color:"error",children:"이름/회사 1개 이상과 전화·휴대전화·이메일 중 1개 이상을 입력하세요."})]}),e==="wifi"&&t.jsxs(x,{mt:1,display:"flex",flexDirection:"column",gap:0,children:[t.jsx(p,{...g,label:"SSID",value:r.ssid,onChange:l=>j({...r,ssid:l.target.value}),fullWidth:!0}),t.jsxs(x,{display:"flex",gap:1,alignItems:"center",children:[t.jsx(B,{fullWidth:!0,margin:"dense",size:"small",children:t.jsx(te,{value:r.security,onChange:l=>j({...r,security:l.target.value}),size:"small",children:Ae.map(l=>t.jsx(le,{value:l.value,children:l.label},l.value))})}),t.jsx(p,{...g,label:"비밀번호",type:"password",value:r.password,onChange:l=>j({...r,password:l.target.value}),fullWidth:!0,disabled:r.security==="nopass"})]}),t.jsx(A,{...F,control:t.jsx(Ie,{size:"small",checked:r.hidden,onChange:l=>j({...r,hidden:l.target.checked})}),label:"SSID 숨김"}),t.jsx(M,{variant:"caption",color:d?"success.main":"error",children:d?"Wi-Fi QR 생성 가능":"SSID와 비밀번호를 확인하세요."})]})]}),qe=({colorDark:e,onColorDarkChange:o,colorLight:n,onColorLightChange:a,ecLevel:s,onEcLevelChange:i,withIcon:r,onWithIconChange:j,roundIcon:c,onRoundIconChange:d,hasIcon:w,onIconFile:l,onClearIcon:b,iconScale:y,onIconScaleChange:I,iconMargin:k,onIconMarginChange:C,iconFit:L,onIconFitChange:R,eyeDropperAvailable:W,onEyeDropper:S})=>{const E=je(e,Q.dark),P=je(n,Q.light);return t.jsxs(J,{spacing:1.25,children:[t.jsxs(x,{display:"flex",gap:1,children:[t.jsx(p,{...g,label:"QR",value:e,onChange:u=>o(u.target.value),onBlur:()=>o(U(e,Q.dark)),InputProps:{startAdornment:t.jsx(_,{position:"start",children:t.jsx(ce,{fontSize:"small"})}),endAdornment:t.jsx(_,{position:"end",sx:{pl:1},children:t.jsxs(J,{direction:"row",spacing:.5,alignItems:"center",children:[W&&t.jsx(V,{title:"스포이드로 화면에서 색상 선택",children:t.jsx(Z,{size:"small",onClick:()=>S("dark"),"aria-label":"QR 색상 스포이드",children:t.jsx(ie,{fontSize:"small"})})}),t.jsx(x,{component:"input",type:"color",value:E,onChange:u=>o(U(u.target.value,Q.dark)),"aria-label":"QR color picker",title:"QR 색상 선택",sx:xe})]})})},fullWidth:!0}),t.jsx(p,{...g,label:"Background",value:n,onChange:u=>a(u.target.value),onBlur:()=>a(U(n,Q.light)),InputProps:{startAdornment:t.jsx(_,{position:"start",children:t.jsx(ce,{fontSize:"small"})}),endAdornment:t.jsx(_,{position:"end",sx:{pl:1},children:t.jsxs(J,{direction:"row",spacing:.5,alignItems:"center",children:[W&&t.jsx(V,{title:"스포이드로 화면에서 색상 선택",children:t.jsx(Z,{size:"small",onClick:()=>S("light"),"aria-label":"Background 색상 스포이드",children:t.jsx(ie,{fontSize:"small"})})}),t.jsx(x,{component:"input",type:"color",value:P,onChange:u=>a(U(u.target.value,Q.light)),"aria-label":"Background color picker",title:"Background 색상 선택",sx:xe})]})})},fullWidth:!0})]}),t.jsxs(B,{fullWidth:!0,children:[t.jsx(M,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"에러 보정(EC Level)"}),t.jsx(te,{value:s,onChange:u=>i(u.target.value),size:"small",children:Oe.map(u=>t.jsx(le,{value:u.value,children:u.label},u.value))})]}),t.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,children:[t.jsx(A,{...F,control:t.jsx(ue,{size:"small",checked:r,onChange:u=>j(u.target.checked)}),label:"아이콘 사용"}),t.jsx(A,{...F,control:t.jsx(ue,{size:"small",checked:c,onChange:u=>d(u.target.checked)}),label:"아이콘 둥글게",sx:{ml:0}})]}),t.jsxs(x,{display:"flex",gap:1,alignItems:"center",children:[t.jsx(V,{title:"아이콘 업로드",children:t.jsxs(Z,{component:"label",size:"small",children:[t.jsx(Se,{}),t.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:u=>l(u.target.files?.[0]??null)})]})}),w&&t.jsx(Ee,{size:"small",onClick:b,children:"아이콘 제거"})]}),t.jsxs(x,{children:[t.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"baseline",sx:{mb:.5},children:[t.jsx(M,{variant:"body2",children:"아이콘 크기"}),t.jsxs(M,{variant:"caption",color:"text.secondary",children:[Math.round(y*100),"%"]})]}),t.jsx(he,{value:y,onChange:(u,T)=>I(T),min:.05,max:.35,step:.01})]}),t.jsxs(x,{children:[t.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"baseline",sx:{mb:.5},children:[t.jsx(M,{variant:"body2",children:"아이콘 여백"}),t.jsxs(M,{variant:"caption",color:"text.secondary",children:[k.toFixed(0),"px"]})]}),t.jsx(he,{value:k,onChange:(u,T)=>C(T),min:0,max:20,step:1})]}),t.jsxs(B,{fullWidth:!0,children:[t.jsx(M,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"아이콘 맞춤"}),t.jsx(te,{value:L,onChange:u=>R(u.target.value),size:"small",children:Fe.map(u=>t.jsx(le,{value:u.value,children:u.label},u.value))})]})]})};export{Xe as P,ke as Q,ge as a,Ge as b,qe as c,Ke as g,U as n,He as u};
