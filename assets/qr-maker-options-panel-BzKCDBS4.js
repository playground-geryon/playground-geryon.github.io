import{r as d,j as e}from"./vendor-DyxFRNuv.js";import{B as x,a4 as G,as as Ie,ab as A,at as D,o as p,T as L,a6 as ne,a7 as oe,ak as Se,S as H,K,a9 as ee,I as X,au as ce,av as ue,aa as ke,ac as de,aw as Ee,a as te,ax as he,l as Le,m as We,n as Me,p as Pe}from"./mui-DxUmZoFs.js";const me={firstName:"",lastName:"",org:"",title:"",mobile:"",phone:"",email:"",url:"",street:"",city:"",region:"",postal:"",country:"",note:""},pe={ssid:"",security:"WPA",password:"",hidden:!1},ge="https://ofsimple.com",Te=8192,xe=1024,v=t=>t.replace(/([\\;,:"])/g,"\\$1"),$e=(t,o="3.0")=>{const n=r=>r?.trim()??"",a=["BEGIN:VCARD",`VERSION:${o}`],s=`${n(t.lastName)};${n(t.firstName)};;;`;s!==";;;;"&&a.push(`N:${s}`);const i=[n(t.firstName),n(t.lastName)].filter(Boolean).join(" ");if(i&&a.push(`FN:${i}`),t.org&&a.push(`ORG:${v(n(t.org))}`),t.title&&a.push(`TITLE:${v(n(t.title))}`),t.mobile&&a.push(`TEL;TYPE=CELL:${v(n(t.mobile))}`),t.phone&&a.push(`TEL;TYPE=WORK:${v(n(t.phone))}`),t.email&&a.push(`EMAIL:${v(n(t.email))}`),t.url&&a.push(`URL:${v(n(t.url))}`),t.street||t.city||t.region||t.postal||t.country){const r=`;;${v(n(t.street))};${v(n(t.city))};${v(n(t.region))};${v(n(t.postal))};${v(n(t.country))}`;a.push(`ADR;TYPE=WORK:${r}`)}return t.note&&a.push(`NOTE:${v(n(t.note))}`),a.push("END:VCARD"),a.join(`
`)},Oe=t=>{const o=[`WIFI:T:${t.security||"nopass"}`,`S:${v(t.ssid||"")}`];return t.security!=="nopass"&&o.push(`P:${v(t.password||"")}`),t.hidden&&o.push("H:true"),`${o.join(";")};`};let le=null;const Qe=async()=>{if(typeof window>"u")throw new Error("QR 코드는 브라우저 환경에서만 생성할 수 있습니다.");return window.QRCode?.toCanvas?window.QRCode:(le||(le=new Promise((t,o)=>{const n=document.createElement("script");n.src="/libs/qrcode.min.js",n.async=!0,n.onload=()=>{window.QRCode?.toCanvas?t(window.QRCode):o(new Error("QR 스크립트를 불러올 수 없습니다."))},n.onerror=()=>o(new Error("QR 스크립트를 불러올 수 없습니다.")),document.head.appendChild(n)})),le)},Ae=t=>new Promise((o,n)=>{const a=URL.createObjectURL(t),s=new Image;s.onload=()=>{URL.revokeObjectURL(a),o(s)},s.onerror=i=>{URL.revokeObjectURL(a),n(i)},s.src=a}),Ue=(t,o,n="qrcode.png")=>{const a=document.createElement("canvas");a.width=o,a.height=o;const s=a.getContext("2d");s.imageSmoothingEnabled=!1,s.drawImage(t,0,0,t.width,t.height,0,0,o,o),a.toBlob(i=>{if(!i)return;const r=URL.createObjectURL(i),f=document.createElement("a");f.href=r,f.download=n,f.click(),URL.revokeObjectURL(r)},"image/png")},Fe=(t,o,n="qrcode.svg")=>{const a=document.createElement("canvas");a.width=o,a.height=o;const s=a.getContext("2d");s.imageSmoothingEnabled=!1,s.drawImage(t,0,0,t.width,t.height,0,0,o,o);const i=a.toDataURL("image/png"),r=`<svg xmlns="http://www.w3.org/2000/svg" width="${o}" height="${o}" viewBox="0 0 ${o} ${o}">
  <image href="${i}" x="0" y="0" width="${o}" height="${o}" />
</svg>`,f=new Blob([r],{type:"image/svg+xml"}),u=URL.createObjectURL(f),h=document.createElement("a");h.href=u,h.download=n,h.click(),URL.revokeObjectURL(u)},se=(t,o,n,a,s,i)=>{const r=Math.min(i,a/2,s/2);t.beginPath(),t.moveTo(o+r,n),t.arcTo(o+a,n,o+a,n+s,r),t.arcTo(o+a,n+s,o,n+s,r),t.arcTo(o,n+s,o,n,r),t.arcTo(o,n,o+a,n,r),t.closePath()},Ne=(t,o)=>{const{size:n,iconImage:a,iconScale:s,iconMargin:i,roundIcon:r,iconFit:f}=o;if(!a)return;const u=Math.max(16,Math.floor(n*s)),h=Math.floor((n-u)/2),C=Math.floor((n-u)/2),l=Math.max(0,Math.min(u/2,i));t.save(),r&&l>0&&(se(t,h,C,u,u,l),t.clip());const b=a.naturalWidth||a.width,w=a.naturalHeight||a.height;let I=h,W=C,y=u,M=u;if(f==="contain"){const R=Math.min(u/b,u/w);y=Math.round(b*R),M=Math.round(w*R),I=h+Math.floor((u-y)/2),W=C+Math.floor((u-M)/2)}else if(f==="cover"){const R=Math.max(u/b,u/w),P=Math.round(u/R),S=Math.round(u/R),k=Math.floor((b-P)/2),E=Math.floor((w-S)/2);t.drawImage(a,k,E,P,S,h,C,u,u),t.restore(),r&&l>0&&(t.save(),t.lineWidth=2,t.strokeStyle="rgba(0,0,0,0.08)",se(t,h,C,u,u,l),t.stroke(),t.restore());return}t.drawImage(a,I,W,y,M),t.restore(),r&&l>0&&(t.save(),t.lineWidth=2,t.strokeStyle="rgba(0,0,0,0.08)",se(t,h,C,u,u,l),t.stroke(),t.restore())},Ye=()=>{const[t,o]=d.useState("text"),[n,a]=d.useState(ge),[s,i]=d.useState(me),[r,f]=d.useState(pe),u=d.useMemo(()=>{const m=!!(s.firstName?.trim()||s.lastName?.trim()||s.org?.trim()),j=!!(s.mobile?.trim()||s.phone?.trim()||s.email?.trim());return m&&j},[s]),h=d.useMemo(()=>r.ssid?.trim()?r.security==="nopass"?!0:!!r.password?.trim():!1,[r]),[C,l]=d.useState(""),[b,w]=d.useState("#000000"),[I,W]=d.useState("#ffffff"),[y,M]=d.useState("Q"),[R,P]=d.useState(!1),[S,k]=d.useState(null),[E,_]=d.useState(.2),[F,B]=d.useState(6),[c,O]=d.useState(!0),[q,ae]=d.useState("stretch"),[Q,z]=d.useState(ge),[Y,re]=d.useState(xe),V=d.useMemo(()=>Math.min(Te,Math.max(64,Math.round(Y))),[Y]),be=d.useCallback(async m=>{if(!m){k(null);return}try{const j=await Ae(m);k(j)}catch{k(null)}},[]),ve=d.useCallback(()=>k(null),[]),ie=d.useCallback(m=>({text:Q,size:m,colorDark:b,colorLight:I,ecLevel:y,iconImage:R?S:null,iconScale:E,iconMargin:F,roundIcon:c,iconFit:q}),[Q,b,I,y,R,S,E,F,c,q]),Ce=d.useCallback(async(m,j)=>{if(!m)return;if(!Q.trim()){m.getContext("2d")?.clearRect(0,0,m.width,m.height);return}const J=await Qe(),T=document.createElement("canvas");T.width=j,T.height=j,await J.toCanvas(T,Q||" ",{errorCorrectionLevel:y,width:j,color:{dark:b,light:I},margin:0,scale:1});const Z=m.getContext("2d");m.width=j,m.height=j,Z.clearRect(0,0,j,j),Z.drawImage(T,0,0),Ne(Z,ie(j)),l("")},[Q,y,b,I,ie]),ye=d.useCallback(()=>{if(t==="text"){const m=n.trim();return m?(z(m),l(""),!0):(l("텍스트/URL을 입력하세요."),!1)}if(t==="vcard"){if(!u)return l("연락처 QR: 이름/회사 1개 이상 + 전화·휴대전화·이메일 중 1개 이상 필요합니다."),!1;try{return z($e(s,"3.0")),l(""),!0}catch{return l("vCard를 생성할 수 없습니다."),!1}}return h?(z(Oe(r)),l(""),!0):(l("Wi-Fi QR: SSID는 필수이며 WPA/WEP는 비밀번호가 필요합니다."),!1)},[t,n,s,r,u,h]),Re=d.useCallback(()=>{o("text"),a(""),i(me),f(pe),w("#000000"),W("#ffffff"),M("Q"),P(!1),k(null),_(.2),B(6),O(!0),ae("stretch"),re(xe),z(""),l("")},[]),we=d.useCallback(async(m,j,J)=>{if(!j)return;const T=J??V;m==="png"?Ue(j,T):Fe(j,T)},[V]);return{mode:t,setMode:o,textDraft:n,setTextDraft:a,vcardDraft:s,setVcardDraft:i,wifiDraft:r,setWifiDraft:f,isVCardValid:u,isWifiValid:h,colorDark:b,setColorDark:w,colorLight:I,setColorLight:W,ecLevel:y,setEcLevel:M,withIcon:R,setWithIcon:P,iconImg:S,iconScale:E,setIconScale:_,iconMargin:F,setIconMargin:B,roundIcon:c,setRoundIcon:O,iconFit:q,setIconFit:ae,payload:Q,errorMsg:C,setErrorMsg:l,exportSize:Y,setExportSize:re,exportSizeSafe:V,generateQR:ye,resetAll:Re,handleIconFile:be,clearIcon:ve,downloadResult:we,drawToCanvas:Ce}},_e=[{label:"L (7%)",value:"L"},{label:"M (15%)",value:"M"},{label:"Q (25%)",value:"Q"},{label:"H (30%)",value:"H"}],Be=[{label:"WPA/WPA2/3",value:"WPA"},{label:"WEP",value:"WEP"},{label:"Open (nopass)",value:"nopass"}],ze=[{label:"채우기",value:"cover"},{label:"맞추기",value:"contain"},{label:"늘리기",value:"stretch"}],Ve=20,$={dark:"#000000",light:"#ffffff"},He=/^#([0-9a-fA-F]{6})$/,Ke=/^#([0-9a-fA-F]{3})$/,fe={width:28,height:28,border:0,p:0,bgcolor:"transparent",cursor:"pointer","&::-webkit-color-swatch-wrapper":{p:0},"&::-webkit-color-swatch":{borderRadius:"50%",border:"1px solid rgba(0,0,0,0.2)"},"&::-moz-color-swatch":{borderRadius:"50%",border:"1px solid rgba(0,0,0,0.2)"}},g={size:"small",margin:"dense"},U={componentsProps:{typography:{variant:"body2"}}},N=(t,o)=>{const n=t.trim();return He.test(n)?n.toLowerCase():Ke.test(n)?`#${n.slice(1).split("").map(s=>`${s}${s}`).join("").toLowerCase()}`:o},je=(t,o)=>N(t,o),Je=t=>$[t],Ze=({mode:t,onModeChange:o,textDraft:n,onTextChange:a,vcardDraft:s,onVcardChange:i,wifiDraft:r,onWifiChange:f,isVCardValid:u,isWifiValid:h,onQuickGenerate:C})=>e.jsxs(x,{children:[e.jsx(G,{sx:{mt:0},children:e.jsxs(Ie,{row:!0,value:t,onChange:(l,b)=>o(b??"text"),children:[e.jsx(A,{value:"text",control:e.jsx(D,{size:"small"}),label:"텍스트 / URL",...U}),e.jsx(A,{value:"vcard",control:e.jsx(D,{size:"small"}),label:"연락처 (vCard)",...U}),e.jsx(A,{value:"wifi",control:e.jsx(D,{size:"small"}),label:"Wi-Fi",...U})]})}),t==="text"&&e.jsx(x,{mt:1,display:"flex",flexDirection:"column",gap:1,color:"red",children:e.jsx(p,{...g,label:"텍스트 / URL",value:n,onChange:l=>a(l.target.value),fullWidth:!0,multiline:!0,minRows:3,maxRows:22,helperText:"⌘/Ctrl + Enter 로 빠르게 생성",onKeyDown:l=>{(l.metaKey||l.ctrlKey)&&l.key==="Enter"&&(l.preventDefault(),C?.())}})}),t==="vcard"&&e.jsxs(x,{mt:1,display:"flex",flexDirection:"column",gap:0,children:[e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"성",value:s.lastName,onChange:l=>i({...s,lastName:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"이름",value:s.firstName,onChange:l=>i({...s,firstName:l.target.value}),fullWidth:!0})]}),e.jsx(p,{...g,label:"회사/조직",value:s.org,onChange:l=>i({...s,org:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"직함",value:s.title,onChange:l=>i({...s,title:l.target.value}),fullWidth:!0}),e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"휴대전화",value:s.mobile,onChange:l=>i({...s,mobile:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"전화",value:s.phone,onChange:l=>i({...s,phone:l.target.value}),fullWidth:!0})]}),e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"이메일",value:s.email,onChange:l=>i({...s,email:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"웹사이트",value:s.url,onChange:l=>i({...s,url:l.target.value}),fullWidth:!0})]}),e.jsx(p,{...g,label:"주소",value:s.street,onChange:l=>i({...s,street:l.target.value}),fullWidth:!0}),e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"도시",value:s.city,onChange:l=>i({...s,city:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"지역/주",value:s.region,onChange:l=>i({...s,region:l.target.value}),fullWidth:!0})]}),e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"우편번호",value:s.postal,onChange:l=>i({...s,postal:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"국가",value:s.country,onChange:l=>i({...s,country:l.target.value}),fullWidth:!0})]}),e.jsx(p,{...g,label:"메모",value:s.note,onChange:l=>i({...s,note:l.target.value}),fullWidth:!0,multiline:!0,minRows:2}),!u&&e.jsx(L,{variant:"caption",color:"error",children:"이름/회사 1개 이상과 전화·휴대전화·이메일 중 1개 이상을 입력하세요."})]}),t==="wifi"&&e.jsxs(x,{mt:1,display:"flex",flexDirection:"column",gap:0,children:[e.jsx(p,{...g,label:"SSID",value:r.ssid,onChange:l=>f({...r,ssid:l.target.value}),fullWidth:!0}),e.jsxs(x,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(G,{fullWidth:!0,margin:"dense",size:"small",children:e.jsx(ne,{value:r.security,onChange:l=>f({...r,security:l.target.value}),size:"small",children:Be.map(l=>e.jsx(oe,{value:l.value,children:l.label},l.value))})}),e.jsx(p,{...g,label:"비밀번호",type:"password",value:r.password,onChange:l=>f({...r,password:l.target.value}),fullWidth:!0,disabled:r.security==="nopass"})]}),e.jsx(A,{...U,control:e.jsx(Se,{size:"small",checked:r.hidden,onChange:l=>f({...r,hidden:l.target.checked})}),label:"SSID 숨김"}),e.jsx(L,{variant:"caption",color:h?"success.main":"error",children:h?"Wi-Fi QR 생성 가능":"SSID와 비밀번호를 확인하세요."})]})]}),De=({colorDark:t,onColorDarkChange:o,colorLight:n,onColorLightChange:a,ecLevel:s,onEcLevelChange:i,withIcon:r,onWithIconChange:f,roundIcon:u,onRoundIconChange:h,hasIcon:C,onIconFile:l,onClearIcon:b,iconScale:w,onIconScaleChange:I,iconMargin:W,onIconMarginChange:y,iconFit:M,onIconFitChange:R,eyeDropperAvailable:P,onEyeDropper:S})=>{const[k,E]=d.useState(!1),_="QR이 일부 훼손되어도 복원할 수 있는 정도입니다. 높을수록 복원력은 커지지만, 담을 수 있는 데이터 양은 줄어듭니다.",F=je(t,$.dark),B=je(n,$.light);return e.jsxs(H,{spacing:1.25,children:[e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"QR",value:t,onChange:c=>o(c.target.value),onBlur:()=>o(N(t,$.dark)),InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(ue,{fontSize:"small"})}),endAdornment:e.jsx(K,{position:"end",sx:{pl:1},children:e.jsxs(H,{direction:"row",spacing:.5,alignItems:"center",children:[P&&e.jsx(ee,{title:"스포이드로 화면에서 색상 선택",children:e.jsx(X,{size:"small",onClick:()=>S("dark"),"aria-label":"QR 색상 스포이드",children:e.jsx(ce,{fontSize:"small"})})}),e.jsx(x,{component:"input",type:"color",value:F,onChange:c=>o(N(c.target.value,$.dark)),"aria-label":"QR color picker",title:"QR 색상 선택",sx:fe})]})})},fullWidth:!0}),e.jsx(p,{...g,label:"Background",value:n,onChange:c=>a(c.target.value),onBlur:()=>a(N(n,$.light)),InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(ue,{fontSize:"small"})}),endAdornment:e.jsx(K,{position:"end",sx:{pl:1},children:e.jsxs(H,{direction:"row",spacing:.5,alignItems:"center",children:[P&&e.jsx(ee,{title:"스포이드로 화면에서 색상 선택",children:e.jsx(X,{size:"small",onClick:()=>S("light"),"aria-label":"Background 색상 스포이드",children:e.jsx(ce,{fontSize:"small"})})}),e.jsx(x,{component:"input",type:"color",value:B,onChange:c=>a(N(c.target.value,$.light)),"aria-label":"Background color picker",title:"Background 색상 선택",sx:fe})]})})},fullWidth:!0})]}),e.jsxs(G,{fullWidth:!0,children:[e.jsxs(H,{direction:"row",spacing:.5,alignItems:"center",sx:{mb:.5},children:[e.jsx(L,{variant:"body2",color:"text.secondary",children:"오류 복원력"}),e.jsx(X,{size:"small","aria-label":"오류 복원력 설명",onClick:()=>E(!0),children:e.jsx(ke,{fontSize:"small"})})]}),e.jsx(ne,{value:s,onChange:c=>i(c.target.value),size:"small",children:_e.map(c=>e.jsx(oe,{value:c.value,children:c.label},c.value))})]}),e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,children:[e.jsx(A,{...U,control:e.jsx(de,{size:"small",checked:r,onChange:c=>f(c.target.checked)}),label:"아이콘 사용"}),e.jsx(A,{...U,control:e.jsx(de,{size:"small",checked:u,onChange:c=>h(c.target.checked),disabled:!r}),label:"아이콘 둥글게",sx:{ml:0}})]}),e.jsxs(x,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(ee,{title:"아이콘 업로드",children:e.jsxs(X,{component:"label",size:"small",disabled:!r,children:[e.jsx(Ee,{}),e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:c=>l(c.target.files?.[0]??null)})]})}),e.jsxs(te,{component:"label",size:"small",variant:"outlined",disabled:!r,children:["아이콘 첨부",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:c=>l(c.target.files?.[0]??null)})]}),C&&e.jsx(te,{size:"small",onClick:b,disabled:!r,children:"아이콘 제거"})]}),e.jsxs(x,{children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"baseline",sx:{mb:.5},children:[e.jsx(L,{variant:"body2",children:"아이콘 크기"}),e.jsxs(L,{variant:"caption",color:"text.secondary",children:[Math.round(w*100),"%"]})]}),e.jsx(he,{value:w,onChange:(c,O)=>I(O),min:.05,max:.35,step:.01,disabled:!r})]}),e.jsxs(x,{children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"baseline",sx:{mb:.5},children:[e.jsx(L,{variant:"body2",children:"아이콘 여백"}),e.jsxs(L,{variant:"caption",color:"text.secondary",children:[W.toFixed(0),"px"]})]}),e.jsx(he,{value:W,onChange:(c,O)=>y(O),min:0,max:20,step:1,disabled:!r})]}),e.jsxs(G,{fullWidth:!0,children:[e.jsx(L,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"아이콘 맞춤 방식"}),e.jsx(ne,{value:M,onChange:c=>R(c.target.value),size:"small",disabled:!r,children:ze.map(c=>e.jsx(oe,{value:c.value,children:c.label},c.value))})]}),e.jsxs(Le,{open:k,onClose:()=>E(!1),fullWidth:!0,children:[e.jsx(We,{children:"오류 복원력"}),e.jsx(Me,{dividers:!0,children:e.jsx(L,{variant:"body2",color:"text.secondary",children:_})}),e.jsx(Pe,{children:e.jsx(te,{onClick:()=>E(!1),children:"닫기"})})]})]})};export{Ve as P,Te as Q,xe as a,Ze as b,De as c,Je as g,N as n,Ye as u};
