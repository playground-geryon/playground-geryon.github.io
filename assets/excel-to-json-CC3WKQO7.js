const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/prism-wcO-HLEn.js","assets/excel-CUMakpxJ.js","assets/prism-54DrP_uy.css"])))=>i.map(i=>d[i]);
import{r as l,j as t}from"./vendor-CRMzTT1s.js";import{_ as C}from"./tree-sitter-aGyQ8e2w.js";import{P as re,G as ne,B as j,S as O,a4 as ae,a5 as se,a6 as oe,a7 as G,a as q,a8 as le,o as H,a9 as ie,aa as ce,ab as de,ac as ue,ad as K,a1 as he,T,ae as pe,l as me,m as fe,n as ge}from"./mui-BTFQHN8y.js";import"./prism-wcO-HLEn.js";import"./excel-CUMakpxJ.js";const Y=r=>r<10?`0${r}`:String(r),we=(r,a)=>{if(!(r instanceof Date)||Number.isNaN(Number(r)))return"";const s=r.getFullYear(),p=String(s).slice(-2),N=r.getMonth()+1,S=Y(N),u=r.getDate(),_=Y(u);return a.replace(/yyyy/g,String(s)).replace(/yy/g,p).replace(/MM/g,S).replace(/M/g,String(N)).replace(/dd/g,_).replace(/d/g,String(u))},xe=r=>{if(!r)return null;if(r instanceof Date&&!Number.isNaN(Number(r)))return r;if(typeof r!="string")return null;let a=r.match(/^(\d{4})[.\-/](\d{1,2})[.\-/](\d{1,2})$/);if(a)return new Date(Number(a[1]),Number(a[2])-1,Number(a[3]));if(a=r.match(/^(\d{1,2})[./-](\d{1,2})[./-](\d{2}|\d{4})$/),a){let s=Number(a[3]);return s<100&&(s+=2e3),new Date(s,Number(a[1])-1,Number(a[2]))}return a=r.match(/^(\d{4})-(\d{2})-(\d{2})$/),a?new Date(Number(a[1]),Number(a[2])-1,Number(a[3])):null},Q=(r,a)=>Array.isArray(r)?!a||a<=0?r:r.length>a?r.slice(0,a):r:[],be=r=>r.trim().toLowerCase()==="date",ye=r=>{if(!r)return null;const a=r;if(typeof a?.highlightAll=="function")return a;const s=r;return typeof s.default?.highlightAll=="function"?s.default:null};function je(){const[r,a]=l.useState({sheetNames:[],selectedSheet:void 0,rowsPreview:[],totalRows:0}),[s,p]=l.useState({useDateFormat:!0,dateNF:"yyyy-MM-dd",headerRowIndex:0,rowLimit:10}),N=l.useCallback((n,e)=>{p(o=>({...o,[n]:e}))},[]),[S,u]=l.useState(!1),[_,m]=l.useState(null),[J,I]=l.useState({open:!1,label:"",progress:0}),g=l.useRef(null),L=l.useRef([]),v=l.useRef([]),k=l.useRef(null),[D,P]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const n=await C(()=>import("./prism-wcO-HLEn.js").then(o=>o.p),__vite__mapDeps([0,1,2])),e=ye(n);if(!e)return;try{await C(()=>import("./prism-wcO-HLEn.js").then(o=>o.b),__vite__mapDeps([0,1,2]))}catch{try{await C(()=>import("./prism-wcO-HLEn.js").then(o=>o.b),__vite__mapDeps([0,1,2]))}catch{}}k.current=e,P(!0)}catch{P(!1)}})()},[]);const E=l.useMemo(()=>JSON.stringify(r.rowsPreview??[],null,2),[r.rowsPreview]),F=l.useMemo(()=>s.rowLimit>0&&r.totalRows>s.rowLimit,[s.rowLimit,r.totalRows]),w=l.useCallback(()=>({raw:!0,cellDates:!0,defval:"",blankrows:!1,range:s.headerRowIndex>0?s.headerRowIndex:0}),[s.headerRowIndex]),x=l.useCallback(n=>{if(!Array.isArray(n)||n.length===0)return[];if(!s.useDateFormat)return n.slice();const e=s.dateNF?.trim()||"yyyy-MM-dd";return n.map(o=>{const c={};for(const i of Object.keys(o)){const d=o[i];if(be(i)){let h=null;if(d instanceof Date&&!Number.isNaN(Number(d)))h=d;else if(typeof d=="number"){const f=d-25569;h=new Date(f*86400*1e3)}else h=xe(d);c[i]=h?we(h,e):d}else c[i]=d}return c})},[s.useDateFormat,s.dateNF]),R=l.useCallback(async n=>{if(!g.current)return{rowsPreview:[],totalRows:0};const e=await C(()=>import("./excel-CUMakpxJ.js").then(h=>h.x),[]),o=g.current.Sheets[n];if(!o)throw new Error(`Worksheet not found: ${n}`);const c=e.utils.sheet_to_json(o,w());L.current=c;const i=x(c);return v.current=i,{rowsPreview:Q(i,s.rowLimit),totalRows:i.length}},[x,w,s.rowLimit]),V=l.useCallback(()=>{const n=L.current||[],e=x(n);v.current=e;const o=Q(e,s.rowLimit);a(c=>({...c,rowsPreview:o,totalRows:e.length}))},[x,s.rowLimit]),W=l.useCallback(n=>{if(!D||!k.current)return;const e=k.current;requestAnimationFrame(()=>{if(n&&typeof e.highlightElement=="function"&&n.tagName==="CODE"){e.highlightElement(n);return}if(n&&typeof e.highlightAllUnder=="function"){e.highlightAllUnder(n);return}typeof e.highlightAll=="function"&&e.highlightAll()})},[D]);l.useEffect(()=>{!g.current||!r.selectedSheet||V()},[s.useDateFormat,s.dateNF,s.rowLimit]),l.useEffect(()=>{(async()=>{if(!(!g.current||!r.selectedSheet)){u(!0);try{const{rowsPreview:n,totalRows:e}=await R(r.selectedSheet);a(o=>({...o,rowsPreview:n,totalRows:e}))}catch(n){m(n?.message??String(n))}finally{u(!1)}}})()},[s.headerRowIndex]);const $=l.useCallback(async n=>{if(n){m(null),u(!0);try{const e=await C(()=>import("./excel-CUMakpxJ.js").then(b=>b.x),[]);try{await C(()=>import("./excel-CUMakpxJ.js").then(b=>b.d),[])}catch{}const o=await n.arrayBuffer(),c=e.read(o,{type:"array"});g.current=c;const i=c.SheetNames||[],d=i[0];let h=[],f=0;if(d){const b=await R(d);h=b.rowsPreview,f=b.totalRows}a({sheetNames:i,selectedSheet:d,rowsPreview:h,totalRows:f})}catch(e){m(e?.message??String(e))}finally{u(!1)}}},[R]),z=l.useCallback(async n=>{if(!(!g.current||!n)){u(!0),m(null);try{const{rowsPreview:e,totalRows:o}=await R(n);a(c=>({...c,selectedSheet:n,rowsPreview:e,totalRows:o}))}catch(e){m(e?.message??String(e))}finally{u(!1)}}},[R]),M=l.useCallback(async(n,e,o,c="JSON 다운로드 중…")=>{Array.isArray(n)||(n=[]);const i=n.length,h=`${(y=>encodeURI(y.replace(/\s+/g,"_")))(e)}${o?`_${o}`:""}_${Date.now()}.json`;I({open:!0,label:c,progress:0});const f=[];f.push(`[
`);const b=Math.max(100,Math.floor(i/100));for(let y=0;y<i;y+=1){const te=JSON.stringify(n[y],null,2);f.push(te),y<i-1&&f.push(`,
`),y%b===0&&(I(U=>({...U,progress:Math.floor(y/Math.max(1,i)*100)})),await new Promise(U=>setTimeout(U,0)))}f.push(`
]`);const ee=new Blob(f,{type:"application/json;charset=utf-8"}),X=URL.createObjectURL(ee),A=document.createElement("a");A.href=X,A.download=h,document.body.appendChild(A),A.click(),A.remove(),URL.revokeObjectURL(X),I({open:!1,label:"",progress:100})},[]),B=l.useCallback(async(n="excel-json")=>{await M(v.current,n,r.selectedSheet,"JSON 전체 다운로드 중…")},[M,r.selectedSheet]);return{parsed:r,options:s,loading:S,error:_,prismReady:D,truncated:F,downloadState:J,setOptions:p,updateOption:N,handleLoadExcel:$,handleSelectSheet:z,handleDownloadAll:B,jsonPretty:E,highlightJson:W}}const Z=36,Se=({controller:r})=>{const{parsed:a,options:s,updateOption:p,loading:N,error:S,prismReady:u,truncated:_,downloadState:m,handleLoadExcel:J,handleSelectSheet:I,handleDownloadAll:g,jsonPretty:L,highlightJson:v}=r,k=l.useId(),D=l.useId(),P=`${D}-label`,E=l.useRef(null),F=l.useRef(null);l.useEffect(()=>{!u||!F.current||requestAnimationFrame(()=>{v(F.current)})},[v,u,L]);const w=N||m.open,x=a.sheetNames.length>0,R=a.totalRows>0,V=e=>{const o=e.target.files?.[0]??null;J(o),E.current&&(E.current.value="")},W=e=>{const o=e.target.value;o&&I(o)},$=e=>{const o=Number(e.target.value);if(Number.isNaN(o))return p("rowLimit",0);p("rowLimit",Math.max(0,Math.floor(o)))},z=e=>{const o=Number(e.target.value);if(Number.isNaN(o)||o<0)return p("headerRowIndex",0);p("headerRowIndex",Math.floor(o))},M=e=>{p("useDateFormat",e.target.checked)},B=e=>{p("dateNF",e.target.value)},n=()=>{g("excel-json")};return t.jsxs(re,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:785,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden"},children:[t.jsx(ne,{styles:{'pre[class*="language-"], code[class*="language-"]':{background:"transparent !important",backgroundColor:"transparent !important",textShadow:"none !important"},'code[class*="language-"] .token.punctuation, pre[class*="language-"] .token.punctuation':{background:"transparent !important"},'code[class*="language-"] .token.operator, pre[class*="language-"] .token.operator':{background:"transparent !important"}}}),t.jsxs(j,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1.5,bgcolor:"background.paper",overflow:"hidden"},children:[t.jsx(j,{sx:{p:1.25},children:t.jsxs(O,{direction:"row",spacing:1.25,sx:{"& .ctrl":{height:Z},"& .MuiInputBase-root.MuiOutlinedInput-root":{height:Z}},children:[t.jsxs(ae,{size:"small",sx:{minWidth:200,flexShrink:0},disabled:!x||w,children:[t.jsx(se,{id:P,children:"시트 선택"}),t.jsxs(oe,{labelId:P,id:D,value:a.selectedSheet??"",label:"시트 선택",onChange:W,children:[!x&&t.jsx(G,{value:"",disabled:!0,children:"업로드된 시트 없음"}),a.sheetNames.map(e=>t.jsx(G,{value:e,children:e},e))]})]}),t.jsxs(j,{children:[t.jsx("input",{ref:E,id:k,type:"file",accept:".xlsx,.xls,.csv",hidden:!0,onChange:V}),t.jsx("label",{htmlFor:k,children:t.jsx(q,{className:"ctrl",component:"span",variant:"contained",startIcon:t.jsx(le,{}),size:"small",disabled:w,sx:{minWidth:130},children:"엑셀 업로드"})})]}),t.jsx(j,{sx:{flexGrow:1}}),t.jsx(H,{className:"ctrl",label:"헤더 시작 행",size:"small",type:"number",value:s.headerRowIndex,onChange:z,inputProps:{min:0},sx:{width:180},disabled:!x}),t.jsxs(O,{direction:"row",spacing:1,alignItems:"center",flexWrap:"nowrap",children:[t.jsx(H,{className:"ctrl",label:"미리보기 행 제한",size:"small",type:"number",value:s.rowLimit,onChange:$,inputProps:{min:0},sx:{width:200}}),t.jsx(ie,{title:t.jsxs("span",{children:["0으로 지정하면 모든 행을 표시합니다.",t.jsx("br",{}),"대용량인 경우 1000~5000 사이를 권장합니다."]}),arrow:!0,children:t.jsx(ce,{fontSize:"small",sx:{color:"text.secondary"}})})]}),t.jsx(de,{control:t.jsx(ue,{checked:s.useDateFormat,onChange:M}),label:"날짜 포맷"}),s.useDateFormat&&t.jsx(H,{className:"ctrl",label:"일자 형식",size:"small",value:s.dateNF,onChange:B,disabled:!s.useDateFormat,placeholder:"예: yyyy-MM-dd",sx:{minWidth:220}})]})}),(w||S)&&t.jsxs(j,{sx:{p:1.25},children:[w&&t.jsx(K,{sx:{mt:2}}),S&&t.jsx(he,{severity:"error",variant:"outlined",sx:{mt:2},children:S})]})]}),t.jsxs(j,{sx:{p:1.25,border:"1px solid",borderColor:"divider",borderRadius:1.5,bgcolor:"background.paper",display:"flex",flexDirection:"column",gap:1,flex:1,minHeight:0},children:[t.jsxs(O,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",sx:{mb:.5},children:[t.jsxs(O,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",children:[t.jsxs(T,{variant:"subtitle2",children:["JSON 미리보기",a.selectedSheet?` (${a.selectedSheet})`:""]}),t.jsxs(T,{variant:"body2",color:"text.secondary",children:[a.rowsPreview.length," / ",a.totalRows," 행"]}),_&&t.jsxs(T,{variant:"caption",color:"text.secondary",children:["(미리보기는 ",s.rowLimit,"행까지만 표시)"]})]}),t.jsx(q,{className:"ctrl",onClick:n,variant:"outlined",color:"primary",size:"small",startIcon:t.jsx(pe,{}),disabled:w||!R,sx:{minWidth:180},children:"JSON 다운로드"})]}),t.jsx(j,{sx:{flex:1,minHeight:100,border:"1px solid",borderColor:"divider",borderRadius:1,overflow:"hidden",bgcolor:"background.default",height:"calc(100dvh - 550px)"},children:t.jsx("pre",{style:{margin:0,height:"100%",overflow:"auto",padding:16,fontFamily:'ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace',fontSize:13.5,lineHeight:1.55,whiteSpace:"pre-wrap",wordBreak:"break-word",background:"transparent",backgroundColor:"transparent"},children:t.jsx("code",{ref:F,className:"language-json",style:{whiteSpace:"inherit",background:"transparent",backgroundColor:"transparent"},children:L})})})]}),t.jsxs(me,{open:m.open,fullWidth:!0,maxWidth:"xs",children:[t.jsx(fe,{children:m.label||"다운로드 중…"}),t.jsx(ge,{children:t.jsxs(j,{sx:{py:2},children:[t.jsx(K,{variant:"determinate",value:m.progress}),t.jsxs(T,{variant:"caption",sx:{display:"block",mt:1,textAlign:"right"},children:[m.progress,"%"]})]})})]})]})},Ce=()=>{const r=je();return t.jsx(Se,{controller:r})};export{Ce as default};
