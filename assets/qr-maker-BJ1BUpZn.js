import{j as e,r as t}from"./vendor-DyxFRNuv.js";import{am as u,B as l,S as Xe,o as Ve,a as p,ae as O,T as C,P as Ge,an as I,a9 as X,ao as _e,ap as $e,h as qe,l as Ye,m as Ne,n as Ue,p as Je}from"./mui-B8yGrLIc.js";import{Q as V,a as Ke,P as M,u as Ze,g as en,n as nn,b as tn,c as rn}from"./qr-maker-options-panel-DaNdzqnV.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-DJeWk4Ia.js";const an=({exportSize:a,onExportSizeChange:c,exportSizeSafe:o,onDownload:i})=>e.jsx(u,{sx:{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center",justifyContent:"space-between",overflowX:"hidden",minWidth:0},children:e.jsxs(l,{sx:{display:"flex",flexDirection:"column",gap:.75,minWidth:0,flex:"1 1 240px"},children:[e.jsxs(Xe,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",children:[e.jsx(Ve,{label:`내보내기 (최대 ${V.toLocaleString()}px)`,type:"number",value:a,onChange:d=>c(Number(d.target.value||Ke)),sx:{width:170,flexShrink:0},inputProps:{min:64,max:V,step:1.25},size:"small"}),e.jsx(p,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(O,{}),onClick:()=>i("png"),children:"PNG"}),e.jsx(p,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(O,{}),onClick:()=>i("svg"),children:"SVG"})]}),e.jsxs(C,{variant:"caption",color:"text.secondary",children:["결과 크기: ",o.toLocaleString(),"px"]})]})}),on=({previewCardRef:a,squareBoxRef:c,canvasRef:o,cssSide:i,minHeight:d=320})=>e.jsx(l,{ref:a,sx:{flex:1,minHeight:0,width:"100%",height:"100%",p:`${M}px`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(l,{ref:c,sx:{width:`${i}px`,height:`${i}px`,maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center",minHeight:d},children:e.jsx("canvas",{ref:o,style:{width:"100%",height:"100%",imageRendering:"crisp-edges",display:"block",borderRadius:8,background:"#fff",boxShadow:"0 8px 24px rgba(0,0,0,0.06)"}})})}),hn=()=>{const a=t.useRef(null),c=t.useRef(null),o=t.useRef(null),i=t.useRef(null),d=t.useRef(null),[G,k]=t.useState(!1),{mode:_,setMode:$,textDraft:q,setTextDraft:Y,vcardDraft:N,setVcardDraft:U,wifiDraft:J,setWifiDraft:K,isVCardValid:Z,isWifiValid:ee,colorDark:ne,setColorDark:v,colorLight:te,setColorLight:w,ecLevel:re,setEcLevel:ae,withIcon:S,iconImg:oe,iconScale:j,setIconScale:ie,containerRadius:se,setContainerRadius:le,containerBgColor:ce,setContainerBgColor:de,containerBorderEnabled:xe,setContainerBorderEnabled:he,containerBorderColor:pe,setContainerBorderColor:ge,containerBorderWidth:fe,setContainerBorderWidth:me,imageRadius:ue,setImageRadius:y,imageFit:Ce,setImageFit:ve,imageScale:we,setImageScale:je,imageOffsetX:ye,setImageOffsetX:Re,imageOffsetY:be,setImageOffsetY:De,errorMsg:R,setErrorMsg:g,exportSize:Ee,setExportSize:Ie,exportSizeSafe:Me,generateQR:B,resetAll:ke,handleIconFile:Se,clearIcon:Be,downloadResult:Pe,drawToCanvas:P}=Ze(),[F,Fe]=t.useState(()=>Math.max(1,window.devicePixelRatio||1)),[h,We]=t.useState(320),b=t.useMemo(()=>{if(!S)return 0;const n=Math.max(16,Math.floor(h*j));return Math.max(0,Math.floor(n))},[S,h,j]);t.useEffect(()=>{let n=0,r=-1;const s=()=>{const x=a.current;if(!x)return;const T=x.getBoundingClientRect(),m=getComputedStyle(x),He=(parseFloat(m.paddingLeft)||0)+(parseFloat(m.paddingRight)||0),Le=(parseFloat(m.paddingTop)||0)+(parseFloat(m.paddingBottom)||0),Te=Math.max(0,T.width-He-M*2),Oe=Math.max(0,T.height-Le-M*2),E=Math.floor(Math.max(120,Math.min(Te,Oe)));Math.abs(E-r)>.5&&(r=E,We(E))},f=new ResizeObserver(()=>{cancelAnimationFrame(n),n=requestAnimationFrame(s)});[a.current,c.current,i.current,d.current,a.current?.parentElement??null].forEach(x=>x&&f.observe(x));const A=()=>Fe(Math.max(1,window.devicePixelRatio||1)),H=window.matchMedia(`(resolution: ${window.devicePixelRatio||1}dppx)`);H.addEventListener?.("change",A);const L=()=>{cancelAnimationFrame(n),n=requestAnimationFrame(s)};return s(),window.addEventListener("resize",L),()=>{f.disconnect(),H.removeEventListener?.("change",A),window.removeEventListener("resize",L),cancelAnimationFrame(n)}},[]);const W=t.useMemo(()=>Math.round(h*F),[h,F]);t.useEffect(()=>{y(n=>Math.min(n,b))},[b,y]),t.useEffect(()=>{(async()=>{const r=o.current;if(r)try{await P(r,W),g("")}catch(s){g(s instanceof Error?s.message:"QR을 생성할 수 없습니다.")}})()},[P,W,g]);const ze=typeof window<"u"&&!!window.EyeDropper,Qe=n=>{Pe(n,o.current)},Ae=t.useCallback(async n=>{if(!(typeof window>"u"||!window.EyeDropper))try{const s=await new window.EyeDropper().open(),f=en(n),D=nn(s?.sRGBHex??"",f);n==="dark"?v(D):w(D)}catch(r){if(r instanceof DOMException&&r.name==="AbortError")return}},[v,w]),z=t.useCallback(()=>{const n=o.current;if(!n)return;n.getContext("2d")?.clearRect(0,0,n.width,n.height)},[]);t.useEffect(()=>{R&&(z(),k(!0))},[R,z]);const Q=()=>{k(!1),g("")};return e.jsxs(e.Fragment,{children:[e.jsx(Ge,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:785,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden"},children:e.jsxs(l,{sx:{flex:1,minHeight:0,display:"grid",gridTemplateColumns:"380px 1fr 380px",gap:1.25,alignItems:"stretch"},children:[e.jsxs(I,{ref:i,variant:"outlined",sx:{minHeight:770,flexDirection:"column",overflow:"hidden",height:"calc(100vh - 190px)"},children:[e.jsx(l,{sx:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid",borderColor:"divider",bgcolor:"background.paper",px:1.25,py:1.25},children:e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,children:[e.jsx(C,{variant:"body2",sx:{fontWeight:600,color:"text.secondary"},children:"입력"}),e.jsxs(l,{display:"flex",gap:1,children:[e.jsx(X,{title:"현재 입력 값으로 QR 생성",children:e.jsx(p,{variant:"contained",size:"small",startIcon:e.jsx(_e,{}),onClick:B,children:"QR 생성"})}),e.jsx(X,{title:"모든 입력/옵션 초기화 및 QR 제거",children:e.jsx(p,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx($e,{}),onClick:ke,children:"초기화"})})]})]})}),e.jsx(u,{sx:{flex:1,minHeight:0,overflow:"auto",pt:1.25,pb:2,pr:2},children:e.jsx(tn,{mode:_,onModeChange:$,textDraft:q,onTextChange:Y,vcardDraft:N,onVcardChange:U,wifiDraft:J,onWifiChange:K,isVCardValid:Z,isWifiValid:ee,onQuickGenerate:B})})]}),e.jsx(I,{variant:"outlined",sx:{minWidth:0,minHeight:0,display:"flex",maxHeight:"100%",height:"auto"},children:e.jsx(u,{sx:{flex:1,minHeight:0,p:0,display:"flex"},children:e.jsx(on,{previewCardRef:a,squareBoxRef:c,canvasRef:o,cssSide:h})})}),e.jsxs(I,{ref:d,variant:"outlined",sx:{height:"calc(100vh - 190px)",minHeight:770,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(u,{sx:{flex:1,minHeight:0,overflow:"auto",pt:1.25,pb:2,px:1.25,display:"flex",flexDirection:"column",gap:1.25},children:[e.jsx(C,{variant:"body2",fontWeight:600,color:"text.secondary",children:"옵션"}),e.jsx(rn,{colorDark:ne,onColorDarkChange:v,colorLight:te,onColorLightChange:w,ecLevel:re,onEcLevelChange:ae,hasIcon:!!oe,onIconFile:Se,onClearIcon:Be,iconScale:j,onIconScaleChange:ie,containerRadius:se,onContainerRadiusChange:le,containerBgColor:ce,onContainerBgColorChange:de,containerBorderEnabled:xe,onContainerBorderEnabledChange:he,containerBorderColor:pe,onContainerBorderColorChange:ge,containerBorderWidth:fe,onContainerBorderWidthChange:me,imageRadius:ue,onImageRadiusChange:y,iconRadiusMax:b,imageFit:Ce,onImageFitChange:ve,imageScale:we,onImageScaleChange:je,imageOffsetX:ye,onImageOffsetXChange:Re,imageOffsetY:be,onImageOffsetYChange:De,eyeDropperAvailable:ze,onEyeDropper:Ae})]}),e.jsx(qe,{}),e.jsx(l,{sx:{position:"sticky",bottom:0,bgcolor:"background.paper",borderTop:"1px solid",borderColor:"divider"},children:e.jsx(an,{exportSize:Ee,onExportSizeChange:Ie,exportSizeSafe:Me,onDownload:Qe})})]})]})}),e.jsxs(Ye,{open:G,onClose:Q,fullWidth:!0,children:[e.jsx(Ne,{children:"오류"}),e.jsx(Ue,{dividers:!0,children:e.jsx(C,{variant:"body2",color:"text.secondary",children:R||"오류가 발생했습니다."})}),e.jsx(Je,{children:e.jsx(p,{onClick:Q,children:"닫기"})})]})]})};export{hn as default};
