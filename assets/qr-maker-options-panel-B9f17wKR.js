import{r as d,j as e}from"./vendor-CRMzTT1s.js";import{B as x,a1 as X,ar as Se,a9 as A,as as Z,n as p,T as M,a3 as te,a4 as le,af as Ie,S as _,J as B,a7 as z,I as H,at as ie,au as ce,a8 as Ee,aa as ue,av as ke,a as de,aw as he}from"./mui-CTdB6wcY.js";const me={firstName:"",lastName:"",org:"",title:"",mobile:"",phone:"",email:"",url:"",street:"",city:"",region:"",postal:"",country:"",note:""},pe={ssid:"",security:"WPA",password:"",hidden:!1},ge="https://ofsimple.com",Le=8192,xe=1024,v=t=>t.replace(/([\\;,:"])/g,"\\$1"),We=(t,o="3.0")=>{const n=r=>r?.trim()??"",a=["BEGIN:VCARD",`VERSION:${o}`],s=`${n(t.lastName)};${n(t.firstName)};;;`;s!==";;;;"&&a.push(`N:${s}`);const i=[n(t.firstName),n(t.lastName)].filter(Boolean).join(" ");if(i&&a.push(`FN:${i}`),t.org&&a.push(`ORG:${v(n(t.org))}`),t.title&&a.push(`TITLE:${v(n(t.title))}`),t.mobile&&a.push(`TEL;TYPE=CELL:${v(n(t.mobile))}`),t.phone&&a.push(`TEL;TYPE=WORK:${v(n(t.phone))}`),t.email&&a.push(`EMAIL:${v(n(t.email))}`),t.url&&a.push(`URL:${v(n(t.url))}`),t.street||t.city||t.region||t.postal||t.country){const r=`;;${v(n(t.street))};${v(n(t.city))};${v(n(t.region))};${v(n(t.postal))};${v(n(t.country))}`;a.push(`ADR;TYPE=WORK:${r}`)}return t.note&&a.push(`NOTE:${v(n(t.note))}`),a.push("END:VCARD"),a.join(`
`)},Me=t=>{const o=[`WIFI:T:${t.security||"nopass"}`,`S:${v(t.ssid||"")}`];return t.security!=="nopass"&&o.push(`P:${v(t.password||"")}`),t.hidden&&o.push("H:true"),`${o.join(";")};`};let D=null;const Pe=async()=>{if(typeof window>"u")throw new Error("QR 코드는 브라우저 환경에서만 생성할 수 있습니다.");return window.QRCode?.toCanvas?window.QRCode:(D||(D=new Promise((t,o)=>{const n=document.createElement("script");n.src="/libs/qrcode.min.js",n.async=!0,n.onload=()=>{window.QRCode?.toCanvas?t(window.QRCode):o(new Error("QR 스크립트를 불러올 수 없습니다."))},n.onerror=()=>o(new Error("QR 스크립트를 불러올 수 없습니다.")),document.head.appendChild(n)})),D)},Te=t=>new Promise((o,n)=>{const a=URL.createObjectURL(t),s=new Image;s.onload=()=>{URL.revokeObjectURL(a),o(s)},s.onerror=i=>{URL.revokeObjectURL(a),n(i)},s.src=a}),$e=(t,o,n="qrcode.png")=>{const a=document.createElement("canvas");a.width=o,a.height=o;const s=a.getContext("2d");s.imageSmoothingEnabled=!1,s.drawImage(t,0,0,t.width,t.height,0,0,o,o),a.toBlob(i=>{if(!i)return;const r=URL.createObjectURL(i),j=document.createElement("a");j.href=r,j.download=n,j.click(),URL.revokeObjectURL(r)},"image/png")},Qe=(t,o,n="qrcode.svg")=>{const a=document.createElement("canvas");a.width=o,a.height=o;const s=a.getContext("2d");s.imageSmoothingEnabled=!1,s.drawImage(t,0,0,t.width,t.height,0,0,o,o);const i=a.toDataURL("image/png"),r=`<svg xmlns="http://www.w3.org/2000/svg" width="${o}" height="${o}" viewBox="0 0 ${o} ${o}">
  <image href="${i}" x="0" y="0" width="${o}" height="${o}" />
</svg>`,j=new Blob([r],{type:"image/svg+xml"}),c=URL.createObjectURL(j),h=document.createElement("a");h.href=c,h.download=n,h.click(),URL.revokeObjectURL(c)},ee=(t,o,n,a,s,i)=>{const r=Math.min(i,a/2,s/2);t.beginPath(),t.moveTo(o+r,n),t.arcTo(o+a,n,o+a,n+s,r),t.arcTo(o+a,n+s,o,n+s,r),t.arcTo(o,n+s,o,n,r),t.arcTo(o,n,o+a,n,r),t.closePath()},Oe=(t,o)=>{const{size:n,iconImage:a,iconScale:s,iconMargin:i,roundIcon:r,iconFit:j}=o;if(!a)return;const c=Math.max(16,Math.floor(n*s)),h=Math.floor((n-c)/2),C=Math.floor((n-c)/2),l=Math.max(0,Math.min(c/2,i));t.save(),r&&l>0&&(ee(t,h,C,c,c,l),t.clip());const f=a.naturalWidth||a.width,y=a.naturalHeight||a.height;let S=h,k=C,R=c,L=c;if(j==="contain"){const w=Math.min(c/f,c/y);R=Math.round(f*w),L=Math.round(y*w),S=h+Math.floor((c-R)/2),k=C+Math.floor((c-L)/2)}else if(j==="cover"){const w=Math.max(c/f,c/y),W=Math.round(c/w),I=Math.round(c/w),E=Math.floor((f-W)/2),P=Math.floor((y-I)/2);t.drawImage(a,E,P,W,I,h,C,c,c),t.restore(),r&&l>0&&(t.save(),t.lineWidth=2,t.strokeStyle="rgba(0,0,0,0.08)",ee(t,h,C,c,c,l),t.stroke(),t.restore());return}t.drawImage(a,S,k,R,L),t.restore(),r&&l>0&&(t.save(),t.lineWidth=2,t.strokeStyle="rgba(0,0,0,0.08)",ee(t,h,C,c,c,l),t.stroke(),t.restore())},Xe=()=>{const[t,o]=d.useState("text"),[n,a]=d.useState(ge),[s,i]=d.useState(me),[r,j]=d.useState(pe),c=d.useMemo(()=>{const m=!!(s.firstName?.trim()||s.lastName?.trim()||s.org?.trim()),b=!!(s.mobile?.trim()||s.phone?.trim()||s.email?.trim());return m&&b},[s]),h=d.useMemo(()=>r.ssid?.trim()?r.security==="nopass"?!0:!!r.password?.trim():!1,[r]),[C,l]=d.useState(""),[f,y]=d.useState("#000000"),[S,k]=d.useState("#ffffff"),[R,L]=d.useState("Q"),[w,W]=d.useState(!0),[I,E]=d.useState(null),[P,u]=d.useState(.2),[T,se]=d.useState(6),[K,ne]=d.useState(!0),[G,oe]=d.useState("stretch"),[O,N]=d.useState(ge),[q,ae]=d.useState(xe),Y=d.useMemo(()=>Math.min(Le,Math.max(64,Math.round(q))),[q]),fe=d.useCallback(async m=>{if(!m){E(null);return}try{const b=await Te(m);E(b)}catch{E(null)}},[]),ve=d.useCallback(()=>E(null),[]),re=d.useCallback(m=>({text:O,size:m,colorDark:f,colorLight:S,ecLevel:R,iconImage:w?I:null,iconScale:P,iconMargin:T,roundIcon:K,iconFit:G}),[O,f,S,R,w,I,P,T,K,G]),Ce=d.useCallback(async(m,b)=>{if(!m)return;if(!O.trim()){m.getContext("2d")?.clearRect(0,0,m.width,m.height);return}const J=await Pe(),$=document.createElement("canvas");$.width=b,$.height=b,await J.toCanvas($,O||" ",{errorCorrectionLevel:R,width:b,color:{dark:f,light:S},margin:0,scale:1});const V=m.getContext("2d");m.width=b,m.height=b,V.clearRect(0,0,b,b),V.drawImage($,0,0),Oe(V,re(b)),l("")},[O,R,f,S,re]),Re=d.useCallback(()=>{if(t==="text"){const m=n.trim();return m?(N(m),l(""),!0):(l("텍스트/URL을 입력하세요."),!1)}if(t==="vcard"){if(!c)return l("연락처 QR: 이름/회사 1개 이상 + 전화·휴대전화·이메일 중 1개 이상 필요합니다."),!1;try{return N(We(s,"3.0")),l(""),!0}catch{return l("vCard를 생성할 수 없습니다."),!1}}return h?(N(Me(r)),l(""),!0):(l("Wi-Fi QR: SSID는 필수이며 WPA/WEP는 비밀번호가 필요합니다."),!1)},[t,n,s,r,c,h]),we=d.useCallback(()=>{o("text"),a(""),i(me),j(pe),y("#000000"),k("#ffffff"),L("Q"),W(!0),E(null),u(.2),se(6),ne(!0),oe("stretch"),ae(xe),N(""),l("")},[]),ye=d.useCallback(async(m,b,J)=>{if(!b)return;const $=J??Y;m==="png"?$e(b,$):Qe(b,$)},[Y]);return{mode:t,setMode:o,textDraft:n,setTextDraft:a,vcardDraft:s,setVcardDraft:i,wifiDraft:r,setWifiDraft:j,isVCardValid:c,isWifiValid:h,colorDark:f,setColorDark:y,colorLight:S,setColorLight:k,ecLevel:R,setEcLevel:L,withIcon:w,setWithIcon:W,iconImg:I,iconScale:P,setIconScale:u,iconMargin:T,setIconMargin:se,roundIcon:K,setRoundIcon:ne,iconFit:G,setIconFit:oe,payload:O,errorMsg:C,setErrorMsg:l,exportSize:q,setExportSize:ae,exportSizeSafe:Y,generateQR:Re,resetAll:we,handleIconFile:fe,clearIcon:ve,downloadResult:ye,drawToCanvas:Ce}},Ae=[{label:"L (7%)",value:"L"},{label:"M (15%)",value:"M"},{label:"Q (25%)",value:"Q"},{label:"H (30%)",value:"H"}],Ue=[{label:"WPA/WPA2/3",value:"WPA"},{label:"WEP",value:"WEP"},{label:"Open (nopass)",value:"nopass"}],Fe=[{label:"채우기",value:"cover"},{label:"맞추기",value:"contain"},{label:"늘리기",value:"stretch"}],Ke=20,Q={dark:"#000000",light:"#ffffff"},Ne=/^#([0-9a-fA-F]{6})$/,_e=/^#([0-9a-fA-F]{3})$/,je={width:28,height:28,border:0,p:0,bgcolor:"transparent",cursor:"pointer","&::-webkit-color-swatch-wrapper":{p:0},"&::-webkit-color-swatch":{borderRadius:"50%",border:"1px solid rgba(0,0,0,0.2)"},"&::-moz-color-swatch":{borderRadius:"50%",border:"1px solid rgba(0,0,0,0.2)"}},g={size:"small",margin:"dense"},U={componentsProps:{typography:{variant:"body2"}}},F=(t,o)=>{const n=t.trim();return Ne.test(n)?n.toLowerCase():_e.test(n)?`#${n.slice(1).split("").map(s=>`${s}${s}`).join("").toLowerCase()}`:o},be=(t,o)=>F(t,o),Ge=t=>Q[t],qe=({mode:t,onModeChange:o,textDraft:n,onTextChange:a,vcardDraft:s,onVcardChange:i,wifiDraft:r,onWifiChange:j,isVCardValid:c,isWifiValid:h,onQuickGenerate:C})=>e.jsxs(x,{children:[e.jsx(X,{sx:{mt:0},children:e.jsxs(Se,{row:!0,value:t,onChange:(l,f)=>o(f??"text"),children:[e.jsx(A,{value:"text",control:e.jsx(Z,{size:"small"}),label:"텍스트 / URL",...U}),e.jsx(A,{value:"vcard",control:e.jsx(Z,{size:"small"}),label:"연락처 (vCard)",...U}),e.jsx(A,{value:"wifi",control:e.jsx(Z,{size:"small"}),label:"Wi-Fi",...U})]})}),t==="text"&&e.jsx(x,{mt:1,display:"flex",flexDirection:"column",gap:1,color:"red",children:e.jsx(p,{...g,label:"텍스트 / URL",value:n,onChange:l=>a(l.target.value),fullWidth:!0,multiline:!0,minRows:3,maxRows:22,helperText:"⌘/Ctrl + Enter 로 빠르게 생성",onKeyDown:l=>{(l.metaKey||l.ctrlKey)&&l.key==="Enter"&&(l.preventDefault(),C?.())}})}),t==="vcard"&&e.jsxs(x,{mt:1,display:"flex",flexDirection:"column",gap:0,children:[e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"성",value:s.lastName,onChange:l=>i({...s,lastName:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"이름",value:s.firstName,onChange:l=>i({...s,firstName:l.target.value}),fullWidth:!0})]}),e.jsx(p,{...g,label:"회사/조직",value:s.org,onChange:l=>i({...s,org:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"직함",value:s.title,onChange:l=>i({...s,title:l.target.value}),fullWidth:!0}),e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"휴대전화",value:s.mobile,onChange:l=>i({...s,mobile:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"전화",value:s.phone,onChange:l=>i({...s,phone:l.target.value}),fullWidth:!0})]}),e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"이메일",value:s.email,onChange:l=>i({...s,email:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"웹사이트",value:s.url,onChange:l=>i({...s,url:l.target.value}),fullWidth:!0})]}),e.jsx(p,{...g,label:"주소",value:s.street,onChange:l=>i({...s,street:l.target.value}),fullWidth:!0}),e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"도시",value:s.city,onChange:l=>i({...s,city:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"지역/주",value:s.region,onChange:l=>i({...s,region:l.target.value}),fullWidth:!0})]}),e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"우편번호",value:s.postal,onChange:l=>i({...s,postal:l.target.value}),fullWidth:!0}),e.jsx(p,{...g,label:"국가",value:s.country,onChange:l=>i({...s,country:l.target.value}),fullWidth:!0})]}),e.jsx(p,{...g,label:"메모",value:s.note,onChange:l=>i({...s,note:l.target.value}),fullWidth:!0,multiline:!0,minRows:2}),!c&&e.jsx(M,{variant:"caption",color:"error",children:"이름/회사 1개 이상과 전화·휴대전화·이메일 중 1개 이상을 입력하세요."})]}),t==="wifi"&&e.jsxs(x,{mt:1,display:"flex",flexDirection:"column",gap:0,children:[e.jsx(p,{...g,label:"SSID",value:r.ssid,onChange:l=>j({...r,ssid:l.target.value}),fullWidth:!0}),e.jsxs(x,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(X,{fullWidth:!0,margin:"dense",size:"small",children:e.jsx(te,{value:r.security,onChange:l=>j({...r,security:l.target.value}),size:"small",children:Ue.map(l=>e.jsx(le,{value:l.value,children:l.label},l.value))})}),e.jsx(p,{...g,label:"비밀번호",type:"password",value:r.password,onChange:l=>j({...r,password:l.target.value}),fullWidth:!0,disabled:r.security==="nopass"})]}),e.jsx(A,{...U,control:e.jsx(Ie,{size:"small",checked:r.hidden,onChange:l=>j({...r,hidden:l.target.checked})}),label:"SSID 숨김"}),e.jsx(M,{variant:"caption",color:h?"success.main":"error",children:h?"Wi-Fi QR 생성 가능":"SSID와 비밀번호를 확인하세요."})]})]}),Ye=({colorDark:t,onColorDarkChange:o,colorLight:n,onColorLightChange:a,ecLevel:s,onEcLevelChange:i,withIcon:r,onWithIconChange:j,roundIcon:c,onRoundIconChange:h,hasIcon:C,onIconFile:l,onClearIcon:f,iconScale:y,onIconScaleChange:S,iconMargin:k,onIconMarginChange:R,iconFit:L,onIconFitChange:w,eyeDropperAvailable:W,onEyeDropper:I})=>{const E=be(t,Q.dark),P=be(n,Q.light);return e.jsxs(_,{spacing:1.25,children:[e.jsxs(x,{display:"flex",gap:1,children:[e.jsx(p,{...g,label:"QR",value:t,onChange:u=>o(u.target.value),onBlur:()=>o(F(t,Q.dark)),InputProps:{startAdornment:e.jsx(B,{position:"start",children:e.jsx(ce,{fontSize:"small"})}),endAdornment:e.jsx(B,{position:"end",sx:{pl:1},children:e.jsxs(_,{direction:"row",spacing:.5,alignItems:"center",children:[W&&e.jsx(z,{title:"스포이드로 화면에서 색상 선택",children:e.jsx(H,{size:"small",onClick:()=>I("dark"),"aria-label":"QR 색상 스포이드",children:e.jsx(ie,{fontSize:"small"})})}),e.jsx(x,{component:"input",type:"color",value:E,onChange:u=>o(F(u.target.value,Q.dark)),"aria-label":"QR color picker",title:"QR 색상 선택",sx:je})]})})},fullWidth:!0}),e.jsx(p,{...g,label:"Background",value:n,onChange:u=>a(u.target.value),onBlur:()=>a(F(n,Q.light)),InputProps:{startAdornment:e.jsx(B,{position:"start",children:e.jsx(ce,{fontSize:"small"})}),endAdornment:e.jsx(B,{position:"end",sx:{pl:1},children:e.jsxs(_,{direction:"row",spacing:.5,alignItems:"center",children:[W&&e.jsx(z,{title:"스포이드로 화면에서 색상 선택",children:e.jsx(H,{size:"small",onClick:()=>I("light"),"aria-label":"Background 색상 스포이드",children:e.jsx(ie,{fontSize:"small"})})}),e.jsx(x,{component:"input",type:"color",value:P,onChange:u=>a(F(u.target.value,Q.light)),"aria-label":"Background color picker",title:"Background 색상 선택",sx:je})]})})},fullWidth:!0})]}),e.jsxs(X,{fullWidth:!0,children:[e.jsxs(_,{direction:"row",spacing:.5,alignItems:"center",sx:{mb:.5},children:[e.jsx(M,{variant:"body2",color:"text.secondary",children:"오류 복원력"}),e.jsx(z,{title:"QR이 일부 훼손되어도 복원할 수 있는 정도입니다. 높을수록 복원력은 커지지만, 담을 수 있는 데이터 양은 줄어듭니다.",children:e.jsx(H,{size:"small","aria-label":"오류 복원력 설명",children:e.jsx(Ee,{fontSize:"small"})})})]}),e.jsx(te,{value:s,onChange:u=>i(u.target.value),size:"small",children:Ae.map(u=>e.jsx(le,{value:u.value,children:u.label},u.value))})]}),e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,children:[e.jsx(A,{...U,control:e.jsx(ue,{size:"small",checked:r,onChange:u=>j(u.target.checked)}),label:"아이콘 사용"}),e.jsx(A,{...U,control:e.jsx(ue,{size:"small",checked:c,onChange:u=>h(u.target.checked),disabled:!r}),label:"아이콘 둥글게",sx:{ml:0}})]}),e.jsxs(x,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(z,{title:"아이콘 업로드",children:e.jsxs(H,{component:"label",size:"small",disabled:!r,children:[e.jsx(ke,{}),e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:u=>l(u.target.files?.[0]??null)})]})}),e.jsxs(de,{component:"label",size:"small",variant:"outlined",disabled:!r,children:["아이콘 첨부",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:u=>l(u.target.files?.[0]??null)})]}),C&&e.jsx(de,{size:"small",onClick:f,disabled:!r,children:"아이콘 제거"})]}),e.jsxs(x,{children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"baseline",sx:{mb:.5},children:[e.jsx(M,{variant:"body2",children:"아이콘 크기"}),e.jsxs(M,{variant:"caption",color:"text.secondary",children:[Math.round(y*100),"%"]})]}),e.jsx(he,{value:y,onChange:(u,T)=>S(T),min:.05,max:.35,step:.01,disabled:!r})]}),e.jsxs(x,{children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"baseline",sx:{mb:.5},children:[e.jsx(M,{variant:"body2",children:"아이콘 여백"}),e.jsxs(M,{variant:"caption",color:"text.secondary",children:[k.toFixed(0),"px"]})]}),e.jsx(he,{value:k,onChange:(u,T)=>R(T),min:0,max:20,step:1,disabled:!r})]}),e.jsxs(X,{fullWidth:!0,children:[e.jsx(M,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"아이콘 맞춤 방식"}),e.jsx(te,{value:L,onChange:u=>w(u.target.value),size:"small",disabled:!r,children:Fe.map(u=>e.jsx(le,{value:u.value,children:u.label},u.value))})]})]})};export{Ke as P,Le as Q,xe as a,qe as b,Ye as c,Ge as g,F as n,Xe as u};
