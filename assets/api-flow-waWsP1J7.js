import{r as d,j as e,q as Un,t as Wn,F as Jn,J as Kn}from"./vendor-DyxFRNuv.js";import{u as Kt,l as Dt,m as $t,n as Gt,S as x,y as St,z as pe,T as j,I as Q,aa as gn,a as oe,aD as qe,B as E,az as Tt,o as K,ac as Ce,aC as Pe,aE as mn,p as Ft,P as fe,aF as Qn,aG as Xn,Y as fn,a9 as be,aH as _t,aI as Yn,aJ as Ut,aK as De,a7 as F,aL as sn,aM as rn,q as Zn,aN as es,aO as ts,aP as ns,h as Lt,aQ as ss,aR as rs,aS as as,af as an,aT as os,K as Be,ab as on,aU as is}from"./mui-B8yGrLIc.js";import{M as Ze}from"./monaco-editor-M5VMZYyH.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-DJeWk4Ia.js";const ls=({open:t,tab:s,onTabChange:r,onClose:p,globalHeaders:c,globalVariables:v,commonHeaderKeys:b,getHeaderValueOptions:k,smallFieldSx:w,onAddHeader:C,onChangeHeader:B,onRemoveHeader:_,onAddVariable:se,onChangeVariable:X,onRemoveVariable:Y})=>{const $=Kt(),[U,O]=d.useState(null),J=f=>{f.stopPropagation(),O(f.currentTarget)},N=()=>O(null);return e.jsxs(Dt,{open:t,onClose:p,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{height:"40vh"}},children:[e.jsx($t,{sx:{fontSize:$.typography.body2.fontSize,py:1},children:"공통 설정 관리"}),e.jsxs(Gt,{dividers:!0,sx:{py:1.5,display:"flex",flexDirection:"column",gap:1,overflow:"hidden"},children:[e.jsxs(x,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(St,{value:s,onChange:(f,T)=>{T&&r(T)},textColor:"primary",indicatorColor:"primary",sx:{minHeight:28,"& .MuiTabs-flexContainer":{gap:.5},"& .MuiTab-root":{minHeight:28,fontSize:$.typography.caption.fontSize,py:.5},"& .MuiTabs-indicator":{bottom:2}},children:[e.jsx(pe,{label:"헤더",value:"headers"}),e.jsx(pe,{label:e.jsxs(x,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(j,{variant:"caption",sx:{fontSize:$.typography.caption.fontSize},children:"변수"}),e.jsx(Q,{size:"small",onClick:J,children:e.jsx(gn,{fontSize:"small"})})]}),value:"variables"})]}),e.jsx(oe,{size:"small",startIcon:e.jsx(qe,{}),onClick:s==="headers"?C:se,children:s==="headers"?"헤더 추가":"변수 추가"})]}),s==="headers"&&e.jsxs(x,{spacing:1,sx:{flex:1,minHeight:0},children:[e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",sx:{px:.5},children:[e.jsx(j,{variant:"caption",sx:{width:{xs:1,sm:180}},children:"Key"}),e.jsx(j,{variant:"caption",sx:{flex:1},children:"Value"}),e.jsx(E,{sx:{width:96}})]}),e.jsx(x,{spacing:1,sx:{flex:1,minHeight:0,overflow:"auto"},children:c.map(f=>e.jsxs(x,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(Tt,{freeSolo:!0,options:b,value:f.key,onInputChange:(T,z)=>B(f.id,"key",z??""),onChange:(T,z)=>B(f.id,"key",typeof z=="string"?z:""),sx:{width:{xs:1,sm:180}},ListboxProps:{sx:{"& .MuiAutocomplete-option":{fontSize:$.typography.caption.fontSize}}},renderInput:T=>e.jsx(K,{...T,size:"small",placeholder:"Key",sx:{...w}})}),e.jsx(Tt,{freeSolo:!0,options:k(f.key),value:f.value,onInputChange:(T,z)=>B(f.id,"value",z??""),onChange:(T,z)=>B(f.id,"value",typeof z=="string"?z:""),sx:{flex:1},ListboxProps:{sx:{"& .MuiAutocomplete-option":{fontSize:$.typography.caption.fontSize}}},renderInput:T=>e.jsx(K,{...T,size:"small",placeholder:"Value",sx:{...w}})}),e.jsxs(x,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(Ce,{size:"small",checked:f.enabled,onChange:T=>B(f.id,"enabled",T.target.checked)}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"활성"})]}),e.jsx(Q,{size:"small",onClick:()=>_(f.id),children:e.jsx(Pe,{fontSize:"small"})})]},f.id))})]}),s==="variables"&&e.jsxs(x,{spacing:1,sx:{flex:1,minHeight:0},children:[e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",sx:{px:.5},children:[e.jsx(j,{variant:"caption",sx:{width:{xs:1,sm:180}},children:"Key"}),e.jsx(j,{variant:"caption",sx:{flex:1},children:"Value"}),e.jsx(E,{sx:{width:96}})]}),e.jsx(x,{spacing:1,sx:{flex:1,minHeight:0,overflow:"auto"},children:v.map(f=>e.jsxs(x,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(K,{size:"small",value:f.key,onChange:T=>X(f.id,"key",T.target.value),placeholder:"Key",sx:{width:{xs:1,sm:180},...w}}),e.jsx(K,{size:"small",value:f.value,onChange:T=>X(f.id,"value",T.target.value),placeholder:"Value",sx:{flex:1,...w}}),e.jsxs(x,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(Ce,{size:"small",checked:f.enabled,onChange:T=>X(f.id,"enabled",T.target.checked)}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"활성"})]}),e.jsx(Q,{size:"small",onClick:()=>Y(f.id),children:e.jsx(Pe,{fontSize:"small"})})]},f.id))}),e.jsx(mn,{open:!!U,anchorEl:U,onClose:N,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsxs(x,{sx:{p:1,maxWidth:320,bgcolor:"grey.900",color:"common.white",borderRadius:1},spacing:.5,children:[e.jsxs(j,{variant:"caption",sx:{fontSize:10,lineHeight:1.5},children:["변수는 ",e.jsx("span",{style:{color:"#90caf9"},children:"공통"}),"으로 저장되며 URL/헤더/바디에서"," ",e.jsx("code",{style:{color:"#ffd54f"},children:"{{변수명}}"})," 형태로 사용할 수 있습니다."]}),e.jsxs(j,{variant:"caption",sx:{fontSize:10,lineHeight:1.5},children:["예: ",e.jsx("code",{style:{color:"#ffe082"},children:"API_URL"})," ="," ",e.jsx("code",{style:{color:"#ffcc80"},children:"https://api.example.com"})]})]})})]})]}),e.jsx(Ft,{children:e.jsx(oe,{onClick:p,children:"닫기"})})]})},cs={idle:{label:"대기",color:"text.disabled"},running:{label:"실행 중",color:"warning.main"},success:{label:"성공",color:"success.main"},error:{label:"실패",color:"error.main"}},ds=({status:t})=>{const s=cs[t];return e.jsxs(x,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(E,{sx:{width:10,height:10,borderRadius:"50%",bgcolor:s.color,transition:"background-color 0.2s ease"}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:s.label})]})},bn=d.memo(({nodes:t,nodeOrder:s,selectedNodeId:r,onSelect:p,onRunNode:c,onCloneNode:v,onRemoveNode:b,onMoveNode:k,onMoveNodeToIndex:w,onToggleField:C,selectionMode:B,selectedNodeIds:_,onToggleNodeSelection:se})=>{const X=d.useRef(null),[Y,$]=d.useState(null),[U,O]=d.useState(null),J=(N,f)=>{$(N),O(N?f:null)};return d.useEffect(()=>{if(!r)return;const N=X.current?.querySelector(`[data-node-id="${r}"]`);N&&N.scrollIntoView({block:"nearest"})},[r,t.length]),e.jsx(x,{ref:X,spacing:1,sx:{minHeight:500,overflowY:"auto",height:"calc(100vh - 305px)"},children:t.length===0?e.jsx(x,{flex:1,alignItems:"center",justifyContent:"center",sx:{color:"text.secondary"},children:e.jsx(j,{variant:"body2",children:"노드가 없습니다. 상단의 추가 버튼으로 시작하세요."})}):t.map(N=>e.jsx(yn,{node:N,nodeIndex:s.indexOf(N.id),nodeOrderLength:s.length,selected:N.id===r,selectionMode:B,isChecked:_.has(N.id),onToggleSelect:()=>se(N.id),onSelect:p,onRunNode:c,onCloneNode:v,onRemoveNode:b,onMoveNode:k,onMoveNodeToIndex:w,dragOverId:Y,dragOverPosition:U,onDragHover:J,onToggleField:C},N.id))})});bn.displayName="NodeListPanel";const yn=d.memo(({node:t,nodeIndex:s,nodeOrderLength:r,selected:p,selectionMode:c,isChecked:v,onToggleSelect:b,onSelect:k,onRunNode:w,onCloneNode:C,onRemoveNode:B,onMoveNode:_,onMoveNodeToIndex:se,dragOverId:X,dragOverPosition:Y,onDragHover:$,onToggleField:U})=>{const O=Kt(),J=d.useMemo(()=>{switch(t.method){case"GET":return O.palette.success.main;case"POST":return O.palette.primary.main;case"PUT":return O.palette.warning.main;case"PATCH":return O.palette.info.main;case"DELETE":return O.palette.error.main;default:return O.palette.grey[400]}},[t.method,O.palette]),[N,f]=d.useState(null),T=!!N,z=S=>{S.stopPropagation(),!c&&f(S.currentTarget)},q=()=>f(null),re=c,ce=s<=0,Ae=s>=r-1,Te=X===t.id?Y:null;return e.jsxs(fe,{variant:"outlined",sx:{p:1.2,position:"relative",boxShadow:"none",cursor:"default",borderColor:p?"primary.main":t.status==="error"?"error.light":t.status==="success"?"success.light":t.status==="running"?"warning.light":void 0,'&[data-dragging="true"]':{opacity:.6,borderStyle:"dashed",cursor:"move"},...Te==="above"&&{"&::before":{content:'""',position:"absolute",left:8,right:8,top:-6,height:2,borderRadius:999,bgcolor:"primary.main",boxShadow:`0 0 0 1px ${O.palette.background.paper}`}},...Te==="below"&&{"&::after":{content:'""',position:"absolute",left:8,right:8,bottom:-6,height:2,borderRadius:999,bgcolor:"primary.main",boxShadow:`0 0 0 1px ${O.palette.background.paper}`}},"&:hover":{borderColor:"primary.light"}},"data-node-id":t.id,draggable:!c,onDragStart:S=>{c||(S.dataTransfer.effectAllowed="move",S.dataTransfer.setData("text/plain",t.id),S.currentTarget.dataset.dragging="true")},onDragEnd:S=>{S.currentTarget.dataset.dragging="false"},onDragOver:S=>{if(c)return;S.preventDefault(),S.dataTransfer.dropEffect="move";const ae=S.currentTarget.getBoundingClientRect(),ie=S.clientY<ae.top+ae.height/2?"above":"below";$(t.id,ie)},onDragLeave:()=>{c||$(null,null)},onDrop:S=>{if(c)return;S.preventDefault();const ae=S.dataTransfer.getData("text/plain");if(!ae||ae===t.id)return;const ie=S.currentTarget.getBoundingClientRect(),H=(S.clientY<ie.top+ie.height/2?"above":"below")==="below"?s+1:s;se(ae,H),$(null,null)},onClick:()=>{if(c){b(),k(t.id);return}k(t.id)},children:[e.jsxs(x,{spacing:1.2,children:[e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",children:[c&&e.jsx(Q,{size:"small",onClick:S=>{S.stopPropagation(),b()},sx:{width:28,height:28},children:v?e.jsx(Qn,{fontSize:"small",color:"primary"}):e.jsx(Xn,{fontSize:"small",color:"action"})}),e.jsx(fn,{label:t.method,size:"small",variant:"filled",sx:{fontWeight:600,fontSize:12,minWidth:72,justifyContent:"center",bgcolor:J,color:O.palette.getContrastText(J)}}),e.jsx(j,{fontWeight:600,color:t.enabled?"text.primary":"text.disabled",noWrap:!0,sx:{minWidth:0,maxWidth:160,fontSize:12},children:t.label||"노드명 없음"})]}),e.jsxs(x,{direction:"row",spacing:.5,children:[e.jsx(be,{title:"실행",children:e.jsx("span",{children:e.jsx(Q,{size:"small",onClick:w(t.id),disabled:re,children:e.jsx(_t,{fontSize:"small"})})})}),e.jsx(be,{title:"복제",children:e.jsx("span",{children:e.jsx(Q,{size:"small",onClick:C(t.id),disabled:re,children:e.jsx(Yn,{fontSize:"small"})})})}),e.jsx(be,{title:"옵션",children:e.jsx("span",{children:e.jsx(Q,{size:"small",onClick:z,disabled:re,children:e.jsx(Ut,{fontSize:"small"})})})})]})]}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(j,{color:"text.secondary",noWrap:!0,sx:{flex:1,minWidth:0,fontSize:12},children:t.resolvedUrl||t.url||"URL을 입력하세요"}),e.jsx(ds,{status:t.status})]}),t.lastRunAt&&e.jsxs(j,{variant:"caption",color:"text.secondary",children:["최근 실행 ",new Date(t.lastRunAt).toLocaleTimeString()]})]}),e.jsxs(De,{anchorEl:N,open:T,onClose:q,onClick:S=>S.stopPropagation(),children:[e.jsx(F,{disableRipple:!0,onClick:S=>S.stopPropagation(),children:e.jsxs(x,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(Ce,{size:"small",checked:t.enabled,onChange:S=>{S.stopPropagation(),U(t.id,"enabled",S.target.checked)}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:t.enabled?"활성":"비활성"})]})}),e.jsx(F,{disableRipple:!0,onClick:S=>S.stopPropagation(),children:e.jsxs(x,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(Ce,{size:"small",checked:t.autoTriggerNext,onChange:S=>{S.stopPropagation(),U(t.id,"autoTriggerNext",S.target.checked)}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"다음 노드 자동 실행"})]})}),e.jsxs(F,{disabled:ce,onClick:S=>{S.stopPropagation(),_(t.id,"up"),q()},children:[e.jsx(sn,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"위로 이동"})]}),e.jsxs(F,{disabled:ce,onClick:S=>{S.stopPropagation(),_(t.id,"top"),q()},children:[e.jsx(sn,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"맨 위로 이동"})]}),e.jsxs(F,{disabled:Ae,onClick:S=>{S.stopPropagation(),_(t.id,"down"),q()},children:[e.jsx(rn,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"아래로 이동"})]}),e.jsxs(F,{disabled:Ae,onClick:S=>{S.stopPropagation(),_(t.id,"bottom"),q()},children:[e.jsx(rn,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"맨 아래로 이동"})]}),e.jsxs(F,{onClick:S=>{S.stopPropagation(),B(t.id)(S),q()},children:[e.jsx(Pe,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"삭제"})]})]})]})},(t,s)=>{if(t.selected!==s.selected||t.selectionMode!==s.selectionMode||t.isChecked!==s.isChecked||t.nodeIndex!==s.nodeIndex||t.nodeOrderLength!==s.nodeOrderLength||t.onSelect!==s.onSelect||t.onCloneNode!==s.onCloneNode||t.onRemoveNode!==s.onRemoveNode||t.onMoveNode!==s.onMoveNode||t.onMoveNodeToIndex!==s.onMoveNodeToIndex||t.onRunNode!==s.onRunNode||t.onToggleField!==s.onToggleField||t.onToggleSelect!==s.onToggleSelect||t.dragOverId!==s.dragOverId||t.dragOverPosition!==s.dragOverPosition)return!1;const r=t.node,p=s.node;return r.id===p.id&&r.label===p.label&&r.method===p.method&&r.url===p.url&&r.resolvedUrl===p.resolvedUrl&&r.enabled===p.enabled&&r.autoTriggerNext===p.autoTriggerNext&&r.status===p.status&&r.lastRunAt===p.lastRunAt});yn.displayName="NodeListItemCard";const Qt=["GET","POST","PUT","PATCH","DELETE"],Wt=20,ln=1,us=new Set(Qt),hs="api-flow",$e="snapshots",jn="latest",ue=t=>`${t}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,xe=(t,s,r)=>{if(!t)return t;const p=t.replace(/\{\{\s*([^}]+?)\s*\}\}/g,(c,v)=>{const b=v.trim();return b in s?String(s[b]):`{{${v}}}`});return!r||r.size===0?p:p.replace(/\{([^}]+)\}/g,(c,v)=>{const b=v.trim();return r.has(b)&&b in s?String(s[b]):c})},vn=()=>new Promise((t,s)=>{const r=indexedDB.open(hs,1);r.onupgradeneeded=()=>{const p=r.result;p.objectStoreNames.contains($e)||p.createObjectStore($e)},r.onsuccess=()=>t(r.result),r.onerror=()=>s(r.error)}),ps=async()=>{const t=await vn();return new Promise((s,r)=>{const v=t.transaction($e,"readonly").objectStore($e).get(jn);v.onsuccess=()=>s(v.result??null),v.onerror=()=>r(v.error)})},xs=async t=>{const s=await vn();return new Promise((r,p)=>{const b=s.transaction($e,"readwrite").objectStore($e).put(t,jn);b.onsuccess=()=>r(),b.onerror=()=>p(b.error)})},gs=t=>({...t,status:"idle",responsePreview:`{
  "status": "idle"
}`,lastRunAt:void 0,lastRequest:void 0,passThroughs:t.passThroughs.map(s=>({...s,preview:void 0}))}),cn=(t,s)=>t.reduce((r,p)=>{if(!p.enabled)return r;const c=p.key.trim();if(!c)return r;const v=xe(c,s);return v&&(r[v]=xe(p.value,s)),r},{}),Bt=(t,s)=>t.reduce((r,p)=>{if(!p.enabled)return r;const c=p.key.trim();return c&&(r[xe(c,s)]=xe(p.value,s)),r},{}),ms=(t,s)=>{const p=xe(t,s).trim();if(p)try{return JSON.parse(p)}catch{return p}},Ie=t=>({id:ue("hdr"),key:"",value:"",enabled:!0,...t}),te=(t,s)=>({id:ue(t),key:"",value:"",enabled:!0,...s}),fs=t=>{const s=new Set;for(let r=0;r<t.length;r++){if(t[r]!=="{")continue;if(t[r+1]==="{"){r++;continue}const p=t.indexOf("}",r+1);if(p===-1)break;if(t[p+1]==="}"){r=p+1;continue}const c=t.slice(r+1,p).trim();c&&s.add(c),r=p}return s},tt=t=>{const s=Array.from(fs(t.url));if(!s.length)return t.localVariables.length===0?t:{...t,localVariables:[]};const r=new Map(t.localVariables.map(c=>[c.key,c])),p=s.map(c=>r.get(c)??te("var",{key:c}));return{...t,localVariables:p}},kt=(t,s)=>{if(typeof t!="string"||!t.startsWith("#/"))return;const r=t.replace(/^#\//,"").split("/");let p=s;for(const c of r)if(p=p?.[c],p===void 0)return;return p},Ct=(t,s,r=0)=>{if(!t||r>5)return"";if(t.example!==void 0)return t.example;if(t.default!==void 0)return t.default;if(t.$ref){const c=kt(t.$ref,s);return Ct(c,s,r+1)}switch(t.type??(t.properties?"object":t.items?"array":"string")){case"object":{const c={},v=t.properties??{};return Object.entries(v).forEach(([b,k])=>{c[b]=Ct(k,s,r+1)??""}),c}case"array":return[Ct(t.items??{},s,r+1)??""];case"boolean":return!1;case"number":case"integer":return 0;default:return""}},Sn=(t,s)=>{if(!t)return[];if(t.$ref){const p=kt(t.$ref,s);return Sn(p,s)}const r=t.properties??{};return Object.keys(r).length===0?[te("form")]:Object.keys(r).map(p=>te("form",{key:p,value:"",enabled:!0}))},bs=t=>{if(!t||typeof t!="object")return[];const s=typeof t.servers?.[0]?.url=="string"?t.servers[0].url.replace(/\/$/,""):"",r=t.paths;if(!r||typeof r!="object")return[];const p=[],c=(v,b)=>{const k=[];return Array.isArray(v)&&k.push(...v),Array.isArray(b)&&k.push(...b),k};return Object.entries(r).forEach(([v,b])=>{!b||typeof b!="object"||Object.entries(b).forEach(([k,w])=>{const C=k.toUpperCase();if(!us.has(C)||!w||typeof w!="object")return;const B=w.summary??`${C} ${v}`,_=w.description??"",se=c(b.parameters,w.parameters),X=[],Y=[];se.forEach(T=>{const z=T?.$ref?kt(T.$ref,t):T;if(!z)return;const q=z.name;if(!q)return;const re=z.example??z.schema?.example??z.schema?.default??"";switch(z.in){case"query":X.push(te("query",{key:q,value:String(re??"")}));break;case"header":Y.push(Ie({key:q,value:String(re??"")}));break}});let $=`{
  
}`,U=[],O;const J=w.requestBody?.$ref?kt(w.requestBody.$ref,t):w.requestBody;if(J?.content&&typeof J.content=="object"){const T=Object.entries(J.content),z=T.find(([q])=>q.includes("application/json"))??T[0];if(z){O=z[0];const q=z[1],re=q?.schema;if(O.includes("application/x-www-form-urlencoded"))U=Sn(re,t);else{const ce=q?.example??q?.examples?.default?.value??Ct(re,t);if(ce!==void 0)try{$=typeof ce=="string"?ce:JSON.stringify(ce,null,2)}catch{$=String(ce)}}}}O&&Y.push(Ie({key:"Content-Type",value:O}));const N=`${s}${v}`.replace(new RegExp("(?<!:)\\/{2,}","g"),"/"),f=Yt(p.length,{label:B,description:_,method:C,url:N,headers:Y.length?Y:[Ie()],useGlobalHeaders:Y.length===0,queryParams:X.length?X:[te("query")],formBodyEntries:U.length?U:[te("form")],body:$});p.push(f)})}),p},qt=t=>{const s={order:[],meta:{},body:{},headers:{},passThroughs:{},queryParams:{},localVariables:{},formBodyEntries:{},runtime:{}};return t.forEach(r=>{s.order.push(r.id),s.meta[r.id]={id:r.id,label:r.label,description:r.description,method:r.method,url:r.url,useGlobalHeaders:r.useGlobalHeaders,autoTriggerNext:r.autoTriggerNext,enabled:r.enabled},s.body[r.id]=r.body??"",s.headers[r.id]=r.headers??[],s.passThroughs[r.id]=r.passThroughs??[],s.queryParams[r.id]=r.queryParams??[],s.localVariables[r.id]=r.localVariables??[],s.formBodyEntries[r.id]=r.formBodyEntries??[],s.runtime[r.id]={status:r.status??"idle",lastRunAt:r.lastRunAt,responsePreview:r.responsePreview??"",lastRequest:r.lastRequest}}),s},et=(t,s)=>{const r=t.meta[s];if(!r)return null;const p=t.runtime[s]??{status:"idle",responsePreview:""};return{id:s,label:r.label,description:r.description,method:r.method,url:r.url,body:t.body[s]??"",headers:t.headers[s]??[],useGlobalHeaders:r.useGlobalHeaders,passThroughs:t.passThroughs[s]??[],queryParams:t.queryParams[s]??[],localVariables:t.localVariables[s]??[],formBodyEntries:t.formBodyEntries[s]??[],responsePreview:p.responsePreview??"",autoTriggerNext:r.autoTriggerNext,enabled:r.enabled,status:p.status??"idle",lastRunAt:p.lastRunAt,lastRequest:p.lastRequest}},yt=(t,s)=>{const r={order:t.order,meta:{...t.meta},body:{...t.body},headers:{...t.headers},passThroughs:{...t.passThroughs},queryParams:{...t.queryParams},localVariables:{...t.localVariables},formBodyEntries:{...t.formBodyEntries},runtime:{...t.runtime}};return r.meta[s.id]={id:s.id,label:s.label,description:s.description,method:s.method,url:s.url,useGlobalHeaders:s.useGlobalHeaders,autoTriggerNext:s.autoTriggerNext,enabled:s.enabled},r.body[s.id]=s.body??"",r.headers[s.id]=s.headers??[],r.passThroughs[s.id]=s.passThroughs??[],r.queryParams[s.id]=s.queryParams??[],r.localVariables[s.id]=s.localVariables??[],r.formBodyEntries[s.id]=s.formBodyEntries??[],r.runtime[s.id]={status:s.status??"idle",lastRunAt:s.lastRunAt,responsePreview:s.responsePreview??"",lastRequest:s.lastRequest},r},ys=(t,s,r)=>{const p=r??t.order,c=[];return p.forEach(v=>{const b=t.meta[v];if(!b)return;const k=t.runtime[v];c.push({id:v,label:b.label,method:b.method,url:b.url,resolvedUrl:b.url?xe(b.url,s,new Set((t.localVariables[v]??[]).map(w=>w.key.trim()).filter(Boolean))):b.url,enabled:b.enabled,autoTriggerNext:b.autoTriggerNext,status:k?.status??"idle",lastRunAt:k?.lastRunAt})}),c},js=t=>{if(t.length===0)return[{index:0,start:0,end:0,nodeIds:[]}];const s=[];for(let r=0;r<t.length;r+=Wt){const p=Math.min(t.length,r+Wt);s.push({index:s.length,start:r,end:p,nodeIds:t.slice(r,p)})}return s},vs=t=>{if(t!==void 0){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return String(t)}}},Ss=(t,s)=>{if(!(!t||!s.trim()))try{const r=Kn({path:s,json:t,wrap:!0});return!Array.isArray(r)||r.length===0?void 0:r[0]}catch{return}},jt=(t,s)=>{const r={};return{updatedRows:s.map(c=>{const v=Ss(t,c.jsonPath),b=vs(v),k=c.label.trim()||c.targetKey.trim();return k&&b!==void 0&&(r[k]=b),{...c,preview:b}}),variables:r}},Xt=t=>({id:ue("map"),label:"",jsonPath:"$.name",targetKey:"",enabled:!0,preview:void 0,...t}),Jt=t=>({...Ie(),...t,id:typeof t?.id=="string"?t.id:ue("hdr"),key:typeof t?.key=="string"?t.key:"",value:typeof t?.value=="string"?t.value:"",enabled:typeof t?.enabled=="boolean"?t.enabled:!0}),Cs=t=>({...Xt(),...t,id:typeof t?.id=="string"?t.id:ue("map"),label:typeof t?.label=="string"&&t.label?t.label:typeof t?.targetKey=="string"?t.targetKey:"",jsonPath:typeof t?.jsonPath=="string"?t.jsonPath:"$.name",targetKey:typeof t?.targetKey=="string"?t.targetKey:"",enabled:!0,preview:void 0}),dn=(t,s)=>{const r=Yt(),p=Qt.includes(t.method)?t.method:r.method,c=Array.isArray(t.headers)&&t.headers.length>0?t.headers.map(C=>Jt(C)):r.headers,v=Array.isArray(t.passThroughs)&&t.passThroughs.length>0?t.passThroughs.map(C=>Cs(C)):r.passThroughs,b=Array.isArray(t.queryParams)&&t.queryParams.length>0?t.queryParams.map(C=>({...te("query"),...C})):r.queryParams,k=Array.isArray(t.localVariables)&&t.localVariables.length>0?t.localVariables.filter(C=>typeof C.key=="string"&&C.key.trim()).map(C=>({...te("var"),...C,key:C.key.trim()})):r.localVariables,w=Array.isArray(t.formBodyEntries)&&t.formBodyEntries.length>0?t.formBodyEntries.map(C=>({...te("form"),...C})):r.formBodyEntries;return tt({...r,...t,id:typeof t.id=="string"?t.id:r.id,label:typeof t.label=="string"?t.label:r.label,description:typeof t.description=="string"?t.description:r.description,method:p,url:typeof t.url=="string"?t.url:r.url,body:typeof t.body=="string"?t.body:r.body,headers:c,useGlobalHeaders:typeof t.useGlobalHeaders=="boolean"?t.useGlobalHeaders:r.useGlobalHeaders,passThroughs:v,queryParams:b,localVariables:k,formBodyEntries:w,autoTriggerNext:typeof t.autoTriggerNext=="boolean"?t.autoTriggerNext:r.autoTriggerNext,enabled:typeof t.enabled=="boolean"?t.enabled:r.enabled,status:"idle",responsePreview:r.responsePreview,lastRunAt:void 0,lastRequest:void 0})},Yt=(t,s)=>{const r={id:ue("node"),label:"",description:"",method:"POST",url:"",body:`{
  
}`,headers:[Ie()],useGlobalHeaders:!0,passThroughs:[Xt()],queryParams:[te("query")],localVariables:[],formBodyEntries:[te("form")],responsePreview:`{
  "status": "idle"
}`,autoTriggerNext:!1,enabled:!0,status:"idle",lastRunAt:void 0,lastRequest:void 0};return tt({...r,...s})},Ts=()=>[],ks=()=>{const t=d.useMemo(()=>Ts(),[]),[s,r]=d.useState(()=>qt(t)),p=d.useRef({}),[c,v]=d.useState(t[0]?.id??null),b=d.useMemo(()=>[{id:ue("gh"),key:"Content-Type",value:"application/json",enabled:!0}],[]),[k,w]=d.useState(b),[C,B]=d.useState([]),[_,se]=d.useState({}),[X,Y]=d.useState(0),[$,U]=d.useState(!1),O=d.useRef(""),J=d.useRef(!1),N=d.useRef(!1),f=d.useMemo(()=>js(s.order),[s.order]),T=Math.min(X,Math.max(f.length-1,0)),z=f[T]?.nodeIds??[],q=d.useMemo(()=>Bt(C,_),[C,_]),re=d.useMemo(()=>({..._,...q}),[_,q]),ce=d.useMemo(()=>{if(!c)return[];const a=s.order.indexOf(c);if(a<=0)return[];const l=new Set;return s.order.slice(0,a).forEach(i=>{(s.passThroughs[i]??[]).forEach(h=>{const m=h.label?.trim()||h.targetKey?.trim();m&&l.add(m)})}),Array.from(l)},[s.order,s.passThroughs,c]),Ae=d.useMemo(()=>ys(s,re,z),[s,re,z]),nt=d.useMemo(()=>f.map(a=>({index:a.index,label:`그룹 ${a.index+1}`,rangeLabel:a.nodeIds.length>0?`${a.start+1}-${a.end}`:"노드 없음",nodeCount:a.nodeIds.length})),[f]),Te=s.order.length;d.useEffect(()=>{if(c&&s.meta[c])return;const a=s.order[0];v(a??null)},[s.order,s.meta,c]),d.useEffect(()=>{Y(a=>{const l=Math.max(f.length-1,0);return a>l?l:a})},[f.length]),d.useEffect(()=>{if(!c)return;const a=s.order.indexOf(c);if(a===-1)return;const l=Math.floor(a/Wt);Y(i=>i===l?i:l)},[c,s.order]);const S=d.useCallback(()=>c?et(s,c):null,[s,c]),ae=d.useCallback(a=>{const l=Math.max(f.length-1,0),i=Math.min(Math.max(a,0),l);Y(i),v(u=>{const h=f[i];return!h||u&&h.nodeIds.includes(u)?u:h.nodeIds[0]??u})},[f]),ie=d.useCallback(()=>{const a=s.order.map(l=>et(s,l)).filter(l=>!!l).map(l=>gs({...l}));return{version:ln,nodes:a,globalHeaders:k,globalVariables:C}},[s,k,C]);d.useEffect(()=>{if(J.current)return;const a=ie();O.current=JSON.stringify(a),U(!1),J.current=!0},[ie]),d.useEffect(()=>{if(J.current){if(!N.current){N.current=!0;return}$||U(!0)}},[s,k,C,$]);const ke=d.useCallback((a,l)=>{const i=a.nodes.map((m,I)=>dn(m)),u=Array.isArray(a.globalHeaders)&&a.globalHeaders.length>0?a.globalHeaders.map(m=>Jt(m)):b,h=Array.isArray(a.globalVariables)&&a.globalVariables.length>0?a.globalVariables.map(m=>({...te("var"),...m})):[];l?.markSaved&&(O.current=JSON.stringify(a),U(!1),N.current=!1),r(qt(i)),v(i[0]?.id??null),w(u),B(h),se({}),p.current={}},[b]);d.useEffect(()=>{let a=!0;return ps().then(l=>{!a||!l||ke(l,{markSaved:!0})}).catch(l=>{console.error(l)}),()=>{a=!1}},[ke]);const H=d.useCallback((a,l)=>{r(i=>{const u=et(i,a);if(!u)return i;const h=tt(l(u));return yt(i,h)})},[]),Rt=d.useCallback((a,l)=>{if(a.length===0)return;const i=new Set(a);r(u=>{let h=!1;const m={...u.meta};return u.order.forEach(I=>{if(!i.has(I))return;const A=m[I];!A||A.enabled===l||(m[I]={...A,enabled:l},h=!0)}),h?{...u,meta:m}:u})},[]),ye=d.useCallback(a=>{if(a.length===0)return;const l=new Set(a);r(i=>{const u=i.order.filter(A=>!l.has(A)),h=A=>{const G={};return Object.entries(A).forEach(([V,le])=>{l.has(V)||(G[V]=le)}),G},m={order:u,meta:h(i.meta),body:h(i.body),headers:h(i.headers),passThroughs:h(i.passThroughs),queryParams:h(i.queryParams),localVariables:h(i.localVariables),formBodyEntries:h(i.formBodyEntries),runtime:h(i.runtime)},I={...p.current};return a.forEach(A=>{delete I[A]}),p.current=I,c&&l.has(c)&&v(u[0]??null),m})},[c]),wt=d.useCallback((a,l)=>{r(i=>{const u=i.order.indexOf(a);if(u===-1)return i;const h=l==="up"?u-1:l==="down"?u+1:l==="top"?0:i.order.length-1;if(h<0||h>=i.order.length)return i;const m=[...i.order];return m.splice(u,1),m.splice(h,0,a),{...i,order:m}})},[]),Pt=d.useCallback((a,l)=>{r(i=>{const u=i.order.indexOf(a);if(u===-1)return i;const h=Math.min(Math.max(l,0),i.order.length-1);if(u===h)return i;const m=[...i.order];return m.splice(u,1),m.splice(h,0,a),{...i,order:m}})},[]),Re=()=>{r(a=>{const l=tt(Yt(a.order.length));return v(l.id),{...yt(a,l),order:[...a.order,l.id]}})},je=a=>()=>{r(l=>{const i=et(l,a);if(!i)return l;const u=tt({...i,id:ue("node"),label:`${i.label} (복제)`,status:"idle",responsePreview:"",lastRunAt:void 0,lastRequest:void 0,headers:i.headers.map(m=>({...m,id:ue("hdr")})),passThroughs:i.passThroughs.map(m=>({...m,id:ue("map"),preview:void 0})),formBodyEntries:i.formBodyEntries.map(m=>({...m,id:ue("form")}))});return v(u.id),{...yt(l,u),order:[...l.order,u.id]}})},It=a=>l=>{l.stopPropagation(),r(i=>{const u=i.order.filter(A=>A!==a),h=A=>{const{[a]:G,...V}=A;return V},m={order:u,meta:h(i.meta),body:h(i.body),headers:h(i.headers),passThroughs:h(i.passThroughs),queryParams:h(i.queryParams),localVariables:h(i.localVariables),formBodyEntries:h(i.formBodyEntries),runtime:h(i.runtime)},I={...p.current};return delete I[a],p.current=I,m})},st=d.useCallback(async(a,l,i=new Set)=>{if(i.has(a))return;i.add(a);const u=et(s,a);if(!u)return;if(!u.url.trim()){H(a,R=>({...R,status:"error",responsePreview:JSON.stringify({error:"요청 URL을 입력하세요."},null,2)}));return}const h=l??_,m=Bt(C,h),I=Object.keys(m).length>0?{...m,...h}:h,A=u.localVariables.reduce((R,L)=>{const ne=xe(L.key,I).trim();if(!ne)return R;const D=xe(L.value,I);return D.trim()===""||(R[ne]=D),R},{}),G=new Set(u.localVariables.map(R=>R.key.trim()).filter(Boolean)),V=Object.keys(A).length>0?{...I,...A}:I,le=new Date,We={...u.useGlobalHeaders?cn(k,V):{},...cn(u.headers,V)},Je=Object.entries(We).find(([R])=>R.toLowerCase()==="content-type")?.[1]?.toLowerCase(),Se={...We};u.method==="GET"&&Object.keys(Se).forEach(R=>{R.toLowerCase()==="content-type"&&delete Se[R]});const Ke=xe(u.url,V,G),Oe=ms(u.body,V),Qe=Bt(u.queryParams,V),M={method:u.method,url:Ke,headers:Se};Object.keys(Qe).length>0&&(M.params=Qe);const ge=u.formBodyEntries.filter(R=>R.enabled&&R.key.trim());if((Je?.includes("application/x-www-form-urlencoded")??!1)&&ge.length>0){const R=new URLSearchParams;ge.forEach(ne=>{const D=xe(ne.key,V);D&&R.append(D,xe(ne.value,V))});const L=R.toString();if(u.method==="GET"){const ne=Array.from(R.entries()).reduce((D,[Z,ee])=>(D[Z]=ee,D),{});M.params={...M.params??{},...ne}}else M.data=L}else Oe!==void 0&&(u.method==="GET"?M.params={...M.params??{},...Oe}:M.data=Oe);const Me={url:Ke,method:u.method,headers:Se,body:M.data,params:M.params};H(a,R=>({...R,lastRunAt:le.toISOString(),status:"running",responsePreview:JSON.stringify({status:"running",startedAt:le.toLocaleString()},null,2),lastRequest:Me}));try{const R=await Un(M),L=R.data;p.current={...p.current,[a]:L};const{updatedRows:ne,variables:D}=jt(L,u.passThroughs),Z=Object.keys(D).length>0?{...V,...D}:V;if(H(a,ee=>({...ee,lastRunAt:new Date().toISOString(),status:"success",responsePreview:JSON.stringify(L,null,2),passThroughs:ne,lastRequest:{...Me,responseHeaders:R.headers}})),Object.keys(D).length>0&&se(ee=>({...ee,...D})),u.autoTriggerNext){const ee=s.order.findIndex(xt=>xt===a),Xe=ee>=0?s.order[ee+1]:void 0;Xe&&await st(Xe,Z,i)}}catch(R){if(Wn(R)){const L=R.response?.data;p.current={...p.current,[a]:L};const{updatedRows:ne,variables:D}=jt(L,u.passThroughs);H(a,Z=>({...Z,lastRunAt:new Date().toISOString(),status:"error",responsePreview:JSON.stringify(L??{status:R.response?.status??"error",message:R.message},null,2),passThroughs:ne,lastRequest:{...Me,responseHeaders:R.response?.headers??void 0}})),Object.keys(D).length>0&&se(Z=>({...Z,...D}));return}p.current={...p.current,[a]:void 0},H(a,L=>({...L,lastRunAt:new Date().toISOString(),status:"error",responsePreview:JSON.stringify({status:"error",message:String(R)},null,2),passThroughs:L.passThroughs.map(ne=>({...ne,preview:void 0})),lastRequest:Me}))}},[s,_,k,C,H]),At=a=>async l=>{l?.stopPropagation(),await st(a)},Ge=d.useCallback((a,l,i)=>{H(a,u=>{let h={...u,[l]:i};if(l==="url"&&typeof i=="string"){const m=new Set,I=i;for(let G=0;G<I.length;G++)if(I[G]==="{"){if(I[G+1]==="{"){G++;continue}const V=I.indexOf("}",G+1);if(V===-1)break;if(I[V+1]==="}"){G=V+1;continue}const le=I.slice(G+1,V).trim();le&&m.add(le),G=V}const A=Array.from(m).map(G=>h.localVariables.find(le=>le.key===G)??te("var",{key:G}));h={...h,localVariables:A}}if(l==="responsePreview"&&typeof i=="string")try{const m=JSON.parse(i),{updatedRows:I}=jt(m,h.passThroughs);h={...h,passThroughs:I}}catch{h={...h,passThroughs:h.passThroughs.map(m=>({...m,preview:void 0}))}}return h})},[H]),y=d.useCallback(()=>{const a=ie(),l=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),i=`api-flow-${new Date().toISOString().slice(0,10)}.json`;Jn.saveAs(l,i)},[ie]),W=d.useCallback(async()=>{const a=ie();try{await xs(a),O.current=JSON.stringify(a),U(!1),N.current=!1}catch(l){console.error(l),window.alert("저장 중 오류가 발생했습니다.")}},[ie]),he=d.useCallback(async a=>{if(a)try{const l=await a.text(),i=JSON.parse(l);if(!i||!Array.isArray(i.nodes))throw new Error("Invalid flow snapshot");ke({version:ln,nodes:i.nodes,globalHeaders:Array.isArray(i.globalHeaders)?i.globalHeaders:[],globalVariables:Array.isArray(i.globalVariables)?i.globalVariables:[]},{markSaved:!1})}catch(l){console.error(l),window.alert("JSON 파일을 불러오는 중 오류가 발생했습니다.")}},[ke]),Fe=d.useCallback(a=>{if(a.globalHeaders){const u=Array.isArray(a.globalHeaders)&&a.globalHeaders.length>0?a.globalHeaders.map(h=>Jt(h)):b;w(u)}if(a.globalVariables){const u=Array.isArray(a.globalVariables)&&a.globalVariables.length>0?a.globalVariables.map(h=>({...te("var"),...h})):[];B(u)}const l=a.nodes??[];if(!Array.isArray(l)||l.length===0)return;const i=l.map((u,h)=>{const{id:m,...I}=u;return{...dn(I),id:ue("node")}});r(u=>{let h={...u,order:[...u.order]};return i.forEach(m=>{h=yt(h,m),h={...h,order:[...h.order,m.id]}}),h}),i[0]?.id&&v(i[0].id)},[b]),zt=d.useCallback(async a=>{if(a)try{const l=await a.text(),i=JSON.parse(l),u=bs(i);if(!u.length){window.alert("OpenAPI 문서에서 변환할 경로를 찾지 못했습니다.");return}r(qt(u)),v(u[0]?.id??null),se({}),p.current={},U(!0),window.alert(`OpenAPI 문서에서 ${u.length}개의 노드를 변환했습니다.`)}catch(l){console.error(l),window.alert("OpenAPI 문서를 불러오는 중 오류가 발생했습니다.")}},[]),_e=(a,l)=>{c&&Ge(c,a,l)},Et=(a,l,i,u)=>{if(a){H(a,h=>({...h,headers:h.headers.map(m=>m.id===l?{...m,[i]:u}:m)}));return}w(h=>h.map(m=>m.id===l?{...m,[i]:u}:m))},ze=a=>()=>{if(a){H(a,l=>({...l,headers:[...l.headers,Ie()]}));return}w(l=>[...l,Ie()])},rt=(a,l)=>()=>{if(a){H(a,i=>({...i,headers:i.headers.filter(u=>u.id!==l)}));return}w(i=>i.filter(u=>u.id!==l))},Ee=(a,l,i)=>{B(u=>u.map(h=>h.id===a?{...h,[l]:i}:h))},ve=()=>{B(a=>[...a,te("var")])},at=a=>()=>{B(l=>l.filter(i=>i.id!==a))},ot=(a,l,i)=>{if(!c)return;const u=p.current[c];H(c,h=>{const m=h.passThroughs.map(A=>A.id===a?{...A,[l]:i}:A);if(!u)return{...h,passThroughs:m.map(A=>A.id===a?{...A,preview:void 0}:A)};const{updatedRows:I}=jt(u,m);return{...h,passThroughs:I}})},it=()=>{c&&H(c,a=>({...a,passThroughs:[...a.passThroughs,Xt()]}))},lt=a=>()=>{c&&H(c,l=>({...l,passThroughs:l.passThroughs.filter(i=>i.id!==a)}))},Ot=a=>a?"공통 헤더와 병합되어 전송됩니다.":"이 노드에서만 사용될 헤더입니다.",ct=(a,l,i)=>{c&&H(c,u=>({...u,queryParams:u.queryParams.map(h=>h.id===a?{...h,[l]:i}:h)}))},Nt=()=>{c&&H(c,a=>({...a,queryParams:[...a.queryParams,te("query")]}))},Mt=a=>()=>{c&&H(c,l=>({...l,queryParams:l.queryParams.filter(i=>i.id!==a)}))},dt=(a,l,i)=>{c&&H(c,u=>({...u,localVariables:u.localVariables.map(h=>h.id===a?{...h,[l]:i}:h)}))},ut=(a,l,i)=>{c&&H(c,u=>({...u,formBodyEntries:u.formBodyEntries.map(h=>h.id===a?{...h,[l]:i}:h)}))},Ue=()=>{c&&H(c,a=>({...a,formBodyEntries:[...a.formBodyEntries,te("form")]}))},ht=a=>()=>{c&&H(c,l=>({...l,formBodyEntries:l.formBodyEntries.filter(i=>i.id!==a)}))};return{nodes:Ae,nodeOrder:s.order,nodeGroups:nt,activeGroupIndex:X,handleGroupChange:ae,totalNodeCount:Te,selectedNodeId:c,setSelectedNodeId:v,globalHeaders:k,globalVariables:C,passThroughVariableKeys:ce,hasUnsavedChanges:$,setNodesEnabled:Rt,removeNodes:ye,moveNode:wt,moveNodeToIndex:Pt,handleAddNode:Re,handleCloneNode:je,handleRemoveNode:It,handleRunNode:At,handleNodeFieldChange:Ge,handleSelectedNodeChange:_e,handleHeaderChange:Et,handleAddHeaderRow:ze,handleRemoveHeaderRow:rt,handleGlobalVariableChange:Ee,handleAddGlobalVariable:ve,handleRemoveGlobalVariable:at,handleAddPassThrough:it,handlePassThroughChange:ot,handleRemovePassThrough:lt,headerHelper:Ot,flowVariables:_,handleExportFlow:y,handleSaveToDb:W,handleImportFlow:he,handleAppendSampleNodes:Fe,handleQueryParamChange:ct,handleAddQueryParam:Nt,handleRemoveQueryParam:Mt,handleLocalVariableChange:dt,handleFormBodyChange:ut,handleAddFormBodyEntry:Ue,handleRemoveFormBodyEntry:ht,handleImportOpenApi:zt,getSelectedNodeData:S}},we=({variables:t,onInsert:s})=>{const[r,p]=d.useState(null),c=Object.entries(t),v=!!r,b=C=>{C.stopPropagation(),p(C.currentTarget)},k=()=>p(null),w=C=>{s(`{{${C}}}`),k()};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{size:"small",onClick:b,disabled:c.length===0,children:e.jsx(is,{fontSize:"small"})}),e.jsx(De,{anchorEl:r,open:v,onClose:k,children:c.length===0?e.jsx(F,{disabled:!0,children:"저장된 변수가 없습니다"}):c.map(([C,B])=>e.jsx(F,{onClick:()=>w(C),children:e.jsxs(x,{spacing:.5,children:[e.jsx(j,{variant:"body2",fontWeight:600,children:C}),e.jsx(j,{variant:"caption",color:"text.secondary",children:B||"값 없음"})]})},C))})]})},Rs=360,vt=320,un=420,hn=["Content-Type","Accept","Authorization","User-Agent","Cache-Control","X-Request-Id"],pn={"content-type":["application/json","application/xml","application/x-www-form-urlencoded","multipart/form-data","text/plain","text/html","application/octet-stream"],accept:["application/json","application/xml","text/plain","text/html","*/*"]},xn=t=>{const s=t?.trim().toLowerCase();return s&&s in pn?pn[s]:[]},Es=()=>{const{nodes:t,nodeOrder:s,nodeGroups:r,activeGroupIndex:p,handleGroupChange:c,selectedNodeId:v,setSelectedNodeId:b,globalHeaders:k,globalVariables:w,passThroughVariableKeys:C,hasUnsavedChanges:B,setNodesEnabled:_,removeNodes:se,moveNode:X,moveNodeToIndex:Y,handleAddNode:$,handleCloneNode:U,handleRemoveNode:O,handleRunNode:J,handleNodeFieldChange:N,handleSelectedNodeChange:f,handleHeaderChange:T,handleAddHeaderRow:z,handleRemoveHeaderRow:q,handleGlobalVariableChange:re,handleAddGlobalVariable:ce,handleRemoveGlobalVariable:Ae,handleAddPassThrough:nt,handlePassThroughChange:Te,handleRemovePassThrough:S,flowVariables:ae,handleExportFlow:ie,handleSaveToDb:ke,handleImportFlow:H,handleAppendSampleNodes:Rt,handleQueryParamChange:ye,handleAddQueryParam:wt,handleRemoveQueryParam:Pt,handleLocalVariableChange:Re,handleFormBodyChange:je,handleAddFormBodyEntry:It,handleRemoveFormBodyEntry:st,handleImportOpenApi:At,getSelectedNodeData:Ge}=ks(),y=d.useMemo(()=>Ge(),[Ge]),W=Kt(),he=Zn(W.breakpoints.down("md")),[Fe,zt]=d.useState("preview"),[_e,Et]=d.useState("headers"),[ze,rt]=d.useState(!1),[Ee,ve]=d.useState(new Set),[at,ot]=d.useState(null),[it,lt]=d.useState(null),[Ot,ct]=d.useState(!1),[Nt,Mt]=d.useState("headers"),[dt,ut]=d.useState(null),[Ue,ht]=d.useState(null),[a,l]=d.useState(!1),[i,u]=d.useState(""),[h,m]=d.useState(!1),[I,A]=d.useState(null),[G,V]=d.useState(null),[le,We]=d.useState(null),pt=d.useRef(null),Je=d.useRef(null),Se=d.useRef(!1),Ke=d.useRef(null),Oe=d.useRef(null),Qe=d.useRef(null),M=d.useMemo(()=>({"& .MuiInputBase-input":{fontSize:12},"& .MuiInputLabel-root":{fontSize:12}}),[]),ge=d.useRef(null),Ne=d.useRef(!1),[Me,R]=d.useState(Rs),[L,ne]=d.useState("headers"),D=Ee.size,Z=d.useMemo(()=>{const n={};return w.forEach(o=>{if(!o.enabled)return;const g=o.key.trim();g&&(n[g]=o.value??"")}),C.forEach(o=>{o&&(n[o]=ae[o]??"")}),Object.entries(ae).forEach(([o,g])=>{n[o]=g}),n},[w,C,ae]),ee=d.useMemo(()=>Object.keys(Z),[Z]),Xe=d.useMemo(()=>{if(Ue===null)return[];const n=Ue.trim().toLowerCase();return n?ee.filter(o=>o.toLowerCase().includes(n)):ee},[ee,Ue]),xt=d.useMemo(()=>{if(le===null)return[];const n=le.trim().toLowerCase();return n?ee.filter(o=>o.toLowerCase().includes(n)):ee},[ee,le]),gt=d.useMemo(()=>{if(!y)return;const n=y.headers.find(o=>o.enabled&&o.key.trim().toLowerCase()==="content-type");if(n?.value.trim())return n.value.trim().toLowerCase();if(y.useGlobalHeaders)return k.find(g=>g.enabled&&g.key.trim().toLowerCase()==="content-type")?.value.trim().toLowerCase()},[y,k]),Ht=!!(gt&&gt.includes("application/x-www-form-urlencoded")),Vt=r[p]??null,Cn=()=>{Ke.current?.click()},Tn=n=>{const o=n.target.files?.[0]??null;H(o),n.target.value=""},kn=()=>{Oe.current?.click()},Rn=n=>{const o=n.target.files?.[0]??null;At(o),n.target.value=""},wn=n=>{n.stopPropagation(),lt(n.currentTarget)},Pn=async()=>{try{const n=await fetch("/sample/api_flow_sample_data.json");if(!n.ok)throw new Error("Failed to load sample");const o=await n.json();if(!o?.nodes||!Array.isArray(o.nodes))throw new Error("Invalid sample format");Rt(o)}catch(n){console.error(n),window.alert("예시 데이터를 불러오는 중 오류가 발생했습니다.")}},Ye=()=>lt(null),mt=()=>{ut(null),ht(null)},ft=()=>{V(null),We(null),pt.current=null},In=n=>{if(!y)return;const o=y.url??"",g=o.lastIndexOf("{{");if(g===-1)return;const de=`${o.slice(0,g)}{{${n}}}`;f("url",de),mt()},An=n=>{const o=pt.current;if(!o)return;const g=o.value??"",P=g.lastIndexOf("{{");if(P===-1)return;const _n=`${g.slice(0,P)}{{${n}}}`;o.setValue(_n),ft()},me=(n,o,g)=>{if(!n||ee.length===0)return;const P=o.lastIndexOf("{{");if(P===-1){ft();return}const de=o.slice(P+2);if(de.includes("}}")){ft();return}pt.current={value:o,setValue:g},V(n),We(de)},zn=n=>{const o=n.target.value;if(f("url",o),ee.length===0)return;const g=o.lastIndexOf("{{");if(g===-1){mt();return}const P=o.slice(g+2);if(P.includes("}}")){mt();return}ut(n.target),ht(P)},En=()=>{Se.current=!0,rt(!1),ve(new Set),$()},On=()=>{rt(n=>{const o=!n;return o||ve(new Set),o})},Nn=n=>{ve(o=>{const g=new Set(o);return g.has(n)?g.delete(n):g.add(n),g})},Mn=()=>{ve(new Set(t.map(n=>n.id)))},Hn=()=>{ve(new Set)},Vn=n=>{n.stopPropagation(),ot(n.currentTarget)},He=()=>ot(null),Ln=()=>{u(y?.description??""),l(!0)},Zt=()=>l(!1),Bn=()=>{y&&(f("description",i),l(!1))},qn=()=>m(!0),en=()=>m(!1),Dn=n=>{n.stopPropagation(),A(n.currentTarget)},$n=()=>A(null),tn=n=>{const o=Array.from(Ee);o.length!==0&&_(o,n)},Gn=()=>{const n=Array.from(Ee);n.length!==0&&(se(n),ve(new Set))};d.useEffect(()=>{y&&y.method==="GET"&&L==="body"&&ne("query")},[y?.method,L]),d.useEffect(()=>{y?.id&&Se.current&&(Se.current=!1,requestAnimationFrame(()=>{Je.current?.focus(),Je.current?.select()}))},[y?.id]);const Ve=d.useCallback(n=>{const o=ge.current?.getBoundingClientRect().width??0;if(!o)return Math.max(n,vt);const g=Math.max(o-un,vt);return Math.min(Math.max(n,vt),g)},[]),Le=d.useCallback(n=>{if(!ge.current)return;const o=ge.current.getBoundingClientRect();R(Ve(n-o.left))},[Ve]),bt=d.useCallback(()=>{Ne.current&&(Ne.current=!1,typeof document<"u"&&(document.body.style.cursor="",document.body.style.userSelect=""))},[]),nn=d.useCallback(n=>{if(!he)if(n.preventDefault(),Ne.current=!0,typeof document<"u"&&(document.body.style.cursor="col-resize",document.body.style.userSelect="none"),"touches"in n){const o=n.touches[0];o&&Le(o.clientX)}else Le(n.clientX)},[he,Le]);d.useEffect(()=>{const n=P=>{Ne.current&&(P.preventDefault(),Le(P.clientX))},o=P=>{if(!Ne.current)return;const de=P.touches[0];de&&(P.preventDefault(),Le(de.clientX))},g=()=>bt();return window.addEventListener("mousemove",n),window.addEventListener("mouseup",g),window.addEventListener("touchmove",o,{passive:!1}),window.addEventListener("touchend",g),window.addEventListener("touchcancel",g),()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",g),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",g),window.removeEventListener("touchcancel",g)}},[bt,Le]),d.useEffect(()=>{if(!ge.current)return;const n=new ResizeObserver(()=>{R(o=>Ve(o))});return n.observe(ge.current),()=>n.disconnect()},[Ve]),d.useEffect(()=>{if(!(typeof window>"u"))return()=>{}},[]),d.useEffect(()=>{if(he){bt();return}R(n=>Ve(n))},[he,Ve,bt]);const Fn=he?"1fr":`minmax(${vt}px, ${Math.round(Me)}px) 6px minmax(${un}px, 1fr)`;return e.jsxs(fe,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:785,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden"},children:[e.jsx("input",{ref:Ke,type:"file",accept:"application/json,.json",style:{display:"none"},onChange:Tn}),e.jsx("input",{ref:Oe,type:"file",accept:"application/json,.json",style:{display:"none"},onChange:Rn}),e.jsx(E,{sx:{width:1},children:e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(oe,{startIcon:e.jsx(qe,{}),onClick:En,size:"small",variant:"contained",children:"추가"}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",justifyContent:"flex-end",children:[e.jsxs(E,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(oe,{size:"small",variant:"outlined",onClick:ke,disabled:!B,children:"저장"}),B&&e.jsx(E,{sx:{position:"absolute",top:-3,right:-3,width:8,height:8,borderRadius:"50%",bgcolor:"warning.main",boxShadow:"0 0 0 2px #fff"}})]}),e.jsx(oe,{size:"small",variant:"outlined",onClick:()=>ct(!0),children:"공통 설정"}),e.jsx(be,{title:"더보기",children:e.jsx(Q,{size:"small",onClick:wn,children:e.jsx(Ut,{fontSize:"small"})})})]})]})}),e.jsxs(E,{ref:ge,sx:{flex:1,minHeight:650,height:"calc(100vh - 250px)",width:1,display:"grid",gridTemplateColumns:Fn,gridTemplateRows:"1fr",columnGap:he?0:1,rowGap:1.25,alignItems:"stretch",overflow:"hidden",touchAction:he?"auto":"none"},children:[e.jsxs(x,{component:fe,variant:"outlined",spacing:1.2,sx:{pt:1,pl:1.25,pr:1.25,pb:1,minHeight:0,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(De,{anchorEl:it,open:!!it,onClose:Ye,onClick:n=>n.stopPropagation(),children:[e.jsxs(F,{onClick:()=>{ie(),Ye()},children:[e.jsx(es,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"내보내기"})]}),e.jsxs(F,{onClick:()=>{Cn(),Ye()},children:[e.jsx(ts,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"불러오기"})]}),e.jsxs(F,{onClick:()=>{Pn(),Ye()},children:[e.jsx(ns,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"예시 불러오기"})]}),e.jsx(Lt,{}),e.jsxs(F,{onClick:()=>{kn(),Ye()},children:[e.jsx(ss,{fontSize:"small",sx:{mr:1}}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"OpenAPI 3.0 불러오기"})]})]}),e.jsx(ls,{open:Ot,tab:Nt,onTabChange:Mt,onClose:()=>ct(!1),globalHeaders:k,globalVariables:w,commonHeaderKeys:hn,getHeaderValueOptions:xn,smallFieldSx:M,onAddHeader:z(null),onChangeHeader:(n,o,g)=>T(null,n,o,g),onRemoveHeader:n=>q(null,n)(),onAddVariable:ce,onChangeVariable:re,onRemoveVariable:n=>Ae(n)()}),e.jsxs(x,{spacing:1.25,flexShrink:0,children:[e.jsxs(x,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[ze?e.jsxs(j,{variant:"caption",color:"text.primary",children:["선택 ",D,"개"]}):e.jsx(E,{}),e.jsxs(x,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(be,{title:"선택 모드",children:e.jsx(Q,{size:"small",onClick:On,children:e.jsx(rs,{fontSize:"small",color:ze?"primary":"inherit"})})}),ze&&e.jsx(be,{title:"선택 옵션",children:e.jsx(Q,{size:"small",onClick:Vn,children:e.jsx(Ut,{fontSize:"small"})})})]})]}),e.jsxs(De,{anchorEl:at,open:!!at,onClose:He,onClick:n=>n.stopPropagation(),children:[e.jsx(F,{onClick:()=>{Mn(),He()},children:"전체 선택"}),e.jsx(F,{disabled:D===0,onClick:()=>{Hn(),He()},children:"선택 해제"}),e.jsx(Lt,{}),e.jsx(F,{disabled:D===0,onClick:()=>{tn(!0),He()},children:"선택 노드 활성"}),e.jsx(F,{disabled:D===0,onClick:()=>{tn(!1),He()},children:"선택 노드 비활성"}),e.jsx(F,{disabled:D===0,onClick:()=>{Gn(),He()},children:"선택 노드 삭제"})]}),e.jsx(Lt,{flexItem:!0}),Object.keys(ae).length>0&&e.jsx(fe,{variant:"outlined",sx:{p:1},children:e.jsxs(x,{spacing:1,children:[e.jsx(j,{variant:"subtitle2",children:"사용 가능한 변수"}),e.jsx(x,{direction:"row",spacing:1,flexWrap:"wrap",children:Object.entries(ae).map(([n,o])=>e.jsx(fn,{label:`${n}: ${o}`,size:"small"},n))})]})})]}),r.length>1&&Vt&&e.jsxs(x,{spacing:.5,flexShrink:0,children:[e.jsxs(x,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(j,{variant:"subtitle2",children:"노드 페이지"}),e.jsxs(j,{variant:"caption",color:"text.secondary",children:[Vt.rangeLabel," (",Vt.nodeCount,"개)"]})]}),e.jsx(as,{count:r.length,page:p+1,onChange:(n,o)=>c(o-1),color:"primary",size:"small",siblingCount:0,boundaryCount:1})]}),e.jsx(bn,{nodes:t,nodeOrder:s,selectedNodeId:v,onSelect:b,onRunNode:J,onCloneNode:U,onRemoveNode:O,onMoveNode:X,onMoveNodeToIndex:Y,onToggleField:N,selectionMode:ze,selectedNodeIds:Ee,onToggleNodeSelection:Nn})]}),!he&&e.jsx(E,{sx:{width:6,justifySelf:"stretch",cursor:"col-resize",bgcolor:"divider","&:hover":{bgcolor:"action.hover"},borderRadius:1,display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none"},onMouseDown:nn,onTouchStart:nn,children:e.jsxs(E,{sx:{display:"flex",flexDirection:"column",gap:.25},children:[e.jsx(E,{sx:{width:2,height:2,bgcolor:"text.secondary",borderRadius:"50%"}}),e.jsx(E,{sx:{width:2,height:2,bgcolor:"text.secondary",borderRadius:"50%"}}),e.jsx(E,{sx:{width:2,height:2,bgcolor:"text.secondary",borderRadius:"50%"}})]})}),e.jsx(fe,{variant:"outlined",sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,minHeight:0,overflow:"hidden",height:"100%","& .MuiTypography-subtitle2, & .MuiTypography-body1, & .MuiTypography-body2":{fontSize:12}},children:y?e.jsxs(x,{spacing:1.2,sx:{flex:1,minHeight:0},children:[e.jsxs(x,{direction:{xs:"column",md:"row"},spacing:1.25,children:[e.jsx(K,{size:"small",label:"노드명",value:y.label,onChange:n=>f("label",n.target.value),fullWidth:!0,inputRef:Je,sx:M}),e.jsx(be,{title:"메모",children:e.jsx(Q,{size:"small",onClick:Ln,sx:{alignSelf:"center"},children:e.jsx(os,{fontSize:"small"})})})]}),e.jsxs(x,{direction:{xs:"column",md:"row"},spacing:1.25,children:[e.jsx(K,{select:!0,size:"small",label:"HTTP Method",value:y.method,onChange:n=>f("method",n.target.value),sx:{width:he?1:160,...M,"& .MuiSelect-select":{fontSize:12},"& .MuiInputBase-root":{height:34}},SelectProps:{MenuProps:{PaperProps:{sx:{"& .MuiMenuItem-root":{fontSize:12}}},MenuListProps:{sx:{"& .MuiMenuItem-root":{fontSize:12}}}}},children:Qt.map(n=>e.jsx(F,{value:n,children:n},n))}),e.jsx(K,{size:"small",label:"요청 URL",value:y.url,placeholder:"https://api.example.com/login",onChange:zn,fullWidth:!0,sx:M,InputProps:{endAdornment:e.jsxs(Be,{position:"end",children:[e.jsx(we,{variables:Z,onInsert:n=>f("url",`${y.url}${n}`)}),e.jsx(be,{title:"이 노드만 실행",children:e.jsx(Q,{size:"small",onClick:J(y.id),children:e.jsx(_t,{fontSize:"small"})})})]})}})]}),e.jsx(De,{anchorEl:dt,open:!!dt&&Xe.length>0,onClose:mt,onClick:n=>n.stopPropagation(),children:Xe.map(n=>e.jsx(F,{onClick:()=>In(n),children:e.jsx(j,{variant:"caption",color:"text.secondary",children:`{{${n}}}`})},n))}),e.jsx(De,{anchorEl:G,open:!!G&&xt.length>0,onClose:ft,onClick:n=>n.stopPropagation(),children:xt.map(n=>e.jsx(F,{onClick:()=>An(n),children:e.jsx(j,{variant:"caption",color:"text.secondary",children:`{{${n}}}`})},n))}),e.jsxs(Dt,{open:a,onClose:Zt,maxWidth:"sm",fullWidth:!0,children:[e.jsx($t,{sx:{fontSize:12},children:"메모"}),e.jsx(Gt,{dividers:!0,sx:{py:1.5},children:e.jsx(K,{autoFocus:!0,size:"small",label:"설명",value:i,onChange:n=>u(n.target.value),fullWidth:!0,multiline:!0,minRows:4,sx:M})}),e.jsxs(Ft,{children:[e.jsx(oe,{onClick:Zt,children:"취소"}),e.jsx(oe,{variant:"contained",onClick:Bn,children:"저장"})]})]}),e.jsxs(Dt,{open:h,onClose:en,maxWidth:!1,PaperProps:{sx:{width:720,height:520}},children:[e.jsx($t,{sx:{fontSize:12,fontWeight:70,pt:.5,pb:.5},children:e.jsxs(x,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(j,{fontWeight:700,fontSize:12,children:"전달 변수 설정"}),e.jsx(Q,{size:"small",onClick:Dn,children:e.jsx(gn,{fontSize:"small"})})]})}),e.jsx(mn,{open:!!I,anchorEl:I,onClose:$n,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(E,{sx:{p:1,maxWidth:500,bgcolor:"grey.900",color:"common.white",borderRadius:1},children:e.jsxs(j,{variant:"caption",sx:{fontSize:10,lineHeight:1.3,whiteSpace:"normal"},children:["응답 JSON에서 ",e.jsx("span",{style:{color:"#90caf9"},children:"JSONPath"}),"로 값을 추출해 변수로 저장합니다.",e.jsx("br",{}),"저장된 변수는 다음 노드의"," ",e.jsx("span",{style:{color:"#a5d6a7"},children:"URL/헤더/바디"}),"에서"," ",e.jsx("code",{style:{color:"#ffd54f"},children:"{{변수명}}"})," 형태로 사용할 수 있습니다.",e.jsx("br",{}),"예: 응답이 ",e.jsx("code",{style:{color:"#ffe082"},children:'{"name":"홍길동"}'})," 이면 JSONPath는"," ",e.jsx("code",{style:{color:"#ffcc80"},children:"$.name"})," 입니다.",e.jsx("br",{}),"응답이 ",e.jsx("code",{style:{color:"#ffe082"},children:'{"data":{"name":"홍길동"}}'})," 이면"," ",e.jsx("code",{style:{color:"#ffcc80"},children:"$.data.name"})," 입니다.",e.jsx("br",{}),"결과는 ",e.jsx("code",{style:{color:"#ce93d8"},children:"홍길동"})," 를 전달합니다."]})})}),e.jsxs(Gt,{dividers:!0,sx:{py:1.5},children:[e.jsx(x,{spacing:1,sx:{flexShrink:0},children:e.jsx(x,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:e.jsx(oe,{size:"small",startIcon:e.jsx(qe,{}),onClick:nt,children:"전달 항목 추가"})})}),e.jsx(x,{spacing:1.25,sx:{mt:1},children:y.passThroughs.map(n=>e.jsx(fe,{variant:"outlined",sx:{p:1.25},children:e.jsxs(x,{spacing:1,children:[e.jsxs(x,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(K,{label:"전달 변수명",size:"small",sx:{flex:.6,...M},placeholder:"token",value:n.label,onChange:o=>Te(n.id,"label",o.target.value)}),e.jsx(K,{size:"small",label:"JSON Path",placeholder:"$.name",value:n.jsonPath,onChange:o=>Te(n.id,"jsonPath",o.target.value),sx:{flex:1,...M}}),e.jsx(Q,{size:"small",onClick:S(n.id),children:e.jsx(Pe,{fontSize:"small"})})]}),e.jsx(j,{variant:"caption",color:n.preview?"success.main":"text.secondary",children:n.preview?`최근 추출 값: ${n.preview}`:"최근 실행 기록이 없습니다."})]})},n.id))})]}),e.jsx(Ft,{children:e.jsx(oe,{onClick:en,children:"닫기"})})]}),e.jsxs(x,{direction:{xs:"column",md:"row"},spacing:1.25,alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",children:[e.jsx(on,{control:e.jsx(Ce,{size:"small",checked:y.useGlobalHeaders,onChange:n=>f("useGlobalHeaders",n.target.checked)}),label:"공통 헤더 사용",sx:{"& .MuiFormControlLabel-label":{fontSize:12}}}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",justifyContent:"flex-end",children:[e.jsx(on,{control:e.jsx(Ce,{size:"small",checked:y.autoTriggerNext,onChange:n=>f("autoTriggerNext",n.target.checked)}),label:"다음 노드 자동 실행",sx:{"& .MuiFormControlLabel-label":{fontSize:12}}}),e.jsx(oe,{size:"small",variant:"outlined",onClick:qn,disabled:!y.autoTriggerNext,children:"전달 변수 설정"})]})]}),e.jsxs(x,{direction:{xs:"column",md:"row"},spacing:1.25,sx:{flex:1,minHeight:0,overflow:"hidden"},children:[e.jsxs(fe,{variant:"outlined",sx:{p:0,display:"flex",flexDirection:"column",flex:1,minHeight:0,overflow:"hidden"},children:[e.jsx(E,{sx:{mb:1,px:1.25,py:.75,bgcolor:"action.hover",width:1},children:e.jsx(j,{variant:"subtitle2",children:"요청"})}),e.jsxs(St,{value:L,onChange:(n,o)=>ne(o),textColor:"primary",indicatorColor:"primary",sx:{mb:.5,pl:1.25,pr:1.25,pb:0,pt:0,minHeight:28,"& .MuiTabs-flexContainer":{gap:.5},"& .MuiTab-root":{minHeight:28,fontSize:W.typography.caption.fontSize,py:.5},"& .MuiTabs-indicator":{bottom:2}},children:[e.jsx(pe,{label:"요청 헤더",value:"headers"}),e.jsx(pe,{label:"Query Param",value:"query"}),e.jsx(pe,{label:"Path 변수",value:"path"}),e.jsx(pe,{label:"Request Value",value:"body"}),e.jsx(pe,{label:"요청 로그",value:"log"})]}),e.jsxs(E,{sx:{flex:1,minHeight:0,p:1.25,overflow:"auto",display:"flex",flexDirection:"column"},children:[L==="headers"&&e.jsxs(E,{sx:{p:1,border:`1px solid ${W.palette.divider}`,borderRadius:1,bgcolor:"background.default"},children:[e.jsxs(x,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1},children:[e.jsx(j,{variant:"subtitle2",children:"요청 헤더"}),e.jsx(oe,{size:"small",startIcon:e.jsx(qe,{}),onClick:z(y.id),children:"헤더 추가"})]}),e.jsx(x,{spacing:1.25,children:y.headers.map(n=>e.jsxs(x,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(Tt,{freeSolo:!0,options:hn,value:n.key,onInputChange:(o,g)=>{const P=g??"";T(y.id,n.id,"key",P),me(o?.currentTarget,P,de=>T(y.id,n.id,"key",de))},onChange:(o,g)=>T(y.id,n.id,"key",typeof g=="string"?g:""),sx:{flex:1},ListboxProps:{sx:{"& .MuiAutocomplete-option":{fontSize:12}}},renderInput:o=>e.jsx(K,{...o,label:"Key",size:"small",sx:{flex:1,...M},InputProps:{...o.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[e.jsx(Be,{position:"end",children:e.jsx(we,{variables:Z,onInsert:g=>T(y.id,n.id,"key",`${n.key}${g}`)})}),o.InputProps.endAdornment]})}})}),e.jsx(Tt,{freeSolo:!0,options:xn(n.key),value:n.value,onInputChange:(o,g)=>{const P=g??"";T(y.id,n.id,"value",P),me(o?.currentTarget,P,de=>T(y.id,n.id,"value",de))},onChange:(o,g)=>T(y.id,n.id,"value",typeof g=="string"?g:""),sx:{flex:2},renderInput:o=>e.jsx(K,{...o,label:"Value",size:"small",sx:{flex:1,...M},InputProps:{...o.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[e.jsx(Be,{position:"end",children:e.jsx(we,{variables:Z,onInsert:g=>T(y.id,n.id,"value",`${n.value}${g}`)})}),o.InputProps.endAdornment]})}})}),e.jsx(Q,{size:"small",onClick:q(y.id,n.id),children:e.jsx(Pe,{fontSize:"small"})})]},n.id))})]}),L==="query"&&e.jsxs(E,{sx:{p:1,border:`1px solid ${W.palette.divider}`,borderRadius:1,bgcolor:"background.default"},children:[e.jsxs(x,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1},children:[e.jsx(j,{variant:"subtitle2",children:"Query Parameters"}),e.jsx(oe,{size:"small",startIcon:e.jsx(qe,{}),onClick:wt,children:"파라미터 추가"})]}),y.method==="GET"&&e.jsx(j,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"GET 요청은 Body 대신 Query Param을 사용하는 것이 일반적입니다."}),e.jsx(x,{spacing:1,children:y.queryParams.map(n=>e.jsxs(x,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(Ce,{size:"small",checked:n.enabled,onChange:o=>ye(n.id,"enabled",o.target.checked)}),e.jsx(K,{label:"Key",size:"small",value:n.key,onChange:o=>{const g=o.target.value;ye(n.id,"key",g),me(o.target,g,P=>ye(n.id,"key",P))},sx:{flex:1,...M}}),e.jsx(K,{label:"Value",size:"small",value:n.value,onChange:o=>{const g=o.target.value;ye(n.id,"value",g),me(o.target,g,P=>ye(n.id,"value",P))},sx:{flex:1,...M},InputProps:{endAdornment:e.jsx(Be,{position:"end",children:e.jsx(we,{variables:Z,onInsert:o=>ye(n.id,"value",`${n.value}${o}`)})})}}),e.jsx(Q,{size:"small",onClick:Pt(n.id),children:e.jsx(Pe,{fontSize:"small"})})]},n.id))})]}),L==="path"&&e.jsxs(E,{sx:{p:1,border:`1px solid ${W.palette.divider}`,borderRadius:1,bgcolor:"background.default"},children:[e.jsx(x,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1},children:e.jsx(j,{variant:"subtitle2",children:"Path / Form 변수"})}),y.localVariables.filter(n=>n.key).length===0?e.jsxs(j,{variant:"body2",color:"text.secondary",children:["URL에 ","{path_param}"," 형식으로 변수를 작성하면 자동으로 목록이 생성됩니다."]}):e.jsx(x,{spacing:1,children:y.localVariables.filter(n=>n.key).map(n=>e.jsxs(x,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:"center",children:[e.jsx(K,{label:"Key",size:"small",value:n.key,onChange:o=>{const g=o.target.value;Re(n.id,"key",g),me(o.target,g,P=>Re(n.id,"key",P))},sx:{flex:1,...M}}),e.jsx(K,{label:"Value",size:"small",value:n.value,onChange:o=>{const g=o.target.value;Re(n.id,"value",g),me(o.target,g,P=>Re(n.id,"value",P))},sx:{flex:1,...M},InputProps:{endAdornment:e.jsx(Be,{position:"end",children:e.jsx(we,{variables:Z,onInsert:o=>Re(n.id,"value",`${n.value}${o}`)})})}})]},n.id))})]}),L==="body"&&e.jsxs(x,{spacing:1,sx:{flex:1,minHeight:0,overflow:"hidden"},children:[e.jsxs(x,{direction:"row",alignItems:"center",spacing:1,ref:Qe,children:[e.jsx(j,{variant:"subtitle2",children:"Request Value"}),Ht?e.jsx(j,{variant:"caption",color:"text.secondary",children:"Content-Type이 form-urlencoded이므로 아래 폼을 사용해 값을 입력하세요."}):e.jsx(be,{title:"샘플 JSON 입력 후 실행하면 응답이 우측에서 확인됩니다.",children:e.jsx(an,{fontSize:"small",color:"action"})}),!Ht&&e.jsx(we,{variables:Z,onInsert:n=>f("body",`${y.body}${n}`)})]}),Ht?e.jsxs(fe,{variant:"outlined",sx:{p:1},children:[e.jsxs(x,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsx(j,{variant:"subtitle2",children:"Form 필드"}),e.jsx(oe,{size:"small",startIcon:e.jsx(qe,{}),onClick:It,children:"필드 추가"})]}),e.jsx(x,{spacing:1,children:y.formBodyEntries.map(n=>e.jsxs(x,{direction:{xs:"column",sm:"row"},spacing:1,children:[e.jsx(Ce,{size:"small",checked:n.enabled,onChange:o=>je(n.id,"enabled",o.target.checked)}),e.jsx(K,{size:"small",label:"Key",value:n.key,onChange:o=>{const g=o.target.value;je(n.id,"key",g),me(o.target,g,P=>je(n.id,"key",P))},sx:{flex:1,...M}}),e.jsx(K,{size:"small",label:"Value",value:n.value,onChange:o=>{const g=o.target.value;je(n.id,"value",g),me(o.target,g,P=>je(n.id,"value",P))},sx:{flex:1,...M},InputProps:{endAdornment:e.jsx(Be,{position:"end",children:e.jsx(we,{variables:Z,onInsert:o=>je(n.id,"value",`${n.value}${o}`)})})}}),e.jsx(Q,{size:"small",onClick:st(n.id),children:e.jsx(Pe,{fontSize:"small"})})]},n.id))})]}):e.jsx(E,{sx:{border:`1px solid ${W.palette.divider}`,borderRadius:1,overflow:"hidden",flex:1,minHeight:240,display:"flex"},children:e.jsx(Ze,{height:"100%",defaultLanguage:gt?.includes("xml")?"xml":gt?.includes("html")?"html":"json",theme:W.palette.mode==="dark"?"vs-dark":"vs-light",value:y.body,onChange:n=>{const o=n??"";f("body",o),me(Qe.current,o,g=>f("body",g))},options:{minimap:{enabled:!1},fontSize:13,automaticLayout:!0,scrollBeyondLastLine:!1,wordWrap:"on"}})})]}),L==="log"&&e.jsx(x,{spacing:1.25,sx:{flex:1,minHeight:0},children:y.lastRequest?e.jsxs(e.Fragment,{children:[e.jsxs(x,{spacing:.5,children:[e.jsx(j,{variant:"subtitle2",children:"요청"}),e.jsxs(j,{variant:"body2",color:"text.secondary",children:["[",y.lastRequest.method,"] ",y.lastRequest.url]})]}),e.jsxs(St,{value:_e,onChange:(n,o)=>Et(o),textColor:"primary",indicatorColor:"primary",sx:{mb:.5,minHeight:28,"& .MuiTabs-flexContainer":{gap:.5},"& .MuiTab-root":{minHeight:28,fontSize:W.typography.caption.fontSize,py:.5},"& .MuiTabs-indicator":{bottom:2}},children:[e.jsx(pe,{label:"Headers",value:"headers"}),e.jsx(pe,{label:"Body / Params",value:"body"})]}),e.jsxs(x,{direction:{xs:"column",md:"row"},spacing:1.25,sx:{flex:1,minHeight:0},children:[_e==="headers"&&e.jsx(E,{sx:{flex:1,minHeight:0},children:e.jsx(E,{sx:{border:`1px solid ${W.palette.divider}`,borderRadius:1,height:"100%",minHeight:160},children:e.jsx(Ze,{height:"100%",defaultLanguage:"json",theme:W.palette.mode==="dark"?"vs-dark":"vs-light",value:JSON.stringify(y.lastRequest.headers,null,2),options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:13,automaticLayout:!0,wordWrap:"on"}})})}),_e==="body"&&e.jsx(E,{sx:{flex:1,minHeight:0},children:e.jsx(E,{sx:{border:`1px solid ${W.palette.divider}`,borderRadius:1,height:"100%",minHeight:160},children:e.jsx(Ze,{height:"100%",defaultLanguage:"json",theme:W.palette.mode==="dark"?"vs-dark":"vs-light",value:JSON.stringify(y.lastRequest.body??y.lastRequest.params??{},null,2),options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:13,automaticLayout:!0,wordWrap:"on"}})})})]})]}):e.jsx(x,{flex:1,alignItems:"center",justifyContent:"center",spacing:1,sx:{color:"text.secondary",textAlign:"center"},children:e.jsx(j,{variant:"body2",children:"아직 요청 로그가 없습니다. 노드를 실행해 정보를 확인하세요."})})})]})]}),e.jsxs(fe,{variant:"outlined",sx:{p:0,display:"flex",flexDirection:"column",flex:1,minHeight:0,overflow:"hidden"},children:[e.jsx(E,{sx:{mb:1,px:1.25,py:.75,bgcolor:"action.hover",width:1},children:e.jsx(j,{variant:"subtitle2",children:"응답"})}),e.jsxs(St,{value:Fe,onChange:(n,o)=>zt(o),textColor:"primary",indicatorColor:"primary",sx:{pl:1.25,pr:1.25,pb:0,pt:0,minHeight:28,"& .MuiTabs-flexContainer":{gap:.5},"& .MuiTab-root":{minHeight:28,fontSize:W.typography.caption.fontSize,py:.5},"& .MuiTabs-indicator":{bottom:2}},children:[e.jsx(pe,{label:"응답 본문",value:"preview"}),e.jsx(pe,{label:"응답 헤더",value:"headers"})]}),e.jsxs(E,{sx:{flex:1,minHeight:0,p:1.25,overflow:"auto",display:"flex",flexDirection:"column"},children:[Fe==="preview"&&e.jsxs(x,{spacing:1,sx:{flex:1,minHeight:0},children:[e.jsxs(x,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(j,{variant:"subtitle2",children:"응답 본문"}),e.jsx(x,{direction:"row",spacing:1,children:e.jsx(oe,{size:"small",startIcon:e.jsx(_t,{}),variant:"contained",onClick:J(y.id),children:"실행"})})]}),e.jsx(E,{sx:{border:`1px solid ${W.palette.divider}`,borderRadius:1,overflow:"hidden",flex:1,minHeight:220,display:"flex"},children:e.jsx(Ze,{height:"100%",defaultLanguage:"json",theme:W.palette.mode==="dark"?"vs-dark":"vs-light",value:y.responsePreview,onChange:n=>f("responsePreview",n??""),options:{minimap:{enabled:!1},readOnly:!1,scrollBeyondLastLine:!1,fontSize:11,automaticLayout:!0,wordWrap:"on"}})})]}),Fe==="headers"&&e.jsx(x,{spacing:1,sx:{flex:1,minHeight:0},children:y.lastRequest?.responseHeaders?e.jsx(E,{sx:{border:`1px solid ${W.palette.divider}`,borderRadius:1,overflow:"hidden",flex:1,minHeight:220,display:"flex"},children:e.jsx(Ze,{height:"100%",defaultLanguage:"json",theme:W.palette.mode==="dark"?"vs-dark":"vs-light",value:JSON.stringify(y.lastRequest.responseHeaders,null,2),options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:11,automaticLayout:!0,wordWrap:"on"}})}):e.jsx(x,{flex:1,alignItems:"center",justifyContent:"center",spacing:1,sx:{color:"text.secondary",textAlign:"center"},children:e.jsx(j,{variant:"body2",children:"응답 헤더가 없습니다. 노드를 실행해 확인하세요."})})})]})]})]})]}):e.jsxs(x,{flex:1,alignItems:"center",justifyContent:"center",spacing:1,sx:{color:"text.secondary",textAlign:"center"},children:[e.jsx(an,{fontSize:"large"}),e.jsx(j,{variant:"body2",children:"좌측에서 노드를 선택하면 상세 설정을 확인할 수 있습니다."})]})})]})]})};export{Es as default};
