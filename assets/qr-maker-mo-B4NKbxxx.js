import{r as n,j as e}from"./vendor-CRMzTT1s.js";import{B as o,P as z,a7 as ut,a as p,ao as ht,am as pt,an as ft,x as xt,y as ie,Y as gt,ap as ce,T as f,I as le,aq as de,S as C,n as mt,a6 as ue,k as he,l as pe,m as fe,o as xe}from"./mui-CTdB6wcY.js";import{u as vt,g as wt,n as jt,b as bt,c as Rt,Q as ge,a as yt,P as me}from"./qr-maker-options-panel-Cf-U_MJA.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";let N=null;const Ct=async()=>{if(typeof window>"u")throw new Error("QR 스캔은 브라우저 환경에서만 사용할 수 있습니다.");return window.jsQR?window.jsQR:(N||(N=new Promise((m,j)=>{const i=document.createElement("script");i.src="/libs/jsQR.min.js",i.async=!0,i.onload=()=>{window.jsQR?m(window.jsQR):j(new Error("QR 스캔 스크립트를 불러올 수 없습니다."))},i.onerror=()=>j(new Error("QR 스캔 스크립트를 불러올 수 없습니다.")),document.head.appendChild(i)})),N)},Mt=()=>{const m=n.useRef(null),j=n.useRef(null),i=n.useRef(null),c=n.useRef(null),S=n.useRef(null),b=n.useRef(null),D=n.useRef(null),A=n.useRef(null),{mode:ve,setMode:we,textDraft:je,setTextDraft:be,vcardDraft:Re,setVcardDraft:ye,wifiDraft:Ce,setWifiDraft:Se,isVCardValid:De,isWifiValid:Ie,colorDark:Ee,setColorDark:W,colorLight:ke,setColorLight:L,ecLevel:Me,setEcLevel:Qe,withIcon:Pe,setWithIcon:Te,iconImg:Fe,iconScale:ze,setIconScale:Ae,iconMargin:We,setIconMargin:Le,roundIcon:Oe,setRoundIcon:He,iconFit:Be,setIconFit:Ve,errorMsg:O,setErrorMsg:g,exportSize:_e,setExportSize:qe,exportSizeSafe:Ue,generateQR:Xe,resetAll:Ge,handleIconFile:$e,clearIcon:Ne,downloadResult:Ye,drawToCanvas:I}=vt(),[Y,Je]=n.useState(()=>Math.max(1,window.devicePixelRatio||1)),[H,Ke]=n.useState(320),[B,Ze]=n.useState(null),[V,et]=n.useState("input"),[_,E]=n.useState(!1),[x,q]=n.useState(!1),[R,U]=n.useState(""),[J,y]=n.useState(""),[v,k]=n.useState(!1),[tt,X]=n.useState(!1),[nt,K]=n.useState(!1);n.useEffect(()=>{let t=0,r=-1;const s=()=>{const h=m.current;if(!h)return;const oe=h.getBoundingClientRect(),F=getComputedStyle(h),it=(parseFloat(F.paddingLeft)||0)+(parseFloat(F.paddingRight)||0),ct=(parseFloat(F.paddingTop)||0)+(parseFloat(F.paddingBottom)||0),lt=Math.max(0,oe.width-it-me*2),dt=Math.max(0,oe.height-ct-me*2),$=Math.floor(Math.max(120,Math.min(lt,dt)));Math.abs($-r)>.5&&(r=$,Ke($))},a=new ResizeObserver(()=>{cancelAnimationFrame(t),t=requestAnimationFrame(s)});[m.current,j.current,m.current?.parentElement??null].forEach(h=>h&&a.observe(h));const u=()=>Je(Math.max(1,window.devicePixelRatio||1)),w=window.matchMedia(`(resolution: ${window.devicePixelRatio||1}dppx)`);w.addEventListener?.("change",u);const T=()=>{cancelAnimationFrame(t),t=requestAnimationFrame(s)};return s(),window.addEventListener("resize",T),()=>{a.disconnect(),w.removeEventListener?.("change",u),window.removeEventListener("resize",T),cancelAnimationFrame(t)}},[]);const M=B??H,Q=n.useMemo(()=>Math.round(M*Y),[M,Y]);n.useEffect(()=>{(async()=>{const r=i.current;if(r)try{await I(r,Q),g("")}catch(s){g(s instanceof Error?s.message:"QR을 생성할 수 없습니다.")}})()},[I,Q,g]),n.useEffect(()=>{if(!_)return;let t=0;return t=requestAnimationFrame(()=>{B===null&&Ze(H);const r=i.current;r&&I(r,Q).then(()=>g("")).catch(s=>{g(s instanceof Error?s.message:"QR을 생성할 수 없습니다.")})}),()=>cancelAnimationFrame(t)},[_,I,Q,g,H,B]);const rt=typeof window<"u"&&!!window.EyeDropper,Z=typeof window<"u"&&window.isSecureContext&&!!navigator.mediaDevices?.getUserMedia,ee=t=>{Ye(t,i.current)},te=()=>{Xe(),E(!0)},d=n.useCallback(()=>{S.current&&(S.current.getTracks().forEach(t=>t.stop()),S.current=null),c.current&&(c.current.srcObject=null),b.current=null,k(!1)},[]),P=n.useCallback(async()=>{if(y(""),U(""),!(typeof window>"u")){if(!window.isSecureContext){y("보안 연결(HTTPS)에서만 카메라를 사용할 수 있습니다.");return}if(!navigator.mediaDevices?.getUserMedia){y("카메라를 사용할 수 없습니다.");return}try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});S.current=t,c.current&&(c.current.srcObject=t,await c.current.play()),window.BarcodeDetector?b.current=new window.BarcodeDetector({formats:["qr_code"]}):D.current=await Ct(),k(!0)}catch(t){t instanceof Error&&t.message?y(t.message):y("카메라 권한이 필요합니다."),d()}}},[d]),st=()=>{q(!0)},ne=()=>{q(!1)},re=()=>{X(!1),x&&P()},G=n.useCallback(t=>{const r=t.trim();return/^http:\/\//i.test(r)?`https://${r.slice(7)}`:r},[]),at=n.useCallback(t=>{try{const r=new URL(G(t));return r.protocol==="http:"||r.protocol==="https:"}catch{return!1}},[G]);n.useEffect(()=>{if(!x){d();return}return P(),()=>{d()}},[x,P,d]),n.useEffect(()=>{if(!x||!v||!b.current)return;let t=!0;const r=setInterval(async()=>{if(!(!t||!c.current))try{const s=await b.current?.detect(c.current);if(!s||!s.length)return;const a=s[0]?.rawValue??"";if(!a)return;U(a),X(!0),k(!1),d()}catch{}},400);return()=>{t=!1,clearInterval(r)}},[x,v,d]),n.useEffect(()=>{if(!x||!v||b.current||!D.current)return;let t=!0;const r=setInterval(()=>{if(!t||!c.current||!D.current)return;const s=c.current,a=s.videoWidth,l=s.videoHeight;if(!a||!l)return;A.current||(A.current=document.createElement("canvas"));const u=A.current;if(!u)return;(u.width!==a||u.height!==l)&&(u.width=a,u.height=l);const w=u.getContext("2d");if(!w)return;w.drawImage(s,0,0,a,l);const T=w.getImageData(0,0,a,l),h=D.current(T.data,a,l);h?.data&&(U(h.data),X(!0),k(!1),d())},500);return()=>{t=!1,clearInterval(r)}},[x,v,d]);const ot=n.useCallback(async t=>{if(!(typeof window>"u"||!window.EyeDropper))try{const s=await new window.EyeDropper().open(),a=wt(t),l=jt(s?.sRGBHex??"",a);t==="dark"?W(l):L(l)}catch(r){if(r instanceof DOMException&&r.name==="AbortError")return}},[W,L]),se=n.useCallback(()=>{const t=i.current;if(!t)return;t.getContext("2d")?.clearRect(0,0,t.width,t.height)},[]);n.useEffect(()=>{O&&(se(),K(!0))},[O,se]);const ae=()=>{K(!1),g("")};return e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:0,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden",boxSizing:"border-box"},children:[e.jsx(z,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[e.jsx(ut,{title:Z?"":"카메라 기능은 HTTPS 및 지원 브라우저에서만 사용할 수 있습니다.",children:e.jsx("span",{children:e.jsx(p,{variant:"outlined",startIcon:e.jsx(ht,{}),onClick:st,disabled:!Z,children:"QR 확인"})})}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(p,{variant:"contained",startIcon:e.jsx(pt,{}),onClick:te,children:"QR 생성"}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(ft,{}),onClick:Ge,children:"초기화"})]})]})}),e.jsxs(z,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:[e.jsxs(xt,{value:V,onChange:(t,r)=>et(r),variant:"fullWidth",sx:{minHeight:36},children:[e.jsx(ie,{value:"input",label:"입력",sx:{minHeight:36,py:.5,fontWeight:600}}),e.jsx(ie,{value:"options",label:"옵션",sx:{minHeight:36,py:.5,fontWeight:600}})]}),e.jsx(gt,{sx:{my:1}}),V==="input"&&e.jsx(bt,{mode:ve,onModeChange:we,textDraft:je,onTextChange:be,vcardDraft:Re,onVcardChange:ye,wifiDraft:Ce,onWifiChange:Se,isVCardValid:De,isWifiValid:Ie,onQuickGenerate:te}),V==="options"&&e.jsx(Rt,{colorDark:Ee,onColorDarkChange:W,colorLight:ke,onColorLightChange:L,ecLevel:Me,onEcLevelChange:Qe,withIcon:Pe,onWithIconChange:Te,roundIcon:Oe,onRoundIconChange:He,hasIcon:!!Fe,onIconFile:$e,onClearIcon:Ne,iconScale:ze,onIconScaleChange:Ae,iconMargin:We,onIconMarginChange:Le,iconFit:Be,onIconFitChange:Ve,eyeDropperAvailable:rt,onEyeDropper:ot})]}),e.jsx(ce,{anchor:"bottom",open:_,onOpen:()=>E(!0),onClose:()=>E(!1),disableDiscovery:!0,swipeAreaWidth:56,ModalProps:{keepMounted:!0},PaperProps:{sx:{borderTopLeftRadius:16,borderTopRightRadius:16,maxHeight:"80vh",height:"80vh",overflow:"hidden"}},children:e.jsxs(o,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(o,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",px:2,pt:1.5,pb:1},children:[e.jsx(o,{sx:{width:36,height:4,borderRadius:999,bgcolor:"divider",position:"absolute",left:"50%",top:8,transform:"translateX(-50%)"}}),e.jsx(f,{variant:"subtitle1",fontWeight:600,children:"QR 미리보기"}),e.jsx(le,{size:"small",onClick:()=>E(!1),children:e.jsx(de,{fontSize:"small"})})]}),e.jsx(o,{sx:{px:2,pb:2,overflowY:"auto"},children:e.jsxs(C,{spacing:1.25,children:[e.jsx(z,{ref:m,sx:{p:2,borderRadius:1,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",minHeight:320},children:e.jsx(o,{ref:j,sx:{width:`${M}px`,height:`${M}px`,maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("canvas",{ref:i,style:{width:"100%",height:"100%",imageRendering:"crisp-edges",display:"block",borderRadius:8,background:"#fff",boxShadow:"0 8px 24px rgba(0,0,0,0.06)"}})})}),e.jsx(z,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(C,{spacing:1,children:[e.jsx(mt,{label:`내보내기 (최대 ${ge.toLocaleString()}px)`,type:"number",value:_e,onChange:t=>qe(Number(t.target.value||yt)),inputProps:{min:64,max:ge,step:1.25},size:"small"}),e.jsxs(C,{direction:"row",spacing:1,children:[e.jsx(p,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(ue,{}),onClick:()=>ee("png"),children:"PNG"}),e.jsx(p,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(ue,{}),onClick:()=>ee("svg"),children:"SVG"})]}),e.jsxs(f,{variant:"caption",color:"text.secondary",children:["결과 크기: ",Ue.toLocaleString(),"px"]})]})})]})})]})}),e.jsx(ce,{anchor:"bottom",open:x,onOpen:()=>q(!0),onClose:ne,disableDiscovery:!0,swipeAreaWidth:56,ModalProps:{keepMounted:!0},PaperProps:{sx:{borderTopLeftRadius:16,borderTopRightRadius:16,maxHeight:"calc(85vh - 10px)",height:"calc(85vh - 10px)",overflow:"hidden"}},children:e.jsxs(o,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(o,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",px:2,pt:1.5,pb:1},children:[e.jsx(o,{sx:{width:36,height:4,borderRadius:999,bgcolor:"divider",position:"absolute",left:"50%",top:8,transform:"translateX(-50%)"}}),e.jsx(f,{variant:"subtitle1",fontWeight:600,children:"QR 확인"}),e.jsx(le,{size:"small",onClick:ne,children:e.jsx(de,{fontSize:"small"})})]}),e.jsx(o,{sx:{px:2,pb:2,flex:1,minHeight:0,overflow:"hidden"},children:e.jsxs(C,{spacing:1.25,sx:{height:"100%"},children:[e.jsx(o,{sx:{width:"100%",aspectRatio:"3 / 4",borderRadius:1,overflow:"hidden",bgcolor:"grey.900",display:"flex",alignItems:"center",justifyContent:"center"},children:J?e.jsx(f,{variant:"body2",color:"error",sx:{px:2,textAlign:"center"},children:J}):e.jsx("video",{ref:c,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs(C,{direction:"row",spacing:1,children:[e.jsx(p,{variant:"outlined",size:"small",onClick:P,disabled:v,children:"다시 스캔"}),v&&e.jsx(f,{variant:"caption",color:"text.secondary",sx:{alignSelf:"center"},children:"스캔 중..."})]})]})})]})}),e.jsxs(he,{open:tt,onClose:re,fullWidth:!0,PaperProps:{sx:{maxHeight:"80vh"}},children:[e.jsx(pe,{sx:{py:1.5},children:e.jsx(f,{variant:"subtitle1",fontWeight:600,children:"QR 확인"})}),e.jsxs(fe,{dividers:!0,sx:{maxHeight:"60vh",overflowY:"auto"},children:[e.jsx(f,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:1},children:"QR 결과"}),e.jsx(f,{variant:"body2",color:"text.secondary",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:R||"QR을 스캔하면 내용이 표시됩니다."})]}),e.jsxs(xe,{children:[e.jsx(p,{onClick:re,children:"닫기"}),e.jsx(p,{variant:"contained",disabled:!R||!at(R),onClick:()=>{R&&window.open(G(R),"_blank","noopener")},children:"링크 열기"})]})]}),e.jsxs(he,{open:nt,onClose:ae,fullWidth:!0,children:[e.jsx(pe,{children:"오류"}),e.jsx(fe,{dividers:!0,children:e.jsx(f,{variant:"body2",color:"text.secondary",children:O||"오류가 발생했습니다."})}),e.jsx(xe,{children:e.jsx(p,{onClick:ae,children:"닫기"})})]})]})};export{Mt as default};
