import{r as c}from"./vendor-DuO8O3Ni.js";const G={firstName:"",lastName:"",org:"",title:"",mobile:"",phone:"",email:"",url:"",street:"",city:"",region:"",postal:"",country:"",note:""},X={ssid:"",security:"WPA",password:"",hidden:!1},Y="https://ofsimple.com",et=8192,H=1024,d=t=>t.replace(/([\\;,:"])/g,"\\$1"),ot=(t,r="3.0")=>{const e=i=>i?.trim()??"",o=["BEGIN:VCARD",`VERSION:${r}`],n=`${e(t.lastName)};${e(t.firstName)};;;`;n!==";;;;"&&o.push(`N:${n}`);const u=[e(t.firstName),e(t.lastName)].filter(Boolean).join(" ");if(u&&o.push(`FN:${u}`),t.org&&o.push(`ORG:${d(e(t.org))}`),t.title&&o.push(`TITLE:${d(e(t.title))}`),t.mobile&&o.push(`TEL;TYPE=CELL:${d(e(t.mobile))}`),t.phone&&o.push(`TEL;TYPE=WORK:${d(e(t.phone))}`),t.email&&o.push(`EMAIL:${d(e(t.email))}`),t.url&&o.push(`URL:${d(e(t.url))}`),t.street||t.city||t.region||t.postal||t.country){const i=`;;${d(e(t.street))};${d(e(t.city))};${d(e(t.region))};${d(e(t.postal))};${d(e(t.country))}`;o.push(`ADR;TYPE=WORK:${i}`)}return t.note&&o.push(`NOTE:${d(e(t.note))}`),o.push("END:VCARD"),o.join(`
`)},rt=t=>{const r=[`WIFI:T:${t.security||"nopass"}`,`S:${d(t.ssid||"")}`];return t.security!=="nopass"&&r.push(`P:${d(t.password||"")}`),t.hidden&&r.push("H:true"),`${r.join(";")};`};let W=null;const nt=async()=>{if(typeof window>"u")throw new Error("QR 코드는 브라우저 환경에서만 생성할 수 있습니다.");return window.QRCode?.toCanvas?window.QRCode:(W||(W=new Promise((t,r)=>{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js",e.async=!0,e.onload=()=>{window.QRCode?.toCanvas?t(window.QRCode):r(new Error("QR 스크립트를 불러올 수 없습니다."))},e.onerror=()=>r(new Error("QR 스크립트를 불러올 수 없습니다.")),document.head.appendChild(e)})),W)},st=t=>new Promise((r,e)=>{const o=URL.createObjectURL(t),n=new Image;n.onload=()=>{URL.revokeObjectURL(o),r(n)},n.onerror=u=>{URL.revokeObjectURL(o),e(u)},n.src=o}),it=(t,r,e="qrcode.png")=>{const o=document.createElement("canvas");o.width=r,o.height=r;const n=o.getContext("2d");n.imageSmoothingEnabled=!1,n.drawImage(t,0,0,t.width,t.height,0,0,r,r),o.toBlob(u=>{if(!u)return;const i=URL.createObjectURL(u),f=document.createElement("a");f.href=i,f.download=e,f.click(),URL.revokeObjectURL(i)},"image/png")},ct=(t,r,e="qrcode.svg")=>{const o=document.createElement("canvas");o.width=r,o.height=r;const n=o.getContext("2d");n.imageSmoothingEnabled=!1,n.drawImage(t,0,0,t.width,t.height,0,0,r,r);const u=o.toDataURL("image/png"),i=`<svg xmlns="http://www.w3.org/2000/svg" width="${r}" height="${r}" viewBox="0 0 ${r} ${r}">
  <image href="${u}" x="0" y="0" width="${r}" height="${r}" />
</svg>`,f=new Blob([i],{type:"image/svg+xml"}),s=URL.createObjectURL(f),m=document.createElement("a");m.href=s,m.download=e,m.click(),URL.revokeObjectURL(s)},F=(t,r,e,o,n,u)=>{const i=Math.min(u,o/2,n/2);t.beginPath(),t.moveTo(r+i,e),t.arcTo(r+o,e,r+o,e+n,i),t.arcTo(r+o,e+n,r,e+n,i),t.arcTo(r,e+n,r,e,i),t.arcTo(r,e,r+o,e,i),t.closePath()},at=(t,r)=>{const{size:e,iconImage:o,iconScale:n,iconMargin:u,roundIcon:i,iconFit:f}=r;if(!o)return;const s=Math.max(16,Math.floor(e*n)),m=Math.floor((e-s)/2),R=Math.floor((e-s)/2),l=Math.max(0,Math.min(s/2,u));t.save(),i&&l>0&&(F(t,m,R,s,s,l),t.clip());const g=o.naturalWidth||o.width,M=o.naturalHeight||o.height;let C=m,$=R,p=s,b=s;if(f==="contain"){const w=Math.min(s/g,s/M);p=Math.round(g*w),b=Math.round(M*w),C=m+Math.floor((s-p)/2),$=R+Math.floor((s-b)/2)}else if(f==="cover"){const w=Math.max(s/g,s/M),T=Math.round(s/w),I=Math.round(s/w),E=Math.floor((g-T)/2),y=Math.floor((M-I)/2);t.drawImage(o,E,y,T,I,m,R,s,s),t.restore(),i&&l>0&&(t.save(),t.lineWidth=2,t.strokeStyle="rgba(0,0,0,0.08)",F(t,m,R,s,s,l),t.stroke(),t.restore());return}t.drawImage(o,C,$,p,b),t.restore(),i&&l>0&&(t.save(),t.lineWidth=2,t.strokeStyle="rgba(0,0,0,0.08)",F(t,m,R,s,s,l),t.stroke(),t.restore())},ht=()=>{const[t,r]=c.useState("text"),[e,o]=c.useState(Y),[n,u]=c.useState(G),[i,f]=c.useState(X),s=c.useMemo(()=>{const a=!!(n.firstName?.trim()||n.lastName?.trim()||n.org?.trim()),h=!!(n.mobile?.trim()||n.phone?.trim()||n.email?.trim());return a&&h},[n]),m=c.useMemo(()=>i.ssid?.trim()?i.security==="nopass"?!0:!!i.password?.trim():!1,[i]),[R,l]=c.useState(""),[g,M]=c.useState("#000000"),[C,$]=c.useState("#ffffff"),[p,b]=c.useState("Q"),[w,T]=c.useState(!0),[I,E]=c.useState(null),[y,j]=c.useState(.2),[v,A]=c.useState(6),[U,V]=c.useState(!0),[Q,B]=c.useState("stretch"),[L,k]=c.useState(Y),[P,q]=c.useState(H),D=c.useMemo(()=>Math.min(et,Math.max(64,Math.round(P))),[P]),K=c.useCallback(async a=>{if(!a){E(null);return}try{const h=await st(a);E(h)}catch{E(null)}},[]),x=c.useCallback(()=>E(null),[]),_=c.useCallback(a=>({text:L,size:a,colorDark:g,colorLight:C,ecLevel:p,iconImage:w?I:null,iconScale:y,iconMargin:v,roundIcon:U,iconFit:Q}),[L,g,C,p,w,I,y,v,U,Q]),J=c.useCallback(async(a,h)=>{if(!a)return;if(!L.trim()){a.getContext("2d")?.clearRect(0,0,a.width,a.height);return}const N=await nt(),S=document.createElement("canvas");S.width=h,S.height=h,await N.toCanvas(S,L||" ",{errorCorrectionLevel:p,width:h,color:{dark:g,light:C},margin:0,scale:1});const O=a.getContext("2d");a.width=h,a.height=h,O.clearRect(0,0,h,h),O.drawImage(S,0,0),at(O,_(h)),l("")},[L,p,g,C,_]),Z=c.useCallback(()=>{if(t==="text"){const a=e.trim();return a?(k(a),l(""),!0):(l("텍스트/URL을 입력하세요."),!1)}if(t==="vcard"){if(!s)return l("연락처 QR: 이름/회사 1개 이상 + 전화·휴대전화·이메일 중 1개 이상 필요합니다."),!1;try{return k(ot(n,"3.0")),l(""),!0}catch{return l("vCard를 생성할 수 없습니다."),!1}}return m?(k(rt(i)),l(""),!0):(l("Wi-Fi QR: SSID는 필수이며 WPA/WEP는 비밀번호가 필요합니다."),!1)},[t,e,n,i,s,m]),z=c.useCallback(()=>{r("text"),o(""),u(G),f(X),M("#000000"),$("#ffffff"),b("Q"),T(!0),E(null),j(.2),A(6),V(!0),B("stretch"),q(H),k(""),l("")},[]),tt=c.useCallback(async(a,h,N)=>{if(!h)return;const S=N??D;a==="png"?it(h,S):ct(h,S)},[D]);return{mode:t,setMode:r,textDraft:e,setTextDraft:o,vcardDraft:n,setVcardDraft:u,wifiDraft:i,setWifiDraft:f,isVCardValid:s,isWifiValid:m,colorDark:g,setColorDark:M,colorLight:C,setColorLight:$,ecLevel:p,setEcLevel:b,withIcon:w,setWithIcon:T,iconImg:I,iconScale:y,setIconScale:j,iconMargin:v,setIconMargin:A,roundIcon:U,setRoundIcon:V,iconFit:Q,setIconFit:B,payload:L,errorMsg:R,setErrorMsg:l,exportSize:P,setExportSize:q,exportSizeSafe:D,generateQR:Z,resetAll:z,handleIconFile:K,clearIcon:x,downloadResult:tt,drawToCanvas:J}};export{et as Q,H as a,ht as u};
