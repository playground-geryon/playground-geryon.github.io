const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/prism-wcO-HLEn.js","assets/excel-CUMakpxJ.js","assets/prism-54DrP_uy.css"])))=>i.map(i=>d[i]);
import{r as o,j as r}from"./vendor-CRMzTT1s.js";import{P as re,G as ae,B as b,S as I,a1 as ne,a2 as se,a3 as oe,a4 as q,a as Y,a5 as le,a6 as ie,Y as ce,n as X,a7 as de,a8 as ue,a9 as he,aa as pe,ab as K,W as ge,T as A,k as me,l as fe,m as we}from"./mui-COpd2GBn.js";import"./prism-wcO-HLEn.js";import{_}from"./tree-sitter-aGyQ8e2w.js";import"./excel-CUMakpxJ.js";const Q=t=>t<10?`0${t}`:String(t);function xe(t,n){if(!(t instanceof Date)||isNaN(+t))return"";const s=t.getFullYear(),v=String(s).slice(-2),j=t.getMonth()+1,N=Q(j),h=Q(t.getDate()),g=t.getDate();return n.replace(/yyyy/g,String(s)).replace(/yy/g,v).replace(/MM/g,N).replace(/M/g,String(j)).replace(/dd/g,h).replace(/d/g,String(g))}function ye(t){if(!t)return null;if(t instanceof Date&&!isNaN(+t))return t;if(typeof t!="string")return null;let n=t.match(/^(\d{4})[.\-/](\d{1,2})[.\-/](\d{1,2})$/);if(n)return new Date(Number(n[1]),Number(n[2])-1,Number(n[3]));if(n=t.match(/^(\d{1,2})[./-](\d{1,2})[./-](\d{2}|\d{4})$/),n){let s=Number(n[3]);return s<100&&(s+=2e3),new Date(s,Number(n[1])-1,Number(n[2]))}return n=t.match(/^(\d{4})-(\d{2})-(\d{2})$/),n?new Date(Number(n[1]),Number(n[2])-1,Number(n[3])):null}function Z(t,n){return Array.isArray(t)?!n||n<=0?t:t.length>n?t.slice(0,n):t:[]}const be=t=>t.trim().toLowerCase()==="date",je=t=>{if(!t)return null;const n=t;if(typeof n?.highlightAll=="function")return n;const s=t;return typeof s.default?.highlightAll=="function"?s.default:null};function Se(){const[t,n]=o.useState({sheetNames:[],selectedSheet:void 0,rowsPreview:[],totalRows:0}),[s,v]=o.useState({useDateFormat:!0,dateNF:"yyyy-MM-dd",headerRowIndex:0,rowLimit:10}),j=o.useCallback((e,a)=>{v(l=>({...l,[e]:a}))},[]),[N,h]=o.useState(!1),[g,S]=o.useState(null),[T,L]=o.useState({open:!1,label:"",progress:0}),k=o.useRef(null),[D,P]=o.useState(!1);o.useEffect(()=>{(async()=>{try{const e=await _(()=>import("./prism-wcO-HLEn.js").then(l=>l.p),__vite__mapDeps([0,1,2])),a=je(e);if(!a)return;try{await _(()=>import("./prism-wcO-HLEn.js").then(l=>l.b),__vite__mapDeps([0,1,2]))}catch{try{await _(()=>import("./prism-wcO-HLEn.js").then(l=>l.b),__vite__mapDeps([0,1,2]))}catch{}}k.current=a,P(!0)}catch{P(!1)}})()},[]);const m=o.useRef(null),M=o.useRef([]),R=o.useRef([]),C=o.useCallback(()=>({raw:!0,cellDates:!0,defval:"",blankrows:!1,range:s.headerRowIndex>0?s.headerRowIndex:0}),[s.headerRowIndex]),f=o.useCallback(e=>{if(!Array.isArray(e)||e.length===0)return[];if(!s.useDateFormat)return e.slice();const a=s.dateNF?.trim()||"yyyy-MM-dd";return e.map(l=>{const c={};for(const i of Object.keys(l)){const d=l[i];if(be(i)){let u=null;if(d instanceof Date&&!isNaN(+d))u=d;else if(typeof d=="number"){const p=d-25569;u=new Date(p*86400*1e3)}else u=ye(d);c[i]=u?xe(u,a):d}else c[i]=d}return c})},[s.useDateFormat,s.dateNF]),w=o.useCallback(async e=>{if(!m.current)return{rowsPreview:[],totalRows:0};const a=await _(()=>import("./excel-CUMakpxJ.js").then(u=>u.x),[]),l=m.current.Sheets[e];if(!l)throw new Error(`Worksheet not found: ${e}`);const c=a.utils.sheet_to_json(l,C());M.current=c;const i=f(c);return R.current=i,{rowsPreview:Z(i,s.rowLimit),totalRows:i.length}},[f,C,s.rowLimit]),W=o.useCallback(()=>{const e=M.current||[],a=f(e);R.current=a;const l=Z(a,s.rowLimit);n(c=>({...c,rowsPreview:l,totalRows:a.length}))},[f,s.rowLimit]),V=o.useCallback(e=>{if(!D||!k.current)return;const a=k.current;requestAnimationFrame(()=>{if(e&&typeof a.highlightElement=="function"&&e.tagName==="CODE"){a.highlightElement(e);return}if(e&&typeof a.highlightAllUnder=="function"){a.highlightAllUnder(e);return}typeof a.highlightAll=="function"&&a.highlightAll()})},[D]),J=o.useCallback(async e=>{if(e){S(null),h(!0);try{const a=await _(()=>import("./excel-CUMakpxJ.js").then(x=>x.x),[]);try{await _(()=>import("./excel-CUMakpxJ.js").then(x=>x.d),[])}catch{}const l=await e.arrayBuffer(),c=a.read(l,{type:"array"});m.current=c;const i=c.SheetNames||[],d=i[0];let u=[],p=0;if(d){const x=await w(d);u=x.rowsPreview,p=x.totalRows}n({sheetNames:i,selectedSheet:d,rowsPreview:u,totalRows:p})}catch(a){S(a?.message??String(a))}finally{h(!1)}}},[w]),$=o.useCallback(async e=>{if(!(!m.current||!e)){h(!0),S(null);try{const{rowsPreview:a,totalRows:l}=await w(e);n(c=>({...c,selectedSheet:e,rowsPreview:a,totalRows:l}))}catch(a){S(a?.message??String(a))}finally{h(!1)}}},[w]);o.useEffect(()=>{!m.current||!t.selectedSheet||W()},[s.useDateFormat,s.dateNF,s.rowLimit]),o.useEffect(()=>{(async()=>{if(!(!m.current||!t.selectedSheet)){h(!0);try{const{rowsPreview:e,totalRows:a}=await w(t.selectedSheet);n(l=>({...l,rowsPreview:e,totalRows:a}))}catch(e){S(e?.message??String(e))}finally{h(!1)}}})()},[s.headerRowIndex]);const E=o.useCallback(async(e,a,l,c="JSON 다운로드 중…")=>{Array.isArray(e)||(e=[]);const i=e.length,u=`${(y=>encodeURI(y.replace(/\s+/g,"_")))(a)}${l?`_${l}`:""}_${Date.now()}.json`;L({open:!0,label:c,progress:0});const p=[];p.push(`[
`);const x=Math.max(100,Math.floor(i/100));for(let y=0;y<i;y++){const te=JSON.stringify(e[y],null,2);p.push(te),y<i-1&&p.push(`,
`),y%x===0&&(L(H=>({...H,progress:Math.floor(y/Math.max(1,i)*100)})),await new Promise(H=>setTimeout(H,0)))}p.push(`
]`);const ee=new Blob(p,{type:"application/json;charset=utf-8"}),G=URL.createObjectURL(ee),F=document.createElement("a");F.href=G,F.download=u,document.body.appendChild(F),F.click(),F.remove(),URL.revokeObjectURL(G),L({open:!1,label:"",progress:100})},[]),B=o.useCallback(async(e="excel-json")=>{await E(R.current,e,t.selectedSheet,"JSON 전체 다운로드 중…")},[E,t.selectedSheet]),z=o.useMemo(()=>JSON.stringify(t.rowsPreview??[],null,2),[t.rowsPreview]),U=o.useMemo(()=>s.rowLimit>0&&t.totalRows>s.rowLimit,[s.rowLimit,t.totalRows]);return{parsed:t,options:s,loading:N,error:g,prismReady:D,truncated:U,downloadState:T,setOptions:v,updateOption:j,handleLoadExcel:J,handleSelectSheet:$,handleDownloadAll:B,jsonPretty:z,highlightJson:V}}const O=36,Ce=()=>{const{parsed:t,options:n,updateOption:s,loading:v,error:j,prismReady:N,truncated:h,downloadState:g,handleLoadExcel:S,handleSelectSheet:T,handleDownloadAll:L,jsonPretty:k,highlightJson:D}=Se(),P=o.useId(),m=o.useId(),M=`${m}-label`,R=o.useRef(null),C=o.useRef(null);o.useEffect(()=>{!N||!C.current||requestAnimationFrame(()=>{D(C.current)})},[D,N,k]);const f=v||g.open,w=t.sheetNames.length>0,W=t.totalRows>0,V=e=>{const a=e.target.files?.[0]??null;S(a),R.current&&(R.current.value="")},J=e=>{const a=e.target.value;a&&T(a)},$=e=>{const a=Number(e.target.value);if(Number.isNaN(a))return s("rowLimit",0);s("rowLimit",Math.max(0,Math.floor(a)))},E=e=>{const a=Number(e.target.value);if(Number.isNaN(a)||a<0)return s("headerRowIndex",0);s("headerRowIndex",Math.floor(a))},B=e=>{s("useDateFormat",e.target.checked)},z=e=>{s("dateNF",e.target.value)},U=()=>{L("excel-json")};return r.jsxs(re,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:785,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden"},children:[r.jsx(ae,{styles:{'pre[class*="language-"], code[class*="language-"]':{background:"transparent !important",backgroundColor:"transparent !important",textShadow:"none !important"},'code[class*="language-"] .token.punctuation, pre[class*="language-"] .token.punctuation':{background:"transparent !important"},'code[class*="language-"] .token.operator, pre[class*="language-"] .token.operator':{background:"transparent !important"}}}),r.jsxs(b,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1.5,bgcolor:"background.paper",overflow:"hidden"},children:[r.jsx(b,{sx:{p:1.25},children:r.jsxs(I,{direction:"row",spacing:1.25,sx:{"& .ctrl":{height:O},"& .MuiInputBase-root.MuiOutlinedInput-root":{height:O}},children:[r.jsxs(ne,{size:"small",sx:{minWidth:200,flexShrink:0},disabled:!w||f,children:[r.jsx(se,{id:M,children:"시트 선택"}),r.jsxs(oe,{labelId:M,id:m,value:t.selectedSheet??"",label:"시트 선택",onChange:J,children:[!w&&r.jsx(q,{value:"",disabled:!0,children:"업로드된 시트 없음"}),t.sheetNames.map(e=>r.jsx(q,{value:e,children:e},e))]})]}),r.jsxs(b,{children:[r.jsx("input",{ref:R,id:P,type:"file",accept:".xlsx,.xls,.csv",hidden:!0,onChange:V}),r.jsx("label",{htmlFor:P,children:r.jsx(Y,{className:"ctrl",component:"span",variant:"contained",startIcon:r.jsx(le,{}),size:"small",disabled:f,sx:{minWidth:130},children:"엑셀 업로드"})})]}),r.jsx(b,{sx:{flexGrow:1}}),r.jsx(Y,{className:"ctrl",onClick:U,variant:"outlined",color:"primary",size:"small",startIcon:r.jsx(ie,{}),disabled:f||!W,sx:{minWidth:180,alignSelf:"auto"},children:"JSON 다운로드"})]})}),r.jsx(ce,{sx:{borderColor:"divider"}}),r.jsxs(b,{sx:{p:1.25},children:[r.jsxs(I,{direction:"row",spacing:1.25,alignItems:{md:"center"},sx:{"& .ctrl":{height:O},"& .MuiInputBase-root.MuiOutlinedInput-root":{height:O}},children:[r.jsxs(I,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",children:[r.jsx(X,{className:"ctrl",label:"미리보기 행 제한",size:"small",type:"number",value:n.rowLimit,onChange:$,inputProps:{min:0},sx:{width:200}}),r.jsx(de,{title:r.jsxs("span",{children:["0으로 지정하면 모든 행을 표시합니다.",r.jsx("br",{}),"대용량인 경우 1000~5000 사이를 권장합니다."]}),arrow:!0,children:r.jsx(ue,{fontSize:"small",sx:{color:"text.secondary"}})})]}),r.jsx(X,{className:"ctrl",label:"헤더 시작 행",size:"small",type:"number",value:n.headerRowIndex,onChange:E,inputProps:{min:0},sx:{width:180},disabled:!w}),r.jsxs(I,{direction:"row",spacing:1.25,alignItems:"center",flexWrap:"wrap",children:[r.jsx(he,{control:r.jsx(pe,{checked:n.useDateFormat,onChange:B}),label:"날짜 포맷"}),n.useDateFormat&&r.jsx(X,{className:"ctrl",label:"일자 형식",size:"small",value:n.dateNF,onChange:z,disabled:!n.useDateFormat,placeholder:"예: yyyy-MM-dd",sx:{minWidth:220}})]})]}),f&&r.jsx(K,{sx:{mt:2}}),j&&r.jsx(ge,{severity:"error",variant:"outlined",sx:{mt:2},children:j})]})]}),r.jsxs(b,{sx:{p:1.25,border:"1px solid",borderColor:"divider",borderRadius:1.5,bgcolor:"background.paper",display:"flex",flexDirection:"column",gap:1,flex:1,minHeight:0},children:[r.jsx(I,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",sx:{mb:.5},children:r.jsxs(I,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",children:[r.jsxs(A,{variant:"subtitle2",children:["JSON 미리보기",t.selectedSheet?` (${t.selectedSheet})`:""]}),r.jsxs(A,{variant:"body2",color:"text.secondary",children:[t.rowsPreview.length," / ",t.totalRows," 행"]}),h&&r.jsxs(A,{variant:"caption",color:"text.secondary",children:["(미리보기는 ",n.rowLimit,"행까지만 표시)"]})]})}),r.jsx(b,{sx:{flex:1,minHeight:100,border:"1px solid",borderColor:"divider",borderRadius:1,overflow:"hidden",bgcolor:"background.default",height:"calc(100dvh - 550px)"},children:r.jsx("pre",{style:{margin:0,height:"100%",overflow:"auto",padding:16,fontFamily:'ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace',fontSize:13.5,lineHeight:1.55,whiteSpace:"pre-wrap",wordBreak:"break-word",background:"transparent",backgroundColor:"transparent"},children:r.jsx("code",{ref:C,className:"language-json",style:{whiteSpace:"inherit",background:"transparent",backgroundColor:"transparent"},children:k})})})]}),r.jsxs(me,{open:g.open,fullWidth:!0,maxWidth:"xs",children:[r.jsx(fe,{children:g.label||"다운로드 중…"}),r.jsx(we,{children:r.jsxs(b,{sx:{py:2},children:[r.jsx(K,{variant:"determinate",value:g.progress}),r.jsxs(A,{variant:"caption",sx:{display:"block",mt:1,textAlign:"right"},children:[g.progress,"%"]})]})})]})]})};export{Ce as default};
