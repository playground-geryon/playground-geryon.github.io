import{j as e,r as n}from"./vendor-CRMzTT1s.js";import{B as r,T as D,a as z,aW as Ie,a9 as he,I as ue,bM as Se,q as ae,S as x,a4 as le,a6 as de,a7 as ce,ap as Re,P as We,bR as De,bS as ze,ax as Me}from"./mui-4f8cQjky.js";import{u as $e,b as He}from"./image-puzzle-utils-rCGFpIzZ.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";const Pe=({imageSrc:a,boardWrapperRef:y,showHint:C,showBackground:k,boardWidth:g,boardHeight:N,pieces:m,placements:f,slotOutlines:M,rows:I,cols:b,pieceWidth:S,pieceHeight:$,tabSize:h,paddedWidth:R,paddedHeight:H,viewScale:i,scaledWidth:P,scaledHeight:q,onDragOver:T,onBoardDrop:U,onDropOnBoard:w,onRemovePlacement:B,onPickFile:E})=>e.jsx(r,{sx:{flex:1,minHeight:0,p:1.25,display:"flex",flexDirection:"column",gap:1.25,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"background.paper",overflow:"hidden"},children:a?e.jsxs(r,{sx:{minHeight:0,flex:1,display:"flex",flexDirection:"column",position:"relative",gap:1,minWidth:0},children:[C&&e.jsx(r,{sx:{position:"absolute",top:0,right:0,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"action.hover",overflow:"hidden",width:"10vw",boxShadow:s=>s.shadows[2],zIndex:5},children:e.jsx("img",{src:a,alt:"원본",style:{width:"100%",display:"block"}})}),e.jsx(r,{sx:{flex:1,minHeight:0,position:"relative",width:"100%",maxWidth:"100%"},children:e.jsx(r,{ref:y,onDragOver:T,onDrop:U,sx:{position:"absolute",inset:0,borderRadius:1,borderColor:"divider",overflow:"auto",boxSizing:"border-box",display:"flex",alignItems:"flex-start",justifyContent:"flex-start",width:"100%",maxWidth:"100%",height:"100%",maxHeight:"100%"},children:e.jsx(r,{sx:{width:P,height:q,position:"relative",flex:"0 0 auto",maxWidth:"none",maxHeight:"none",margin:"auto"},children:e.jsxs(r,{sx:{position:"absolute",top:"50%",left:"50%",width:g,height:N,borderRadius:1,border:"1px dashed",borderColor:"divider",overflow:"hidden",backgroundColor:"action.hover",transform:`translate(-50%, -50%) scale(${i})`,transformOrigin:"center"},children:[k&&e.jsx(r,{sx:{position:"absolute",inset:0,backgroundImage:a?`url(${a})`:void 0,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",opacity:a?.2:1}}),e.jsx(r,{sx:{position:"absolute",inset:0,zIndex:3,pointerEvents:"none"},children:M.map(s=>{const l=!!f[s.id];return e.jsx(r,{sx:{position:"absolute",top:s.row*$-h,left:s.col*S-h,width:R,height:H,opacity:l?0:1,transition:"opacity 0.2s ease"},children:e.jsx("svg",{width:"100%",height:"100%",viewBox:`0 0 ${S+h*2} ${$+h*2}`,preserveAspectRatio:"none",children:e.jsx("g",{transform:`translate(${h}, ${h})`,children:e.jsx("path",{d:s.path,fill:"rgba(255,255,255,0.08)",stroke:"rgba(0,0,0,0.2)",strokeWidth:.6})})})},`outline-${s.id}`)})}),e.jsx(r,{sx:{position:"absolute",inset:0,zIndex:2,pointerEvents:"none"},children:m.map(s=>{const l=f[s.id];return l?e.jsx(r,{sx:{position:"absolute",top:l.row*$-h,left:l.col*S-h,width:R,height:H,pointerEvents:"none"},children:e.jsx("img",{src:s.image,alt:"완성조각",draggable:!1,style:{width:"100%",height:"100%",display:"block"}})},`placed-${s.id}`):null})}),e.jsx(r,{sx:{position:"absolute",inset:0,display:"grid",gridTemplateColumns:`repeat(${b}, 1fr)`,gridTemplateRows:`repeat(${I}, 1fr)`,zIndex:4},children:Array.from({length:I*b}).map((s,l)=>{const j=Math.floor(l/b),v=l%b,u=m.find(F=>{const A=f[F.id];return A&&A.row===j&&A.col===v});return e.jsx(r,{onDragOver:T,onDrop:w(j,v),sx:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",bgcolor:u?"rgba(255,255,255,0.05)":"transparent"},children:u&&e.jsx(he,{title:"조각 되돌리기",children:e.jsx(ue,{size:"small",sx:{position:"absolute",top:4,right:4},onClick:()=>B(u.id),children:e.jsx(Se,{fontSize:"inherit"})})})},`slot-${j}-${v}`)})})]})})})})]}):e.jsx(r,{onDragOver:T,onDrop:U,sx:{flex:1,minHeight:0,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs(r,{sx:{width:"100%",maxWidth:"100%",minHeight:360,borderRadius:1,border:"1px dashed",borderColor:"divider",bgcolor:"action.hover",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,textAlign:"center",p:1,height:"100%"},children:[e.jsx(D,{variant:"subtitle1",children:"이미지를 드래그하거나 업로드하세요."}),e.jsx(D,{variant:"body2",color:"text.secondary",children:"이 영역에 이미지를 드래그하거나 버튼을 눌러 파일을 선택하면 퍼즐이 생성됩니다."}),e.jsx(z,{startIcon:e.jsx(Ie,{}),variant:"contained",size:"small",onClick:E,children:"이미지 선택"})]})})}),Te=({rows:a,cols:y,onRowsChange:C,onColsChange:k,onShuffle:g,onReset:N,trayPieces:m,draggingId:f,onDragStart:M,onDragEnd:I})=>{const b=Array.from({length:29},(i,P)=>P+2),S=ae("(min-width: 1920px)"),h=ae("(min-width: 2560px)")?1.25:S?1.1:1,R=m.length>=36?56:m.length>=20?68:90,H=Math.round(R*h);return e.jsxs(r,{sx:{width:320,flexShrink:0,p:1.25,display:"flex",flexDirection:"column",gap:1.25,minHeight:0,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"background.paper",overflow:"hidden"},children:[e.jsxs(r,{children:[e.jsx(D,{variant:"subtitle2",gutterBottom:!0,children:"퍼즐 크기 (행 / 열)"}),e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",sx:{width:"100%"},children:[e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",sx:{flex:1,minWidth:0},children:[e.jsx(D,{variant:"body2",sx:{minWidth:20},children:"행"}),e.jsx(le,{size:"small",sx:{flex:1,minWidth:0},children:e.jsx(de,{value:a,onChange:i=>C(Number(i.target.value)),sx:{width:"100%"},children:b.map(i=>e.jsx(ce,{value:i,children:i},`rows-${i}`))})})]}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",sx:{flex:1,minWidth:0},children:[e.jsx(D,{variant:"body2",sx:{minWidth:20},children:"열"}),e.jsx(le,{size:"small",sx:{flex:1,minWidth:0},children:e.jsx(de,{value:y,onChange:i=>k(Number(i.target.value)),sx:{width:"100%"},children:b.map(i=>e.jsx(ce,{value:i,children:i},`cols-${i}`))})})]})]})]}),e.jsxs(x,{direction:"row",spacing:1,children:[e.jsx(z,{fullWidth:!0,startIcon:e.jsx(Re,{}),onClick:g,children:"퍼즐 섞기"}),e.jsx(z,{fullWidth:!0,variant:"outlined",onClick:N,children:"초기화"})]}),e.jsx(r,{sx:{flex:1,minHeight:0},children:e.jsx(r,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,p:1,minHeight:160,maxHeight:"calc(100vh - 370px)",overflowY:"auto",display:"grid",gridTemplateColumns:`repeat(auto-fill, minmax(${H}px, 1fr))`,gap:1},children:m.length===0?e.jsx(D,{variant:"caption",color:"text.secondary",children:"남은 조각이 없습니다."}):m.map(i=>e.jsx(r,{draggable:!0,onDragStart:M(i.id),onDragEnd:I,sx:{border:"1px solid",borderColor:f===i.id?"primary.main":"divider",borderRadius:1,p:.5,bgcolor:"background.paper",cursor:"grab"},children:e.jsx("img",{src:i.image,alt:"조각",style:{width:"100%",display:"block"}})},i.id))})})]})},Ve=()=>{const{imageSrc:a,rows:y,cols:C,pieces:k,board:g,placements:N,trayPieces:m,draggingId:f,solved:M,handleFileInput:I,setRows:b,setCols:S,shufflePieces:$,resetPlacements:h,placePiece:R,removePlacement:H,startDrag:i,endDrag:P,acknowledgeSolved:q}=$e(),[T,U]=n.useState(!0),[w,B]=n.useState(!1),[E,s]=n.useState(null),l=n.useRef(null),j=n.useRef(null),v=n.useRef(null),[u,F]=n.useState(1),[A,oe]=n.useState(1),[te,Q]=n.useState("fit");n.useEffect(()=>{U(!0),B(!1),s(null),Q("fit"),oe(1)},[a]),n.useEffect(()=>{if(!M)return;const t=setTimeout(()=>{alert("축하합니다! 퍼즐을 모두 맞췄어요."),q()},200);return()=>clearTimeout(t)},[M,q]);const O=g?.width??400,V=g?.height??400,X=g?.pieceWidth??O/Math.max(1,C),Y=g?.pieceHeight??V/Math.max(1,y),ne=g?.tabSize??0,ie=g?.paddedWidth??X,re=g?.paddedHeight??Y,xe=O*u,ge=V*u,Z=.25,G=5,pe=n.useCallback(t=>o=>{o.dataTransfer.setData("text/plain",t);const c=Math.round(ie*u),p=Math.round(re*u),L=o.currentTarget.querySelector("img");if(L&&c>0&&p>0){const d=document.createElement("div");d.style.position="fixed",d.style.top="-9999px",d.style.left="-9999px",d.style.width=`${c}px`,d.style.height=`${p}px`,d.style.pointerEvents="none";const W=document.createElement("canvas"),_=window.devicePixelRatio||1;W.width=Math.round(c*_),W.height=Math.round(p*_),W.style.width=`${c}px`,W.style.height=`${p}px`;const ee=W.getContext("2d");ee&&(ee.imageSmoothingEnabled=!0,_!==1&&ee.scale(_,_),ee.drawImage(L,0,0,c,p)),d.appendChild(W),document.body.appendChild(d),o.dataTransfer.setDragImage(W,c/2,p/2),v.current=d}i(t)},[re,ie,i,u]),me=n.useCallback(()=>{P(),v.current&&(v.current.remove(),v.current=null)},[P]),fe=n.useCallback(t=>{t.preventDefault()},[]),be=n.useCallback((t,o)=>c=>{c.preventDefault();const p=c.dataTransfer.getData("text/plain")||f;p&&R(p,t,o)},[f,R]),se=n.useCallback(t=>{t&&I(t)},[I]),we=n.useCallback(t=>{t.preventDefault();const o=t.dataTransfer?.files?.[0];se(o)},[se]),J=n.useRef(null),je=n.useCallback(()=>{Q("original"),F(1)},[]),ve=n.useCallback(()=>{Q("fit"),F(A||1)},[A]),ye=n.useCallback((t,o)=>{const c=Array.isArray(o)?o[0]:o;Q("custom"),F(c)},[]),Ce=n.useCallback(()=>{if(w){B(!1),s(null);return}B(!0),s(5)},[w]),ke=n.useMemo(()=>k.map(t=>({id:t.id,row:t.row,col:t.col,path:He(X,Y,ne,t)})),[k,X,Y,ne]),K=n.useCallback(()=>{if(!j.current||!O||!V)return;const{clientWidth:t,clientHeight:o}=j.current;if(!t||!o)return;const c=t/O,p=o/V,L=Math.min(c,p),d=Math.min(Math.max(L,Z),G);!Number.isFinite(d)||d<=0||(oe(d),te==="fit"&&F(d))},[O,V,te,Z,G]);return n.useEffect(()=>{K()},[K]),n.useEffect(()=>{if(typeof ResizeObserver>"u")return;const t=j.current;if(!t)return;const o=new ResizeObserver(()=>K());return o.observe(t),()=>o.disconnect()},[K]),n.useEffect(()=>{if(!w||E===null){l.current&&(window.clearInterval(l.current),l.current=null);return}return l.current=window.setInterval(()=>{s(t=>t===null?null:t<=1?(B(!1),null):t-1)},1e3),()=>{l.current&&(window.clearInterval(l.current),l.current=null)}},[w,E]),e.jsx(We,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:785,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden",boxSizing:"border-box"},children:e.jsxs(x,{spacing:1,sx:{height:"100%",minHeight:600,minWidth:0},children:[e.jsxs(x,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(x,{direction:"row",spacing:1,alignItems:"center",sx:{width:320},children:e.jsx(z,{fullWidth:!0,variant:"contained",startIcon:e.jsx(De,{}),onClick:()=>J.current?.click(),children:"이미지 선택"})}),e.jsxs(x,{direction:"row",spacing:1.5,alignItems:"center",justifyContent:"center",sx:{flex:1},children:[e.jsx(he,{title:"화면에 맞추기",children:e.jsx("span",{children:e.jsx(ue,{size:"small",color:te==="fit"?"primary":"default",onClick:ve,disabled:!a,children:e.jsx(ze,{fontSize:"small"})})})}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:240},children:[e.jsx(D,{variant:"caption",color:"text.secondary",sx:{minWidth:44,textAlign:"center"},children:`${Math.round(u*100)}%`}),e.jsx(Me,{size:"small",min:Z,max:G,step:.01,value:Math.min(Math.max(u,Z),G),onChange:ye,disabled:!a}),e.jsx(z,{size:"small",variant:"outlined",onClick:je,disabled:!a,children:"100%"})]})]}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",sx:{minWidth:200,justifyContent:"flex-end"},children:[e.jsx(z,{variant:"outlined",onClick:()=>U(t=>!t),disabled:!a,children:T?"힌트 숨기기":"힌트 보기"}),e.jsx(z,{variant:"outlined",onClick:Ce,disabled:!a,children:w?`배경 숨기기${E?` (${E})`:""}`:"배경 보이기"})]})]}),e.jsxs(x,{direction:"row",spacing:0,sx:{flex:1,minHeight:0,minWidth:0,alignItems:"stretch",gap:1},children:[e.jsx("input",{ref:J,hidden:!0,type:"file",accept:"image/*",onChange:t=>{se(t.target.files?.[0]),t.target.value=""}}),e.jsx(Te,{onPickFile:()=>J.current?.click(),rows:y,cols:C,onRowsChange:b,onColsChange:S,hasImage:!!a,onShuffle:$,onReset:h,trayPieces:m,draggingId:f,onDragStart:pe,onDragEnd:me}),e.jsx(x,{spacing:1,sx:{flex:1,minWidth:0},children:e.jsx(Pe,{imageSrc:a,boardWrapperRef:j,showHint:T,showBackground:w,boardWidth:O,boardHeight:V,pieces:k,placements:N,slotOutlines:ke,rows:y,cols:C,pieceWidth:X,pieceHeight:Y,tabSize:ne,paddedWidth:ie,paddedHeight:re,viewScale:u,scaledWidth:xe,scaledHeight:ge,onDragOver:fe,onBoardDrop:we,onDropOnBoard:be,onRemovePlacement:H,onPickFile:()=>J.current?.click()})})]})]})})};export{Ve as default};
