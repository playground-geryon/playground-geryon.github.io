import{r}from"./vendor-CRMzTT1s.js";const A=600,H=320,Q=(e,t,o)=>Math.min(Math.max(e,t),o),R=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():Math.random().toString(36).slice(2,10),F=e=>new Promise((t,o)=>{const n=new Image;n.onload=()=>t(n),n.onerror=o,n.src=e}),z=(e,t)=>{const o=Array.from({length:e},()=>Array.from({length:t},()=>[0,0,0,0]));for(let n=0;n<e;n+=1)for(let s=0;s<t;s+=1){const d=n===0?0:o[n-1][s][2]*-1,l=s===0?0:o[n][s-1][1]*-1,a=s===t-1?0:Math.random()>.5?1:-1,u=n===e-1?0:Math.random()>.5?1:-1;o[n][s]=[d,a,u,l]}return o},_=(e,t,o,n,s)=>{const d=n;if(e.beginPath(),e.moveTo(0,0),e.lineTo(t/3,0),s.top!==0){const a=-s.top*d;e.quadraticCurveTo(t/2,a,2*t/3,0)}else e.lineTo(2*t/3,0);if(e.lineTo(t,0),e.lineTo(t,o/3),s.right!==0){const a=s.right*d;e.quadraticCurveTo(t+a,o/2,t,2*o/3)}else e.lineTo(t,2*o/3);if(e.lineTo(t,o),e.lineTo(2*t/3,o),s.bottom!==0){const a=s.bottom*d;e.quadraticCurveTo(t/2,o+a,t/3,o)}else e.lineTo(t/3,o);if(e.lineTo(0,o),e.lineTo(0,2*o/3),s.left!==0){const a=-s.left*d;e.quadraticCurveTo(a,o/2,0,o/3)}else e.lineTo(0,o/3);e.closePath()},j=async(e,t,o)=>{const n=await F(e),s=Q(n.width,H,A),d=n.height/n.width,l=s,a=Math.round(l*d),u=l/o,f=a/t,$=Math.min(u,f)*.2,y=u+$*2,b=f+$*2,p=document.createElement("canvas");p.width=l,p.height=a;const T=p.getContext("2d");T?.drawImage(n,0,0,l,a);const I=z(t,o),L=[];for(let C=0;C<t;C+=1)for(let P=0;P<o;P+=1){const[k,D,E,W]=I[C][P],v=document.createElement("canvas");v.width=y,v.height=b;const m=v.getContext("2d");!m||!T||(m.translate($,$),_(m,u,f,$,{top:k,right:D,bottom:E,left:W}),m.save(),m.clip(),m.drawImage(p,-P*u,-C*f,l,a),m.restore(),m.strokeStyle="rgba(0,0,0,0.25)",m.lineWidth=1,m.stroke(),L.push({id:R(),row:C,col:P,top:k,right:D,bottom:E,left:W,image:v.toDataURL()}))}return{pieces:L,metrics:{width:l,height:a,pieceWidth:u,pieceHeight:f,tabSize:$,paddedWidth:y,paddedHeight:b}}},J=()=>{const[e,t]=r.useState(null),[o,n]=r.useState(null),[s,d]=r.useState(3),[l,a]=r.useState(4),[u,f]=r.useState([]),[$,y]=r.useState(null),[b,p]=r.useState({}),[T,I]=r.useState(null),[L,M]=r.useState(!1),C=r.useMemo(()=>u.filter(c=>!b[c.id]),[u,b]),P=r.useCallback(c=>{if(!c.type.startsWith("image/")){t("이미지 파일만 업로드할 수 있습니다.");return}const i=new FileReader;i.onload=()=>{typeof i.result=="string"&&(n(i.result),t(null))},i.onerror=()=>t("파일을 읽을 수 없습니다."),i.readAsDataURL(c)},[]);r.useEffect(()=>{let c=!1;return(async()=>{if(!o){f([]),y(null),p({});return}const{pieces:g,metrics:S}=await j(o,s,l);c||(f(g.sort(()=>Math.random()-.5)),p({}),y(S))})(),()=>{c=!0}},[o,s,l]),r.useEffect(()=>{if(!u.length){M(!1);return}const c=u.length>0&&u.every(i=>{const g=b[i.id];return g&&g.row===i.row&&g.col===i.col});M(c)},[u,b]);const k=r.useCallback(()=>{p({}),f(c=>[...c].sort(()=>Math.random()-.5))},[]),D=r.useCallback(()=>{p({})},[]),E=r.useCallback((c,i,g)=>{const S=u.find(U=>U.id===c);return!S||S.row!==i||S.col!==g?!1:(p(U=>({...U,[c]:{row:i,col:g}})),!0)},[u]),W=r.useCallback(c=>{p(i=>({...i,[c]:null}))},[]),v=r.useCallback(c=>{I(c)},[]),m=r.useCallback(()=>{I(null)},[]),q=r.useCallback(()=>{M(!1)},[]);return{fileError:e,imageSrc:o,rows:s,cols:l,pieces:u,board:$,placements:b,trayPieces:C,draggingId:T,solved:L,handleFileInput:P,setRows:d,setCols:a,shufflePieces:k,resetPlacements:D,placePiece:E,removePlacement:W,startDrag:v,endDrag:m,acknowledgeSolved:q}},N=(e,t,o,n)=>{const s=[],d=e/3,l=t/3;if(s.push("M 0 0"),s.push(`L ${d} 0`),n.top!==0){const a=-n.top*o;s.push(`Q ${e/2} ${a} ${2*e/3} 0`)}else s.push(`L ${2*e/3} 0`);if(s.push(`L ${e} 0`),s.push(`L ${e} ${l}`),n.right!==0){const a=n.right*o;s.push(`Q ${e+a} ${t/2} ${e} ${2*t/3}`)}else s.push(`L ${e} ${2*t/3}`);if(s.push(`L ${e} ${t}`),s.push(`L ${2*e/3} ${t}`),n.bottom!==0){const a=n.bottom*o;s.push(`Q ${e/2} ${t+a} ${e/3} ${t}`)}else s.push(`L ${e/3} ${t}`);if(s.push(`L 0 ${t}`),s.push(`L 0 ${2*t/3}`),n.left!==0){const a=-n.left*o;s.push(`Q ${a} ${t/2} 0 ${t/3}`)}else s.push(`L 0 ${t/3}`);return s.push("Z"),s.join(" ")};export{N as b,J as u};
