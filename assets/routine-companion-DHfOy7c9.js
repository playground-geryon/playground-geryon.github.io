import{_ as St}from"./monaco-BZh3GCvz.js";import{j as e,r as u,F as dn}from"./vendor-BHnfqNCc.js";import{S as b,B as $,C as mt,T as f,ak as Y,an as J,I as Se,bK as En,n as te,bL as ps,x as Ot,y as Ze,Y as et,bM as un,bJ as mn,al as hn,a as W,X as Tn,b4 as An,bx as Nt,a6 as ht,aM as _n,bN as pe,bw as zt,L as fn,Z as xn,b as js,d as gn,bO as bs,ab as Xe,bm as ys,bn as ws,f as Ms,bo as vs,aa as $n,p as Ds,P as ks,k as Ct,l as It,m as Et,o as Tt,a4 as Rs,ao as pn,a9 as Re,ap as Le,ae as Ss,af as Cs}from"./mui-DWpzSE2I.js";import"./excel-CUMakpxJ.js";const jn=({value:n,total:i,label:l,detail:a,accent:p})=>{const g=i>0?Math.min(100,Math.round(n/i*100)):0;return e.jsxs(b,{alignItems:"center",spacing:1,sx:{minWidth:140},children:[e.jsxs($,{sx:{position:"relative",display:"inline-flex",width:120,height:120},children:[e.jsx(mt,{variant:"determinate",value:100,size:120,thickness:4.5,sx:{color:"rgba(148,163,184,0.25)"}}),e.jsx(mt,{variant:"determinate",value:g,size:120,thickness:4.5,sx:{position:"absolute",left:0,top:0,color:p}}),e.jsxs($,{sx:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:.5},children:[e.jsx(f,{fontSize:24,fontWeight:700,children:i?`${g}%`:"---"}),e.jsx(f,{variant:"caption",color:"text.secondary",children:l})]})]}),e.jsx(f,{variant:"body2",color:"text.secondary",textAlign:"center",children:a})]})},bn=({percent:n})=>{const i=Math.max(0,Math.min(100,n)),l=`${Math.round(i)}%`;return e.jsxs($,{sx:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",width:52,height:52},children:[e.jsx(mt,{variant:"determinate",value:100,size:48,thickness:5,sx:{color:i>=100?"#2563eb":"#f87171",position:"absolute",left:0,top:0}}),e.jsx(mt,{variant:"determinate",value:i,size:48,thickness:5,sx:{color:"#2563eb",position:"absolute",left:0,top:0}}),e.jsx(f,{variant:"caption",component:"div",sx:{position:"absolute",fontWeight:600,color:"text.primary",textAlign:"center",lineHeight:1.1},children:l})]})},yn={light:{pageBg:"#f5f6fb",cardBg:"#ffffff",softText:"#6b7280",divider:"rgba(15,23,42,0.08)",accent:"#2563eb",accentGradient:"linear-gradient(90deg,#3b82f6,#2563eb)"},dark:{pageBg:"#0f172a",cardBg:"#17233f",softText:"#cbd5f5",divider:"rgba(148,163,184,0.25)",accent:"#60a5fa",accentGradient:"linear-gradient(90deg,#60a5fa,#2563eb)"}},wn={light:{accent:"rgba(37,99,235,0.45)",accentLow:"rgba(37,99,235,0.15)",pending:"rgba(248,113,113,0.35)",pendingLow:"rgba(248,113,113,0.12)"},dark:{accent:"rgba(96,165,250,0.45)",accentLow:"rgba(96,165,250,0.18)",pending:"rgba(239,68,68,0.4)",pendingLow:"rgba(239,68,68,0.18)"}},Mn=(n,i)=>{const l=Math.max(0,Math.min(100,n));return`linear-gradient(90deg, ${i.accentLow} 0%, ${i.accent} ${l}%, ${i.pending} ${l}%, ${i.pendingLow} 100%)`},Is=({summaryDateKey:n,onSummaryDateChange:i,onSummaryDateShift:l,summaryData:a,theme:p,todayRoutineTab:g,onTodayRoutineTabChange:T,routineLists:P,viewRecords:k,routineTimers:C,isViewingToday:_,isPastSummaryDate:H,summaryDate:ue,goalsById:re,openNoteEditor:me,toggleRoutineTimer:L,toggleTimeRoutine:ne,toggleDurationRoutine:O,getRoutineTargetMinutes:K,parseTimeToMinutes:j,rowProgressPalette:A,nowMinutesOfDay:se,formatDurationText:he,getStatusColor:ie,isRoutineActiveOnDate:je})=>e.jsxs(b,{spacing:2,sx:{width:"600px"},children:[e.jsx(Y,{variant:"outlined",sx:{borderRadius:2,width:"100%"},children:e.jsxs(J,{children:[e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",flexWrap:"wrap",rowGap:1,children:[e.jsx(Se,{color:"primary",onClick:()=>l(-1),size:"small",children:e.jsx(En,{fontSize:"small"})}),e.jsx(te,{type:"date",value:n,onChange:v=>i(v.target.value),InputProps:{sx:{textAlign:"center","& input":{textAlign:"center",fontWeight:600}}},sx:{width:160,"& .MuiOutlinedInput-root":{borderRadius:999,minHeight:40}}}),e.jsx(Se,{color:"primary",onClick:()=>l(1),size:"small",children:e.jsx(ps,{fontSize:"small"})})]}),e.jsxs(b,{direction:"row",spacing:3,mt:3,justifyContent:"center",flexWrap:"wrap",rowGap:3,children:[e.jsx(jn,{value:a.completed,total:a.total,label:"루틴 달성",detail:a.total?`달성 ${a.completed}개 · 미달성 ${a.missed}개`:"해당 일자에 루틴이 없습니다.",accent:p.accent}),e.jsx(jn,{value:Math.min(a.durationMinutes,a.durationTargets||0),total:a.durationTargets||0,label:"지속시간 기록",detail:a.durationTargets?`기록 ${a.durationMinutes}분 · 목표 ${a.durationTargets}분`:"지속시간 루틴 목표가 없습니다.",accent:"#10b981"})]})]})}),e.jsxs(Y,{variant:"outlined",sx:{borderRadius:2,width:"100%"},children:[e.jsxs(Ot,{value:g,onChange:(v,I)=>T(I),variant:"fullWidth",children:[e.jsx(Ze,{value:"time",label:"고정시간 루틴"}),e.jsx(Ze,{value:"duration",label:"지속시간 루틴"})]}),e.jsx(et,{}),e.jsxs(J,{children:[g==="time"&&e.jsxs(e.Fragment,{children:[!P.time.length&&e.jsx(f,{variant:"body2",color:p.softText,children:"고정시간 루틴이 없습니다."}),e.jsx(b,{spacing:2,children:P.time.map(v=>{const I=k[v.id],Q=I?.note?.trim(),le=C[v.id],B=I?.minutes??0,S=j(v.time?.to),x=re[v.goalId],y=je(v,ue,x),D=_&&y?le:void 0,q=D&&D.running&&D.startedAt?D.accumulatedMs+(Date.now()-D.startedAt):D?.accumulatedMs??0,V=(D?.committedMinutes??B)*6e4,fe=Math.max(0,q-V),ge=B*6e4+fe,N=K(v)*6e4,Oe=N?N-ge:0,Ye=Math.max(0,Oe),U=!!D?.running,ve=N?Math.min(100,ge/N*100):0,Ae=!!D,be=I?.done?100:ve;let Z="대기";I?.done?Z="달성":I?.missed||H&&y&&!_?Z="미달성":_&&y&&(U?Z="진행중":Ae||B>0?Z="일시중지":S&&se>S&&(Z="미달성"));const ye=ie(Z),_e=Z==="미달성"||Z==="달성"||!y||!_,$e=N?he(Ye):"---",ce=I?.done?"달성 취소":"달성",tt=Z==="미달성"||!y||!_,E=Mn(be,A);return e.jsx($,{sx:{p:1.5,borderRadius:2,backgroundImage:E,backgroundColor:A.pendingLow},children:e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:{sm:"center"},justifyContent:"space-between",children:[e.jsxs(b,{direction:"row",spacing:2,alignItems:"flex-start",flex:1,children:[e.jsx(bn,{percent:be}),e.jsxs(b,{spacing:.25,flex:1,children:[e.jsxs(f,{fontWeight:700,sx:{lineHeight:1.25},children:[v.title,!y&&e.jsx(f,{component:"span",variant:"caption",color:p.softText,ml:1,children:"해당 일자 제외"})]}),e.jsxs(f,{variant:"body2",color:p.softText,children:["남음 ",$e]})]})]}),e.jsxs(b,{spacing:.5,alignItems:{xs:"flex-start",sm:"flex-end"},children:[e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[e.jsxs(f,{fontWeight:600,children:[v.time?.from??"--"," ~ ",v.time?.to??"--"]}),e.jsx(f,{variant:"body2",color:ye,fontWeight:600,children:Z}),e.jsx(Se,{size:"small",onClick:()=>me(v.id),children:e.jsx(un,{color:Q?"primary":"inherit",fontSize:"small"})})]}),e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Se,{size:"small",color:U?"secondary":"primary",onClick:()=>L(v),disabled:_e,"aria-label":U?"중지":"시작",children:U?e.jsx(mn,{fontSize:"small"}):e.jsx(hn,{fontSize:"small"})}),e.jsx(W,{variant:I?.done?"outlined":"contained",color:I?.done?"success":"primary",size:"small",onClick:()=>ne(v,!I?.done),disabled:tt,children:ce})]})]})]})},v.id)})})]}),g==="duration"&&e.jsxs(e.Fragment,{children:[!P.duration.length&&e.jsx(f,{variant:"body2",color:p.softText,children:"지속시간 루틴이 없습니다."}),e.jsx(b,{spacing:2,children:P.duration.map(v=>{const I=k[v.id],Q=I?.minutes??0,B=(v.duration?.targetMinutes??0)*6e4,S=C[v.id],x=re[v.goalId],y=je(v,ue,x),D=_&&y?S:void 0,q=D&&D.running&&D.startedAt?D.accumulatedMs+(Date.now()-D.startedAt):D?.accumulatedMs??0,V=(D?.committedMinutes??Q)*6e4,fe=Math.max(0,q-V),ge=Q*6e4+fe,Pe=B?Math.max(0,B-ge):0,N=!!D?.running,Oe=!!D,Ye=I?.note?.trim();let U="대기";I?.done||B>0&&ge>=B?U="달성":I?.missed||H&&y&&!_?U="미달성":_&&y&&(N?U="진행중":(Oe||Q>0)&&(U="일시중지"));const ve=ie(U),Ae=U==="달성"||U==="미달성"||!y||!_,be=I?.done?"달성 취소":"달성",Z=B?Math.min(100,ge/B*100):0,ye=I?.done?100:Z,_e=B?he(Pe):"---",$e=U==="미달성"||!y||!_,ce=Mn(ye,A);return e.jsx($,{sx:{p:1.5,borderRadius:2,backgroundImage:ce,backgroundColor:A.pendingLow},children:e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:1,alignItems:{sm:"center"},justifyContent:"space-between",children:[e.jsxs(b,{direction:"row",spacing:2,alignItems:"flex-start",flex:1,children:[e.jsx(bn,{percent:ye}),e.jsxs(b,{spacing:.25,flex:1,children:[e.jsx(f,{fontWeight:700,sx:{lineHeight:1.25},children:v.title}),e.jsxs(f,{variant:"body2",color:p.softText,children:["남음 ",_e]})]})]}),e.jsxs(b,{spacing:.5,alignItems:{xs:"flex-start",sm:"flex-end"},children:[e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(f,{variant:"body2",color:ve,fontWeight:600,children:U}),e.jsx(Se,{size:"small",onClick:()=>me(v.id),children:e.jsx(un,{color:Ye?"primary":"inherit",fontSize:"small"})})]}),e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Se,{size:"small",color:N?"secondary":"primary",onClick:()=>L(v),disabled:Ae,"aria-label":N?"중지":"시작",children:N?e.jsx(mn,{fontSize:"small"}):e.jsx(hn,{fontSize:"small"})}),e.jsx(W,{variant:I?.done?"outlined":"contained",color:I?.done?"success":"primary",size:"small",onClick:()=>O(v,!I?.done),disabled:$e,children:be})]})]})]})},v.id)})})]})]})]})]}),Es=[{label:"확인",value:"today"},{label:"관리",value:"manage"},{label:"통계",value:"stats"},{label:"설정",value:"settings"}],Yt=["일","월","화","수","목","금","토"],At=n=>{const i=n.repeat?.mode??"everyday";if(i==="everyday")return"매일";if(i==="weekday")return"평일";if(i==="weekend")return"주말";if(i==="custom"){const l=n.repeat.days?.map(a=>Yt[a])??[];return l.length?l.join(", "):"선택 요일"}return"매일"},Ts=({routine:n,onDelete:i,onEdit:l,canEdit:a,themeSoftText:p})=>e.jsx(Y,{variant:"outlined",sx:{borderRadius:2},children:e.jsx(J,{children:e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:2,children:[e.jsxs($,{children:[e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Tn,{label:n.type==="time"?"고정시간":"지속시간",size:"small"}),e.jsx(f,{fontWeight:600,children:n.title})]}),e.jsx(f,{variant:"body2",color:p,children:n.type==="time"&&n.time?`${n.time.from} ~ ${n.time.to}, ${At(n)}`:n.type==="duration"&&n.duration?`하루 ${n.duration.targetMinutes}분, ${At(n)}`:At(n)})]}),e.jsxs(b,{direction:"row",spacing:1,children:[e.jsx(W,{variant:"outlined",size:"small",startIcon:e.jsx(An,{}),onClick:l,disabled:!a,title:a?void 0:"기록이 있는 루틴은 수정할 수 없습니다.",children:"수정"}),e.jsx(W,{variant:"outlined",color:"error",size:"small",startIcon:e.jsx(Nt,{}),onClick:()=>i(n.id),children:"삭제"})]})]})})}),As=({theme:n,activeGoals:i,archivedGoals:l,selectedGoal:a,selectedGoalId:p,onSelectGoal:g,onAddGoalClick:T,onGoalEdit:P,onGoalDelete:k,onGoalUnarchive:C,onArchivedGoalDelete:_,goalRoutines:H,goalRoutineLists:ue,routineListTab:re,onRoutineListTabChange:me,canRoutineBeEdited:L,onRoutineEdit:ne,onRoutineDelete:O,onAddRoutineClick:K,downloadingTemplate:j,downloadingData:A,importingData:se,onDownloadTemplate:he,onDownloadData:ie,onImportClick:je,formatDateDisplay:v})=>{const[I,Q]=u.useState(a?"detail":"list");u.useEffect(()=>{Q(a?"detail":"list")},[a]);const le=S=>{g(S),Q("detail")},B=()=>{g(null),Q("list")};return e.jsxs(b,{spacing:2,sx:{width:"600px"},children:[e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:1.5,justifyContent:"flex-end",children:[e.jsx(W,{variant:"outlined",startIcon:e.jsx(ht,{}),onClick:he,disabled:j,children:j?"템플릿 준비 중...":"엑셀 템플릿"}),e.jsx(W,{variant:"outlined",startIcon:e.jsx(ht,{}),onClick:ie,disabled:A,children:A?"다운로드 중...":"데이터 다운로드"}),e.jsx(W,{variant:"contained",startIcon:e.jsx(_n,{}),onClick:je,disabled:se,children:se?"불러오는 중...":"데이터 불러오기"})]}),I==="list"&&e.jsxs(b,{spacing:2,sx:{width:"100%"},children:[e.jsxs(Y,{sx:{backgroundColor:n.cardBg},children:[e.jsx(pe,{title:"목표",action:e.jsx(W,{variant:"outlined",size:"small",startIcon:e.jsx(zt,{}),onClick:T,children:"추가"})}),e.jsxs(J,{children:[!i.length&&e.jsx(f,{variant:"body2",color:n.softText,textAlign:"center",children:"목표를 추가해 시작하세요."}),!!i.length&&e.jsx(fn,{children:i.map(S=>e.jsx(xn,{disableGutters:!0,secondaryAction:e.jsxs(b,{direction:"row",spacing:.5,children:[e.jsx(Se,{size:"small",onClick:()=>P(S),children:e.jsx(An,{fontSize:"inherit"})}),e.jsx(Se,{size:"small",color:"error",onClick:()=>k(S),children:e.jsx(Nt,{fontSize:"inherit"})})]}),sx:{borderRadius:2,mb:1},children:e.jsx(js,{selected:S.id===p,onClick:()=>le(S.id),sx:{borderRadius:2},children:e.jsx(gn,{primary:S.title,secondary:S.description,primaryTypographyProps:{fontWeight:S.id===p?600:500}})})},S.id))})]})]}),l.length>0&&e.jsxs(Y,{variant:"outlined",sx:{borderRadius:2},children:[e.jsx(pe,{title:"아카이브된 목표"}),e.jsx(J,{children:e.jsx(fn,{children:l.map(S=>e.jsx(xn,{disableGutters:!0,secondaryAction:e.jsxs(b,{direction:"row",spacing:.5,children:[e.jsx(W,{size:"small",startIcon:e.jsx(bs,{}),onClick:()=>C(S.id),children:"복원"}),e.jsx(W,{size:"small",color:"error",startIcon:e.jsx(Nt,{}),onClick:()=>_(S.id),children:"삭제"})]}),sx:{borderRadius:2,mb:1},children:e.jsx(gn,{primary:S.title,secondary:S.description})},S.id))})})]})]}),I==="detail"&&a&&e.jsxs(b,{spacing:2,sx:{width:"100%"},children:[e.jsx(Y,{variant:"outlined",sx:{borderRadius:2},children:e.jsxs(J,{children:[e.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(W,{variant:"text",startIcon:e.jsx(En,{fontSize:"small"}),onClick:B,children:"목록"}),e.jsx(f,{fontWeight:600,children:a.title})]}),e.jsx(f,{variant:"body2",color:n.softText,mt:.5,ml:{xs:0,sm:6},children:a.description||"목표 설명이 없습니다."}),e.jsxs(f,{variant:"body2",color:n.softText,mt:1,ml:{xs:0,sm:6},children:["기간: ",v(a.startDate)," ~ ",v(a.endDate)]})]})}),e.jsxs(Y,{variant:"outlined",sx:{borderRadius:2},children:[e.jsx(pe,{title:"루틴 설정",subheader:"목표에 연결된 루틴을 관리하세요.",action:e.jsx(W,{variant:"contained",startIcon:e.jsx(zt,{}),onClick:K,children:"루틴 추가"})}),e.jsx(et,{}),e.jsxs(J,{children:[!H.length&&e.jsx(f,{color:n.softText,children:"등록된 루틴이 없습니다."}),!!H.length&&e.jsxs($,{children:[e.jsxs(Ot,{value:re,onChange:(S,x)=>me(x),children:[e.jsx(Ze,{value:"time",label:"고정시간 루틴"}),e.jsx(Ze,{value:"duration",label:"지속시간 루틴"})]}),e.jsx(et,{sx:{my:2}}),e.jsxs(b,{spacing:1.5,children:[!ue[re].length&&e.jsx(f,{color:n.softText,children:re==="time"?"고정시간 루틴이 없습니다.":"지속시간 루틴이 없습니다."}),ue[re].map(S=>e.jsx(Ts,{routine:S,canEdit:L(S.id),onEdit:()=>ne(S),onDelete:O,themeSoftText:n.softText},S.id))]})]})]})]})]})]})},_s=({theme:n,isDesktop:i,activeGoals:l,overallStats:a,goalStatsById:p,formatMinutesLabel:g})=>e.jsxs(b,{spacing:2,sx:{width:"600px"},children:[!l.length&&e.jsx(Y,{variant:"outlined",sx:{borderRadius:2},children:e.jsxs(J,{children:[e.jsx(f,{variant:"h6",children:"통계를 확인하려면 목표를 추가해 주세요."}),e.jsx(f,{variant:"body2",color:n.softText,mt:1,children:"최소 한 개의 목표와 루틴이 있어야 전체 여정을 분석할 수 있습니다."})]})}),!!l.length&&e.jsxs(e.Fragment,{children:[a&&e.jsxs(Y,{variant:"outlined",sx:{borderRadius:2},children:[e.jsx(pe,{title:"전체 루틴 요약",subheader:`활성 목표 ${a.goalCount}개 · 루틴 ${a.routineCount}개`}),e.jsxs(J,{children:[e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsxs($,{flex:1,children:[e.jsx(f,{variant:"subtitle2",color:n.softText,children:"전체 기대 노력"}),e.jsx(f,{variant:"h4",children:g(a.expectedMinutes)})]}),e.jsxs($,{flex:1,children:[e.jsx(f,{variant:"subtitle2",color:n.softText,children:"실제 수행량"}),e.jsx(f,{variant:"h4",children:g(a.actualMinutes)})]}),e.jsxs($,{flex:1,children:[e.jsx(f,{variant:"subtitle2",color:n.softText,children:"평균 달성률"}),e.jsxs(f,{variant:"h4",children:[a.completionRate,"%"]})]})]}),e.jsx(Xe,{variant:"determinate",value:a.completionRate,sx:{mt:3,height:12,borderRadius:6}})]})]}),l.map((T,P)=>{const k=p[T.id];return k?e.jsxs(ys,{disableGutters:!0,defaultExpanded:P===0,sx:{borderRadius:2,border:"1px solid",borderColor:"divider",backgroundColor:n.cardBg,mb:2,"&:before":{display:"none"}},children:[e.jsx(ws,{expandIcon:e.jsx(Ms,{}),sx:{px:2,py:1.5},children:e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:1.5,justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},width:"100%",children:[e.jsxs($,{children:[e.jsx(f,{variant:"h6",fontWeight:700,children:T.title}),e.jsxs(f,{variant:"body2",color:n.softText,children:[k.startLabel," ~ ",k.endLabel," · ",k.weekdaysLabel," · 루틴 ",k.routineCount,"개"]}),e.jsxs(f,{variant:"caption",color:n.softText,children:["총 ",k.periodDays,"일 기준"]})]}),e.jsxs($,{textAlign:i?"right":"left",children:[e.jsx(f,{variant:"subtitle2",color:n.softText,children:"달성률"}),e.jsxs(f,{variant:"h5",fontWeight:700,children:[k.completionRate,"%"]})]})]})}),e.jsx(vs,{sx:{p:0},children:e.jsxs(b,{spacing:2,sx:{p:2},children:[e.jsxs(Y,{variant:"outlined",sx:{borderRadius:2},children:[e.jsx(pe,{title:"목표 전체 요약",subheader:"기대 노력 대비 실제 노력"}),e.jsxs(J,{children:[e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsxs($,{flex:1,children:[e.jsx(f,{variant:"subtitle2",color:n.softText,children:"전체 기대 노력"}),e.jsx(f,{variant:"h4",children:g(k.expectedMinutes)})]}),e.jsxs($,{flex:1,children:[e.jsx(f,{variant:"subtitle2",color:n.softText,children:"실제 수행량"}),e.jsx(f,{variant:"h4",children:g(k.actualMinutes)})]}),e.jsxs($,{flex:1,children:[e.jsx(f,{variant:"subtitle2",color:n.softText,children:"달성률"}),e.jsxs(f,{variant:"h4",children:[k.completionRate,"%"]})]})]}),e.jsx(Xe,{variant:"determinate",value:k.completionRate,sx:{mt:3,height:12,borderRadius:6}})]})]}),e.jsxs(Y,{variant:"outlined",sx:{borderRadius:2},children:[e.jsx(pe,{title:"성장 여정 (Goal Journey)"}),e.jsx(J,{children:k.journey.total>0?e.jsxs(e.Fragment,{children:[e.jsxs(f,{variant:"body2",color:n.softText,mb:1,children:[k.journey.current.toLocaleString("ko-KR"),"m / ",k.journey.total.toLocaleString("ko-KR"),"m 여정"]}),e.jsx(Xe,{variant:"determinate",value:k.journey.percent,sx:{height:16,borderRadius:8,backgroundColor:"rgba(99,102,241,0.12)","& .MuiLinearProgress-bar":{borderRadius:8,backgroundImage:n.accentGradient}}}),e.jsxs(f,{variant:"body2",mt:2,children:["지금 여정의 ",k.journey.percent,"% 지점에 도달했습니다."]})]}):e.jsx(f,{variant:"body2",color:n.softText,children:"루틴 목표 시간이 없어 여정을 계산할 수 없습니다. 루틴에 목표 시간을 설정해 주세요."})})]}),e.jsxs(Y,{variant:"outlined",sx:{borderRadius:2},children:[e.jsx(pe,{title:"루틴별 성취도"}),e.jsxs(J,{children:[!k.routines.length&&e.jsx(f,{variant:"body2",color:n.softText,children:"루틴을 등록하면 기대 노력 대비 성취도를 확인할 수 있습니다."}),e.jsx(b,{spacing:2,children:k.routines.map(C=>e.jsxs($,{sx:{p:2,border:"1px solid",borderColor:"divider",borderRadius:2,backgroundColor:n.cardBg},children:[e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(f,{fontWeight:600,children:C.title}),e.jsx(Tn,{label:C.type==="time"?"고정시간":"지속시간",size:"small",color:C.type==="time"?"primary":"success",variant:"outlined"})]}),e.jsxs(f,{variant:"body2",color:n.softText,mt:.5,children:["기대 ",g(C.expectedMinutes)," · 실제 ",g(C.actualMinutes)]}),e.jsx(Xe,{variant:"determinate",value:C.rate,sx:{mt:2,borderRadius:4,height:8}}),e.jsxs(f,{variant:"caption",color:n.softText,display:"block",mt:.5,children:["달성률 ",C.rate,"%"]})]},C.id))})]})]}),e.jsxs(Y,{variant:"outlined",sx:{borderRadius:2},children:[e.jsx(pe,{title:"주차별 수행 변화"}),e.jsxs(J,{children:[!k.weeklyTrend.length&&e.jsx(f,{variant:"body2",color:n.softText,children:"아직 집계할 기록이 없습니다. 오늘의 루틴을 완료해 첫 변화를 확인해 보세요."}),e.jsx(b,{spacing:2,children:k.weeklyTrend.map(C=>e.jsxs($,{children:[e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(f,{fontWeight:600,children:C.label}),e.jsxs(f,{variant:"caption",color:n.softText,children:["기대 ",g(C.expected)," · 실제 ",g(C.actual)]})]}),e.jsx(Xe,{variant:"determinate",value:Math.min(100,C.rate),sx:{mt:1,borderRadius:4,height:8}})]},C.label))})]})]}),e.jsxs(Y,{variant:"outlined",sx:{borderRadius:2},children:[e.jsx(pe,{title:"통찰"}),e.jsx(J,{children:e.jsx(f,{children:k.insight})})]})]})})]},T.id):null})]})]}),$s=({theme:n,darkMode:i,onToggleDarkMode:l})=>e.jsx(b,{spacing:2,sx:{width:"600px"},children:e.jsx(Y,{variant:"outlined",sx:{borderRadius:2,width:"100%"},children:e.jsx(J,{children:e.jsxs(b,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs($,{children:[e.jsx(f,{fontWeight:600,children:"테마"}),e.jsx(f,{variant:"body2",color:n.softText,children:"라이트/다크 모드 전환"})]}),e.jsx($n,{checked:i,onChange:a=>l(a.target.checked)})]})})})}),Bs="routine_companion_db",Ie="kv",Ws=1;let lt=null;const Ht=()=>typeof window>"u"||!("indexedDB"in window)?Promise.resolve(null):lt||(lt=new Promise((n,i)=>{const l=window.indexedDB.open(Bs,Ws);l.onupgradeneeded=()=>{const a=l.result;a.objectStoreNames.contains(Ie)||a.createObjectStore(Ie)},l.onsuccess=()=>{n(l.result)},l.onerror=()=>{i(l.error??new Error("Failed to open IndexedDB"))}}).catch(n=>(console.error("Failed to open IndexedDB",n),null)),lt),ct=async n=>{const i=await Ht();return i?new Promise((l,a)=>{const T=i.transaction(Ie,"readonly").objectStore(Ie).get(n);T.onsuccess=()=>l(T.result??null),T.onerror=()=>a(T.error??new Error("IndexedDB read failed"))}).catch(l=>(console.error("Failed to read IndexedDB value",l),null)):null},Ls=async(n,i)=>{const l=await Ht();l&&await new Promise((a,p)=>{const P=l.transaction(Ie,"readwrite").objectStore(Ie).put(i,n);P.onsuccess=()=>a(),P.onerror=()=>p(P.error??new Error("IndexedDB write failed"))}).catch(a=>{console.error("Failed to persist IndexedDB value",a)})},Gs=async n=>{const i=await Ht();i&&await new Promise((l,a)=>{const T=i.transaction(Ie,"readwrite").objectStore(Ie).delete(n);T.onsuccess=()=>l(),T.onerror=()=>a(T.error??new Error("IndexedDB delete failed"))}).catch(l=>{console.error("Failed to delete IndexedDB value",l)})},_t="routine_app_goals",$t="routine_app_routines",Bt="routine_app_records",vn="routine_app_theme",Qe="routine_app_timers",Ns="9999-12-31",Dn=()=>({title:"",description:"",startDate:"",endDate:""}),kn=()=>({type:"time",goalId:"",title:"",category:"",repeatMode:"everyday",customDays:[],timeFrom:"07:00",timeTo:"07:30",targetMinutes:30,notificationEnabled:!1,notificationAt:"",notificationLeadMinutes:10}),Wt={inputMode:"numeric",pattern:"[0-9]{2}:[0-9]{2}",maxLength:5},Te=n=>{const i=n.getFullYear(),l=String(n.getMonth()+1).padStart(2,"0"),a=String(n.getDate()).padStart(2,"0");return`${i}-${l}-${a}`},Ge=n=>{const[i,l,a]=n.split("-").map(Number);return new Date(i,(l||1)-1,a||1)},zs=(n,i)=>{const l=n.repeat?.mode??"everyday",a=i.getDay();return l==="everyday"?!0:l==="weekday"?a>=1&&a<=5:l==="weekend"?a===0||a===6:l==="custom"?(n.repeat.days??[]).includes(a):!0},ze=n=>String(n).padStart(2,"0"),Fs=(n,i,l)=>{if(!(!n||!i||!l)&&!(i<1||i>12||l<1||l>31))return`${n}-${ze(i)}-${ze(l)}`},Ps=/(\d{4})\s*(?:년)?\s*(?:[-./]|\s)*(\d{1,2})\s*(?:월)?\s*(?:[-./]|\s)*(\d{1,2})\s*(?:일)?/g,Ft=n=>{const i=[];if(!n)return i;for(const l of n.matchAll(Ps)){const[,a,p,g]=l,T=Fs(Number(a),Number(p),Number(g));T&&i.push(T)}return i},Os=/^\d{4}-\d{2}-\d{2}$/,Fe=n=>{if(!n)return null;const i=n.trim();if(!i)return null;if(Os.test(i))return Ge(i);const l=new Date(i);if(!Number.isNaN(l.getTime()))return new Date(l.getFullYear(),l.getMonth(),l.getDate());const a=Ft(i)[0];return a?Ge(a):null},Lt=n=>{const i=Fe(n);return i?Te(i):null},Ys=(n,i)=>{const l=Ft(n),a=Ft(i);let p=l[0],g=a[0];return!p&&a.length&&(p=a[0],g=a[1]),!g&&l.length>1&&(g=l[1]),{startDate:p,endDate:g}},Hs=n=>`${n}-arch-${Date.now().toString(36)}`,dt=n=>{if(typeof window>"u")return null;try{const i=window.localStorage.getItem(n);return i?JSON.parse(i):null}catch(i){return console.error("Failed to parse localStorage value",i),null}},Rn=(n,i)=>{if(!n||n.dayKey!==i||!n.timers)return{};const l={};return Object.entries(n.timers).forEach(([a,p])=>{p&&(l[a]={running:!!p.running,startedAt:typeof p.startedAt=="number"?p.startedAt:null,accumulatedMs:typeof p.accumulatedMs=="number"?p.accumulatedMs:0,committedMinutes:typeof p.committedMinutes=="number"?p.committedMinutes:0,targetMinutes:typeof p.targetMinutes=="number"?p.targetMinutes:0})}),l},ut=(n,i)=>{if(typeof window<"u")try{window.localStorage.setItem(n,JSON.stringify(i))}catch(l){console.error("Failed to persist localStorage value",l)}Ls(n,i).catch(l=>{console.error("Failed to persist IndexedDB value",l)})},Sn=n=>{if(typeof window<"u")try{window.localStorage.removeItem(n)}catch(i){console.error("Failed to remove localStorage value",i)}Gs(n).catch(i=>{console.error("Failed to remove IndexedDB value",i)})},Pt=n=>{if(!n)return"미정";const i=Fe(n);return i?`${i.getFullYear()}-${ze(i.getMonth()+1)}-${ze(i.getDate())}`:n},Ks=(n,i)=>{if(!n)return!0;const l=Fe(n.startDate);if(l&&i<l)return!1;const a=Fe(n.endDate);return!(a&&i>a)},Ne=(n,i,l)=>Ks(l,i)&&zs(n,i),Ce=n=>{if(!n)return 0;const[i,l]=n.split(":").map(Number);return Number.isNaN(i)||Number.isNaN(l)?0:i*60+l},qs=n=>{if(!n.time?.from||!n.time?.to)return 0;const i=Ce(n.time.from);let a=Ce(n.time.to)-i;return a<0&&(a+=1440),Math.max(a,0)},Ee=n=>n.type==="duration"?n.duration?.targetMinutes??0:qs(n),Gt=(n,i)=>(n.time?.from??"00:00").localeCompare(i.time?.from??"00:00"),Cn=(n,i)=>{if(i<n)return[];const l=[],a=new Date(n);for(;a<=i;)l.push(new Date(a.getFullYear(),a.getMonth(),a.getDate())),a.setDate(a.getDate()+1);return l},Us=n=>{const i=new Date(n),l=i.getDay()||7;return i.setDate(i.getDate()-(l-1)),new Date(i.getFullYear(),i.getMonth(),i.getDate())},Js=n=>{const i=new Date(n);return i.setDate(n.getDate()+6),`${n.getMonth()+1}/${String(n.getDate()).padStart(2,"0")}~${i.getMonth()+1}/${String(i.getDate()).padStart(2,"0")}`},Vs=n=>`${n.getFullYear()}.${String(n.getMonth()+1).padStart(2,"0")}.${String(n.getDate()).padStart(2,"0")}`,Xs=n=>`${n.toLocaleString("ko-KR")}분`,In=(n,i)=>i?n.type==="duration"?i.minutes??0:i.minutes&&i.minutes>0?i.minutes:i.done?Ee(n):0:0,Qs=(n,i,l,a)=>{const p=Fe(n.startDate),g=Fe(n.endDate),P=Object.keys(l).filter(x=>{const y=l[x];return y?i.some(R=>!!y[R.id]):!1}).map(x=>Ge(x)).sort((x,y)=>x.getTime()-y.getTime())[0],k=p??P??a,C=g??a,_=C<k?k:C,H=g&&g<a?g:a,ue=H&&H>=k?H:null,re=Cn(k,_),me=ue?Cn(k,ue):[],L=new Set;i.forEach(x=>{const y=x.repeat?.mode??"everyday";if(y==="everyday")for(let R=0;R<7;R+=1)L.add(R);else if(y==="weekday")for(let R=1;R<=5;R+=1)L.add(R);else y==="weekend"?(L.add(0),L.add(6)):y==="custom"&&x.repeat.days?.forEach(R=>L.add(R))});let ne="미지정";L.size===7?ne="매일":L.size===5&&[1,2,3,4,5].every(x=>L.has(x))?ne="평일":L.size===2&&L.has(0)&&L.has(6)?ne="주말":L.size&&(ne=Array.from(L).sort((y,R)=>y-R).map(y=>Yt[y]).join(", "));let O=0,K=0;const j=i.map(x=>{const y=Ee(x);let R=0;re.forEach(V=>{Ne(x,V,n)&&(R+=y)});let D=0;me.forEach(V=>{if(!Ne(x,V,n))return;const fe=l[Te(V)]?.[x.id];D+=In(x,fe)}),O+=R,K+=D;const q=R?Math.min(100,Math.round(D/R*100)):0;return{id:x.id,title:x.title,type:x.type,expectedMinutes:R,actualMinutes:D,targetMinutes:y,rate:q}}),A=O?Math.min(100,Math.round(K/O*100)):0,se=Math.round(O/10),he=Math.round(K/10),ie=se>0?Math.min(se,he):he,je=me.map(x=>{const y=Te(x);let R=0,D=0;return i.forEach(q=>{if(!Ne(q,x,n))return;const V=Ee(q);R+=V;const fe=l[y]?.[q.id];D+=In(q,fe)}),{date:x,expected:R,actual:D}}),v=new Map;je.forEach(({date:x,expected:y,actual:R})=>{const D=Us(x),q=Te(D);v.has(q)||v.set(q,{start:D,expected:0,actual:0});const V=v.get(q);V.expected+=y,V.actual+=R});const I=Array.from(v.values()).sort((x,y)=>x.start.getTime()-y.start.getTime()).map(x=>({label:Js(x.start),expected:x.expected,actual:x.actual,rate:x.expected?Math.round(x.actual/x.expected*100):0})),Q=j.filter(x=>x.expectedMinutes>0);let le="루틴 데이터를 입력해 여정을 시작해 보세요.";if(j.length&&Q.length){const x=Q.reduce((R,D)=>D.rate>R.rate?D:R),y=Q.reduce((R,D)=>D.rate<R.rate?D:R);x.rate>=80?le=`${x.title} 루틴이 가장 안정적으로 이어지고 있어요.`:y.rate<50?le=`${y.title} 루틴의 시간이 기대보다 적어요. 이번 주 조금 더 집중해 볼까요?`:le="모든 루틴이 고르게 진행 중입니다. 지금 페이스를 유지해 보세요."}else j.length||(le="루틴을 추가해 첫 통계를 만들어 보세요.");const B=n.startDate?Pt(n.startDate):Vs(k),S=n.endDate?Pt(n.endDate):"진행중";return{startLabel:B,endLabel:S,weekdaysLabel:ne,routineCount:i.length,expectedMinutes:O,actualMinutes:K,completionRate:A,journey:{total:se,current:ie,percent:A},periodDays:re.length,routines:j,weeklyTrend:I,insight:le}},Zs=n=>{const i=Math.max(0,Math.floor(n/1e3)),l=Math.floor(i/60),a=i%60;return l===0?`${a}초`:a===0?`${l}분`:`${l}분 ${a}초`},ii=()=>{const n=Ds("(min-width:960px)"),[i,l]=u.useState(()=>dt(_t)??[]),[a,p]=u.useState(()=>dt($t)??[]),[g,T]=u.useState(()=>dt(Bt)??{}),P=u.useRef(g),k=u.useRef(null),[C,_]=u.useState(null),[H,ue]=u.useState("today"),[re,me]=u.useState(!1),[L,ne]=u.useState(!1),[O,K]=u.useState(()=>Dn()),[j,A]=u.useState(()=>kn()),[se,he]=u.useState(null),[ie,je]=u.useState(null),[v,I]=u.useState("time"),[Q,le]=u.useState("time"),[B,S]=u.useState(()=>typeof window>"u"?!1:window.localStorage.getItem(vn)==="dark"),[x,y]=u.useState(()=>Rn(dt(Qe),Te(new Date))),[,R]=u.useState(0),[D,q]=u.useState(!1),[V,fe]=u.useState(""),[ge,Pe]=u.useState(null),[N,Oe]=u.useState(()=>new Date),[Ye,U]=u.useState(()=>new Date),[ve,Ae]=u.useState(!1),[be,Z]=u.useState(!1),[ye,_e]=u.useState(!1),$e=u.useRef(null),[ce,tt]=u.useState(!1),E=Te(new Date),He=u.useMemo(()=>Ge(E),[E]),Ke=Te(Ye),nt=u.useMemo(()=>Ge(Ke),[Ke]),Bn=Ke===E,st=nt<He,qe=u.useMemo(()=>Object.fromEntries(i.map(t=>[t.id,t])),[i]),Wn=N.getHours()*60+N.getMinutes();u.useEffect(()=>{if(typeof window>"u"){tt(!0);return}let t=!1;return(async()=>{try{const[o,r,c,m]=await Promise.all([ct(_t),ct($t),ct(Bt),ct(Qe)]);if(t)return;o&&l(o),r&&p(r),c&&T(c),m&&y(Rn(m,E))}catch(o){console.error("Failed to load stored routine data",o)}finally{t||tt(!0)}})(),()=>{t=!0}},[E]),u.useEffect(()=>{ce&&ut(_t,i)},[i,ce]),u.useEffect(()=>{ce&&ut($t,a)},[a,ce]),u.useEffect(()=>{ce&&ut(Bt,g)},[g,ce]),u.useEffect(()=>{P.current=g},[g]),u.useEffect(()=>{k.current=null},[E]),u.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(vn,B?"dark":"light")},[B]);const Kt=u.useRef(!1);u.useEffect(()=>{if(!Kt.current){Kt.current=!0;return}y({}),Sn(Qe)},[E]),u.useEffect(()=>{if(!ce)return;const t=Object.entries(x);if(!t.length){Sn(Qe);return}const s=Object.fromEntries(t.map(([r,c])=>[r,{running:c.running,startedAt:c.startedAt,accumulatedMs:c.accumulatedMs,committedMinutes:c.committedMinutes,targetMinutes:c.targetMinutes}])),o={dayKey:E,savedAt:Date.now(),timers:s};ut(Qe,o)},[x,E,ce]);const oe=u.useMemo(()=>i.filter(t=>!t.isArchived),[i]),Ln=u.useMemo(()=>i.filter(t=>t.isArchived),[i]);u.useEffect(()=>{if(!oe.length){_(null);return}C&&!oe.some(t=>t.id===C)&&_(oe[0].id)},[oe,C]),u.useEffect(()=>{if(!i.length&&a.length){const t={id:`goal-${Date.now().toString(36)}`,title:"나의 목표"};l([t]),p(s=>s.map(o=>({...o,goalId:t.id}))),_(t.id)}},[i.length,a]),u.useEffect(()=>{const t=window.setInterval(()=>Oe(new Date),6e4);return()=>window.clearInterval(t)},[]);const we=oe.find(t=>t.id===C)??null,Be=u.useMemo(()=>we?a.filter(t=>t.goalId===we.id):[],[a,we]),Gn=u.useMemo(()=>({time:Be.filter(t=>t.type==="time").sort(Gt),duration:Be.filter(t=>t.type==="duration").sort((t,s)=>t.title.localeCompare(s.title))}),[Be]),Ue=u.useMemo(()=>a.filter(t=>Ne(t,nt,qe[t.goalId])),[a,nt,qe]),Nn=u.useMemo(()=>({time:Ue.filter(t=>t.type==="time").sort(Gt),duration:Ue.filter(t=>t.type==="duration").sort((t,s)=>t.title.localeCompare(s.title))}),[Ue]),qt=u.useMemo(()=>Object.values(x).some(t=>t.running),[x]),ft=u.useMemo(()=>{const t=a.filter(w=>Ne(w,He,qe[w.goalId])),s=t.filter(w=>w.type==="time").sort(Gt),o=t.filter(w=>w.type==="duration");let r=0,c=0,m=0,d=0;return t.forEach(w=>{const h=g[E]?.[w.id];if(w.type==="time")h?.done?r+=1:h?.missed&&(c+=1);else{const z=h?.minutes??0,X=w.duration?.targetMinutes??0;m+=z,d+=X,h?.done||X>0&&z>=X?r+=1:h?.missed&&(c+=1)}}),{todaysRoutines:t,timeRoutines:s,durationRoutines:o,completed:r,missed:c,durationMinutes:m,durationTargets:d}},[a,g,He,E,qe]),xt=g[Ke]??{},zn=u.useMemo(()=>{const t=Ue;let s=0,o=0,r=0,c=0;return t.forEach(m=>{const d=xt[m.id];if(m.type==="time")d?.done?s+=1:(d?.missed||!d&&st)&&(o+=1);else{const w=d?.minutes??0,h=m.duration?.targetMinutes??0;r+=w,c+=h,d?.done||h>0&&w>=h?s+=1:(d?.missed||!d&&st)&&(o+=1)}}),{total:t.length,completed:s,missed:o,durationMinutes:r,durationTargets:c}},[Ue,xt,st]),gt=u.useMemo(()=>{const t=a.reduce((o,r)=>(o[r.goalId]||(o[r.goalId]=[]),o[r.goalId].push(r),o),{}),s={};return oe.forEach(o=>{const r=t[o.id]??[];s[o.id]=Qs(o,r,g,He)}),s},[oe,g,a,He]),Fn=u.useMemo(()=>{const t=oe.map(m=>gt[m.id]).filter(m=>!!m);if(!t.length)return null;const s=t.reduce((m,d)=>m+d.expectedMinutes,0),o=t.reduce((m,d)=>m+d.actualMinutes,0),r=s?Math.min(100,Math.round(o/s*100)):0,c=t.reduce((m,d)=>m+d.routineCount,0);return{expectedMinutes:s,actualMinutes:o,completionRate:r,goalCount:t.length,routineCount:c}},[oe,gt]),de=u.useCallback((t,s)=>{T(o=>{const r={...o};return r[E]||(r[E]={}),r[E]={...r[E],[t]:s(r[E]?.[t])},r})},[E]),Me=u.useCallback(t=>{y(s=>{if(!s[t])return s;const o={...s};return delete o[t],o})},[]);u.useEffect(()=>{if(!ft.timeRoutines.length)return;const t=N.getHours()*60+N.getMinutes();ft.timeRoutines.forEach(s=>{const o=Ce(s.time?.to);if(!o)return;const r=g[E]?.[s.id];r?.done||r?.missed||t>o&&(de(s.id,c=>({...c,missed:!0})),Me(s.id))})},[N,ft.timeRoutines,g,E,de,Me]),u.useEffect(()=>{if(k.current===E)return;const t=N.getHours(),s=N.getMinutes();t!==23||s<59||(k.current=E,Be.forEach(o=>{if(o.type!=="duration")return;const r=g[E]?.[o.id];if(r?.done||r?.missed)return;const c=o.duration?.targetMinutes??0;if(!c)return;(r?.minutes??0)<c&&(de(o.id,d=>({...d,missed:!0})),Me(o.id))}))},[N,Be,g,E,de,Me]);const Pn=(t,s)=>{const o=t.id,r=Ee(t);de(o,c=>({...c,done:s,minutes:s?r?Math.max(r,c?.minutes??0):c?.minutes??0:0,unresolvedSeconds:s?0:c?.unresolvedSeconds,missed:s?!1:c?.missed})),s&&Me(o)},On=(t,s)=>{const o=t.id,r=t.duration?.targetMinutes??0;de(o,c=>({...c,done:s,minutes:s&&r?Math.max(r,c?.minutes??0):c?.minutes??0,missed:s?!1:c?.missed})),s&&Me(o)},Je=u.useCallback((t,s,o)=>{s<=0||de(t,r=>{const m=(r?.minutes??0)+s,d=o?m>=o:!1,w=o?o*60:0,h=w?Math.max(0,w-m*60):void 0;return{...r,minutes:m,done:r?.done||d,unresolvedSeconds:h,missed:d?!1:r?.missed}})},[de]),Yn=(t,s)=>{de(t,o=>({...o,note:s}))},Hn=t=>{const s=g[E]?.[t]?.note??"";fe(s),Pe(t),q(!0)},pt=()=>{q(!1),Pe(null),fe("")},Kn=()=>{if(!ge)return;const t=V.trim();Yn(ge,t),pt()},qn=t=>{const s=t.id,o=Ee(t),r=P.current[E]?.[s];y(c=>{const m=c[s];if(m?.running){const h=Date.now(),z=m.startedAt?m.accumulatedMs+(h-m.startedAt):m.accumulatedMs,X=Math.floor(z/6e4);if(t.type==="duration"){const ee=m.committedMinutes??r?.minutes??0,xe=X-ee;xe>0&&Je(s,xe,o)}else de(s,ee=>{const xe=Math.max(ee?.minutes??0,X),We=o>0?xe>=o:!!ee?.done;return{...ee,minutes:xe,done:We,missed:We?!1:ee?.missed}});return{...c,[s]:{...m,running:!1,startedAt:null,accumulatedMs:z,committedMinutes:X}}}const d=r?.minutes??0,w=d*6e4;return{...c,[s]:{running:!0,startedAt:Date.now(),accumulatedMs:m?.accumulatedMs??w,committedMinutes:m?.committedMinutes??d,targetMinutes:o}}})};u.useEffect(()=>{if(!Object.keys(x).length)return;const t=Date.now(),s={};let o=!1;Object.entries(x).forEach(([r,c])=>{if(!c.running||!c.startedAt)return;const m=c.accumulatedMs+(t-c.startedAt),d=Math.floor(m/6e4);if(d<=c.committedMinutes)return;const w=d-c.committedMinutes,h=a.find(z=>z.id===r);if(h){if(h.type==="duration")Je(r,w,h.duration?.targetMinutes);else{const z=Ee(h);de(r,X=>{const ee=Math.max(X?.minutes??0,d),xe=z>0?ee>=z:!!X?.done;return{...X,minutes:ee,done:xe,missed:xe?!1:X?.missed}})}s[r]={...c,committedMinutes:d,accumulatedMs:m},o=!0}}),o&&y(r=>({...r,...s}))},[Je,x,a,de]),u.useEffect(()=>{if(!qt)return;const t=window.setInterval(()=>{R(s=>s+1),y(s=>{const o=Date.now();let r=!1;const c={...s};return Object.entries(s).forEach(([m,d])=>{if(!d.running||!d.startedAt)return;const w=d.accumulatedMs+(o-d.startedAt),h=Math.floor(w/6e4);if(h>d.committedMinutes){const z=h-d.committedMinutes,X=P.current[E]?.[m]?.minutes??0;Je(m,z,d.targetMinutes),d.targetMinutes>0&&X+z>=d.targetMinutes?delete c[m]:c[m]={...d,committedMinutes:h},r=!0}}),r?c:s})},1e3);return()=>window.clearInterval(t)},[Je,qt,E]);const Ut=u.useCallback(t=>t?!!(t.done||(t.minutes??0)>0||(t.unresolvedSeconds??0)>0||t.note?.trim()):!1,[]),Jt=u.useCallback(t=>!Object.values(g).some(s=>Ut(s?.[t])),[Ut,g]),jt=(t,s)=>{const o=kn();A({...o,type:s??o.type,goalId:t??C??""}),je(null)},Un=t=>{if(!Jt(t.id)){window.alert("기록이 있는 루틴은 수정할 수 없습니다.");return}I(t.type),A({type:t.type,goalId:t.goalId,title:t.title,category:t.category??"",repeatMode:t.repeat.mode,customDays:t.repeat.mode==="custom"?[...t.repeat.days??[]]:[],timeFrom:t.time?.from??"07:00",timeTo:t.time?.to??"07:30",targetMinutes:t.duration?.targetMinutes??30,notificationEnabled:t.notification?.enabled??!1,notificationAt:t.notification?.at??"",notificationLeadMinutes:t.notification?.leadMinutes??10}),je(t.id),ne(!0)},bt=()=>{me(!1),he(null)},yt=()=>{ne(!1),jt(C??void 0,v)},Vt=()=>{K(Dn()),he(null),me(!0)},Jn=u.useCallback(()=>{we&&(jt(we.id,v),ne(!0))},[jt,v,we]),Vn=t=>{K({title:t.title,description:t.description??"",startDate:t.startDate??"",endDate:t.endDate??""}),he(t.id),me(!0)},Xn=t=>{t.preventDefault();const s=O.title.trim();if(!s){window.alert("목표 제목을 입력해 주세요.");return}const o=O.startDate.trim(),r=O.endDate.trim(),c=o?Lt(o):null;let m=r?Lt(r):null;if(o&&!c){window.alert("시작일 형식을 YYYY-MM-DD 또는 20240131 형태로 입력해 주세요.");return}if(r&&!m){window.alert("종료일 형식을 YYYY-MM-DD 또는 20240131 형태로 입력해 주세요.");return}r||(m=Ns);const d={id:se??`goal-${Date.now().toString(36)}`,title:s,description:O.description.trim()||void 0,startDate:c??void 0,endDate:m??void 0,isArchived:!1};se?l(w=>w.map(h=>h.id===se?d:h)):(l(w=>[...w,d]),_(d.id)),bt()},Xt=u.useCallback(t=>()=>{K(s=>{const o=s[t];if(!o)return s;const r=Lt(o);return r&&r!==o?{...s,[t]:r}:s})},[K]),Qt=u.useCallback(t=>{t.length&&(T(s=>{const o={...s};return Object.keys(o).forEach(r=>{const c={...o[r]};let m=!1;t.forEach(d=>{c[d]&&(delete c[d],m=!0)}),m&&(Object.keys(c).length?o[r]=c:delete o[r])}),o}),t.forEach(s=>Me(s)))},[Me]),wt=u.useCallback(t=>{const s=a.filter(o=>o.goalId===t).map(o=>o.id);l(o=>{const r=o.filter(c=>c.id!==t);return _(c=>c===t?r.find(d=>!d.isArchived)?.id??null:c&&!r.some(m=>m.id===c&&!m.isArchived)?r.find(d=>!d.isArchived)?.id??null:c),r}),p(o=>o.filter(r=>r.goalId!==t)),Qt(s)},[a,Qt]),Qn=u.useCallback(t=>{const s=Hs(t);l(o=>{const r=o.map(c=>c.id===t?{...c,id:s,isArchived:!0}:c);return _(c=>c===t?r.find(d=>!d.isArchived)?.id??null:c),r}),p(o=>o.map(r=>r.goalId===t?{...r,goalId:s}:r))},[]),Zn=u.useCallback(t=>{l(s=>{const o=s.map(r=>r.id===t?{...r,isArchived:!1}:r);return _(t),o})},[]),es=t=>{if(a.filter(o=>o.goalId===t.id).length>0){if(window.confirm("이 목표에는 연결된 루틴/기록이 있습니다. 확인을 누르면 아카이브로 이동하고, 취소를 누르면 완전 삭제를 계속합니다.")){Qn(t.id),window.alert("아카이브 탭에서 이 목표를 확인할 수 있습니다.");return}if(!window.confirm("정말로 목표와 연결된 모든 데이터를 삭제할까요?"))return;wt(t.id),window.alert("목표와 연결된 데이터가 삭제되었습니다.");return}window.confirm("선택한 목표를 삭제할까요?")&&wt(t.id)},ts=t=>{window.confirm("아카이브된 목표와 연결된 모든 데이터를 완전히 삭제할까요?")&&wt(t)},ns=t=>{U(s=>{const o=new Date(s);return o.setDate(s.getDate()+t),o})},ss=t=>{t&&U(Ge(t))},is=t=>{if(t.preventDefault(),!we){window.alert("목표를 먼저 선택해 주세요.");return}const s=j.title.trim();if(!s){window.alert("루틴 제목을 입력해 주세요.");return}const o=ie??`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,7)}`,r=ie?a.find(w=>w.id===ie):void 0,c=j.goalId||r?.goalId||we.id;if(!c){window.alert("루틴을 연결할 목표를 선택해 주세요.");return}if(j.type==="time"){const{timeFrom:w,timeTo:h}=j;if(!w||!h){window.alert("고정시간 루틴은 시작/종료 시간을 모두 입력해 주세요.");return}if(Ce(h)<=Ce(w)){window.alert("종료 시간은 시작 시간보다 뒤여야 합니다.");return}}const m=Math.max(0,Math.round(j.notificationLeadMinutes||0)),d={id:o,goalId:c,title:s,type:j.type,category:j.category.trim()||void 0,repeat:{mode:j.repeatMode,days:j.repeatMode==="custom"?[...j.customDays].sort((w,h)=>w-h):void 0},time:j.type==="time"?{from:j.timeFrom,to:j.timeTo}:void 0,duration:j.type==="duration"?{targetMinutes:Math.max(5,Math.round(j.targetMinutes||0))}:void 0,notification:j.type==="time"?{enabled:j.notificationEnabled,leadMinutes:m}:{enabled:j.notificationEnabled,at:j.notificationAt||void 0}};p(ie?w=>w.map(h=>h.id===ie?d:h):w=>[...w,d]),yt()},os=t=>{window.confirm("해당 루틴을 삭제할까요?")&&(p(s=>s.filter(o=>o.id!==t)),Me(t),T(s=>{const o={...s};return Object.keys(o).forEach(r=>{if(o[r]?.[t]){const{[t]:c,...m}=o[r];o[r]=m}}),o}))},Zt=async()=>{if(!ve){Ae(!0);try{const{Workbook:t}=await St(async()=>{const{Workbook:h}=await import("./excel-CUMakpxJ.js").then(z=>z.e);return{Workbook:h}},[]),s=new t;s.creator="Routine Companion",s.created=new Date;const o=s.addWorksheet("README");o.getColumn(1).width=80,o.addRow(["템플릿 사용 안내"]).font={bold:!0,size:14},o.addRow([]),o.addRow(["1. Goals 시트에서 목표를 정의하고 goal_id 값을 루틴 시트에서 사용하세요."]),o.addRow(["2. repeat_mode 는 everyday, weekday, weekend, custom 중 하나여야 합니다."]),o.addRow(["3. custom_days 는 0(일)~6(토) 까지 쉼표로 구분해 입력합니다. 예) 1,3,5"]),o.addRow(["4. type 값이 time 이면 time_from/time_to 를, duration 이면 target_minutes 를 채우세요."]),o.addRow(["5. notification_enabled 는 true/false 중 하나로 작성합니다."]);const r=s.addWorksheet("Goals");r.columns=[{header:"goal_id (필수, 고유값)",key:"id",width:24},{header:"title (필수)",key:"title",width:26},{header:"description",key:"description",width:32},{header:"start_date (YYYY-MM-DD)",key:"startDate",width:24},{header:"end_date (YYYY-MM-DD)",key:"endDate",width:24}],r.getRow(1).font={bold:!0},r.addRow({id:"goal-001",title:"건강 루틴",description:"아침 기상 루틴",startDate:"2025-01-01",endDate:"2025-12-31"});const c=s.addWorksheet("Routines");c.columns=[{header:"routine_id (비워두면 자동)",key:"id",width:26},{header:"goal_id (필수)",key:"goalId",width:20},{header:"title (필수)",key:"title",width:26},{header:"type (time/duration)",key:"type",width:20},{header:"category",key:"category",width:18},{header:"repeat_mode",key:"repeatMode",width:18},{header:"custom_days (예: 1,3,5)",key:"customDays",width:24},{header:"time_from (HH:mm)",key:"timeFrom",width:18},{header:"time_to (HH:mm)",key:"timeTo",width:18},{header:"target_minutes",key:"targetMinutes",width:18},{header:"notification_enabled (true/false)",key:"notificationEnabled",width:32},{header:"notification_at (HH:mm)",key:"notificationAt",width:22},{header:"notification_lead_minutes",key:"notificationLeadMinutes",width:28}],c.getRow(1).font={bold:!0},c.addRow({id:"",goalId:"goal-001",title:"아침 스트레칭",type:"time",category:"건강",repeatMode:"weekday",customDays:"",timeFrom:"07:00",timeTo:"07:30",targetMinutes:"",notificationEnabled:!0,notificationAt:"",notificationLeadMinutes:10}),c.addRow({id:"",goalId:"goal-001",title:"독서",type:"duration",category:"자기계발",repeatMode:"everyday",customDays:"",timeFrom:"",timeTo:"",targetMinutes:30,notificationEnabled:!0,notificationAt:"21:30",notificationLeadMinutes:""});const m=await s.xlsx.writeBuffer(),d=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=new Date().toISOString().split("T")[0];dn.saveAs(d,`routine-template-${w}.xlsx`)}catch(t){console.error(t),window.alert("엑셀 템플릿을 생성하는 중 오류가 발생했습니다.")}finally{Ae(!1)}}},en=async()=>{if(!be){Z(!0);try{const{Workbook:t}=await St(async()=>{const{Workbook:h}=await import("./excel-CUMakpxJ.js").then(z=>z.e);return{Workbook:h}},[]),s=new t;s.creator="Routine Companion",s.created=new Date;const o=s.addWorksheet("README");o.getColumn(1).width=80,o.addRow(["현재 앱에서 내려받은 목표/루틴 데이터입니다."]).font={bold:!0},o.addRow([]),o.addRow(["Goals 시트: 목표 정보를 포함합니다."]),o.addRow(["Routines 시트: 각 루틴과 연결된 목표 ID를 제공합니다."]);const r=s.addWorksheet("Goals");r.columns=[{header:"goal_id",key:"id",width:24},{header:"title",key:"title",width:30},{header:"description",key:"description",width:32},{header:"start_date",key:"startDate",width:20},{header:"end_date",key:"endDate",width:20}],r.getRow(1).font={bold:!0},i.forEach(h=>r.addRow({id:h.id,title:h.title,description:h.description??"",startDate:h.startDate??"",endDate:h.endDate??""}));const c=s.addWorksheet("Routines");c.columns=[{header:"routine_id",key:"id",width:26},{header:"goal_id",key:"goalId",width:20},{header:"title",key:"title",width:30},{header:"type (time/duration)",key:"type",width:18},{header:"category",key:"category",width:18},{header:"repeat_mode",key:"repeatMode",width:16},{header:"custom_days",key:"customDays",width:20},{header:"time_from",key:"timeFrom",width:16},{header:"time_to",key:"timeTo",width:16},{header:"target_minutes",key:"targetMinutes",width:18},{header:"notification_enabled",key:"notificationEnabled",width:24},{header:"notification_at",key:"notificationAt",width:18},{header:"notification_lead_minutes",key:"notificationLeadMinutes",width:28}],c.getRow(1).font={bold:!0},a.forEach(h=>c.addRow({id:h.id,goalId:h.goalId,title:h.title,type:h.type,category:h.category??"",repeatMode:h.repeat.mode,customDays:h.repeat.mode==="custom"?(h.repeat.days??[]).join(","):"",timeFrom:h.time?.from??"",timeTo:h.time?.to??"",targetMinutes:h.duration?.targetMinutes??"",notificationEnabled:h.notification?.enabled??!1,notificationAt:h.notification?.at??"",notificationLeadMinutes:h.notification?.leadMinutes??""}));const m=await s.xlsx.writeBuffer(),d=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=new Date().toISOString().split("T")[0];dn.saveAs(d,`routine-data-${w}.xlsx`)}catch(t){console.error(t),window.alert("데이터 다운로드 중 오류가 발생했습니다.")}finally{Z(!1)}}},tn=()=>{ye||$e.current?.click()},as=async t=>{const s=t.target.files?.[0];if(s){_e(!0);try{const{Workbook:o}=await St(async()=>{const{Workbook:M}=await import("./excel-CUMakpxJ.js").then(G=>G.e);return{Workbook:M}},[]),r=new o,c=await s.arrayBuffer();await r.xlsx.load(c);const m=r.getWorksheet("Goals");if(!m)throw new Error("Goals 시트를 찾을 수 없습니다.");const d=(M,G)=>{const ae=M.getCell(G),F=ae?.value;return F instanceof Date?`${F.getFullYear()}-${ze(F.getMonth()+1)}-${ze(F.getDate())}`:String(ae?.text??"").trim()},w=M=>{if(!M)return"";const[G,ae]=M.split(":").map(F=>Number(F));return Number.isNaN(G)||Number.isNaN(ae)||G<0||G>23||ae<0||ae>59?"":`${String(G).padStart(2,"0")}:${String(ae).padStart(2,"0")}`},h=M=>M==="weekday"||M==="weekend"||M==="custom"?M:"everyday",z=M=>M.split(",").map(G=>Number(G.trim())).filter(G=>Number.isInteger(G)&&G>=0&&G<=6),X=M=>["true","1","yes","y"].includes(M.toLowerCase()),ee=[],xe=new Set(i.map(M=>M.id)),We=new Set;m.eachRow((M,G)=>{if(G===1)return;const ae=d(M,2);if(!ae)return;let F=d(M,1)||`goal-${Date.now().toString(36)}-${G}`;for(;We.has(F);)F=`${F}-${We.size+1}`;We.add(F);const{startDate:ke,endDate:Ve}=Ys(d(M,4),d(M,5));ee.push({id:F,title:ae,description:d(M,3)||void 0,startDate:ke,endDate:Ve,isArchived:!1})});const ot=ee.filter(M=>!xe.has(M.id)),nn=ee.length-ot.length,at=new Set([...xe,...ot.map(M=>M.id)]);if(!at.size)throw new Error("목표가 없습니다. Goals 시트에 최소 1개의 목표를 입력해 주세요.");const sn=at.size===1?[...at][0]:null,ds=at,on=r.getWorksheet("Routines"),Mt=[];on&&on.eachRow((M,G)=>{if(G===1)return;const ae=d(M,3);let F=d(M,2);if(!F&&sn&&(F=sn),!ae||!F||!ds.has(F))return;const ke=d(M,4)?.toLowerCase()==="duration"?"duration":"time",Ve=h(d(M,6)),ln=Ve==="custom"?z(d(M,7)):[],kt=w(d(M,8)),Rt=w(d(M,9)),hs=Math.max(0,Math.round(Number(d(M,10))||0)),cn=X(d(M,11)),fs=w(d(M,12)),xs=Math.max(0,Math.round(Number(d(M,13))||0));if(ke==="time"&&(!kt||!Rt||Ce(Rt)<=Ce(kt)))return;const gs=d(M,1)||`${F}-${Date.now().toString(36)}-${G}`;Mt.push({id:gs,goalId:F,title:ae,type:ke,category:d(M,5)||void 0,repeat:{mode:Ve,days:Ve==="custom"&&ln.length?ln:void 0},time:ke==="time"?{from:kt,to:Rt}:void 0,duration:ke==="duration"?{targetMinutes:Math.max(5,hs||0)}:void 0,notification:ke==="time"?{enabled:cn,leadMinutes:xs}:{enabled:cn,at:fs||void 0}})});const us=new Set(a.map(M=>M.id)),vt=Mt.filter(M=>!us.has(M.id)),an=Mt.length-vt.length,Dt=[...i,...ot],ms=[...a,...vt];l(Dt),p(ms),!i.length&&Dt.length&&_(Dt[0].id);let rn=`목표 ${ot.length}개, 루틴 ${vt.length}개를 불러왔습니다.`;const rt=[];nn>0&&rt.push(`중복 목표 ${nn}개 제외`),an>0&&rt.push(`중복 루틴 ${an}개 제외`),rt.length&&(rn+=` (${rt.join(", ")})`),window.alert(rn)}catch(o){console.error(o),window.alert(o instanceof Error?o.message:"엑셀 데이터를 불러오지 못했습니다.")}finally{_e(!1),t.target.value=""}}},De=B?yn.dark:yn.light,rs=B?wn.dark:wn.light,it=oe.length>0,ls=t=>t==="달성"?"success.main":t==="미달성"?"error.main":t==="진행중"?"primary.main":De.softText;u.useEffect(()=>{!it&&H!=="manage"&&ue("manage")},[it,H]);const cs=()=>e.jsx(Y,{sx:{backgroundColor:De.cardBg,borderRadius:2,p:4},children:e.jsxs(b,{spacing:2,alignItems:"center",textAlign:"center",children:[e.jsx(f,{variant:"h6",children:"아직 목표가 없습니다"}),e.jsx(f,{color:De.softText,children:"목표를 먼저 만들고 루틴을 연결해 보세요. 목표별로 오늘 해야 할 일과 통계를 확인할 수 있습니다."}),e.jsx(W,{variant:"contained",size:"large",startIcon:e.jsx(zt,{}),onClick:Vt,children:"목표 만들기"})]})});return e.jsxs(ks,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:785,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden"},children:[e.jsxs($,{sx:{maxWidth:1200,mx:"auto",px:{xs:2,md:4},color:B?"#f8fafc":"#0f172a"},children:[e.jsx("input",{ref:$e,type:"file",accept:".xlsx,.xls",hidden:!0,onChange:as}),e.jsx(b,{direction:"column",spacing:3,children:e.jsxs($,{flex:1,children:[!it&&e.jsxs(b,{spacing:2,width:"100%",children:[cs(),e.jsxs(Y,{variant:"outlined",sx:{borderRadius:2},children:[e.jsx(pe,{title:"엑셀 템플릿 및 데이터",subheader:"목표를 만들기 전에 템플릿을 내려받거나 기존 데이터를 불러올 수 있습니다."}),e.jsx(et,{}),e.jsx(J,{children:e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:1.5,justifyContent:"flex-end",children:[e.jsx(W,{variant:"outlined",startIcon:e.jsx(ht,{}),onClick:Zt,disabled:ve,children:ve?"템플릿 준비 중...":"엑셀 템플릿"}),e.jsx(W,{variant:"outlined",startIcon:e.jsx(ht,{}),onClick:en,disabled:be,children:be?"다운로드 중...":"데이터 다운로드"}),e.jsx(W,{variant:"contained",startIcon:e.jsx(_n,{}),onClick:tn,disabled:ye,children:ye?"불러오는 중...":"데이터 불러오기"})]})})]})]}),it&&e.jsx(b,{spacing:2,children:e.jsxs(Y,{sx:{backgroundColor:De.cardBg},children:[e.jsx(Ot,{value:H,onChange:(t,s)=>ue(s),variant:"scrollable",scrollButtons:"auto",children:Es.map(t=>e.jsx(Ze,{value:t.value,label:t.label,sx:{fontWeight:600}},t.value))}),e.jsx(et,{}),e.jsxs(J,{children:[H==="today"&&e.jsx(Is,{summaryDateKey:Ke,onSummaryDateChange:ss,onSummaryDateShift:ns,summaryData:zn,theme:De,todayRoutineTab:Q,onTodayRoutineTabChange:t=>le(t),routineLists:Nn,viewRecords:xt,routineTimers:x,isViewingToday:Bn,isPastSummaryDate:st,summaryDate:nt,goalsById:qe,openNoteEditor:Hn,toggleRoutineTimer:qn,toggleTimeRoutine:Pn,toggleDurationRoutine:On,getRoutineTargetMinutes:Ee,parseTimeToMinutes:Ce,rowProgressPalette:rs,nowMinutesOfDay:Wn,formatDurationText:Zs,getStatusColor:ls,isRoutineActiveOnDate:Ne}),H==="manage"&&e.jsx(As,{theme:De,activeGoals:oe,archivedGoals:Ln,selectedGoal:we,selectedGoalId:C,onSelectGoal:t=>_(t),onAddGoalClick:Vt,onGoalEdit:Vn,onGoalDelete:es,onGoalUnarchive:Zn,onArchivedGoalDelete:ts,goalRoutines:Be,goalRoutineLists:Gn,routineListTab:v,onRoutineListTabChange:t=>I(t),canRoutineBeEdited:Jt,onRoutineEdit:Un,onRoutineDelete:os,onAddRoutineClick:Jn,downloadingTemplate:ve,downloadingData:be,importingData:ye,onDownloadTemplate:Zt,onDownloadData:en,onImportClick:tn,formatDateDisplay:Pt}),H==="stats"&&e.jsx(_s,{theme:De,isDesktop:n,activeGoals:oe,overallStats:Fn,goalStatsById:gt,formatMinutesLabel:Xs}),H==="settings"&&e.jsx($s,{theme:De,darkMode:B,onToggleDarkMode:t=>S(t)})]})]})})]})})]}),e.jsxs(Ct,{open:re,onClose:bt,fullWidth:!0,maxWidth:"sm",children:[e.jsx(It,{children:se?"목표 수정":"새 목표 추가"}),e.jsxs($,{component:"form",onSubmit:Xn,children:[e.jsxs(Et,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(te,{label:"제목",value:O.title,onChange:t=>K(s=>({...s,title:t.target.value})),required:!0,fullWidth:!0}),e.jsx(te,{label:"설명",value:O.description,onChange:t=>K(s=>({...s,description:t.target.value})),fullWidth:!0,multiline:!0,minRows:2}),e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(te,{label:"시작일",placeholder:"YYYY-MM-DD 또는 20250131",InputLabelProps:{shrink:!0},value:O.startDate,onChange:t=>K(s=>({...s,startDate:t.target.value})),onBlur:Xt("startDate"),inputProps:{inputMode:"numeric"},fullWidth:!0}),e.jsx(te,{label:"종료일",placeholder:"YYYY-MM-DD 또는 20250131",InputLabelProps:{shrink:!0},value:O.endDate,onChange:t=>K(s=>({...s,endDate:t.target.value})),onBlur:Xt("endDate"),inputProps:{inputMode:"numeric"},fullWidth:!0})]})]}),e.jsxs(Tt,{children:[e.jsx(W,{onClick:bt,children:"취소"}),e.jsx(W,{type:"submit",variant:"contained",children:"저장"})]})]})]}),e.jsxs(Ct,{open:L,onClose:yt,fullWidth:!0,maxWidth:"sm",children:[e.jsx(It,{children:ie?"루틴 수정":"루틴 추가"}),e.jsxs($,{component:"form",onSubmit:is,children:[e.jsxs(Et,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(te,{select:!0,label:"목표",value:j.goalId,onChange:t=>A(s=>({...s,goalId:t.target.value})),required:!0,fullWidth:!0,helperText:"이 루틴이 속할 목표를 선택하세요",children:oe.map(t=>e.jsx(Rs,{value:t.id,children:t.title},t.id))}),e.jsx(f,{variant:"subtitle2",children:"루틴 타입"}),e.jsxs(pn,{row:!0,value:j.type,onChange:t=>A(s=>({...s,type:t.target.value})),children:[e.jsx(Re,{value:"time",control:e.jsx(Le,{}),label:"고정시간"}),e.jsx(Re,{value:"duration",control:e.jsx(Le,{}),label:"지속시간"})]}),e.jsx(te,{label:"제목",value:j.title,onChange:t=>A(s=>({...s,title:t.target.value})),required:!0,fullWidth:!0}),e.jsx(te,{label:"카테고리",value:j.category,onChange:t=>A(s=>({...s,category:t.target.value})),fullWidth:!0,placeholder:"예: 건강, 공부"}),e.jsxs($,{children:[e.jsx(f,{variant:"subtitle2",gutterBottom:!0,children:"반복 주기"}),e.jsxs(pn,{value:j.repeatMode,onChange:t=>A(s=>({...s,repeatMode:t.target.value})),children:[e.jsx(Re,{value:"everyday",control:e.jsx(Le,{}),label:"매일"}),e.jsx(Re,{value:"weekday",control:e.jsx(Le,{}),label:"평일"}),e.jsx(Re,{value:"weekend",control:e.jsx(Le,{}),label:"주말"}),e.jsx(Re,{value:"custom",control:e.jsx(Le,{}),label:"직접 선택"})]}),j.repeatMode==="custom"&&e.jsx(Ss,{row:!0,children:Yt.map((t,s)=>e.jsx(Re,{control:e.jsx(Cs,{checked:j.customDays.includes(s),onChange:()=>{A(o=>({...o,customDays:o.customDays.includes(s)?o.customDays.filter(r=>r!==s):[...o.customDays,s]}))}}),label:t},t))})]}),j.type==="time"&&e.jsxs(b,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(te,{label:"시작 시간",type:"text",placeholder:"예: 07:00",InputLabelProps:{shrink:!0},value:j.timeFrom,helperText:"24시간 형식 (HH:MM)",inputProps:Wt,onChange:t=>A(s=>({...s,timeFrom:t.target.value})),fullWidth:!0}),e.jsx(te,{label:"종료 시간",type:"text",placeholder:"예: 07:30",InputLabelProps:{shrink:!0},value:j.timeTo,helperText:"24시간 형식 (HH:MM)",inputProps:Wt,onChange:t=>A(s=>({...s,timeTo:t.target.value})),fullWidth:!0})]}),j.type==="duration"&&e.jsx(te,{label:"목표 분",type:"number",value:j.targetMinutes,onChange:t=>A(s=>({...s,targetMinutes:Number(t.target.value)})),inputProps:{min:5,step:5}}),e.jsxs($,{children:[e.jsx(Re,{control:e.jsx($n,{checked:j.notificationEnabled,onChange:t=>A(s=>({...s,notificationEnabled:t.target.checked}))}),label:"알림 사용"}),j.type==="time"?e.jsx(te,{label:"시작 시간 몇 분 전",type:"number",value:j.notificationLeadMinutes,onChange:t=>A(s=>({...s,notificationLeadMinutes:Number(t.target.value)})),inputProps:{min:0,step:5},disabled:!j.notificationEnabled,fullWidth:!0}):e.jsx(te,{label:"알림 시각",type:"text",placeholder:"예: 21:30",InputLabelProps:{shrink:!0},value:j.notificationAt,helperText:"24시간 형식 (HH:MM)",inputProps:Wt,onChange:t=>A(s=>({...s,notificationAt:t.target.value})),disabled:!j.notificationEnabled,fullWidth:!0})]})]}),e.jsxs(Tt,{children:[e.jsx(W,{onClick:yt,children:"취소"}),e.jsx(W,{type:"submit",variant:"contained",children:"저장"})]})]})]}),e.jsxs(Ct,{open:D,onClose:pt,fullWidth:!0,maxWidth:"sm",children:[e.jsx(It,{children:"메모 편집"}),e.jsx(Et,{children:e.jsx(te,{label:"메모",value:V,onChange:t=>fe(t.target.value),fullWidth:!0,multiline:!0,minRows:3})}),e.jsxs(Tt,{children:[e.jsx(W,{onClick:pt,children:"취소"}),e.jsx(W,{onClick:Kn,variant:"contained",disabled:!ge,children:"저장"})]})]})]})};export{ii as default};
