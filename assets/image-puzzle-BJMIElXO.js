import{j as e,r as i}from"./vendor-CRMzTT1s.js";import{u as xe,b as ue}from"./image-puzzle-utils-DjtHPyLY.js";import{B as n,T as f,a as g,aM as ge,a7 as pe,I as me,bD as fe,S as x,aw as K,an as be,P as je}from"./mui-CTdB6wcY.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";const we=({imageSrc:s,boardWrapperRef:b,showHint:j,showBackground:w,boardWidth:c,boardHeight:S,pieces:v,placements:h,slotOutlines:C,rows:p,cols:m,pieceWidth:k,pieceHeight:y,tabSize:d,paddedWidth:D,paddedHeight:I,viewScale:H,scaledWidth:z,scaledHeight:P,onDragOver:a,onBoardDrop:u,onDropOnBoard:A,onRemovePlacement:V,onPickFile:W})=>e.jsx(n,{sx:{flex:1,minHeight:0,p:1.25,display:"flex",flexDirection:"column",gap:1.25,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"background.paper",overflow:"hidden"},children:s?e.jsxs(n,{sx:{minHeight:0,flex:1,display:"flex",flexDirection:"column",position:"relative",gap:1,minWidth:0},children:[j&&e.jsx(n,{sx:{position:"absolute",top:16,right:16,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"action.hover",overflow:"hidden",width:160,boxShadow:r=>r.shadows[2],zIndex:5},children:e.jsx("img",{src:s,alt:"원본",style:{width:"100%",display:"block"}})}),e.jsx(n,{sx:{flex:1,minHeight:0,position:"relative",width:"100%",maxWidth:"100%"},children:e.jsx(n,{ref:b,onDragOver:a,onDrop:u,sx:{position:"absolute",inset:0,borderRadius:1,borderColor:"divider",overflow:"auto",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",width:"100%",maxWidth:"100%",height:"100%",maxHeight:"100%"},children:e.jsx(n,{sx:{width:z,height:P,position:"relative",flex:"0 0 auto",maxWidth:"none",maxHeight:"none"},children:e.jsxs(n,{sx:{position:"absolute",top:"50%",left:"50%",width:c,height:S,borderRadius:1,border:"1px dashed",borderColor:"divider",overflow:"hidden",backgroundColor:"action.hover",transform:`translate(-50%, -50%) scale(${H})`,transformOrigin:"center"},children:[w&&e.jsx(n,{sx:{position:"absolute",inset:0,backgroundImage:s?`url(${s})`:void 0,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",opacity:s?.2:1}}),e.jsx(n,{sx:{position:"absolute",inset:0,zIndex:3,pointerEvents:"none"},children:C.map(r=>{const l=!!h[r.id];return e.jsx(n,{sx:{position:"absolute",top:r.row*y-d,left:r.col*k-d,width:D,height:I,opacity:l?0:1,transition:"opacity 0.2s ease"},children:e.jsx("svg",{width:"100%",height:"100%",viewBox:`0 0 ${k+d*2} ${y+d*2}`,preserveAspectRatio:"none",children:e.jsx("g",{transform:`translate(${d}, ${d})`,children:e.jsx("path",{d:r.path,fill:"rgba(255,255,255,0.08)",stroke:"rgba(0,0,0,0.2)",strokeWidth:.6})})})},`outline-${r.id}`)})}),e.jsx(n,{sx:{position:"absolute",inset:0,zIndex:2,pointerEvents:"none"},children:v.map(r=>{const l=h[r.id];return l?e.jsx(n,{sx:{position:"absolute",top:l.row*y-d,left:l.col*k-d,width:D,height:I,pointerEvents:"none"},children:e.jsx("img",{src:r.image,alt:"완성조각",draggable:!1,style:{width:"100%",height:"100%",display:"block"}})},`placed-${r.id}`):null})}),e.jsx(n,{sx:{position:"absolute",inset:0,display:"grid",gridTemplateColumns:`repeat(${m}, 1fr)`,gridTemplateRows:`repeat(${p}, 1fr)`,zIndex:4},children:Array.from({length:p*m}).map((r,l)=>{const B=Math.floor(l/m),$=l%m,R=v.find(M=>{const O=h[M.id];return O&&O.row===B&&O.col===$});return e.jsx(n,{onDragOver:a,onDrop:A(B,$),sx:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",bgcolor:R?"rgba(255,255,255,0.05)":"transparent"},children:R&&e.jsx(pe,{title:"조각 되돌리기",children:e.jsx(me,{size:"small",sx:{position:"absolute",top:4,right:4},onClick:()=>V(R.id),children:e.jsx(fe,{fontSize:"inherit"})})})},`slot-${B}-${$}`)})})]})})})})]}):e.jsx(n,{onDragOver:a,onDrop:u,sx:{flex:1,minHeight:0,display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs(n,{sx:{width:"100%",maxWidth:"100%",minHeight:360,borderRadius:1,border:"1px dashed",borderColor:"divider",bgcolor:"action.hover",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:1,textAlign:"center",p:1,height:"100%"},children:[e.jsx(f,{variant:"subtitle1",children:"이미지를 드래그하거나 업로드하세요."}),e.jsx(f,{variant:"body2",color:"text.secondary",children:"이 영역에 이미지를 드래그하거나 버튼을 눌러 파일을 선택하면 퍼즐이 생성됩니다."}),e.jsx(g,{startIcon:e.jsx(ge,{}),variant:"contained",size:"small",onClick:W,children:"이미지 선택"})]})})}),ve=({onPickFile:s,rows:b,cols:j,onRowsChange:w,onColsChange:c,hasImage:S,viewMode:v,viewScale:h,zoomSliderMin:C,zoomSliderMax:p,onOriginalView:m,onFitView:k,onZoomChange:y,onShuffle:d,onReset:D,trayPieces:I,draggingId:H,onDragStart:z,onDragEnd:P})=>e.jsxs(n,{sx:{width:320,flexShrink:0,p:1.25,display:"flex",flexDirection:"column",gap:1.25,minHeight:0,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"background.paper",overflow:"hidden"},children:[e.jsxs(n,{children:[e.jsx(f,{variant:"subtitle2",gutterBottom:!0,children:"퍼즐 크기 (행 / 열)"}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(f,{variant:"body2",children:"행"}),e.jsx(K,{min:2,max:30,value:b,onChange:(a,u)=>w(u),valueLabelDisplay:"auto"})]}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(f,{variant:"body2",children:"열"}),e.jsx(K,{min:2,max:30,value:j,onChange:(a,u)=>c(u),valueLabelDisplay:"auto"})]})]}),S&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{direction:"row",spacing:1,children:[e.jsx(g,{size:"small",variant:v==="original"?"contained":"outlined",onClick:m,children:"원본 사이즈"}),e.jsx(g,{size:"small",variant:v==="fit"?"contained":"outlined",onClick:k,children:"화면에 맞추기"})]}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",sx:{mt:1},children:[e.jsx(f,{variant:"caption",color:"text.secondary",sx:{width:48,textAlign:"center"},children:`${Math.round(h*100)}%`}),e.jsx(K,{size:"small",min:C,max:p,step:.01,value:Math.min(Math.max(h,C),p),onChange:y})]})]}),e.jsxs(x,{direction:"row",spacing:1,children:[e.jsx(g,{fullWidth:!0,startIcon:e.jsx(be,{}),onClick:d,children:"퍼즐 섞기"}),e.jsx(g,{fullWidth:!0,variant:"outlined",onClick:D,children:"초기화"})]}),e.jsxs(n,{sx:{flex:1,minHeight:0},children:[e.jsx(f,{variant:"subtitle2",gutterBottom:!0,children:"퍼즐 조각"}),e.jsx(n,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,p:1,minHeight:160,maxHeight:"calc(100vh - 550px)",overflowY:"auto",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(90px, 1fr))",gap:1},children:I.length===0?e.jsx(f,{variant:"caption",color:"text.secondary",children:"남은 조각이 없습니다."}):I.map(a=>e.jsx(n,{draggable:!0,onDragStart:z(a.id),onDragEnd:P,sx:{border:"1px solid",borderColor:H===a.id?"primary.main":"divider",borderRadius:1,p:.5,bgcolor:"background.paper",cursor:"grab"},children:e.jsx("img",{src:a.image,alt:"조각",style:{width:"100%",display:"block"}})},a.id))})]}),!S&&e.jsx(g,{variant:"contained",onClick:s,children:"이미지 선택"})]}),Re=()=>{const{imageSrc:s,rows:b,cols:j,pieces:w,board:c,placements:S,trayPieces:v,draggingId:h,solved:C,handleFileInput:p,setRows:m,setCols:k,shufflePieces:y,resetPlacements:d,placePiece:D,removePlacement:I,startDrag:H,endDrag:z,acknowledgeSolved:P}=xe(),[a,u]=i.useState(!1),[A,V]=i.useState(!0),W=i.useRef(null),[r,l]=i.useState(1),[B,$]=i.useState(1),[R,M]=i.useState("fit");i.useEffect(()=>{u(!1),V(!0),M("fit"),$(1)},[s]),i.useEffect(()=>{if(!C)return;const t=setTimeout(()=>{alert("축하합니다! 퍼즐을 모두 맞췄어요."),P()},200);return()=>clearTimeout(t)},[C,P]);const O=i.useCallback(t=>o=>{o.dataTransfer.setData("text/plain",t),H(t)},[H]),Q=i.useCallback(()=>{z()},[z]),ee=i.useCallback(t=>{t.preventDefault()},[]),te=i.useCallback((t,o)=>T=>{T.preventDefault();const U=T.dataTransfer.getData("text/plain")||h;U&&D(U,t,o)},[h,D]),Y=i.useCallback(t=>{t&&p(t)},[p]),ie=i.useCallback(t=>{t.preventDefault();const o=t.dataTransfer?.files?.[0];Y(o)},[Y]),_=i.useRef(null),ne=i.useCallback(()=>{M("original"),l(1)},[]),re=i.useCallback(()=>{M("fit"),l(B||1)},[B]),oe=i.useCallback((t,o)=>{const T=Array.isArray(o)?o[0]:o;M("custom"),l(T)},[]),E=c?.width??400,F=c?.height??400,L=c?.pieceWidth??E/Math.max(1,j),Z=c?.pieceHeight??F/Math.max(1,b),q=c?.tabSize??0,se=c?.paddedWidth??L,ae=c?.paddedHeight??Z,le=E*r,de=F*r,G=.25,J=5,ce=i.useMemo(()=>w.map(t=>({id:t.id,row:t.row,col:t.col,path:ue(L,Z,q,t)})),[w,L,Z,q]),N=i.useCallback(()=>{if(!W.current||!E||!F)return;const{clientWidth:t,clientHeight:o}=W.current;if(!t||!o)return;const T=t/E,U=o/F,he=Math.min(T,U),X=Math.min(Math.max(he,G),J);!Number.isFinite(X)||X<=0||($(X),R==="fit"&&l(X))},[E,F,R,G,J]);return i.useEffect(()=>{N()},[N]),i.useEffect(()=>{if(typeof ResizeObserver>"u")return;const t=W.current;if(!t)return;const o=new ResizeObserver(()=>N());return o.observe(t),()=>o.disconnect()},[N]),e.jsx(je,{sx:{p:1.25,display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:785,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden",boxSizing:"border-box"},children:e.jsxs(x,{spacing:2,sx:{height:"100%",minHeight:600,minWidth:0},children:[e.jsxs(x,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsx(x,{direction:"row",spacing:1,alignItems:"center",children:e.jsx(g,{variant:"contained",onClick:()=>_.current?.click(),children:"이미지 올리기"})}),e.jsxs(x,{direction:"row",spacing:1,children:[e.jsx(g,{variant:"outlined",onClick:()=>u(t=>!t),disabled:!s,children:a?"힌트 숨기기":"힌트 보기"}),e.jsx(g,{variant:"outlined",onClick:()=>V(t=>!t),disabled:!s,children:A?"배경 숨기기":"배경 보이기"})]})]}),e.jsxs(x,{direction:"row",spacing:1,sx:{flex:1,minHeight:0,minWidth:0,alignItems:"stretch"},children:[e.jsx("input",{ref:_,hidden:!0,type:"file",accept:"image/*",onChange:t=>{Y(t.target.files?.[0]),t.target.value=""}}),e.jsx(ve,{onPickFile:()=>_.current?.click(),rows:b,cols:j,onRowsChange:m,onColsChange:k,hasImage:!!s,viewMode:R,viewScale:r,zoomSliderMin:G,zoomSliderMax:J,onOriginalView:ne,onFitView:re,onZoomChange:oe,onShuffle:y,onReset:d,trayPieces:v,draggingId:h,onDragStart:O,onDragEnd:Q}),e.jsx(we,{imageSrc:s,boardWrapperRef:W,showHint:a,showBackground:A,boardWidth:E,boardHeight:F,pieces:w,placements:S,slotOutlines:ce,rows:b,cols:j,pieceWidth:L,pieceHeight:Z,tabSize:q,paddedWidth:se,paddedHeight:ae,viewScale:r,scaledWidth:le,scaledHeight:de,onDragOver:ee,onBoardDrop:ie,onDropOnBoard:te,onRemovePlacement:I,onPickFile:()=>_.current?.click()})]})]})})};export{Re as default};
