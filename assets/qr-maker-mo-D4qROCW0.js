import{r,j as e}from"./vendor-CRMzTT1s.js";import{B as a,P as S,a7 as N,a as x,au as jt,al as bt,am as wt,x as yt,y as ke,Y as Ct,a1 as $,ao as Rt,a9 as k,ap as se,n as l,T as o,a3 as le,a4 as ie,af as St,S as g,J as q,I as L,aq as Ie,ar as De,aa as Ee,as as kt,at as We,av as ze,aw as Pe,a6 as Le,k as It,l as Dt,m as Et,o as Wt}from"./mui-COpd2GBn.js";import{u as zt,Q as Me,a as Pt}from"./qr-maker-controller-izNAdlJ4.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";const Lt=[{label:"L (7%)",value:"L"},{label:"M (15%)",value:"M"},{label:"Q (25%)",value:"Q"},{label:"H (30%)",value:"H"}],Mt=[{label:"WPA/WPA2/3",value:"WPA"},{label:"WEP",value:"WEP"},{label:"Open (nopass)",value:"nopass"}],At=[{label:"cover",value:"cover"},{label:"contain",value:"contain"},{label:"stretch",value:"stretch"}],Ae=20,w={dark:"#000000",light:"#ffffff"},Tt=/^#([0-9a-fA-F]{6})$/,Ft=/^#([0-9a-fA-F]{3})$/,D=(m,y)=>{const h=m.trim();return Tt.test(h)?h.toLowerCase():Ft.test(h)?`#${h.slice(1).split("").map(v=>`${v}${v}`).join("").toLowerCase()}`:y},Te=(m,y)=>D(m,y),Fe={width:28,height:28,border:0,p:0,bgcolor:"transparent",cursor:"pointer","&::-webkit-color-swatch-wrapper":{p:0},"&::-webkit-color-swatch":{borderRadius:"50%",border:"1px solid rgba(0,0,0,0.2)"},"&::-moz-color-swatch":{borderRadius:"50%",border:"1px solid rgba(0,0,0,0.2)"}},i={size:"small",margin:"dense"},I={componentsProps:{typography:{variant:"body2"}}},Ut=()=>{const m=r.useRef(null),y=r.useRef(null),h=r.useRef(null),p=r.useRef(null),v=r.useRef(null),G=r.useRef(null),{mode:M,setMode:_e,textDraft:Oe,setTextDraft:Qe,vcardDraft:s,setVcardDraft:d,wifiDraft:f,setWifiDraft:A,isVCardValid:Be,isWifiValid:oe,colorDark:T,setColorDark:E,colorLight:F,setColorLight:W,ecLevel:He,setEcLevel:Ue,withIcon:Ve,setWithIcon:Xe,iconImg:Ne,iconScale:ce,setIconScale:$e,iconMargin:de,setIconMargin:qe,roundIcon:Ge,setRoundIcon:Ke,iconFit:Ye,setIconFit:Je,errorMsg:ue,setErrorMsg:C,exportSize:Ze,setExportSize:et,exportSizeSafe:tt,generateQR:at,resetAll:nt,handleIconFile:rt,clearIcon:st,downloadResult:lt,drawToCanvas:_}=zt(),[xe,it]=r.useState(()=>Math.max(1,window.devicePixelRatio||1)),[K,ot]=r.useState(320),[Y,ct]=r.useState(null),[J,dt]=r.useState("input"),[Z,O]=r.useState(!1),[z,ee]=r.useState(!1),[u,he]=r.useState(""),[pe,P]=r.useState(""),[Q,te]=r.useState(!1),[ut,B]=r.useState(!1);r.useEffect(()=>{let t=0,n=-1;const c=()=>{const R=m.current;if(!R)return;const Se=R.getBoundingClientRect(),X=getComputedStyle(R),ft=(parseFloat(X.paddingLeft)||0)+(parseFloat(X.paddingRight)||0),gt=(parseFloat(X.paddingTop)||0)+(parseFloat(X.paddingBottom)||0),mt=Math.max(0,Se.width-ft-Ae*2),vt=Math.max(0,Se.height-gt-Ae*2),re=Math.floor(Math.max(120,Math.min(mt,vt)));Math.abs(re-n)>.5&&(n=re,ot(re))},b=new ResizeObserver(()=>{cancelAnimationFrame(t),t=requestAnimationFrame(c)});[m.current,y.current,m.current?.parentElement??null].forEach(R=>R&&b.observe(R));const ye=()=>it(Math.max(1,window.devicePixelRatio||1)),Ce=window.matchMedia(`(resolution: ${window.devicePixelRatio||1}dppx)`);Ce.addEventListener?.("change",ye);const Re=()=>{cancelAnimationFrame(t),t=requestAnimationFrame(c)};return c(),window.addEventListener("resize",Re),()=>{b.disconnect(),Ce.removeEventListener?.("change",ye),window.removeEventListener("resize",Re),cancelAnimationFrame(t)}},[]);const H=Y??K,U=r.useMemo(()=>Math.round(H*xe),[H,xe]);r.useEffect(()=>{(async()=>{const n=h.current;if(n)try{await _(n,U),C("")}catch(c){C(c instanceof Error?c.message:"QR을 생성할 수 없습니다.")}})()},[_,U,C]),r.useEffect(()=>{if(!Z)return;let t=0;return t=requestAnimationFrame(()=>{Y===null&&ct(K);const n=h.current;n&&_(n,U).then(()=>C("")).catch(c=>{C(c instanceof Error?c.message:"QR을 생성할 수 없습니다.")})}),()=>cancelAnimationFrame(t)},[Z,_,U,C,K,Y]);const xt=r.useMemo(()=>Te(T,w.dark),[T]),ht=r.useMemo(()=>Te(F,w.light),[F]),fe=typeof window<"u"&&!!window.EyeDropper,ge=typeof window<"u"&&window.isSecureContext&&!!window.BarcodeDetector&&!!navigator.mediaDevices?.getUserMedia,me=t=>{lt(t,h.current)},ve=()=>{at(),O(!0)},j=r.useCallback(()=>{v.current&&(v.current.getTracks().forEach(t=>t.stop()),v.current=null),p.current&&(p.current.srcObject=null),te(!1)},[]),ae=r.useCallback(async()=>{if(P(""),he(""),!(typeof window>"u")){if(!window.isSecureContext){P("보안 연결(HTTPS)에서만 카메라를 사용할 수 있습니다.");return}if(!navigator.mediaDevices?.getUserMedia){P("카메라를 사용할 수 없습니다.");return}if(!window.BarcodeDetector){P("QR 스캔 기능을 지원하지 않는 브라우저입니다.");return}try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});v.current=t,p.current&&(p.current.srcObject=t,await p.current.play()),G.current=new window.BarcodeDetector({formats:["qr_code"]}),te(!0)}catch{P("카메라 권한이 필요합니다."),j()}}},[j]),pt=()=>{ee(!0),B(!1)},je=()=>{ee(!1)},V=r.useCallback(t=>{const n=t.trim();return/^http:\/\//i.test(n)?`https://${n.slice(7)}`:n},[]),be=r.useCallback(t=>{try{const n=new URL(V(t));return n.protocol==="http:"||n.protocol==="https:"}catch{return!1}},[V]);r.useEffect(()=>{if(!z){j();return}return ae(),()=>{j()}},[z,ae,j]),r.useEffect(()=>{if(!z||!Q||!G.current)return;let t=!0;const n=setInterval(async()=>{if(!(!t||!p.current))try{const c=await G.current?.detect(p.current);if(!c||!c.length)return;const b=c[0]?.rawValue??"";if(!b)return;he(b),B(!0),te(!1),j()}catch{}},400);return()=>{t=!1,clearInterval(n)}},[z,Q,j]);const we=r.useCallback(async t=>{if(!(typeof window>"u"||!window.EyeDropper))try{const c=await new window.EyeDropper().open(),b=w[t],ne=D(c?.sRGBHex??"",b);t==="dark"?E(ne):W(ne)}catch(n){if(n instanceof DOMException&&n.name==="AbortError")return}},[E,W]);return e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:0,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden",boxSizing:"border-box"},children:[e.jsx(S,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:1},children:[e.jsx(N,{title:ge?"":"카메라 기능은 HTTPS 및 지원 브라우저에서만 사용할 수 있습니다.",children:e.jsx("span",{children:e.jsx(x,{variant:"outlined",startIcon:e.jsx(jt,{}),onClick:pt,disabled:!ge,children:"QR 확인"})})}),e.jsx(x,{variant:"contained",startIcon:e.jsx(bt,{}),onClick:ve,children:"QR 생성"}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(wt,{}),onClick:nt,children:"초기화"})]})}),e.jsxs(S,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:[e.jsxs(yt,{value:J,onChange:(t,n)=>dt(n),variant:"fullWidth",sx:{minHeight:36},children:[e.jsx(ke,{value:"input",label:"입력",sx:{minHeight:36,py:.5,fontWeight:600}}),e.jsx(ke,{value:"options",label:"옵션",sx:{minHeight:36,py:.5,fontWeight:600}})]}),e.jsx(Ct,{sx:{my:1}}),J==="input"&&e.jsxs(a,{children:[e.jsx($,{sx:{mt:0},children:e.jsxs(Rt,{row:!0,value:M,onChange:(t,n)=>_e(n??"text"),children:[e.jsx(k,{value:"text",control:e.jsx(se,{size:"small"}),label:"텍스트 / URL",...I}),e.jsx(k,{value:"vcard",control:e.jsx(se,{size:"small"}),label:"연락처 (vCard)",...I}),e.jsx(k,{value:"wifi",control:e.jsx(se,{size:"small"}),label:"Wi-Fi",...I})]})}),M==="text"&&e.jsx(a,{mt:1,display:"flex",flexDirection:"column",gap:1,children:e.jsx(l,{...i,label:"텍스트 / URL",value:Oe,onChange:t=>Qe(t.target.value),fullWidth:!0,multiline:!0,minRows:3,helperText:"⌘/Ctrl + Enter 로 빠르게 생성",onKeyDown:t=>{(t.metaKey||t.ctrlKey)&&t.key==="Enter"&&(t.preventDefault(),ve())}})}),M==="vcard"&&e.jsxs(a,{mt:1,display:"flex",flexDirection:"column",gap:0,children:[e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"성",value:s.lastName,onChange:t=>d({...s,lastName:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"이름",value:s.firstName,onChange:t=>d({...s,firstName:t.target.value}),fullWidth:!0})]}),e.jsx(l,{...i,label:"회사/조직",value:s.org,onChange:t=>d({...s,org:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"직함",value:s.title,onChange:t=>d({...s,title:t.target.value}),fullWidth:!0}),e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"휴대전화",value:s.mobile,onChange:t=>d({...s,mobile:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"전화",value:s.phone,onChange:t=>d({...s,phone:t.target.value}),fullWidth:!0})]}),e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"이메일",value:s.email,onChange:t=>d({...s,email:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"웹사이트",value:s.url,onChange:t=>d({...s,url:t.target.value}),fullWidth:!0})]}),e.jsx(l,{...i,label:"주소",value:s.street,onChange:t=>d({...s,street:t.target.value}),fullWidth:!0}),e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"도시",value:s.city,onChange:t=>d({...s,city:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"지역/주",value:s.region,onChange:t=>d({...s,region:t.target.value}),fullWidth:!0})]}),e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"우편번호",value:s.postal,onChange:t=>d({...s,postal:t.target.value}),fullWidth:!0}),e.jsx(l,{...i,label:"국가",value:s.country,onChange:t=>d({...s,country:t.target.value}),fullWidth:!0})]}),e.jsx(l,{...i,label:"메모",value:s.note,onChange:t=>d({...s,note:t.target.value}),fullWidth:!0,multiline:!0,minRows:2}),!Be&&e.jsx(o,{variant:"caption",color:"error",children:"이름/회사 1개 이상과 전화·휴대전화·이메일 중 1개 이상을 입력하세요."})]}),M==="wifi"&&e.jsxs(a,{mt:1,display:"flex",flexDirection:"column",gap:0,children:[e.jsx(l,{...i,label:"SSID",value:f.ssid,onChange:t=>A({...f,ssid:t.target.value}),fullWidth:!0}),e.jsxs(a,{display:"flex",gap:1,alignItems:"center",children:[e.jsx($,{fullWidth:!0,margin:"dense",size:"small",children:e.jsx(le,{value:f.security,onChange:t=>A({...f,security:t.target.value}),size:"small",children:Mt.map(t=>e.jsx(ie,{value:t.value,children:t.label},t.value))})}),e.jsx(l,{...i,label:"비밀번호",type:"password",value:f.password,onChange:t=>A({...f,password:t.target.value}),fullWidth:!0,disabled:f.security==="nopass"})]}),e.jsx(k,{...I,control:e.jsx(St,{size:"small",checked:f.hidden,onChange:t=>A({...f,hidden:t.target.checked})}),label:"SSID 숨김"}),e.jsx(o,{variant:"caption",color:oe?"success.main":"error",children:oe?"Wi-Fi QR 생성 가능":"SSID와 비밀번호를 확인하세요."})]}),ue&&e.jsx(o,{variant:"body2",color:"error",mt:1,children:ue})]}),J==="options"&&e.jsxs(g,{spacing:1.25,children:[e.jsxs(a,{display:"flex",gap:1,children:[e.jsx(l,{...i,label:"QR",value:T,onChange:t=>E(t.target.value),onBlur:()=>E(D(T,w.dark)),InputProps:{startAdornment:e.jsx(q,{position:"start",children:e.jsx(De,{fontSize:"small"})}),endAdornment:e.jsx(q,{position:"end",sx:{pl:1},children:e.jsxs(g,{direction:"row",spacing:.5,alignItems:"center",children:[fe&&e.jsx(N,{title:"스포이드로 화면에서 색상 선택",children:e.jsx(L,{size:"small",onClick:()=>we("dark"),"aria-label":"QR 색상 스포이드",children:e.jsx(Ie,{fontSize:"small"})})}),e.jsx(a,{component:"input",type:"color",value:xt,onChange:t=>E(D(t.target.value,w.dark)),"aria-label":"QR color picker",title:"QR 색상 선택",sx:Fe})]})})},fullWidth:!0}),e.jsx(l,{...i,label:"Background",value:F,onChange:t=>W(t.target.value),onBlur:()=>W(D(F,w.light)),InputProps:{startAdornment:e.jsx(q,{position:"start",children:e.jsx(De,{fontSize:"small"})}),endAdornment:e.jsx(q,{position:"end",sx:{pl:1},children:e.jsxs(g,{direction:"row",spacing:.5,alignItems:"center",children:[fe&&e.jsx(N,{title:"스포이드로 화면에서 색상 선택",children:e.jsx(L,{size:"small",onClick:()=>we("light"),"aria-label":"Background 색상 스포이드",children:e.jsx(Ie,{fontSize:"small"})})}),e.jsx(a,{component:"input",type:"color",value:ht,onChange:t=>W(D(t.target.value,w.light)),"aria-label":"Background color picker",title:"Background 색상 선택",sx:Fe})]})})},fullWidth:!0})]}),e.jsxs($,{fullWidth:!0,children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"에러 보정(EC Level)"}),e.jsx(le,{value:He,onChange:t=>Ue(t.target.value),size:"small",children:Lt.map(t=>e.jsx(ie,{value:t.value,children:t.label},t.value))})]}),e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:1,children:[e.jsx(k,{...I,control:e.jsx(Ee,{size:"small",checked:Ve,onChange:t=>Xe(t.target.checked)}),label:"아이콘 사용"}),e.jsx(k,{...I,control:e.jsx(Ee,{size:"small",checked:Ge,onChange:t=>Ke(t.target.checked)}),label:"아이콘 둥글게",sx:{ml:0}})]}),e.jsxs(a,{display:"flex",gap:1,alignItems:"center",children:[e.jsx(N,{title:"아이콘 업로드",children:e.jsxs(L,{component:"label",size:"small",children:[e.jsx(kt,{}),e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:t=>rt(t.target.files?.[0]??null)})]})}),Ne&&e.jsx(x,{size:"small",onClick:st,children:"아이콘 제거"})]}),e.jsxs(a,{children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"baseline",sx:{mb:.5},children:[e.jsx(o,{variant:"body2",children:"아이콘 크기"}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:[Math.round(ce*100),"%"]})]}),e.jsx(We,{value:ce,onChange:(t,n)=>$e(n),min:.05,max:.35,step:.01})]}),e.jsxs(a,{children:[e.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"baseline",sx:{mb:.5},children:[e.jsx(o,{variant:"body2",children:"아이콘 여백"}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:[de.toFixed(0),"px"]})]}),e.jsx(We,{value:de,onChange:(t,n)=>qe(n),min:0,max:20,step:1})]}),e.jsxs($,{fullWidth:!0,children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"아이콘 맞춤"}),e.jsx(le,{value:Ye,onChange:t=>Je(t.target.value),size:"small",children:At.map(t=>e.jsx(ie,{value:t.value,children:t.label},t.value))})]})]})]}),e.jsx(ze,{anchor:"bottom",open:Z,onOpen:()=>O(!0),onClose:()=>O(!1),disableDiscovery:!0,swipeAreaWidth:56,ModalProps:{keepMounted:!0},PaperProps:{sx:{borderTopLeftRadius:16,borderTopRightRadius:16,maxHeight:"80vh",height:"80vh",overflow:"hidden"}},children:e.jsxs(a,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(a,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",px:2,pt:1.5,pb:1},children:[e.jsx(a,{sx:{width:36,height:4,borderRadius:999,bgcolor:"divider",position:"absolute",left:"50%",top:8,transform:"translateX(-50%)"}}),e.jsx(o,{variant:"subtitle1",fontWeight:600,children:"QR 미리보기"}),e.jsx(L,{size:"small",onClick:()=>O(!1),children:e.jsx(Pe,{fontSize:"small"})})]}),e.jsx(a,{sx:{px:2,pb:2,overflowY:"auto"},children:e.jsxs(g,{spacing:1.25,children:[e.jsx(S,{ref:m,sx:{p:2,borderRadius:1,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",minHeight:320},children:e.jsx(a,{ref:y,sx:{width:`${H}px`,height:`${H}px`,maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("canvas",{ref:h,style:{width:"100%",height:"100%",imageRendering:"crisp-edges",display:"block",borderRadius:8,background:"#fff",boxShadow:"0 8px 24px rgba(0,0,0,0.06)"}})})}),e.jsx(S,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(g,{spacing:1,children:[e.jsx(l,{label:`내보내기 (최대 ${Me.toLocaleString()}px)`,type:"number",value:Ze,onChange:t=>et(Number(t.target.value||Pt)),inputProps:{min:64,max:Me,step:1.25},size:"small"}),e.jsxs(g,{direction:"row",spacing:1,children:[e.jsx(x,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(Le,{}),onClick:()=>me("png"),children:"PNG"}),e.jsx(x,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(Le,{}),onClick:()=>me("svg"),children:"SVG"})]}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:["결과 크기: ",tt.toLocaleString(),"px"]})]})})]})})]})}),e.jsx(ze,{anchor:"bottom",open:z,onOpen:()=>ee(!0),onClose:je,disableDiscovery:!0,swipeAreaWidth:56,ModalProps:{keepMounted:!0},PaperProps:{sx:{borderTopLeftRadius:16,borderTopRightRadius:16,maxHeight:"85vh",height:"85vh",overflow:"hidden"}},children:e.jsxs(a,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(a,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",px:2,pt:1.5,pb:1},children:[e.jsx(a,{sx:{width:36,height:4,borderRadius:999,bgcolor:"divider",position:"absolute",left:"50%",top:8,transform:"translateX(-50%)"}}),e.jsx(o,{variant:"subtitle1",fontWeight:600,children:"QR 확인"}),e.jsx(L,{size:"small",onClick:je,children:e.jsx(Pe,{fontSize:"small"})})]}),e.jsx(a,{sx:{px:2,pb:2,overflowY:"auto"},children:e.jsxs(g,{spacing:1.25,children:[e.jsxs(S,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:[e.jsx(a,{sx:{width:"100%",aspectRatio:"3 / 4",borderRadius:1,overflow:"hidden",bgcolor:"grey.900",display:"flex",alignItems:"center",justifyContent:"center"},children:pe?e.jsx(o,{variant:"body2",color:"error",sx:{px:2,textAlign:"center"},children:pe}):e.jsx("video",{ref:p,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs(g,{direction:"row",spacing:1,sx:{mt:1},children:[e.jsx(x,{variant:"outlined",size:"small",onClick:ae,disabled:Q,children:"다시 스캔"}),Q&&e.jsx(o,{variant:"caption",color:"text.secondary",sx:{alignSelf:"center"},children:"스캔 중..."})]})]}),e.jsx(S,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(g,{spacing:1,children:[e.jsx(o,{variant:"subtitle2",children:"결과"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:u||"QR을 스캔하면 내용이 표시됩니다."}),e.jsx(x,{variant:"contained",size:"small",disabled:!u||!be(u),onClick:()=>{u&&window.open(V(u),"_blank","noopener")},children:"링크 열기"})]})})]})})]})}),e.jsxs(It,{open:ut,onClose:()=>B(!1),fullWidth:!0,children:[e.jsx(Dt,{children:"QR 내용"}),e.jsx(Et,{dividers:!0,children:e.jsx(o,{variant:"body2",color:"text.secondary",children:u||"QR을 스캔하면 내용이 표시됩니다."})}),e.jsxs(Wt,{children:[e.jsx(x,{onClick:()=>B(!1),children:"닫기"}),e.jsx(x,{variant:"contained",disabled:!u||!be(u),onClick:()=>{u&&window.open(V(u),"_blank","noopener")},children:"링크 열기"})]})]})]})};export{Ut as default};
