import{r as n,j as e}from"./vendor-CRMzTT1s.js";import{B as o,P as A,a9 as ft,a as f,aq as pt,ao as xt,ap as gt,y as mt,z as le,g as vt,ar as de,T as p,I as ue,N as he,S,o as wt,ae as fe,l as pe,m as xe,n as ge,p as me}from"./mui-CPA928Wz.js";import{u as jt,g as bt,n as Rt,b as yt,c as Ct,Q as ve,a as St,P as we}from"./qr-maker-options-panel-B-O5Gxlp.js";import"./excel-CUMakpxJ.js";import"./tree-sitter-aGyQ8e2w.js";let Y=null;const Dt=async()=>{if(typeof window>"u")throw new Error("QR 스캔은 브라우저 환경에서만 사용할 수 있습니다.");return window.jsQR?window.jsQR:(Y||(Y=new Promise((m,b)=>{const i=document.createElement("script");i.src="/libs/jsQR.min.js",i.async=!0,i.onload=()=>{window.jsQR?m(window.jsQR):b(new Error("QR 스캔 스크립트를 불러올 수 없습니다."))},i.onerror=()=>b(new Error("QR 스캔 스크립트를 불러올 수 없습니다.")),document.head.appendChild(i)})),Y)},Qt=()=>{const m=n.useRef(null),b=n.useRef(null),i=n.useRef(null),c=n.useRef(null),D=n.useRef(null),R=n.useRef(null),I=n.useRef(null),W=n.useRef(null),{mode:je,setMode:be,textDraft:Re,setTextDraft:ye,vcardDraft:Ce,setVcardDraft:Se,wifiDraft:De,setWifiDraft:Ie,isVCardValid:Ee,isWifiValid:ke,colorDark:Me,setColorDark:L,colorLight:Pe,setColorLight:O,ecLevel:Qe,setEcLevel:Te,withIcon:ze,setWithIcon:Fe,iconImg:Ae,iconScale:We,setIconScale:Le,iconMargin:Oe,setIconMargin:He,roundIcon:Be,setRoundIcon:Ve,iconFit:_e,setIconFit:qe,errorMsg:H,setErrorMsg:g,exportSize:Ue,setExportSize:Xe,exportSizeSafe:Ge,generateQR:Ne,resetAll:$e,handleIconFile:Ye,clearIcon:Je,downloadResult:Ke,drawToCanvas:E}=jt(),[J,Ze]=n.useState(()=>Math.max(1,window.devicePixelRatio||1)),[B,et]=n.useState(320),[V,tt]=n.useState(null),[_,nt]=n.useState("input"),[q,v]=n.useState(!1),[K,k]=n.useState(!1),[x,U]=n.useState(!1),[y,X]=n.useState(""),[Z,C]=n.useState(""),[w,M]=n.useState(!1),[rt,G]=n.useState(!1),[st,ee]=n.useState(!1);n.useEffect(()=>{let t=0,r=-1;const s=()=>{const h=m.current;if(!h)return;const ce=h.getBoundingClientRect(),F=getComputedStyle(h),lt=(parseFloat(F.paddingLeft)||0)+(parseFloat(F.paddingRight)||0),dt=(parseFloat(F.paddingTop)||0)+(parseFloat(F.paddingBottom)||0),ut=Math.max(0,ce.width-lt-we*2),ht=Math.max(0,ce.height-dt-we*2),$=Math.floor(Math.max(120,Math.min(ut,ht)));Math.abs($-r)>.5&&(r=$,et($))},a=new ResizeObserver(()=>{cancelAnimationFrame(t),t=requestAnimationFrame(s)});[m.current,b.current,m.current?.parentElement??null].forEach(h=>h&&a.observe(h));const u=()=>Ze(Math.max(1,window.devicePixelRatio||1)),j=window.matchMedia(`(resolution: ${window.devicePixelRatio||1}dppx)`);j.addEventListener?.("change",u);const z=()=>{cancelAnimationFrame(t),t=requestAnimationFrame(s)};return s(),window.addEventListener("resize",z),()=>{a.disconnect(),j.removeEventListener?.("change",u),window.removeEventListener("resize",z),cancelAnimationFrame(t)}},[]);const P=V??B,Q=n.useMemo(()=>Math.round(P*J),[P,J]);n.useEffect(()=>{(async()=>{const r=i.current;if(r)try{await E(r,Q),g(""),K&&(v(!0),k(!1))}catch(s){g(s instanceof Error?s.message:"QR을 생성할 수 없습니다."),k(!1)}})()},[E,Q,g,K]),n.useEffect(()=>{if(!q)return;let t=0;return t=requestAnimationFrame(()=>{V===null&&tt(B);const r=i.current;r&&E(r,Q).then(()=>g("")).catch(s=>{g(s instanceof Error?s.message:"QR을 생성할 수 없습니다.")})}),()=>cancelAnimationFrame(t)},[q,E,Q,g,B,V]);const at=typeof window<"u"&&!!window.EyeDropper,te=typeof window<"u"&&window.isSecureContext&&!!navigator.mediaDevices?.getUserMedia,ne=t=>{Ke(t,i.current)},re=()=>{if(!Ne()){k(!1),v(!1);return}k(!0)},d=n.useCallback(()=>{D.current&&(D.current.getTracks().forEach(t=>t.stop()),D.current=null),c.current&&(c.current.srcObject=null),R.current=null,M(!1)},[]),T=n.useCallback(async()=>{if(C(""),X(""),!(typeof window>"u")){if(!window.isSecureContext){C("보안 연결(HTTPS)에서만 카메라를 사용할 수 있습니다.");return}if(!navigator.mediaDevices?.getUserMedia){C("카메라를 사용할 수 없습니다.");return}try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});D.current=t,c.current&&(c.current.srcObject=t,await c.current.play()),window.BarcodeDetector?R.current=new window.BarcodeDetector({formats:["qr_code"]}):I.current=await Dt(),M(!0)}catch(t){t instanceof Error&&t.message?C(t.message):C("카메라 권한이 필요합니다."),d()}}},[d]),ot=()=>{U(!0)},se=()=>{U(!1)},ae=()=>{G(!1),x&&T()},N=n.useCallback(t=>{const r=t.trim();return/^http:\/\//i.test(r)?`https://${r.slice(7)}`:r},[]),it=n.useCallback(t=>{try{const r=new URL(N(t));return r.protocol==="http:"||r.protocol==="https:"}catch{return!1}},[N]);n.useEffect(()=>{if(!x){d();return}return T(),()=>{d()}},[x,T,d]),n.useEffect(()=>{if(!x||!w||!R.current)return;let t=!0;const r=setInterval(async()=>{if(!(!t||!c.current))try{const s=await R.current?.detect(c.current);if(!s||!s.length)return;const a=s[0]?.rawValue??"";if(!a)return;X(a),G(!0),M(!1),d()}catch{}},400);return()=>{t=!1,clearInterval(r)}},[x,w,d]),n.useEffect(()=>{if(!x||!w||R.current||!I.current)return;let t=!0;const r=setInterval(()=>{if(!t||!c.current||!I.current)return;const s=c.current,a=s.videoWidth,l=s.videoHeight;if(!a||!l)return;W.current||(W.current=document.createElement("canvas"));const u=W.current;if(!u)return;(u.width!==a||u.height!==l)&&(u.width=a,u.height=l);const j=u.getContext("2d");if(!j)return;j.drawImage(s,0,0,a,l);const z=j.getImageData(0,0,a,l),h=I.current(z.data,a,l);h?.data&&(X(h.data),G(!0),M(!1),d())},500);return()=>{t=!1,clearInterval(r)}},[x,w,d]);const ct=n.useCallback(async t=>{if(!(typeof window>"u"||!window.EyeDropper))try{const s=await new window.EyeDropper().open(),a=bt(t),l=Rt(s?.sRGBHex??"",a);t==="dark"?L(l):O(l)}catch(r){if(r instanceof DOMException&&r.name==="AbortError")return}},[L,O]),oe=n.useCallback(()=>{const t=i.current;if(!t)return;t.getContext("2d")?.clearRect(0,0,t.width,t.height)},[]);n.useEffect(()=>{H&&(oe(),v(!1),ee(!0))},[H,oe]);const ie=()=>{ee(!1),g("")};return e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:1.25,flex:1,minHeight:0,height:"100%",width:1,maxWidth:"100%",overflowX:"hidden",boxSizing:"border-box"},children:[e.jsx(A,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[e.jsx(ft,{title:te?"":"카메라 기능은 HTTPS 및 지원 브라우저에서만 사용할 수 있습니다.",children:e.jsx("span",{children:e.jsx(f,{variant:"outlined",startIcon:e.jsx(pt,{}),onClick:ot,disabled:!te,children:"QR 확인"})})}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(f,{variant:"contained",startIcon:e.jsx(xt,{}),onClick:re,children:"QR 생성"}),e.jsx(f,{variant:"outlined",startIcon:e.jsx(gt,{}),onClick:$e,children:"초기화"})]})]})}),e.jsxs(A,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:[e.jsxs(mt,{value:_,onChange:(t,r)=>nt(r),variant:"fullWidth",sx:{minHeight:36},children:[e.jsx(le,{value:"input",label:"입력",sx:{minHeight:36,py:.5,fontWeight:600}}),e.jsx(le,{value:"options",label:"옵션",sx:{minHeight:36,py:.5,fontWeight:600}})]}),e.jsx(vt,{sx:{my:1}}),_==="input"&&e.jsx(yt,{mode:je,onModeChange:be,textDraft:Re,onTextChange:ye,vcardDraft:Ce,onVcardChange:Se,wifiDraft:De,onWifiChange:Ie,isVCardValid:Ee,isWifiValid:ke,onQuickGenerate:re}),_==="options"&&e.jsx(Ct,{colorDark:Me,onColorDarkChange:L,colorLight:Pe,onColorLightChange:O,ecLevel:Qe,onEcLevelChange:Te,withIcon:ze,onWithIconChange:Fe,roundIcon:Be,onRoundIconChange:Ve,hasIcon:!!Ae,onIconFile:Ye,onClearIcon:Je,iconScale:We,onIconScaleChange:Le,iconMargin:Oe,onIconMarginChange:He,iconFit:_e,onIconFitChange:qe,eyeDropperAvailable:at,onEyeDropper:ct})]}),e.jsx(de,{anchor:"bottom",open:q,onOpen:()=>v(!0),onClose:()=>v(!1),disableDiscovery:!0,swipeAreaWidth:56,ModalProps:{keepMounted:!0},PaperProps:{sx:{borderTopLeftRadius:16,borderTopRightRadius:16,maxHeight:"80vh",height:"80vh",overflow:"hidden"}},children:e.jsxs(o,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(o,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",px:2,pt:1.5,pb:1},children:[e.jsx(o,{sx:{width:36,height:4,borderRadius:999,bgcolor:"divider",position:"absolute",left:"50%",top:8,transform:"translateX(-50%)"}}),e.jsx(p,{variant:"subtitle1",fontWeight:600,children:"QR 미리보기"}),e.jsx(ue,{size:"small",onClick:()=>v(!1),children:e.jsx(he,{fontSize:"small"})})]}),e.jsx(o,{sx:{px:2,pb:2,overflowY:"auto"},children:e.jsxs(S,{spacing:1.25,children:[e.jsx(A,{ref:m,sx:{p:2,borderRadius:1,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",minHeight:320},children:e.jsx(o,{ref:b,sx:{width:`${P}px`,height:`${P}px`,maxWidth:"100%",maxHeight:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("canvas",{ref:i,style:{width:"100%",height:"100%",imageRendering:"crisp-edges",display:"block",borderRadius:8,background:"#fff",boxShadow:"0 8px 24px rgba(0,0,0,0.06)"}})})}),e.jsx(A,{sx:{p:2,borderRadius:1,overflow:"hidden"},children:e.jsxs(S,{spacing:1,children:[e.jsx(wt,{label:`내보내기 (최대 ${ve.toLocaleString()}px)`,type:"number",value:Ue,onChange:t=>Xe(Number(t.target.value||St)),inputProps:{min:64,max:ve,step:1.25},size:"small"}),e.jsxs(S,{direction:"row",spacing:1,children:[e.jsx(f,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(fe,{}),onClick:()=>ne("png"),children:"PNG"}),e.jsx(f,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(fe,{}),onClick:()=>ne("svg"),children:"SVG"})]}),e.jsxs(p,{variant:"caption",color:"text.secondary",children:["결과 크기: ",Ge.toLocaleString(),"px"]})]})})]})})]})}),e.jsx(de,{anchor:"bottom",open:x,onOpen:()=>U(!0),onClose:se,disableDiscovery:!0,swipeAreaWidth:56,ModalProps:{keepMounted:!0},PaperProps:{sx:{borderTopLeftRadius:16,borderTopRightRadius:16,maxHeight:"calc(85vh - 10px)",height:"calc(85vh - 10px)",overflow:"hidden"}},children:e.jsxs(o,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(o,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",px:2,pt:1.5,pb:1},children:[e.jsx(o,{sx:{width:36,height:4,borderRadius:999,bgcolor:"divider",position:"absolute",left:"50%",top:8,transform:"translateX(-50%)"}}),e.jsx(p,{variant:"subtitle1",fontWeight:600,children:"QR 확인"}),e.jsx(ue,{size:"small",onClick:se,children:e.jsx(he,{fontSize:"small"})})]}),e.jsx(o,{sx:{px:2,pb:2,flex:1,minHeight:0,overflow:"hidden"},children:e.jsxs(S,{spacing:1.25,sx:{height:"100%"},children:[e.jsx(o,{sx:{width:"100%",aspectRatio:"3 / 4",borderRadius:1,overflow:"hidden",bgcolor:"grey.900",display:"flex",alignItems:"center",justifyContent:"center"},children:Z?e.jsx(p,{variant:"body2",color:"error",sx:{px:2,textAlign:"center"},children:Z}):e.jsx("video",{ref:c,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}})}),e.jsxs(S,{direction:"row",spacing:1,children:[e.jsx(f,{variant:"outlined",size:"small",onClick:T,disabled:w,children:"다시 스캔"}),w&&e.jsx(p,{variant:"caption",color:"text.secondary",sx:{alignSelf:"center"},children:"스캔 중..."})]})]})})]})}),e.jsxs(pe,{open:rt,onClose:ae,fullWidth:!0,PaperProps:{sx:{maxHeight:"80vh"}},children:[e.jsx(xe,{sx:{py:1.5},children:e.jsx(p,{variant:"subtitle1",fontWeight:600,children:"QR 확인"})}),e.jsxs(ge,{dividers:!0,sx:{maxHeight:"60vh",overflowY:"auto"},children:[e.jsx(p,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:1},children:"QR 결과"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:y||"QR을 스캔하면 내용이 표시됩니다."})]}),e.jsxs(me,{children:[e.jsx(f,{onClick:ae,children:"닫기"}),e.jsx(f,{variant:"contained",disabled:!y||!it(y),onClick:()=>{y&&window.open(N(y),"_blank","noopener")},children:"링크 열기"})]})]}),e.jsxs(pe,{open:st,onClose:ie,fullWidth:!0,children:[e.jsx(xe,{children:"오류"}),e.jsx(ge,{dividers:!0,children:e.jsx(p,{variant:"body2",color:"text.secondary",children:H||"오류가 발생했습니다."})}),e.jsx(me,{children:e.jsx(f,{onClick:ie,children:"닫기"})})]})]})};export{Qt as default};
